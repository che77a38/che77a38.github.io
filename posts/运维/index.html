<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>运维 | ZEROKO14的个人博客</title><meta name="keywords" content="运维"><meta name="author" content="ZEROKO14"><meta name="copyright" content="ZEROKO14"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="运维"><meta name="application-name" content="运维"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="运维"><meta property="og:url" content="https://che77a38.github.io/posts/%E8%BF%90%E7%BB%B4/index.html"><meta property="og:site_name" content="ZEROKO14的个人博客"><meta property="og:description" content="记录一些简单的运维知识   国内注册域名后要先实名认证后，使用国内的服务器时，网站还需要在工信部，网安备案 在国内域名商购买了域名，解析的主机或服务器也在国内时，则必须备案通过后才能访问 海外域名，就只能用国外或香港主机&amp;#x2F;服务器，不能解析到国内的服务器 运维相关好用工具iperf3iPer"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta property="article:author" content="ZEROKO14"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta name="description" content="记录一些简单的运维知识   国内注册域名后要先实名认证后，使用国内的服务器时，网站还需要在工信部，网安备案 在国内域名商购买了域名，解析的主机或服务器也在国内时，则必须备案通过后才能访问 海外域名，就只能用国外或香港主机&amp;#x2F;服务器，不能解析到国内的服务器 运维相关好用工具iperf3iPer"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://che77a38.github.io/posts/%E8%BF%90%E7%BB%B4/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: ZEROKO14","link":"链接: ","source":"来源: ZEROKO14的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZEROKO14的个人博客',
  title: '运维',
  postAI: '',
  pageFillDescription: '运维相关好用工具, iperf3, 安装, 威联通安装方式, 使用, 关于ECC, Windows上的运维指令盘点, Windows事件查看器, 核心功能与作用, 打开方式, 网站快速部署方案, Linux控制面板, Websoft9, 部署自己的项目, 临时公共子域名, Coolify, 免费云服务器盘点, 开源自托管项目盘点, git服务器, GitLab, gitbucket, Gitea, docker部署Gitea, 权限注意事项, 将其他项目迁移到gitea流程, 删除原始凭证(可选), 迁移流程, gitea配置, 内外网域名统一设置, Gitea链接内外网显示一致, 内外网访问一致, 最终效果, 内外网域名统一设置标准流程, 为内网环境部署HTTPS证书, 需要配置自动续期, 配置内网Nginx HTTPS反向代理, 群晖Nginx, 内网DNS解析, gitea分支保护配置, 生产分支, 开发分支, 分支命名规范, 实际保护配置, certbot, 安装流程, docker方案部署流程, 获取cloudflare api token, 下载运行镜像申请证书, 自动续期, 使用证书, 群晖中使用证书, 为Gitea本身配置SSL证书, Jenkins, 私有云平台, Nextcloud, copyparty, 域名相关, 个人域名购买, 域名商, 将购买的域名连接到Cloudflare, SSL证书购买, 网站备案（ICP备案）, 费用总结, 公网ip申请, 公网ip解决方案, 解决ipv4访问ipv6服务器的问题解决方案, 替代方案, IPv6, 查看是否支持ipv6, 路由器开启ipv6支持, 群晖nas开启ipv6, 解决动态变化的IPv6地址, 内网穿透方案, 内网穿透, cloudflare方案, 群晖部署Cloudflare Tunnel, 自建服务器内网穿透, 无限邮域名, 技巧记录, 路由器配置, 静态ip注意, 路由器防火墙, 网络设备盘点, 云管理交换机, VLAN, 工作原理, TL-SG2024D, 局域网扫描工具, 部署问题盘点, 群晖默认nginx与docker nginx端口冲突, 使用独立IP方案, macvlan, 工作原理, 优缺点, 使宿主机能和macvlan容器互通(可选)记录一些简单的运维知识国内注册域名后要先实名认证后使用国内的服务器时网站还需要在工信部网安备案在国内域名商购买了域名解析的主机或服务器也在国内时则必须备案通过后才能访问海外域名就只能用国外或香港主机服务器不能解析到国内的服务器运维相关好用工具是一个支持跨平台部署使用的网络性能测量工具它可以创建数据流测量两端之间单向或双向的网络吞吐量安装官网下载链接版下载链接安卓下载地址内含功能威联通参考安装方式威联通安装方式网络环境新增一个端口主机和容器都选择一般默认的端口也是在命令行里输入这个是开启监听端口的命令这样其他设备才能通过命令访问的端口总览使用启动服务端启动客户端服务端地址表示启用线程反转数据流方向数据从服务端发向客户端表示测试时长秒保存文件名设置导出为文件设置后测试结果就不会在命令行中展示了关于内存是一种能够自动检测和修正内存错误的技术它通过添加额外的位来存储数据从而能够识别和纠正单比特错误这在服务器和关键任务系统中尤其重要因为这些系统对数据的准确性和可靠性有很高的要求内存的主要优点包括数据完整性能够自动检测并修正内存中的错误从而减少数据损坏的风险系统稳定性提高系统的稳定性减少由于内存错误导致的崩溃或数据丢失的可能性适用于关键应用在需要高可靠性的环境中如金融医疗和科学计算等领域内存是一个理想的选择全世界的商用级服务器都在使用内存纠错内存条的区别主要在于内存条其中一面的一个额外的内存颗粒上这个颗粒会对内存进行校验在内存和处理器间传递数据之前进行奇偶校验内存通常使用汉明码或其他更高级的错误更正码来实现错误检测和纠正功能必要性在于有时候会自己反转造成软错误如果位反转现象没有被发现和解决的话会导致数据损坏或崩溃会影响内存出现软错误频率的因素主要有下面几项大小速度密度一个来自谷歌的相关研究表明大概的服务器以及的内存会在每年至少遇到一次内存错误如果使用的是内存就可以一定程度上把这些内存错误找到并更正缺点就是同一个内存频率下支持的内存条比普通内存条跑分更低性能差在到之间内存条要比普通内存条贵原料成本最多增加上的运维指令盘点中查硬盘信息指令获取剪贴板内容事件查看器事件查看器是操作系统内置的系统日志管理工具用于记录系统运行状态应用程序行为和安全事件它通过分析事件日志帮助用户快速定位系统故障应用程序错误及安全隐患核心功能与作用日志分类应用程序日志记录软件运行事件如程序崩溃安装卸载系统日志记录操作系统组件事件如驱动加载失败服务启动错误安全日志记录安全相关操作如登录尝试权限变更日志系统安装或更新事件转发事件其他计算机转发的日志事件级别错误红色严重故障如蓝屏服务崩溃警告黄色潜在问题如磁盘空间不足信息蓝色正常操作记录如系统启动打开方式快捷搜索输入事件查看器或运行命令输入或控制面板控制面板管理工具事件查看器任务管理器文件运行新任务输入文件资源管理器访问路径网站快速部署方案控制面板特性维度宝塔面板核心定位开源应用全生命周期管理通用服务器运维专业虚拟主机管理现代化容器化运维快速建站与多语言支持轻量级低资源占用应用生态模板深度优化丰富但需手动调优通用功能为主缺乏深度适配模板较少依赖容器化支持等一键安装支持多语言环境但应用较少部署效率分钟一键自动化分钟需一定基础依赖主机商分钟容器化部署安全机制全生命周期自动防护漏洞修复基础防火墙依赖插件企业级但成本高侧重容器和网络隔离提供基础防火墙和管理资源效率轻量化内存即可运行高负载时性能可能下降需要企业级硬件支持中等容器化有优势资源占用极低占传统面板扩展性支持自主扩展中间件插件生态丰富功能依赖主机商兼容容器编排学习成本基础功能简单高级功能需学习中文友好社区活跃现代化但需容器知识中等低适用场景需快速部署深度管理多种开源应用的企业开发者教育机构国内用户广泛适合通用服务器运维单站点管理传统虚拟主机管理邮件服务需要轻量级容器化管理的场景需要搭建多语言教学平台或快速创建课程网站资源有限的服务器老旧设备改造的核心是提供一个大量预配置好的生产就绪的开源应用目录如等它解决了手动部署这些应用时遇到的依赖复杂配置繁琐优化和安全加固困难的问题它非常适合那些希望快速获得这些特定开源软件并希望其稳定安全运行而不想深究底层基础设施细节的用户和团队项目地址的核心定位是一个和用于运行开源基于的或的应用程序自托管和平台自托管数据存储在本地平台是开发和运维的组合词是一种文化实践和工具的集合旨在缩短软件开发生命周期实现持续集成持续交付和高效运维即一套自动化流水线工具传统方式是开发人员写完代码扔给运维人员去手动部署效率低易出错平台则自动化了这个过程代码一提交自动测试自动打包自动部署上线基于的一个通过浏览器访问的图形化用户界面用于管理和操作服务器隐藏了复杂的命令行操作轻量级平台即服务是云计算服务的一种模式提供软件部署和运行的环境如运行时数据库服务器开发者只需关心自己的代码轻量级指这是一个简化版通常为单机或小规模集群设计易于部署和使用即给你一个应用程序的万能运行底座你不需要关心服务器环境配置比如需要哪个版本的如何配置只需要把你的代码或应用程序打包扔给它它就能自动为你准备好一切并运行起来但是要注意是针对开源项目优化才能实现到这一点针对自己的项目并不一定可以它的主要功能是帮助用户在单台服务器上通过以微服务的方式部署和管理预配置好的开源应用模板例如等的核心优势在于自动化和集中管理它通过应用商店和容器技术简化了从部署配置到维护的全过程非常适合管理多个应用或需要快速搭建标准业务系统的场景部署自己的项目极致简约的个人版的核心是极简和模仿的推送部署体验它非常适合个人开发者或微型项目让你在最低成本的上就能体验到类似的部署流程其功能主要通过插件体系扩展本身非常轻量功能完善的小团队利器在的理念基础上增加了友好的管理界面和丰富的开箱即用功能如一键部署数据库它降低了自托管的使用门槛适合小团队初创公司或个人开发者希望在易用性和控制权之间取得平衡面向未来的自托管中心的目标是成为一体化的自托管解决方案它不仅支持应用部署还强调多云混合云管理强大的自动化如自动备份和团队协作适合注重数据主权需要灵活部署策略且有一定运维能力的用户省心省力的全托管标杆提供了最完整的开箱即用体验和无忧的运维管理你完全不需要关心底层基础设施只需专注代码但其昂贵的成本和可能的厂商锁定风险使得许多开发者和团队开始寻求像和这样的替代方案共同点它们都通过容器化技术将开发者从配置服务器环境安装依赖配置服务器如设置证书等重复性劳动中解放出来你通常只需要简单地推送代码平台就会自动完成构建和部署差异点最轻量极致模仿的体验但功能相对单一适合个人项目在基础上增加了友好的界面和更丰富的功能如一键部署数据库在易用性和灵活性之间取得了很好的平衡是小团队和独立开发者的热门选择目标更宏大更像一个一体化的自托管解决方案支持多云管理和强大的自动化适合对控制权和部署灵活性要求更高的用户特性维度参照基准核心定位全托管云轻量级极简的个人版功能丰富的自托管平衡易用性与灵活性开源自托管平台追求全面控制与自动化支持多云混合云托管方式完全托管自托管通常单服务器自托管支持单机与集群自托管支持单服务器多服务器集群计划支持开源协议闭源开源开源开源部署方式容器主要方式界面支持多种平台数据库支持需通过付费插件市场集成需手动部署或通过插件扩展支持一键部署多种数据库等支持一键部署多种数据库等并支持自动备份到兼容存储界面功能完善的控制台无官方界面主要依赖提供直观的控制台提供功能强大的控制台多语言框架支持广泛支持支持多种语言通过支持多种语言和框架支持多种语言和框架证书自动管理可通过插件获取内置自动申请和续期内置自动申请和续期扩展性垂直与水平扩展需付费仅限于单机性能支持集群部署可实现水平扩展支持多服务器集群未来计划支持成本昂贵免费层已取消极低仅服务器成本低仅服务器成本低仅服务器成本适用场景初创公司快速原型验证企业项目追求稳定免运维开发者学习个人开发者小型项目需要极致简单和低成本的情景小团队初创公司需要界面和一定灵活性希望平衡易用性和控制权的场景注重数据主权和控制权需要多云混合云部署有一定运维能力或愿意学习的团队和个人开始平台选择是否需要完全托管的服务且预算充足是选择否主要用户是个人开发者小型团队中大型团队或追求全面控制追求极致简单且只需基础部署是选择否考虑或选择选择特点免运维易用昂贵特点极简低成本操作特点功能全面有界面性价比高特点高度可控支持多云功能强大选择哪个工具取决于你的具体需求想快速使用成熟的优化好的开源软件如是更直接的选择它帮你处理好了应用本身的所有复杂问题想部署自己写的代码项目如一个后端或应用追求极致简单和低成本从开始希望有界面和更好的易用性适合小团队协作是很棒的选择需要更强大的功能支持多云混合云且不介意稍高的学习成本关注预算充足追求极致省心和开箱即用不想维护任何服务器仍然是体验非常好的选择临时公共子域名完全免费使用使用你的端口命令启动服务不需要支付任何费用它会为你生成一个随机的公共子域名如指向你本地运行的服务开源项目的代码在上公开遵循许可证这意味着你可以自由地使用修改和分发它官方公共服务器默认情况下命令连接的是由项目维护者提供的公共中继服务器域名这是他们提供的免费公共服务临时性免费提供的链接是临时的当你主动停止了运行的命令行进程你的电脑断网或者本地服务进程停止长时间没有流量通过隧道具体超时时间可能由服务器设定公共服务器维护或重启链接就会失效下次启动时你会获得一个新的随机子域名完整部署流程仅需两行命令自托管是完全免费的官网官方文档免费云服务器盘点参考来源免费资源个非抢占式实例每月小时可连续运行存储快照存储网络出口流量条件仅限特定区域如超出部分按量付费免费资源个虚拟机内存个核心内存可拆分或单机使用块存储对象存储条件实例闲置时可能被回收免费出口流量月免费资源无服务器部署万次请求日读请求日对象存储月特点全球边缘网络无需管理服务器免费资源台共享虚拟机内存台持久存储出站流量月适合轻量级容器化应用免费资源个内存实例无限应用部署限制需绑定信用卡但免费额度不扣费开源自托管项目盘点服务器特性维度社区版分支核心定位一体化功能全面的平台轻量级快速功能丰富的协作平台由社区驱动注重自由与隐私的协作平台极致轻量最简单的协作平台内置的平台类易上手的协作平台开源协议社区版开发语言资源占用高推荐核内存低约内存低与相近极低树莓派可运行中等较低核心功能仓库管理容器仓库监控仓库管理包注册表仓库管理包注册表仓库管理专注核心功能仓库管理看板内置代码搜索仓库管理插件系统方式强大且内置通过兼容通过兼容需外部集成如强大且内置图形化或配置需外部集成如特色优势功能最全面开箱即用覆盖全生命周期社区活跃功能与资源占用的最佳平衡迭代快强调数据主权社区治理避免商业公司控制安装部署最简单资源占用极低智能代码搜索导航深度集成兼容性好操作类似潜在缺点资源消耗大安装和维护相对复杂高级功能需要企业版功能广度与深度不及生态与市场占有率暂不如功能相对较少高级协作功能有限基于资源占用相对语言项目稍高开发活跃度和社区规模相对较小最适合场景中大型团队需要开箱即用的完整解决方案不介意资源消耗中小团队及个人项目追求功能资源和社区的最佳平衡注重数据隐私合规和社区治理的团队微型团队个人项目及资源极度受限的环境需要开箱即用的中小团队喜欢一体化喜欢风格寻求简单易用的团队一体化平台是一个基于的一体化平台覆盖了从项目规划源代码管理到监控的整个软件开发生命周期它能做什么代码仓库管理提供强大的仓库管理功能支持代码审查分支保护合并请求内建通过配置文件无缝集成持续集成和交付自动化构建测试和部署流程项目管理提供问题跟踪文档看板等功能帮助团队协同多种部署方式提供托管服务也支持私有化部署社区版免费企业版付费适合对数据安全有高要求的企业谁适合用寻求开箱即用高度集成的解决方案的团队希望减少在工具链整合上花费精力的开发者是一个由驱动的网络平台提供以下功能简单安装直观的用户界面插件高度可扩展与兼容特性主要语言部署方式单文件可执行群辉套件支持包资源占用很低轻量较高需要界面风格类简洁几乎原版风格功能可通过插件扩展等插件扩展内置功能多插件较少插件机制灵活可扩展功能社区活跃度非常活跃更新快不算活跃更新慢适合场景小团队个人开发轻量部署团队内部风格需要插件扩展长期维护性高社区活跃更新频繁中依赖少数维护者更新较慢易用性非常简单上手快上手容易但依赖配置似乎更好部署使用部署非常简单打开注册表搜索选择镜像下载创建容器打开容器添加使用镜像选择配置基本设置容器名称启动方式开机自启网络桥接模式端口映射容器端口端口卷映射中的和文件夹要自己新建用于结合配置自身的配置需要将符号链接文件和原本文件的路径都配置上才行启动容器后就可以访问会显示初始化界面初始化界面中推荐使用轻量级直接用文件即可使用查看日志也可以使用更方便是容器名权限注意事项中私有库即使给了协助者可写权限也不能或但是如果将人员加入到组织中全部成员设置为管理员却可以进行正常的全部读写操作将其他项目迁移到流程删除原始凭证可选迁移流程删除原始凭证可选界面操作如下系统打开控制面板用户账户凭据管理器在凭据或普通凭据中找到与相关的条目并删除系统打开钥匙串访问应用搜索或旧地址找到并删除对应的互联网密码条目使用下面命令行方式使用命令行删除原仓库凭证如下下面是列出所有保存的凭据删除相关凭据将替换为列表中的标识下面是查找凭据删除特定文件将替换为实际文件名查找相关凭据删除凭据编辑凭据文件删除包含的行清除缓存如果使用模式清除后测试连接此时应弹出新的认证窗口证明旧凭据已移除迁移流程在原项目目录下移除原本的远程地址将的新仓库地址添加为新的远程地址命名为你的新仓库例如查看项目的远程仓库信息是否配置上了检查是否连接上新的远程仓库了查看远程仓库详情会显示远程分支执行以下命令如果没有新凭证会弹出浏览器要求登录将本地所有分支所有提交历史所有标签全部推送到新的仓库重建原本就已经存在的本地分支与远程仓库的追踪关系远程分支名使当前分支追踪指定的远程分支名之后就可以正常使用与之交互了配置中配置限制只能这个域名访问不保留这一行就可以随意访问强制重定向非端口内外网域名统一设置链接内外网显示一致的配置文件通常位于安装目录下的使用文本编辑器如或打开它找到部分修改或添加以下两个参数内部监听地址和端口保持原样即可这不影响外部访问最重要的配置设置的外部访问根请将替换为您实际对外访问的域名其他配置设置好后检查所有页面上的链接特别是仓库的克隆地址应该都显示为而不是内网内外网访问一致目标让所有用户无论内外网都访问统一的无端口的标准下面的可以跳过试错流程直接看标准流程通过设置路由器来为内网用户设置解析将域名在内网解析为地址端口号内网用户通过路由器或文件将解析到外网用户通过公网解析到穿透服务的公网这样所有用户都使用访问无需区分环境看起来很美好但实际上内网解析或文件只能解析到无法附带端口号而外网解析却可以解析到端口因此还需要在内网搭建一个反向代理服务器如让它监听标准的端口然后将请求转发给的端口如果配置了证书也监听你的域名核心配置将所有请求转发给或者最终效果访问来源用户行为流量路径外网用户访问域名公网公网反向代理穿透服务内网内网用户访问域名内网内网但这样依旧内外网不统一内网是而外网却是这对于来说会视为两个仓库因此还是有问题应该参照标准流程来进行内外网域名统一设置标准流程生产环境的标准实践可扩展的企业级架构架构图客户端内网客户端外网用户网络域名解析反向代理隧道群晖宿主机网络独立反向代理服务隧道一次性申请自动续期脚本内网访问直接访问访问局域网解析到外网访问使用插件申请证书挂载证书定时证书证书更新后服务可选下面流程图局域网宿主机不能直连网络反向代理证书服务外网隧道一次性申请证书自动续期脚本定时任务内网访问内网客户端静态外网访问外网用户节点验证申请证书证书挂载周期执行检测到续期成功后服务可选为内网环境部署证书使用免费证书需公网域名在内网服务器安装通过验证申请证书无需开放端口按提示在域名添加记录验证所有权证书将生成在需要配置自动续期每月自动续期配置内网反向代理证书路径选择方案或的路径或自签名证书路径强化的配置保持转发强制跳转群晖群晖的配置方式有所不同因为其本身有内置占用了常用端口最好不要动群晖本身的群晖本身就提供了反向代理服务器的功能操作位置为登录进入控制面板登录门户高级选项卡反向代理服务器的功能由于群晖本身内部的实现就基于实现的反向代理接口因此我们自建来监听端口会有冲突可以通过分配的地址中监听端口就可以监听端口并与群晖本身相独立相关指令如下新建网络这个网络在重启后会丢失解决方案参考下面的网络持久化查看新建的网络启动位于网络中的服务启动位于网络中的服务这个服务必须可以访问到的证书的和目录这样才能证书可以后自动更新验证容器状态检查地址检查重启策略启动位于网络中的内网穿透服务此处必须要手动指明可能是因为无法使用宿主机的服务器的原因不指明无法正常连接服务器进行内网穿透注意一下的容器通过创建的在群晖中的自动重新启动策略是即即使正常退出也重启在界面显示自动重启没有勾选是因为策略不是而是所以实际上不影响出问题自动重启的功能更改配置的流程停止容器断开当前网络重新连接并指定启动容器检查项目如下检查配置项目是否已加载检查配置是否通过语法测试应用配置更改检查监听状态不需要因为与原本配置没有区别原本配置也会监听和网络持久化设置开机后执行创建的指令控制面板任务计划新增触发的任务用户定义的脚本任务设置用户定义的脚本中填入未在预期时间内启动待反馈信息的版本错误未在秒内启动网络已存在正在创建网络网络创建成功网络创建失败在大多数系统的计划任务或脚本输入框中我们需要将命令写为一行用空格分隔各个参数内网解析在路由器或内网服务器将解析到内网反向代理服务器如或每台设备修改分支保护配置的分支保护设置对于企业规范而言核心在于平衡代码质量安全管控与团队协作效率保护规则功能描述适用场景企业规范建议禁止强制推送防止覆盖历史提交确保提交历史可追溯所有重要分支对所有保护分支开启要求强制代码审查流程合并前必须通过所有重要分支对所有保护分支开启根据分支重要性设置不同批准人数要求状态检查确保测试通过代码质量达标集成测试分支配置必要的状态检查如构建测试检查要求签名提交验证提交者身份增强安全性和责任追溯安全敏感项目按需开启通常用于核心库或高风险项目限制推送权限指定特定用户或团队拥有推送权限核心代码分支通常仅授权技术负责人或核心维护者企业中的代码库通常需要保护以下关键分支生产分支如或这是最严格保护的分支通常对应生产环境开发分支如集成分支用于合并各个功能分支稳定性次于主分支但仍需保护发布分支如用于测试和准备发布的分支热修复分支如用于紧急修复生产环境问题生产分支这是你的黄金标准保护应该最为严格要求必须开启所有合并必须通过代码审查所需批准数建议至少人重要修改应获得多位核心成员的认可禁止强制推送必须开启防止历史提交被覆盖要求状态检查必须开启必须通过所有流程如编译单元测试集成测试安全扫描等才能合并要求签名提交按需开启对于安全要求极高的项目可以要求所有提交必须经过签名验证限制推送权限强烈建议通常只授权给团队负责人或少数核心成员其他开发者通过协作开发分支开发分支是活动最频繁的集成分支需在质量和效率间权衡要求必须开启功能分支合并到前必须经过审查所需批准数至少人通常由项目核心开发人员或团队负责人批准即可禁止强制推送必须开启要求状态检查必须开启至少需要通过基础构建和测试限制推送权限通常不开启允许所有开发者创建指向的但可根据团队成熟度调整分支命名规范清晰的分支命名能极大提升管理效率推荐以下规范功能分支简短功能描述例如修复分支问题简要描述例如文档分支更新内容描述例如重构分支修改模块描述例如发布分支版本号例如热修复分支紧急问题描述例如实际保护配置比更好用是一个由赞助的开源工具用于自动化管理和部署证书证书是用于加密网站与用户之间传输的数据的一种安全协议的主要目的是使网站管理员能够轻松获取部署和更新这些证书以确保网站的安全性链接采用协议来自动化验证你是否真正控制着要申请证书的域名上述流程中最常见的两种验证方式是验证方式是否需要公网是否需要开放端口配合内网穿透的可行性推荐度间接需要穿透服务器有即可需要开端口可行但麻烦受穿透服务限制完全不需要不需要非常可行且简单是最佳方案挑战这是最常用的方式会在你的服务器上通常是端口临时生成一个特定的验证文件的服务器会尝试通过公网访问这个文件例如你的域名某个令牌如果你的服务器没有公网或者端口被防火墙阻挡外界就无法访问到这个文件验证自然会失败挑战这种方式下会提供一个特定的文本记录你需要手动或通过自动将其添加到你的域名配置中随后会通过查询来验证这种方式不要求你的服务器有公网或开放端口但需要你能够操作域名的记录这对于无法开放端口的服务器或申请通配符证书你的域名非常有用无论服务器在哪里有无公网运行会给你提供一个随机生成的记录值手动或通过脚本自动到你的域名管理后台如阿里云等为你的域名添加这条记录例如随机值确认记录添加后回车继续会去查询域名的记录如果找到并匹配成功就颁发证书成功后别忘了从中删除那条记录虽然不删也没大问题但保持整洁为好如果服务器位于网络地址转换后面或者由云服务提供商托管但提供商集成了例如某些云平台的负载均衡器或托管服务那么你可能不需要直接在你的服务器实例上配置公网证书的申请和验证过程可以由云平台在其基础设施层面代为完成为确保顺利申请证书你的服务器和环境需满足以下条件公网与开放端口服务器需具备公网并确保所需验证端口验证需开放端口未被防火墙或云服务商的安全组阻挡域名与解析你必须拥有一个已注册的域名并已将该域名如和的记录通常是记录或记录正确解析到你的服务器公网服务器环境服务器需安装支持的操作系统如发行版并具备命令行权限对于验证需提前安装并运行服务器软件如或对于验证需具备域名管理权限或访问密钥工具在服务器上安装客户端官方推荐通过包安装以获得最新版本和完整功能安装流程安装安装安装首先确保和端口未被占用证书存放目录方案部署流程方式参考下面步骤操作内容关键信息命令选择验证方式采用验证无需公网需域名服务商支持准备域名凭证从您的域名服务商如获取密钥例如的或创建存储目录在群晖上创建目录用于持久化配置和证书首次申请证书运行容器使用插件和凭证申请证书配置自动续期创建续期脚本并添加群晖计划任务获取获取链接这个必须要有修改记录的权限配置令牌权限和范围权限确保权限范围是这赋予了修改记录的权限资源范围选择包括特定区域然后在下拉列表中选择你托管的那个域名这样可以将的权限限制在仅管理该域名的记录遵循最小权限原则更安全完成配置后点击继续到摘要检查设置确认无误后点击创建令牌下载运行镜像申请证书镜像名称描述基础镜像只包含核心的功能不包含任何插件专用镜像在基础镜像上额外预装了插件支持参数由于没有公网所以需要采用验证方式申请证书因此需要的镜像是新建需要映射的文件夹和文件点击添加文件夹文件夹选择您之前创建的挂载路径输入再次点击添加文件夹文件夹选择挂载路径输入再次点击添加文件夹文件夹选择挂载路径输入点击添加文件这是一个重要技巧文件选择您创建的凭证文件挂载路径输入最后的代表只读更安全群晖中不写而是手动选择只读中内容如下如果您使用的是不推荐但可用或者如果您使用的是推荐更安全这套方案采用这种方式这里填入上一个流程获取到的的要么使用组合要么单独使用绝不能同时出现这三行运行镜像的配置如下写成指令大概如下运行后可以在日志中观察到如下内容表示成功虽然消息会显示意外中断生成的证书在此处不需要勾选显示隐藏就能看见在里您会找到以下几个符号链接文件在群晖中默认被隐藏在中可以被看到他们始终指向中的真实证书文件真实证书文件名最后会带数字编号更新后得以标识证书证书链文件这是您需要在服务器中配置的证书文件私钥文件这是您需要在服务器中配置的密钥文件证书文件中间证书文件自动续期创建自动续期脚本赋予脚本执行权限登录群晖后台打开控制面板任务计划器创建新计划任务用户定义的脚本设置任务执行计划例如每月号和号凌晨点在任务设置中粘贴脚本路径保存并运行任务测试检查证书目录确认续期成功创建自动续期脚本建议放在一个固定的有权限的目录例如目录下方便管理记录当前证书的过期时间或修改时间记录日志方便排查开始执行证书续期检查运行续期命令使用参数让输出更简洁只打印错误或真正续期的信息检查状态并判断是否真的续期了检查容器的退出状态码表示命令执行成功非表示执行过程中出现错误证书已成功续期新证书已生效配置续期后自动重新加载服务重启群晖的以使新证书生效或者如果您是单独为配置的反向代理并且证书是独立使用的可能需要重启容器名字参考部署时候的容器名证书检查完成无需续期证书尚未到期证书续期过程中出现错误赋予脚本执行可读可写权限的命令有以下特点如果证书未到期距离过期时间超过天它会安静退出状态码不做任何操作如果证书即将到期天内它会执行续期并退出状态码只有遇到错误时才会返回非零状态码配置群晖计划任务登录打开控制面板任务计划器点击新增计划的任务用户定义的脚本在常规选项卡中任务填写一个描述性名称例如证书自动续期用户账号选择这一点非常重要因为普通用户可能没有足够的权限执行命令在计划选项卡中设置执行频率建议每月运行次例如每月号和号的凌晨点证书会在到期前天才允许续期所以不需要每天检查在任务设置选项卡中在用户定义的脚本框中输入验证自动续期是否工作手动测试在任务计划器中找到您创建的任务选中它并点击运行然后检查脚本输出的日志或去证书目录查看时间戳查看日志脚本的执行日志会输出到您指定的位置您也可以运行在任务运行时来查看实时输出检查证书续期成功后您的域名目录下会生成新的证书文件如而目录下的符号链接会更新指向这些新文件使用证书特性方案群晖管理证书方案容器管理证书配置位置群晖控制面板安全性证书容器内部的配置文件自动续期无法自动续期需手动下载新证书并重新导入简单指向的目录续期后自动生效管理方式图形化界面简单直观需修改配置文件影响范围影响整个系统及所有相关服务仅影响一个服务冲突风险无无两者是完全独立的群晖中使用证书控制面板安全性证书新增新增新证书导入证书导入私钥证书中间证书确定控制面板安全性证书设置将域名设置到对应的证书为本身配置证书是直接安装在群晖中的您可以跳过群晖的证书设置直接为容器配置必须是容器内部能访问到的路径这个路径的设置要参考容器本身部署的时候的文件映射因为的文件夹映射为所以重启容器这样服务本身就直接提供了灵活可扩展的自动化引擎是一个开源的高度可扩展的持续集成和持续交付工具它的核心价值在于自动化软件的构建测试和部署流程它能做什么自动化流水线通过丰富的插件生态系统超个插件支持与各种工具如等集成实现高度定制化的构建测试部署自动化流水线即代码使用基于定义流水线实现复杂流程的版本化和可重复性分布式构建支持主从架构可在多台机器上分布式执行构建任务提升效率谁适合用需要高度定制化和控制其流水线的团队技术栈多样需要与大量第三方工具集成的场景需要注意的是通常需要更多的维护和配置工作私有云平台开源私有云平台是一个开源的文件同步与共享平台允许你搭建属于自己的私有云服务它能做什么文件同步与共享类似或你可以在不同设备间同步文件并与他人安全共享丰富的应用生态通过安装应用可以扩展出日历联系人管理在线文档编辑视频会议任务管理等众多功能成为一个完整的协作平台数据掌控与隐私所有数据都存储在你自己的服务器上无需担心第三方云服务的隐私问题谁适合用对数据隐私和安全非常重视的个人团队或企业希望替代公有云服务如百度网盘完全掌控自己数据的用户开箱即用的文件服务器最大的特色就是简单粗暴整个服务器就是一个文件不需要安装任何依赖双击运行就能启动整个安装过程不到秒服务器启动后会自动监听端口用浏览器打开就能看到熟悉的文件管理界面虽然在界面美观度和插件生态方面还比不上但它的轻量简单易上手特性让更多人能上手体验如果你正在寻找一个开箱即用的文件服务器解决方案不妨试试这个只有一个文件的小工具项目地址域名相关个人域名购买费用范围首年元元人民币等国际域名约元年首年常有优惠等国内域名约元年需实名认证其他小众后缀如可能低至元年促销时备注续费价格通常高于首年价需留意服务商续费政策热门后缀利于收录和排名冷门后缀不利于优化但价格便宜无限邮域名也可以使用域名商域名购买商美金一年美金一年美金一年元首年阿里云年腾讯云的很便宜的年位数后缀域名元阿里云买这个域名年一共将购买的域名连接到主要是为了利用提供的加速安全防护如防御免费证书等服务通常有两种主要方式仅使用的托管更简单可逆只将域名的解析服务器改为的域名注册商仍是将域名完全转移到更彻底将域名的管理权从转移到注册商对于大多数用户推荐第一种方式托管因为它更简单快捷且可逆在账户主页域中添加域名输入从购买的完整域名例如然后点击继续会自动扫描该域名现有的记录请仔细核对确保所有必要的记录如记录记录记录等都已正确导入也可以在此手动添加或修改记录选择套餐免费计划通常足够个人使用点击继续更改的名称服务器这是最关键的一步完成上一步后会提供两个或更多特定的名称服务器地址通常类似于和请完整准确地复制这些地址登录账户进入域名管理后台找到要管理的域名点击管理或类似选项找到名称服务器设置部分选择使用自定义名称服务器或类似选项将默认的名称服务器删除替换为提供的那两个地址保存更改在完成并检查激活回到界面点击完成或类似按钮会开始检查名称服务器更改是否生效此过程最多需要小时传播时间但通常几分钟到几小时内就会完成完成后会收到的确认邮件在仪表板上也能看到域名状态变为有效关闭如果您之前在启用了必须先将其关闭否则在可能导致解析问题您可以在添加域名成功后再重新配置证书购买免费证书推荐个人使用完全免费支持自动续期适用于企业官网个人博客和小型网站证书有效期短证书仅天有效行业主流商业证书为年需定期续订自动续订机制可通过工具如实现自动化续期几乎无需人工干预特性自签名证书证书颁发机构自己给自己签发一个受全球信任的非营利证书颁发机构浏览器信任不信任会显示不安全警告完全信任显示绿色锁头或安全标识安全性加密强度可以很高但身份无法被第三方验证加密强度高且身份由可信的第三方验证成本免费免费获取难度自己一行命令生成非常简单需要验证您对域名的所有权自动化的过程有效期可以任意设置例如年很短天强制要求自动化续期以提升安全服务商赠送部分云平台如阿里云腾讯云购买服务器时赠送免费证书付费证书证书域名验证型元年适合个人证书企业验证型元年企业用途更多备注个人网站建议优先选择免费证书证书适合个人博客小型网站测试环境不适用涉及用户隐私支付等敏感信息的网站证书适合企业官网电商平台服务不适用需要最高信任度的金融政务场景证书适合银行支付平台政府机构大型企业官网不适用个人或非敏感业务成本过高证书的绿色地址栏在部分新浏览器如中不再显示但企业名称仍会展示在证书详情页网站备案备案费用免费官方流程不收费代理服务费可选如果自行备案元需自行准备材料并提交通过服务商代理备案约元协助资料审核和流程处理耗时约个工作日需配合管局审核费用总结最低成本自行操作域名元免费元备案元元常规成本含代理服务域名元免费元备案代理元元高端配置付费证书代理服务域名元付费元备案代理元元公网申请难度评估中国移动很难申请拉专线中国联通一般般打电话给客服中国电信一个月元就可以申请到公网话术今天打开监控发现我们家的那个公网地址怎么没有了之前装监控的时候有公网呀结果广东电信实测失败公网解决方案方案成本速度难度适用场景免费快直连中等外部设备支持自建穿透中快高高频访问需自定义端口组网免费中等低多设备互联低频率访问花生壳商业服务低高中等低临时测试小白用户解决访问服务器的问题解决方案方案成本实现难度适用场景双栈部署高高企业有公网资源协议转换低低快速兼容适合大多数企业中高实验性场景依赖运营商支持回退服务高中对兼容性要求极高的关键业务通过反向代理实现协议转换原理使用支持双栈的或反向代理服务将流量自动转换为请求推荐工具免费版支持将域名解析托管到在中开启兼容性和代理边缘节点会同时响应请求并将流量转发到公司的源站反向代理自建在具备双栈的代理服务器上配置公司源站优点无需公司源站支持可缓存内容提升访问速度缺点依赖第三方服务如或自建代理服务器替代方案若只需临时低速访问管理可使用它适合临时从外网登录后台来管理容器启停和设置若有公网且追求最佳速度可考虑端口转发但务必注意网络安全风险仅映射必要端口并使用强密码和非标端口号若要暴露服务如博客导航页是首选它无需公网能自动提供证书安全性较好若需访问所有协议的服务如远程桌面私有数据库等零信任网络方案是最佳选择它能在所有设备间建立加密通道像在局域网内一样安全访问所有服务配置也不复杂可以用开代理支持待后续了解不同地址特征地址类型前缀范围十六进制用途是否可全球路由全球单播地址公网如全球唯一可直接访问互联网是唯一本地地址内网通常类似的私有地址限本地网络使用否链路本地地址仅在同一物理链路有效如局域网通信否查看是否支持系统打开命令提示符或输入查看以地址标识的条目系统打开终端输入或查看网卡信息在输出信息中寻找那些不以或开头的地址如果你看到的地址是以等开头的属于范围这很可能就是一个公网地址使用在线工具测试通过访问一些支持的测试网站可以快速验证你的公网连通性和显示的地址访问或网站会自动检测你的连接状态如果页面显示访问优先给出了一个完整的地址并且这个地址与你之前查看到的以或开头的地址一致或者测试分数很高如就说明你已成功连接到互联网并且该地址是公网地址路由器开启支持以企业路由器为例首先需要在基本设置设置中启用然后需要在基本设置设置中启用服务当开启后服务的开关变为不可操作的状态这并非故障而是路由器的一种智能设计它强制用户采用业界推荐的无状态的协同工作模式功能负责内容当前状态分配地址解决我是谁已开启工作正常分配等信息解决如何找到别人被联动开启无需单独操作然后就可以在基本设置设置客户端列表中查看的地址分配情况群晖开启控制面板网络网络界面找到正在使用的局域网右键编辑设置改为自动确定解决动态变化的地址地址是动态变化的虽然运营上粉皮儿的前缀通常比较固定但设备通过生成的地址后缀可能会变尤其是隐私拓展地址解决方案为需要访问的设备如配置静态地址内网穿透方案参考内网穿透内网穿透服务名称免费带宽免费流量免费隧道数实名认证支持协议特点与注意事项不限流量条否流量不限是显著优势带宽适中隧道数较多每小时会变化的公网地址付费解决每月条是免费带宽较大通过每日签到可获取额外免费流量不限流量条是不限流量但免费版域名或端口可能不定时强制更换花生壳每月条是老牌服务需元认证费免费版流量较少飞鸽不限流量条否带宽较低解压即用无需安装适合临时轻量级需求备选方案自建内网穿透如果你拥有一台具有公网的云服务器国内或海外均可可以考虑使用或等开源工具自建内网穿透服务这种方式前期投入较高需要服务器成本但长期来看更灵活可控且无商业服务的额度限制对于绝大多数个人用户无论是远程访问家庭调试开发中的项目还是运行一个小型博客免费版提供的带宽和无限流量是完全足够且非常划算的方案的域名安全配置进入设置进入域名管理左侧菜单栏点击默认进入概述页面找到加密模式点击配置进入详细设置选择合适的模式默认模式为灵活需要改成完全适用于一般场景安全性较高风险内网中可能面临中间人攻击风险如果有这种风险需要采用下面的完全严格模式完全严格适用于指向服务器的域名但服务器需安装有效证书可以使用证书搭配天自动续期服务如果域名不指向服务器仅做跳转或解析可选择完全模式点击保存完成加密设置开启边缘证书点击边缘证书选项会自动申请并管理托管证书下拉找到始终使用选项点击开启可选但推荐这样可以确保所有请求都自动跳转到提高安全性可通过测试工具验证加密强度参考视频教程参考博客提供的内网穿透服务必须现有一个托管在的域名界面中网络添加隧道选择按照安装要求进行相应安装连接器然后就可以转到隧道管理中配置内网穿透的具体服务了就可以实现内网穿透了但是要注意内网穿透没法将设备直接暴露到公网只能暴露某个端口群晖部署能把低频访问的内网服务用最低成本稳定暴露到外网关键数据全程加密比自建省了服务器钱还不用操心防护使用邮箱可以无手机注册然后再试用账号注册要先在新建隧道新建后继续下面的步骤群晖通过部署隧道连接器部署参考下载镜像打开群晖的进入镜像仓库页面搜索选择并下载最新标签的镜像创建容器在映像中找到下载好的镜像点击启动按照下面进行配置注意网络一定要设置为模式命令要设置为总结一下配置选项卡设置项推荐配置执行命令保持不变命令环境变量新增值新增您的真实网络网络模式建议选择使用与相同的网络配置完成后需要告诉哪个公网域名对应哪个内网服务在面板中进入你刚创建的隧道的配置页面点击选项卡然后点击配置你的服务映射输入你喜欢的子域名前缀如从下拉菜单中选择一个你托管在上的域名选择或填写你的群晖服务在内网的地址和端口例如访问管理界面访问中的某个服务点击保存现在你就可以通过你配置的公网域名例如安全地访问内网服务了到此就部署成功了自建服务器内网穿透使用或将宿主机端口映射到公网无限邮域名参考链接在购买无限邮域名后缀会特别便宜另外免费方式在上配置一个域名然后找到电子邮件配置邮件路由就可以技巧记录绕开代理连接不然会显示被断开连接路由器配置静态注意路由器的客户端列表不会显示所有设备的地址如果是静态设置手动配置地址的设备在客户端列表中不可见特性静态地址分配保留静态设置手动配置配置位置路由器的管理界面每台终端设备的操作系统内管理方式集中式管理所有在一个地方分配和查看分散式管理需要登录每台设备修改可靠性非常高地址由权威的服务器分配绝对不会有冲突较低容易因人为失误导致冲突造成网络中断灵活性高更改地址只需在路由器上操作设备无感知低更改需要逐台设备操作非常繁琐迁移性高设备拿到新网络会自动获取新无需重新配置低设备换网络后仍需手动设置否则无法上网所需知识较低只需知道设备的地址较高需要正确填写子网掩码网关推荐场景绝大多数情况尤其是家庭中小企业环境极特殊情况如无服务的纯静态网络网络设备交换机路由器自身临时测试路由器防火墙一般被称为虚拟服务器将某个内网的某个端口对外开放网络设备盘点云管理交换机虚拟局域网最核心最根本的作用是可以实现将一个物理交换机虚拟成多个独立的逻辑交换机的效果工作原理传统交换机无所有端口都处于同一个广播域中一台电脑发送的广播数据包如请求会被交换机转发给所有其他端口上的设备整个交换机就像一个大的开放的房间大家都能听到彼此的喊话启用的交换机您可以将不同的端口划分到不同的中例如将端口划分到比如给财务部使用将端口划分到比如给市场部使用效果此时和就相当于两个完全独立的虚拟交换机广播隔离一台连接在端口上的电脑发送广播包这个包只会被转发到其他属于的端口的端口完全收不到任何的流量反之亦然通信隔离即使两台电脑都接在同一台物理交换机上但如果它们属于不同的它们之间默认也无法直接通信就像接在了两台完全不同的交换机上一样说明书云管理交换机用户手册全新开发推出的云交换系列全千兆云管理交换机提供更为高效简单安全易用的远程管理方式支持智能开局自动配置组网异常告警等功能无需专业运维人员小白也能轻松上手采用新一代高性能硬件和软件平台提供灵活高性价比的全千兆端口支持灵活的端口监控端口汇聚带宽控制等基础网络管理功能易于管理维护适用于校园酒店及企业园区网络接入应用场景一键切换工作模式云管理模式交换机支持端口汇聚端口监控等网管功能可以通过商云商用网络云平台本地界面进行管理和维护隔离模式交换机不支持网管功能并且部分端口相互隔离详安装手册相关说明标准交换模式交换机不支持网管功能并且所有端口均可以自由通信局域网扫描工具特性维度支持明确支持免费性完全免费开源免费主要功能特点快速扫描地址和端口支持自定义范围数据导出插件扩展命令行界面快速扫描局域网设备显示设备信息地址远程开关机访问共享资源用户友好性界面简洁提供图形界面和命令行界面强调易于使用提供图形化界面额外优势跨平台兼容性佳无需安装便携版开源绿色免安装支持远程控制官网官网官网部署问题盘点群晖默认与端口冲突常见解决方案释放默认端口通过修改的配置将改成其他端口比如注意系统升级可能会恢复配置需使用计划任务定时执行脚本参考做法群晖停用内置使用独立给反向代理容器分配一个单独的局域网如通过使它不与共享这样反向代理可以在该的上运行而自带服务绑定在另一上例如的案例中他将容器分配到让它独立监听下图示意了这种网络布局容器和主机各自拥有不同反向代理可独占端口参考做法更换端口如果不想改系统可以让容器监听其他端口如并在侧进行端口映射或转发不过这样访问时需要指定非标准端口或使用额外的到转发如模块或自带转发方案注意使用独立方案登录到群晖查看宿主机的物理网卡名通常是或者类似取决于你是否用了群晖的虚拟网络层创建一个网络局域网的子网局域网网关替换为你实际的物理网卡名这个是网络的名字可以自己定义启动容器并绑定独立这是容器在局域网的固定可以省略因为容器直接在独立上监听不需要映射到宿主机配置域名解析在路由器或本地中把解析到注意事项宿主机访问容器问题模式下宿主机群晖本身默认不能直接访问这个容器如果需要本身访问容器例如的备份任务访问你需要再建一个或者用替代防火墙检查群晖和路由器的防火墙设置确保放行到冲突务必在路由器池之外选择或者在路由器里给容器做静态绑定简单定义是内核的一种网络驱动把容器虚拟成网络上的独立设备每个容器拥有自己的地址和像一台真实主机那样直接出现在网络上交换机能识别它的物理网口即使是两个网口各自有独立的地址也会在层面涉及到互相之间端口占用的影响而使用方案是真正意义上可以不互相占用的解决的问题当你想让容器直接在局域网中拥有独立并可以占用标准端口而不与宿主机群晖自带服务端口冲突时非常合适应用场景反向代理直接对外提供把容器暴露成局域网内独立服务在多服务多下避免端口冲突工作原理在宿主物理网口上创建虚拟网口子接口容器的网口直接挂在这个虚拟网口上容器发出的帧带自己的物理交换机会像对待物理主机一样转发你需要指定一个物理网卡作为例如等会基于它创建虚拟接口主机与容器隔离宿主机默认不能直接访问上的容器因为主机和容器处于不同的接口这通常是优点隔离但也带来需要额外配置以便访问的尴尬支持如果你的网络需要标签可以在上用子接口如优缺点优点容器看起来像局域网内真实主机直接使用标准端口不需要宿主端口映射几乎原生网速延迟低无便于把容器放到已有网络策略路由里如静态路由器防火墙规则等缺点限制宿主机默认无法访问容器需要特殊配置才能从访问容器的一些家用路由器交换机或提供的设备可能会限制一个物理端口上的多个或者对客户端行为不友好尤其某些网关或中继容器在网络上直接可见安全性依赖你在容器内配置的防护而不是隔离需要知道宿主机物理接口名称并具有对其操作权限在群晖上需要替代方案说明网络模式容器直接和宿主共享网络栈能访问的接口但你无法分配独立与类似但在某些场景比如需要更低开销更合适此外在通信上有不同行为一般入门用更直观使宿主机能和容器互通可选如前所述默认内核会阻止宿主和其子设备互通这是内核设计安全隔离若你需要从上直接访问调试容器或容器访问只是局域网内别的机器能访问容器就行需要在宿主上建立一个虚拟接口并给它一个通常是保留的那个这是社区推荐的解决办法示例命令继续用上面假设创建虚拟设备仅在内存不会重启后保留这个同保持一致告诉宿主到容器网段走验证宿主上容器应该可达容器已运行的情况下持久化上面这些命令是临时的重启会丢失建议用的控制面板任务计划程序新建一个开机登录时运行的任务以身份运行一个小脚本来恢复这几个脚本示例我会在下面给出',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-29 09:37:44',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://th.bing.com/th/id/OIP.wtmjepfWPBvn26uz7s18dgHaHa?rs=1&amp;pid=ImgDetMain"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ZEROKO14的个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 1.05rem;">AI<sup>1</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 1.05rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 1.05rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 1.05rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 1.05rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 1.05rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 1.05rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 1.05rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 1.05rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 1.05rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 1.05rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 1.05rem;">ppt<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 1.05rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 1.05rem;">vue<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 1.05rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 1.05rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 1.05rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 1.05rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">基础<sup>6</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 1.05rem;">杂项<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%89%A9%E7%90%86/" style="font-size: 1.05rem;">物理<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">逆向<sup>5</sup></a><a href="/tags/%E9%AD%94%E6%B3%95/" style="font-size: 1.05rem;">魔法<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E8%BF%90%E7%BB%B4/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>运维</span></a></span></div></div><h1 class="post-title" itemprop="name headline">运维</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2021-10-23T14:51:13.000Z" title="发表于 2021-10-23 22:51:13">2021-10-23</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-09-29T01:37:44.740Z" title="更新于 2025-09-29 09:37:44">2025-09-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="运维"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新加坡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新加坡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://che77a38.github.io/posts/%E8%BF%90%E7%BB%B4/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><a href="/tags/%E8%BF%90%E7%BB%B4/" tabindex="-1" itemprop="url">运维</a><h1 id="CrawlerTitle" itemprop="name headline">运维</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ZEROKO14</span><time itemprop="dateCreated datePublished" datetime="2021-10-23T14:51:13.000Z" title="发表于 2021-10-23 22:51:13">2021-10-23</time><time itemprop="dateCreated datePublished" datetime="2025-09-29T01:37:44.740Z" title="更新于 2025-09-29 09:37:44">2025-09-29</time></header><p>记录一些简单的运维知识</p>
<span id="more"></span>

<p>国内注册域名后要先实名认证后，使用国内的服务器时，网站还需要在工信部，网安备案</p>
<p>在国内域名商购买了域名，解析的主机或服务器也在国内时，则必须备案通过后才能访问</p>
<p>海外域名，就只能用国外或香港主机&#x2F;服务器，不能解析到国内的服务器</p>
<h1 id="运维相关好用工具"><a href="#运维相关好用工具" class="headerlink" title="运维相关好用工具"></a>运维相关好用工具</h1><h2 id="iperf3"><a href="#iperf3" class="headerlink" title="iperf3"></a>iperf3</h2><p>iPerf是一个支持跨平台部署使用的网络性能测量工具。它可以创建数据流测量两端之间单向或双向的网络吞吐量。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><a target="_blank" rel="noopener" href="https://iperf.fr/iperf-download.php">官网下载链接</a></p>
<ul>
<li><a href="github.com/ar51an/iperf3-win-builds">windows版下载链接</a></li>
<li>linux: <code>apt install iperf3</code></li>
<li>安卓: Magic iPerf  <a target="_blank" rel="noopener" href="https://apkpure.com/cn/he-net-network-tools/net.he.networktools">net.he下载地址,内含iperf3功能</a></li>
<li>IOS: iPerf 3 Wifi Speed Test&#x2F;HE.NET Network Tools</li>
<li>威联通  <a href="%E5%A8%81%E8%81%94%E9%80%9A%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F">参考安装方式</a></li>
<li>mac: <code>brew install iperf3</code></li>
</ul>
<h4 id="威联通安装方式"><a href="#威联通安装方式" class="headerlink" title="威联通安装方式"></a>威联通安装方式</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202411161646573.png" alt="如何在局域网测网速？手把手教会NAS、电脑、路由器、手机如何安装 iperf3"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202411161647126.png" alt="如何在局域网测网速？手把手教会NAS、电脑、路由器、手机如何安装 iperf3"></p>
<p>网络环境新增一个 TCP 端口，主机和容器都选择 5201，一般 iperf3 默认的端口也是 5201</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202411161648446.png" alt="如何在局域网测网速？手把手教会NAS、电脑、路由器、手机如何安装 iperf3"></p>
<p>在命令行里输入-s，这个是开启5201 监听端口的命令，这样其他设备才能通过命令访问 NAS 的 iperf3 端口</p>
<p>总览:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202411161648299.png" alt="如何在局域网测网速？手把手教会NAS、电脑、路由器、手机如何安装 iperf3"></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>启动服务端: <code>iperf3 -s</code></p>
<p>启动客户端: <code>-perf3 -c 服务端ip地址</code></p>
<p><code>-P 8</code>表示启用8线程</p>
<p><code>-R</code> 反转数据流方向（数据从服务端发向客户端）</p>
<p><code>-t 1800</code> 表示测试时长1800秒</p>
<p><code>--logfile 保存文件名.txt</code> 设置导出为文件(设置后,测试结果就不会在命令行中展示了)</p>
<h1 id="关于ECC"><a href="#关于ECC" class="headerlink" title="关于ECC"></a>关于ECC</h1><p><strong>ECC（Error-Correcting Code）内存</strong>是一种能够自动检测和修正内存错误的技术。它通过添加额外的位来存储数据，从而能够识别和纠正单比特错误。这在服务器和关键任务系统中尤其重要，因为这些系统对数据的准确性和可靠性有很高的要求。 ECC内存的主要优点包括： </p>
<ol>
<li><strong>数据完整性</strong>：能够自动检测并修正内存中的错误，从而减少数据损坏的风险。 </li>
<li><strong>系统稳定性</strong>：提高系统的稳定性，减少由于内存错误导致的崩溃或数据丢失的可能性。 </li>
<li><strong>适用于关键应用</strong>：在需要高可靠性的环境中（如金融、医疗和科学计算等领域），ECC内存是一个理想的选择。</li>
</ol>
<blockquote>
<p>全世界的商用级服务器都在使用ECC内存纠错</p>
</blockquote>
<p>内存条的区别主要在于ECC内存条其中一面的一个额外的内存颗粒上,这个颗粒会对内存进行校验,在内存和处理器间传递数据之前,进行奇偶校验</p>
<p>ECC内存通常使用汉明码（Hamming Code）或其他更高级的错误更正码来实现错误检测和纠正功能。</p>
<p>必要性在于bit有时候会自己反转,造成软错误.如果位反转现象没有被发现和解决的话,会导致数据损坏或崩溃</p>
<p>会影响内存出现软错误频率的因素主要有下面几项:</p>
<ol>
<li>大小</li>
<li>速度</li>
<li>密度</li>
</ol>
<blockquote>
<p>一个来自谷歌的相关研究表明:</p>
<p>大概32%的服务器以及8%的内存会在每年至少遇到一次内存错误</p>
</blockquote>
<p>如果使用的是ECC内存,就可以一定程度上把这些内存错误找到并更正</p>
<p>缺点就是: 同一个内存频率下,支持ECC的内存条比普通内存条跑分更低,性能差在0%到20%之间</p>
<p>ECC内存条要比普通内存条贵,原料成本最多增加12%</p>
<h1 id="Windows上的运维指令盘点"><a href="#Windows上的运维指令盘点" class="headerlink" title="Windows上的运维指令盘点"></a>Windows上的运维指令盘点</h1><p>powershell中查硬盘信息指令<code>Get-PhysicalDisk | Format-Table FriendlyName, MediaType, Size, HealthStatus</code></p>
<p>获取剪贴板内容: <code>Get-Clipboard</code></p>
<h1 id="Windows事件查看器"><a href="#Windows事件查看器" class="headerlink" title="Windows事件查看器"></a>Windows事件查看器</h1><blockquote>
<p><strong>Windows事件查看器（Event Viewer）</strong>是Windows操作系统内置的系统日志管理工具，用于记录系统运行状态、应用程序行为和安全事件。它通过分析事件日志，帮助用户快速定位系统故障、应用程序错误及安全隐患</p>
</blockquote>
<h2 id="核心功能与作用"><a href="#核心功能与作用" class="headerlink" title="核心功能与作用"></a>核心功能与作用</h2><p><strong>日志分类</strong></p>
<ul>
<li><strong>应用程序日志</strong>：记录软件运行事件（如程序崩溃、安装卸载）</li>
<li><strong>系统日志</strong>：记录操作系统组件事件（如驱动加载失败、服务启动错误）</li>
<li><strong>安全日志</strong>：记录安全相关操作（如登录尝试、权限变更）</li>
<li><strong>Setup日志</strong>：系统安装或更新事件</li>
<li><strong>转发事件</strong>：其他计算机转发的日志</li>
</ul>
<p><strong>事件级别</strong>：</p>
<ul>
<li><strong>错误</strong>（红色）：严重故障（如蓝屏、服务崩溃）。</li>
<li><strong>警告</strong>（黄色）：潜在问题（如磁盘空间不足）。</li>
<li><strong>信息</strong>（蓝色）：正常操作记录（如系统启动）。</li>
</ul>
<h2 id="打开方式"><a href="#打开方式" class="headerlink" title="打开方式"></a>打开方式</h2><ol>
<li><p><strong>快捷搜索</strong>：</p>
<p>Win + S 输入“事件查看器”或“Event Viewer”</p>
</li>
<li><p><strong>运行命令</strong>：</p>
<p>Win + R 输入 <code>eventvwr</code> 或 <code>eventvwr.msc</code></p>
</li>
<li><p><strong>控制面板</strong>：</p>
<p>控制面板 → 管理工具 → 事件查看器</p>
</li>
<li><p><strong>任务管理器</strong>：</p>
<p>Ctrl + Shift + Esc → 文件 → 运行新任务 → 输入 <code>eventvwr</code></p>
</li>
<li><p><strong>文件资源管理器</strong>：</p>
<p>访问路径 <code>C:\Windows\System32\eventvwr.exe</code></p>
</li>
</ol>
<h1 id="网站快速部署方案"><a href="#网站快速部署方案" class="headerlink" title="网站快速部署方案"></a>网站快速部署方案</h1><h2 id="Linux控制面板"><a href="#Linux控制面板" class="headerlink" title="Linux控制面板"></a>Linux控制面板</h2><table>
<thead>
<tr>
<th>特性维度</th>
<th><a href="#Websoft9">Websoft9</a></th>
<th>宝塔面板</th>
<th>cPanel</th>
<th>1Panel</th>
<th>FastPanel</th>
<th>Urlos</th>
</tr>
</thead>
<tbody><tr>
<td><strong>核心定位</strong></td>
<td>开源应用全生命周期管理</td>
<td>通用服务器运维</td>
<td>专业虚拟主机管理</td>
<td>现代化容器化运维</td>
<td>快速建站与多语言支持</td>
<td>轻量级、低资源占用</td>
</tr>
<tr>
<td><strong>应用生态</strong></td>
<td>★★★★★ (300+模板，深度优化)</td>
<td>★★★★☆ (丰富，但需手动调优)</td>
<td>★★★☆☆ (通用功能为主，缺乏深度适配)</td>
<td>★★★☆☆ (模板较少，依赖容器化)</td>
<td>★★★☆☆ (支持WordPress&#x2F;Joomla等一键安装)</td>
<td>★★☆☆☆ (支持多语言环境但应用较少)</td>
</tr>
<tr>
<td><strong>部署效率</strong></td>
<td>★★★★★ (3-5分钟，一键自动化)</td>
<td>★★★☆☆ (30-60分钟，需一定基础)</td>
<td>★★★☆☆ (依赖主机商)</td>
<td>★★★★☆ (20分钟，容器化部署)</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>安全机制</strong></td>
<td>★★★★★ (全生命周期自动防护+漏洞修复)</td>
<td>★★★☆☆ (基础防火墙+依赖插件)</td>
<td>★★★★☆ (企业级但成本高)</td>
<td>★★★☆☆ (侧重容器和网络隔离)</td>
<td>★★★☆☆ (提供基础防火墙和SSL管理)</td>
<td></td>
</tr>
<tr>
<td><strong>资源效率</strong></td>
<td>★★★★★ (轻量化，1GB内存即可运行)</td>
<td>★★★☆☆ (高负载时性能可能下降)</td>
<td>★★☆☆☆ (需要企业级硬件支持)</td>
<td>★★★★☆ (中等，容器化有优势)</td>
<td>★★★★★ (资源占用极低，占传统面板1&#x2F;3)</td>
<td></td>
</tr>
<tr>
<td><strong>扩展性</strong></td>
<td>★★★★★ (支持Docker&#x2F;K8s，自主扩展中间件)</td>
<td>★★★★☆ (插件生态丰富)</td>
<td>★★★☆☆ (功能依赖主机商)</td>
<td>★★★★☆ (兼容K8s，容器编排)</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>学习成本</strong></td>
<td>★★☆☆☆ (基础功能简单，高级功能需学习)</td>
<td>★★★☆☆ (中文友好，社区活跃)</td>
<td>★★★★☆ (现代化UI，但需容器知识)</td>
<td>★★★☆☆ (中等)</td>
<td>★★★☆☆ (低)</td>
<td></td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>需快速部署、深度管理多种开源应用的企业、开发者、教育机构</td>
<td>国内用户广泛，适合通用服务器运维、单站点管理</td>
<td>传统虚拟主机管理、邮件服务</td>
<td>需要轻量级容器化管理的场景</td>
<td>需要搭建多语言教学平台或快速创建课程网站</td>
<td>资源有限的服务器、老旧设备改造</td>
</tr>
</tbody></table>
<h3 id="Websoft9"><a href="#Websoft9" class="headerlink" title="Websoft9"></a>Websoft9</h3><p>Websoft9 的核心是提供一个<strong>大量预配置好的、生产就绪的开源应用目录</strong>（如 WordPress、Jenkins、Nextcloud、Moodle 等）。它解决了手动部署这些应用时遇到的依赖复杂、配置繁琐、优化和安全加固困难的问题。<strong>它非常适合那些希望快速获得这些特定开源软件，并希望其稳定、安全运行，而不想深究底层基础设施细节的用户和团队</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Websoft9/websoft9">项目地址</a></p>
<ul>
<li><p>Websoft9 的核心定位是一个 <strong>“Applications self-hosting and DevOps platform”</strong> 和 <strong>“lite PaaS”</strong>。</p>
<blockquote>
<p><strong>用于运行开源、基于 Web 的 Linux Panel 或 Lite PaaS 的应用程序自托管和 DevOps 平台</strong></p>
<ul>
<li><p>自托管: 数据存储在本地</p>
</li>
<li><p>DevOps 平台: DevOps是“Development（开发）”和“Operations（运维）”的组合词，是一种文化、实践和工具的集合，旨在缩短软件开发生命周期，实现持续集成、持续交付和高效运维,即<strong>一套“自动化流水线”工具</strong>。传统方式是开发人员写完代码，扔给运维人员去手动部署，效率低易出错。DevOps平台则自动化了这个过程：代码一提交，自动测试、自动打包、自动部署上线</p>
</li>
<li><p>基于 Web 的 Linux Panel: 一个通过浏览器访问的图形化用户界面，用于管理和操作Linux服务器。隐藏了复杂的命令行操作</p>
</li>
<li><p>Lite PaaS (轻量级平台即服务): PaaS是云计算服务的一种模式，提供软件部署和运行的环境（如运行时、数据库、Web服务器），开发者只需关心自己的代码。<strong>“Lite”（轻量级）</strong> 指这是一个简化版，通常为单机或小规模集群设计，易于部署和使用.即<strong>给你一个“应用程序的万能运行底座”</strong>。你不需要关心服务器环境配置（比如需要哪个版本的PHP、Python，如何配置Nginx），只需要把你的代码或应用程序打包扔给它，它就能自动为你准备好一切并运行起来</p>
</li>
</ul>
<p>  但是要注意Websoft9是针对开源项目优化才能实现到这一点,针对自己的项目并不一定可以</p>
</blockquote>
</li>
<li><p>它的主要功能是帮助用户在单台 Linux 服务器上通过 Docker Compose 以微服务的方式 <strong>部署和管理预配置好的开源应用模板</strong>（例如 WordPress, Nextcloud, MySQL, Redis, GitLab 等）</p>
</li>
</ul>
<p>Websoft9 的核心优势在于<strong>自动化</strong>和<strong>集中管理</strong>。它通过应用商店和容器技术，简化了从部署、配置到维护的全过程，非常适合管理多个应用或需要快速搭建标准业务系统的场景</p>
<h2 id="部署自己的项目"><a href="#部署自己的项目" class="headerlink" title="部署自己的项目"></a>部署自己的项目</h2><ol>
<li><p><strong>Dokku：极致简约的个人版 Heroku</strong></p>
<p>Dokku 的核心是<strong>极简</strong>和<strong>模仿 Heroku 的 Git 推送部署体验</strong>。它非常适合个人开发者或微型项目，让你在最低成本的 VPS 上就能体验到类似 Heroku 的部署流程。其功能主要通过插件体系扩展，本身非常轻量</p>
</li>
<li><p><strong>CapRover：功能完善的小团队利器</strong></p>
<p>CapRover 在 Dokku 的理念基础上，增加了<strong>友好的 Web 管理界面</strong>和<strong>丰富的开箱即用功能</strong>（如一键部署数据库）。它降低了自托管 PaaS 的使用门槛，适合小团队、初创公司或个人开发者，希望在易用性和控制权之间取得平衡</p>
</li>
<li><p><strong>Coolify：面向未来的自托管中心</strong></p>
<p>Coolify 的目标是成为<strong>一体化的自托管解决方案</strong>。它不仅支持应用部署，还强调<strong>多云&#x2F;混合云管理</strong>、<strong>强大的自动化</strong>（如自动备份、Webhooks）和<strong>团队协作</strong>。适合注重数据主权、需要灵活部署策略，且有一定运维能力的用户</p>
</li>
<li><p><strong>Heroku：省心省力的全托管标杆</strong></p>
<p>Heroku 提供了<strong>最完整的开箱即用体验</strong>和<strong>无忧的运维管理</strong>。你完全不需要关心底层基础设施，只需专注代码。但其昂贵的成本和可能的厂商锁定风险，使得许多开发者和团队开始寻求像 Dokku、CapRover 和 Coolify 这样的替代方案</p>
</li>
</ol>
<blockquote>
<ul>
<li><strong>共同点</strong>：它们都通过容器化技术（Docker），将开发者从配置服务器环境、安装依赖、配置 Web 服务器（如 Nginx）、设置 SSL 证书等重复性劳动中解放出来。你通常只需要简单地推送代码（git push），平台就会自动完成构建和部署。</li>
<li><strong>差异点</strong>：<ul>
<li><strong>Dokku</strong> 最轻量，<strong>极致模仿 Heroku 的体验</strong>，但功能相对单一，适合个人项目。</li>
<li><strong>CapRover</strong> 在 Dokku 基础上增加了<strong>友好的 Web 界面</strong>和<strong>更丰富的功能</strong>（如一键部署数据库），<strong>在易用性和灵活性之间取得了很好的平衡</strong>，是小团队和独立开发者的热门选择</li>
<li><strong>Coolify</strong> 目标更宏大，更像一个<strong>一体化的自托管解决方案</strong>，支持<strong>多云管理</strong>和<strong>强大的自动化</strong>，适合对控制权和部署灵活性要求更高的用户。</li>
</ul>
</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>特性维度</th>
<th>Heroku (参照基准)</th>
<th><a target="_blank" rel="noopener" href="https://github.com/dokku/dokku">Dokku</a></th>
<th><a target="_blank" rel="noopener" href="https://github.com/caprover/caprover">CapRover</a></th>
<th><a target="_blank" rel="noopener" href="https://github.com/coollabsio/coolify">Coolify</a></th>
</tr>
</thead>
<tbody><tr>
<td><strong>核心定位</strong></td>
<td>全托管云 PaaS</td>
<td>轻量级、极简的个人版 Heroku</td>
<td>功能丰富的自托管 PaaS，平衡易用性与灵活性</td>
<td>开源自托管平台，追求全面控制与自动化，支持多云&#x2F;混合云</td>
</tr>
<tr>
<td><strong>托管方式</strong></td>
<td>完全托管</td>
<td>自托管 (通常单服务器)</td>
<td>自托管 (支持单机与集群)</td>
<td>自托管 (支持单服务器、多服务器、Docker Swarm集群，计划支持Kubernetes)</td>
</tr>
<tr>
<td><strong>开源协议</strong></td>
<td>闭源</td>
<td>开源</td>
<td>开源</td>
<td>开源</td>
</tr>
<tr>
<td><strong>部署方式</strong></td>
<td>Git Push、CLI、容器</td>
<td>Git Push (主要方式)</td>
<td>Git Push、Web界面、Dockerfile、Docker Compose</td>
<td>Git Push (支持多种Git平台)、Dockerfile、Docker Compose</td>
</tr>
<tr>
<td><strong>数据库支持</strong></td>
<td>需通过付费插件市场集成</td>
<td>需手动部署或通过插件扩展</td>
<td>支持一键部署多种数据库 (MySQL, PostgreSQL, MongoDB, Redis等)</td>
<td>支持一键部署多种数据库 (MySQL, PostgreSQL, MongoDB, Redis等)，并支持自动备份到S3兼容存储</td>
</tr>
<tr>
<td><strong>Web界面</strong></td>
<td>功能完善的Web控制台</td>
<td>无官方Web界面 (主要依赖CLI)</td>
<td>提供直观的Web控制台</td>
<td>提供功能强大的Web控制台</td>
</tr>
<tr>
<td><strong>多语言&#x2F;框架支持</strong></td>
<td>广泛支持</td>
<td>支持多种语言 (通过Buildpack)</td>
<td>支持多种语言和框架</td>
<td>支持多种语言和框架</td>
</tr>
<tr>
<td><strong>SSL证书</strong></td>
<td>自动管理</td>
<td>可通过Let’s Encrypt插件获取</td>
<td>内置Let’s Encrypt，自动申请和续期</td>
<td>内置Let’s Encrypt，自动申请和续期</td>
</tr>
<tr>
<td><strong>扩展性</strong></td>
<td>垂直与水平扩展（需付费）</td>
<td>仅限于单机性能</td>
<td>支持Docker Swarm集群部署，可实现水平扩展</td>
<td>支持多服务器、Docker Swarm集群，未来计划支持Kubernetes</td>
</tr>
<tr>
<td><strong>成本</strong></td>
<td>昂贵（免费层已取消）</td>
<td>极低（仅服务器成本）</td>
<td>低（仅服务器成本）</td>
<td>低（仅服务器成本）</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>初创公司（快速原型验证）、企业项目（追求稳定免运维）、开发者（学习）</td>
<td>个人开发者、小型项目、需要极致简单和低成本的情景</td>
<td>小团队、初创公司、需要Web界面和一定灵活性、希望平衡易用性和控制权的场景</td>
<td>注重数据主权和控制权、需要多云&#x2F;混合云部署、有一定运维能力或愿意学习的团队和个人</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[开始平台选择] --&gt; B&#123;是否需要完全托管的服务&lt;br&gt;且预算充足？&#125;;</span><br><span class="line">    </span><br><span class="line">    B -- 是 --&gt; C[选择 Heroku];</span><br><span class="line">    </span><br><span class="line">    B -- 否 --&gt; D&#123;主要用户是？&#125;;</span><br><span class="line">    </span><br><span class="line">    D --&gt; E[个人开发者];</span><br><span class="line">    D --&gt; F[小型团队];</span><br><span class="line">    D --&gt; G[中大型团队或&lt;br&gt;追求全面控制];</span><br><span class="line">    </span><br><span class="line">    E --&gt; H&#123;追求极致简单&lt;br&gt;且只需基础部署？&#125;;</span><br><span class="line">    H -- 是 --&gt; I[选择 Dokku];</span><br><span class="line">    H -- 否 --&gt; J[考虑 CapRover 或 Coolify];</span><br><span class="line">    </span><br><span class="line">    F --&gt; K[选择 CapRover];</span><br><span class="line">    </span><br><span class="line">    G --&gt; L[选择 Coolify];</span><br><span class="line">    </span><br><span class="line">    C --&gt; M[特点：免运维、易用、昂贵];</span><br><span class="line">    I --&gt; N[特点：极简、低成本、CLI操作];</span><br><span class="line">    K --&gt; O[特点：功能全面、有Web界面、性价比高];</span><br><span class="line">    L --&gt; P[特点：高度可控、支持多云、功能强大];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>选择哪个工具取决于你的具体需求：</p>
<ol>
<li><p><strong>想快速使用成熟的、优化好的开源软件</strong>（如 WordPress, GitLab, Jenkins）：<a href="Websoft9">Websoft9</a> 是更直接的选择，它帮你处理好了应用本身的所有复杂问题。</p>
</li>
<li><p><strong>想部署自己写的代码项目</strong>（如一个 Node.js 后端或 Python Web 应用）：</p>
<p>追求<strong>极致简单和低成本</strong>：从 <strong>Dokku</strong> 开始。</p>
<ul>
<li>希望有<strong>Web界面</strong>和<strong>更好的易用性</strong>，适合小团队协作：<strong>CapRover</strong> 是很棒的选择</li>
<li>需要<strong>更强大的功能</strong>、<strong>支持多云&#x2F;混合云</strong>，且不介意稍高的学习成本：关注 <strong>Coolify</strong>。</li>
</ul>
</li>
<li><p><strong>预算充足，追求极致省心和开箱即用，不想维护任何服务器</strong>：<strong>Heroku</strong> 仍然是体验非常好的选择。</p>
</li>
</ol>
</blockquote>
<h3 id="临时公共子域名"><a href="#临时公共子域名" class="headerlink" title="临时公共子域名"></a>临时公共子域名</h3><p><strong>完全免费使用：</strong> 使用 <code>npx localtunnel --port [你的端口]</code>命令启动服务<strong>不需要支付任何费用</strong>。它会为你生成一个随机的公共子域名（如 <code>https://your-random-subname.loca.lt</code>）指向你本地运行的服务。</p>
<p><strong>开源项目：</strong> localtunnel 的代码在 <a target="_blank" rel="noopener" href="https://github.com/localtunnel/localtunnel">GitHub 上公开</a>，遵循 MIT 许可证。这意味着你可以自由地使用、修改和分发它。</p>
<p><strong>官方公共服务器：</strong> 默认情况下，命令连接的是由 localtunnel 项目维护者提供的<strong>公共中继服务器</strong>（<code>loca.lt</code>域名）。这是他们提供的免费公共服务</p>
<p><strong>临时性：</strong> 免费提供的链接是<strong>临时的</strong>。当：</p>
<ul>
<li><p>你<strong>主动停止</strong>了运行 <code>npx localtunnel</code>的命令行进程。</p>
</li>
<li><p>你的电脑<strong>断网</strong>或者本地服务进程<strong>停止</strong>。</p>
</li>
<li><p>长时间<strong>没有流量</strong>通过隧道（具体超时时间可能由服务器设定）。</p>
</li>
<li><p>公共服务器维护或重启。</p>
<p>链接就会失效。下次启动时，你会获得一个<strong>新的随机子域名</strong>。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">完整部署流程（仅需两行命令）：</span></span><br><span class="line">cd project/dist &amp;&amp; npx http-server -p 3000 &amp; </span><br><span class="line">npx localtunnel --port 3000</span><br></pre></td></tr></table></figure>

<h3 id="Coolify"><a href="#Coolify" class="headerlink" title="Coolify"></a>Coolify</h3><p>自托管是完全免费的</p>
<p><a target="_blank" rel="noopener" href="https://coolify.io/">官网</a>    <a target="_blank" rel="noopener" href="https://coolify.io/docs/get-started/installation">官方文档</a></p>
<h1 id="免费云服务器盘点"><a href="#免费云服务器盘点" class="headerlink" title="免费云服务器盘点"></a>免费云服务器盘点</h1><p><a target="_blank" rel="noopener" href="https://free-for.dev/#/?id=major-cloud-providers">参考来源</a></p>
<ol>
<li><p><strong>Google Cloud Platform (GCP)</strong></p>
<ul>
<li><strong>免费资源</strong>：<ul>
<li>1个非抢占式 e2-micro实例（每月750小时，可连续运行）</li>
<li>30GB HDD存储 + 5GB快照存储</li>
<li>5GB Cloud Storage + 1GB网络出口流量</li>
</ul>
</li>
<li><strong>条件</strong>：仅限特定区域（如 us-west1, us-central1），超出部分按量付费。</li>
</ul>
</li>
<li><p><strong>Oracle Cloud</strong></p>
<ul>
<li><strong>免费资源</strong>：<ul>
<li>2个AMD虚拟机（1&#x2F;8 OCPU + 1GB内存）</li>
<li>4个Arm核心 + 24GB内存（可拆分或单机使用）</li>
<li>200GB块存储 + 10GB对象存储</li>
</ul>
</li>
<li><strong>条件</strong>：实例闲置时可能被回收，10TB免费出口流量&#x2F;月。</li>
</ul>
</li>
<li><p><strong>Cloudflare Workers</strong></p>
<ul>
<li><strong>免费资源</strong>：<ul>
<li>无服务器部署（10万次请求&#x2F;日）</li>
<li>Workers KV（100k读请求&#x2F;日）</li>
<li>R2对象存储（10GB&#x2F;月）</li>
</ul>
</li>
<li><strong>特点</strong>：全球边缘网络，无需管理服务器。</li>
</ul>
</li>
<li><p><strong>Fly.io</strong></p>
<ul>
<li><strong>免费资源</strong>：<ul>
<li>3台共享CPU虚拟机（256MB内存&#x2F;台）</li>
<li>3GB持久存储</li>
<li>160GB出站流量&#x2F;月</li>
</ul>
</li>
<li><strong>适合</strong>：轻量级容器化应用。</li>
</ul>
</li>
<li><p><strong>Koyeb</strong></p>
<ul>
<li><strong>免费资源</strong>：<ul>
<li>2个vCPU + 2GB内存实例</li>
<li>无限应用部署</li>
</ul>
</li>
<li><strong>限制</strong>：需绑定信用卡，但免费额度不扣费。</li>
</ul>
</li>
</ol>
<h1 id="开源自托管项目盘点"><a href="#开源自托管项目盘点" class="headerlink" title="开源自托管项目盘点"></a>开源自托管项目盘点</h1><h2 id="git服务器"><a href="#git服务器" class="headerlink" title="git服务器"></a>git服务器</h2><table>
<thead>
<tr>
<th>特性维度</th>
<th><a href="#GitLab">GitLab CE (社区版)</a></th>
<th>Gitea</th>
<th>Forgejo (Gitea 分支)</th>
<th>Gogs</th>
<th>OneDev</th>
<th>GitBucket</th>
</tr>
</thead>
<tbody><tr>
<td><strong>核心定位</strong></td>
<td>一体化、功能全面的 DevOps 平台</td>
<td>轻量级、快速、功能丰富的协作平台</td>
<td>由社区驱动，注重自由与隐私的协作平台</td>
<td>极致轻量、最简单的协作平台</td>
<td>All-in-One、内置 CI&#x2F;CD 的 DevOps 平台</td>
<td>类 GitHub、易上手的协作平台</td>
</tr>
<tr>
<td><strong>开源协议</strong></td>
<td>MIT (社区版)</td>
<td>MIT</td>
<td>MIT</td>
<td>MIT</td>
<td>Apache-2.0</td>
<td>Apache-2.0</td>
</tr>
<tr>
<td><strong>开发语言</strong></td>
<td>Ruby on Rails</td>
<td>Go</td>
<td>Go</td>
<td>Go</td>
<td>Java (?)</td>
<td>Scala</td>
</tr>
<tr>
<td><strong>资源占用</strong></td>
<td>高 (推荐 4核 CPU, 4GB+ 内存) 🚀</td>
<td>低 (约 1GB 内存) ✅</td>
<td>低 (与 Gitea 相近) ✅</td>
<td>极低 (树莓派可运行) ✅</td>
<td>中等</td>
<td>较低 ✅</td>
</tr>
<tr>
<td><strong>核心功能</strong></td>
<td>仓库管理、Issue、PR、Wiki、CI&#x2F;CD、容器仓库、监控</td>
<td>仓库管理、Issue、PR、Wiki、Actions、包注册表</td>
<td>仓库管理、Issue、PR、Wiki、Actions、包注册表</td>
<td>仓库管理、Issue、PR、Wiki (专注核心功能)</td>
<td>仓库管理、Issue看板、内置CI&#x2F;CD、代码搜索</td>
<td>仓库管理、Issue、PR、Wiki、插件系统</td>
</tr>
<tr>
<td><strong>CI&#x2F;CD 方式</strong></td>
<td>强大且内置 (.gitlab-ci.yml)</td>
<td>通过 Actions (兼容 GitHub)</td>
<td>通过 Actions (兼容 GitHub)</td>
<td>需外部集成 (如 Drone, Jenkins)</td>
<td>强大且内置 (图形化或 YAML 配置) 🚀</td>
<td>需外部集成 (如 Jenkins)</td>
</tr>
<tr>
<td><strong>特色优势</strong></td>
<td>功能最全面，开箱即用，覆盖 DevOps 全生命周期</td>
<td>社区活跃，功能与资源占用的最佳平衡，迭代快</td>
<td>强调数据主权、社区治理，避免商业公司控制</td>
<td>安装部署最简单，资源占用极低</td>
<td>智能（代码搜索导航）、深度集成CI&#x2F;CD</td>
<td>API 兼容性好，操作类似 GitHub</td>
</tr>
<tr>
<td><strong>潜在缺点</strong></td>
<td>资源消耗大，安装和维护相对复杂，高级功能需要企业版 (EE)</td>
<td>功能广度与深度不及 GitLab</td>
<td>生态与市场占有率暂不如 Gitea</td>
<td>功能相对较少，高级协作功能有限</td>
<td>基于 Java，资源占用相对 Go 语言项目稍高</td>
<td>开发活跃度和社区规模相对较小</td>
</tr>
<tr>
<td><strong>最适合场景</strong></td>
<td>中大型团队，需要开箱即用的完整 DevOps 解决方案，不介意资源消耗</td>
<td>中小团队及个人项目，追求功能、资源和社区的最佳平衡</td>
<td>注重数据隐私、合规和社区治理的团队</td>
<td>微型团队、个人项目及资源极度受限的环境</td>
<td>需要开箱即用CI&#x2F;CD的中小团队，喜欢一体化</td>
<td>喜欢 GitHub 风格、寻求简单易用的团队</td>
</tr>
</tbody></table>
<h3 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h3><p>🛠️ <strong>GitLab：一体化 DevOps 平台</strong></p>
<p>GitLab 是一个基于 Git 的一体化 DevOps 平台，覆盖了从项目规划、源代码管理到 CI&#x2F;CD、监控的整个软件开发生命周期。</p>
<ul>
<li><p><strong>它能做什么</strong>：</p>
<ul>
<li><strong>代码仓库管理</strong>：提供强大的 Git 仓库管理功能，支持代码审查、分支保护、合并请求（Merge Requests）。</li>
<li><strong>内建 CI&#x2F;CD</strong>：通过 .gitlab-ci.yml 配置文件无缝集成持续集成和交付，自动化构建、测试和部署流程。</li>
<li><strong>项目管理</strong>：提供问题跟踪（Issue Tracking）、Wiki 文档、看板（Kanban）等功能，帮助团队协同。</li>
<li><strong>多种部署方式</strong>：提供 SaaS 托管服务（gitlab.com），也支持私有化部署（社区版免费，企业版付费），适合对数据安全有高要求的企业。</li>
</ul>
</li>
<li><p><strong>谁适合用</strong>：</p>
<ul>
<li>寻求开箱即用、高度集成的 DevOps 解决方案的团队。</li>
<li>希望减少在工具链整合上花费精力的开发者。</li>
</ul>
</li>
</ul>
<h3 id="gitbucket"><a href="#gitbucket" class="headerlink" title="gitbucket"></a>gitbucket</h3><p><a target="_blank" rel="noopener" href="https://github.com/gitbucket/gitbucket">GitBucket</a> 是一个由 Scala 驱动的 Git 网络平台，提供以下功能：</p>
<ul>
<li>简单安装</li>
<li>直观的用户界面</li>
<li><strong>插件</strong>高度可扩展</li>
<li>与 GitHub API 兼容</li>
</ul>
<h3 id="Gitea"><a href="#Gitea" class="headerlink" title="Gitea"></a>Gitea</h3><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>Gitea</strong></th>
<th><strong>GitBucket</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>主要语言</strong></td>
<td>Go</td>
<td>Scala (JVM)</td>
</tr>
<tr>
<td><strong>部署方式</strong></td>
<td>单文件可执行，Docker，群辉套件支持</td>
<td>Java WAR 包 &#x2F; Docker</td>
</tr>
<tr>
<td><strong>资源占用</strong></td>
<td>很低，轻量</td>
<td>较高，需要 JVM</td>
</tr>
<tr>
<td><strong>界面风格</strong></td>
<td>类 GitHub &#x2F; GitLab 简洁</td>
<td>几乎 GitHub 原版风格</td>
</tr>
<tr>
<td><strong>功能</strong></td>
<td>Issues、PR、Wiki、CI&#x2F;CD (Gitea Actions)、Web IDE</td>
<td>Issues、PR、Wiki，可通过插件扩展 CI&#x2F;CD、GitLFS 等</td>
</tr>
<tr>
<td><strong>插件&#x2F;扩展</strong></td>
<td>内置功能多，插件较少</td>
<td>插件机制灵活，可扩展功能</td>
</tr>
<tr>
<td><strong>社区活跃度</strong></td>
<td>非常活跃，更新快</td>
<td>不算活跃，更新慢</td>
</tr>
<tr>
<td><strong>适合场景</strong></td>
<td>NAS、小团队、个人开发、轻量部署</td>
<td>Java 团队、内部 GitHub 风格、需要插件扩展</td>
</tr>
<tr>
<td><strong>长期维护性</strong></td>
<td>高，社区活跃，更新频繁</td>
<td>中，依赖少数维护者，更新较慢</td>
</tr>
<tr>
<td><strong>易用性</strong></td>
<td>非常简单，上手快</td>
<td>上手容易，但依赖 JVM 配置</td>
</tr>
</tbody></table>
<p>似乎gitea更好</p>
<h4 id="docker部署Gitea"><a href="#docker部署Gitea" class="headerlink" title="docker部署Gitea"></a>docker部署Gitea</h4><p>使用docker部署非常简单</p>
<ol>
<li><p><strong>打开 Docker → 注册表</strong></p>
<ul>
<li>搜索 gitea&#x2F;gitea</li>
<li>选择 latest 镜像下载</li>
</ul>
</li>
<li><p><strong>创建容器</strong></p>
<ul>
<li><p>打开 <strong>容器 → 添加 → 使用镜像</strong></p>
</li>
<li><p>选择 gitea&#x2F;gitea:latest</p>
</li>
<li><p>配置基本设置：</p>
<ul>
<li><p><strong>容器名称</strong>：gitea</p>
</li>
<li><p><strong>启动方式</strong>：开机自启</p>
</li>
<li><p><strong>网络</strong>：桥接模式（Bridge）</p>
</li>
<li><p><strong>端口映射</strong></p>
<ul>
<li>容器端口 -  NAS端口</li>
<li>3000    -  3000</li>
<li>22      -  2222</li>
</ul>
</li>
<li><p>卷映射</p>
<p>nas中的data和git文件夹要自己新建</p>
<ul>
<li><code>\data</code> -  <code>/volume1/docker/gitea/data</code></li>
<li><code>\git</code> -   <code>/volume1/docker/gitea/git</code></li>
<li><code>\ssl</code> -  <code>/volume1/docker/certbot/etc/</code>   用于结合<a href="#certbot">certbot</a>配置<a href="#%E4%B8%BAGitea%E6%9C%AC%E8%BA%AB%E9%85%8D%E7%BD%AESSL%E8%AF%81%E4%B9%A6">gitea自身的ssl配置</a>,需要将符号链接文件和原本文件的路径都配置上才行</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>启动容器后就可以访问 <code>http://NAS_IP:3000</code> ,会显示Gitea初始化界面</p>
<p>初始化界面中推荐使用 SQLite（轻量级，直接用文件即可）</p>
</li>
</ol>
<p>使用<code>tail -f /var/log/gitea/gitea.log</code>查看gitea日志,也可以使用<code>docker logs gitea</code>更方便(gitea是容器名)</p>
<h4 id="权限注意事项"><a href="#权限注意事项" class="headerlink" title="权限注意事项"></a>权限注意事项</h4><p>gitea中,私有库即使给了协助者可写权限,也不能fetch或clone,但是如果将人员加入到组织中,全部成员设置为管理员,却可以进行正常的全部读写操作</p>
<h4 id="将其他项目迁移到gitea流程"><a href="#将其他项目迁移到gitea流程" class="headerlink" title="将其他项目迁移到gitea流程"></a>将其他项目迁移到gitea流程</h4><ol>
<li><a href="#%E5%88%A0%E9%99%A4%E5%8E%9F%E5%A7%8B%E5%87%AD%E8%AF%81(%E5%8F%AF%E9%80%89)">删除原始凭证(可选)</a></li>
<li><a href="#%E8%BF%81%E7%A7%BB%E6%B5%81%E7%A8%8B">迁移流程</a></li>
</ol>
<h5 id="删除原始凭证-可选"><a href="#删除原始凭证-可选" class="headerlink" title="删除原始凭证(可选)"></a>删除原始凭证(可选)</h5><p>界面操作如下</p>
<ul>
<li><p><strong>Windows系统</strong>：</p>
<ol>
<li>打开“控制面板” -&gt; “用户账户” -&gt; “凭据管理器”。</li>
<li>在“Windows凭据”或“普通凭据”中，找到与Coding相关的条目并删除</li>
</ol>
</li>
<li><p><strong>macOS系统</strong>：</p>
<ol>
<li>打开“钥匙串访问”应用。</li>
<li>搜索“Coding”或旧地址，找到并删除对应的“互联网密码”条目</li>
</ol>
</li>
<li><p><strong>Linux:</strong></p>
<p>使用下面命令行方式</p>
</li>
</ul>
<p>使用命令行删除原仓库凭证如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## Windows</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 下面是cmd</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有保存的凭据</span></span><br><span class="line">cmdkey /list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除Coding相关凭据（将&lt;target&gt;替换为列表中的标识）</span></span><br><span class="line">cmdkey /delete:&lt;target&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 下面是powershell</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找Coding凭据</span></span><br><span class="line">Get-ChildItem ~\AppData\Local\GitCredentialManager\credentialstore\</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除特定文件（将&lt;file&gt;替换为实际文件名）</span></span><br><span class="line">Remove-Item ~\AppData\Local\GitCredentialManager\credentialstore\&lt;file&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## MacOS</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找Coding相关凭据</span></span><br><span class="line">security find-internet-password -s &quot;coding.net&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除凭据</span></span><br><span class="line">security delete-internet-password -s &quot;coding.net&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## Linux</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编辑凭据文件</span></span><br><span class="line">vim ~/.git-credentials</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除包含coding.net的行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">清除缓存（如果使用cache模式）</span></span><br><span class="line">git credential-cache exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 清除后测试连接</span></span></span><br><span class="line">git ls-remote https://coding.net/your/repo.git</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时应弹出新的认证窗口，证明旧凭据已移除</span></span><br></pre></td></tr></table></figure>

<h5 id="迁移流程"><a href="#迁移流程" class="headerlink" title="迁移流程"></a>迁移流程</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在原项目目录下移除原本的远程地址</span></span><br><span class="line">git remote remove origin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将的新仓库地址添加为新的远程地址（命名为 origin）</span></span><br><span class="line">git remote add origin &lt;你的Gitea新仓库URL&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例如：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git remote add origin https://gitea.example.com/yourname/yourproject.git</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看项目的远程仓库信息是否配置上了</span></span><br><span class="line">git remote -v</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查是否连接上新的远程仓库了</span></span><br><span class="line">git fetch origin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看远程仓库详情,会显示远程分支</span></span><br><span class="line">git remote show origin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行以下命令(如果没有新凭证会弹出浏览器要求登录)，将本地所有分支、所有提交历史、所有标签全部推送到新的Gitea仓库</span></span><br><span class="line">git push -u origin --all</span><br><span class="line">git push -u origin --tags</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重建原本就已经存在的本地分支与远程仓库的追踪关系</span></span><br><span class="line">git branch --set-upstream-to=&quot;origin/远程分支名&quot; #使当前分支追踪指定的远程分支名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">之后就可以正常使用git与之交互了</span></span><br></pre></td></tr></table></figure>

<h4 id="gitea配置"><a href="#gitea配置" class="headerlink" title="gitea配置"></a>gitea配置</h4><p>gitea&#x2F;data&#x2F;gitea&#x2F;conf&#x2F;app.ini中配置gitea:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="attr">APP_DATA_PATH</span> = /data/gitea</span><br><span class="line"><span class="attr">DOMAIN</span> = <span class="number">192.168</span>.<span class="number">8.6</span></span><br><span class="line"><span class="attr">SSH_DOMAIN</span> = <span class="number">192.168</span>.<span class="number">8.6</span></span><br><span class="line"><span class="attr">HTTP_PORT</span> = <span class="number">3000</span></span><br><span class="line"><span class="comment">#ROOT_URL = https://xxx.xxx.x<span class="doctag">xxx:</span>xxxx  #限制只能这个域名访问,不保留这一行就可以随意访问</span></span><br><span class="line"><span class="attr">DISABLE_SSH</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">SSH_PORT</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">SSH_LISTEN_PORT</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">LFS_START_SERVER</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">LFS_JWT_SECRET</span> = UewPxQMOLEF7dRIxrCfUKrbm3TxAptRjtUw0cFyRMeE</span><br><span class="line"><span class="attr">OFFLINE_MODE</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">REDIRECT_OTHER_PORT</span> = <span class="literal">true</span> <span class="comment">; 强制重定向非HTTPS端口</span></span><br></pre></td></tr></table></figure>

<h4 id="内外网域名统一设置"><a href="#内外网域名统一设置" class="headerlink" title="内外网域名统一设置"></a>内外网域名统一设置</h4><h5 id="Gitea链接内外网显示一致"><a href="#Gitea链接内外网显示一致" class="headerlink" title="Gitea链接内外网显示一致"></a>Gitea链接内外网显示一致</h5><p>Gitea 的配置文件通常位于安装目录下的 <code>custom/conf/app.ini</code>。使用文本编辑器（如 <code>nano</code>或 <code>vim</code>）打开它,找到 <code>[server]</code>部分，修改或添加以下两个参数</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="comment">; 内部监听地址和端口，保持原样即可，这不影响外部访问</span></span><br><span class="line"><span class="attr">HTTP_ADDR</span> = <span class="number">192.168</span>.<span class="number">8.6</span></span><br><span class="line"><span class="attr">HTTP_PORT</span> = <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; ！！！最重要的配置：设置Gitea的外部访问根URL ！！！</span></span><br><span class="line"><span class="attr">ROOT_URL</span> = https://your-domain.com/</span><br><span class="line"><span class="comment">; 请将 your-domain.com 替换为您实际对外访问的域名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; 其他配置...</span></span><br></pre></td></tr></table></figure>

<p><strong>设置好后检查所有页面上的链接</strong>：特别是仓库的“克隆”地址，应该都显示为 <code>https://your-domain.com/username/repo.git</code>，而不是内网 IP</p>
<h5 id="内外网访问一致"><a href="#内外网访问一致" class="headerlink" title="内外网访问一致"></a>内外网访问一致</h5><p><strong>目标: 让所有用户（无论内外网）都访问统一的、无端口的标准URL</strong></p>
<p>下面的可以跳过(试错流程),直接看<a href="#%E5%86%85%E5%A4%96%E7%BD%91%E5%9F%9F%E5%90%8D%E7%BB%9F%E4%B8%80%E8%AE%BE%E7%BD%AE%E6%A0%87%E5%87%86%E6%B5%81%E7%A8%8B">标准流程</a></p>
<p>通过设置路由器来<strong>为内网用户设置DNS解析</strong>,将域名在内网解析为ip地址+端口号</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.8.6:3000    gitea.your-company.com</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>内网用户</strong>：通过路由器 DNS 或 <code>hosts</code>文件将 <code>your-domain.com</code>解析到 <code>192.168.8.6</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.8.6    your-domain.com</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>外网用户</strong>：通过公网 DNS 解析到穿透服务的公网 IP。</p>
</li>
<li><p>这样所有用户都使用 <code>https://your-domain.com</code>访问，无需区分环境。</p>
</li>
</ul>
<blockquote>
<p>看起来很美好,但实际上<strong>内网DNS解析（或hosts文件）只能解析到IP，无法附带端口号</strong></p>
<p>而外网dns解析却可以解析到IP+端口</p>
<p>因此还需要在内网搭建一个反向代理服务器(如Nginx),让它监听标准的80&#x2F;443端口，然后将请求转发给Gitea的3000端口</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="comment"># 如果配置了SSL证书，也监听443</span></span><br><span class="line">    <span class="comment"># listen 443 ssl;</span></span><br><span class="line">    <span class="attribute">server_name</span> your-domain.com; <span class="comment"># 你的域名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 核心配置：将所有请求转发给Gitea</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3000; <span class="comment"># 或者 http://192.168.8.6:3000</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h3><table>
<thead>
<tr>
<th align="center">访问来源</th>
<th align="center">用户行为</th>
<th align="center">流量路径</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>外网用户</strong></td>
<td align="center">访问 <code>https://your-domain.com</code></td>
<td align="center">域名 → 公网IP → (公网反向代理) → 穿透服务 → <strong>内网Nginx(:80)</strong> → Gitea(:3000)</td>
</tr>
<tr>
<td align="center"><strong>内网用户</strong></td>
<td align="center">访问 <code>http://your-domain.com</code></td>
<td align="center">域名 → 内网IP → <strong>内网Nginx(:80)</strong> → Gitea(:3000)</td>
</tr>
</tbody></table>
<p>但这样依旧内外网不统一,内网是http,而外网却是https,这对于git来说会视为两个仓库,因此还是有问题,应该<a href="#%E5%86%85%E5%A4%96%E7%BD%91%E5%9F%9F%E5%90%8D%E7%BB%9F%E4%B8%80%E8%AE%BE%E7%BD%AE%E6%A0%87%E5%87%86%E6%B5%81%E7%A8%8B">参照标准流程来进行</a></p>
</blockquote>
<h4 id="内外网域名统一设置标准流程"><a href="#内外网域名统一设置标准流程" class="headerlink" title="内外网域名统一设置标准流程"></a>内外网域名统一设置标准流程</h4><p><strong>生产环境的标准实践</strong>，可扩展的企业级架构</p>
<p>架构图:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    subgraph Clients[&quot;客户端&quot;]</span><br><span class="line">        LAN_PC[&quot;内网客户端&quot;]</span><br><span class="line">        WAN_User[&quot;外网用户&quot;]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph CloudflareNet[&quot;Cloudflare 网络&quot;]</span><br><span class="line">        CF_DNS[&quot;Cloudflare DNS\n(域名解析)&quot;]</span><br><span class="line">        CF_Edge[&quot;Cloudflare Edge\n(反向代理/CDN/隧道)&quot;]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph NAS[&quot;群晖 NAS\n(宿主机: 192.168.8.199)&quot;]</span><br><span class="line">        subgraph Macvlan[&quot;Docker Macvlan 网络\n(192.168.8.0/24 独立IP)&quot;]</span><br><span class="line">            Nginx[&quot;Nginx 反向代理\n192.168.8.201\n80/443&quot;]</span><br><span class="line">            Gitea[&quot;Gitea 服务\n192.168.8.202:3000&quot;]</span><br><span class="line">            Cloudflared[&quot;Cloudflared 隧道\n192.168.8.203&quot;]</span><br><span class="line">            Certbot[&quot;Certbot\n一次性申请&quot;]</span><br><span class="line">            CertbotRenew[&quot;Certbot Renew\n自动续期脚本&quot;]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    %% 内网访问</span><br><span class="line">    LAN_PC --&gt;|直接访问 http://192.168.8.202:3000| Gitea</span><br><span class="line">    LAN_PC --&gt;|访问 nas.jhh1.site → 局域网 DNS 解析到 192.168.8.201| Nginx</span><br><span class="line">    Nginx --&gt; Gitea</span><br><span class="line"></span><br><span class="line">    %% 外网访问</span><br><span class="line">    WAN_User --&gt;|https://nas.jhh1.site| CF_Edge</span><br><span class="line">    CF_DNS --&gt; CF_Edge</span><br><span class="line">    CF_Edge --&gt; Cloudflared</span><br><span class="line">    Cloudflared --&gt; Nginx</span><br><span class="line">    Nginx --&gt; Gitea</span><br><span class="line"></span><br><span class="line">    %% Certbot</span><br><span class="line">    Certbot --&gt;|使用 dns-cloudflare 插件申请证书| CF_DNS</span><br><span class="line">    Certbot --&gt;|挂载证书| Nginx</span><br><span class="line">    CertbotRenew --&gt;|定时 renew 证书| Certbot</span><br><span class="line">    CertbotRenew --&gt;|证书更新后 reload 服务| Nginx</span><br><span class="line">    CertbotRenew --&gt;|可选: docker restart Gitea| Gitea</span><br></pre></td></tr></table></figure>

<p>下面流程图:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">flowchart TB</span><br><span class="line">    subgraph LAN[&quot;局域网 192.168.8.0/24&quot;]</span><br><span class="line">        NAS[&quot;宿主机 NAS\n192.168.8.199\n(不能直连 macvlan)&quot;]</span><br><span class="line"></span><br><span class="line">        subgraph Macvlan[&quot;Docker macvlan 网络 (nas-macvlan)&quot;]</span><br><span class="line">            Nginx[&quot;nginx\n192.168.8.201\n80/443\n反向代理 + TLS 证书&quot;]</span><br><span class="line">            Gitea[&quot;gitea\n192.168.8.202:3000\nGit 服务&quot;]</span><br><span class="line">            Cloudflared[&quot;cloudflared\n192.168.8.203\n外网隧道&quot;]</span><br><span class="line">            Certbot[&quot;certbot\n一次性申请证书&quot;]</span><br><span class="line">            CertbotRenew[&quot;certbot-renew\n自动续期脚本 (定时任务)&quot;]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    %% 内网访问</span><br><span class="line">    ClientLAN[&quot;内网客户端&quot;] --&gt;|http://192.168.8.202:3000| Gitea</span><br><span class="line">    ClientLAN --&gt;|https://nas.jjh1.site → 静态DNS: 192.168.8.201| Nginx</span><br><span class="line">    Nginx --&gt; Gitea</span><br><span class="line"></span><br><span class="line">    %% 外网访问</span><br><span class="line">    ClientWAN[&quot;外网用户&quot;] --&gt;|https://nas.jjh1.site| CloudflareNet[&quot;Cloudflare 节点&quot;]</span><br><span class="line">    CloudflareNet --&gt; Cloudflared</span><br><span class="line">    Cloudflared --&gt; Nginx</span><br><span class="line">    Nginx --&gt; Gitea</span><br><span class="line"></span><br><span class="line">    %% Certbot</span><br><span class="line">    Certbot --&gt;|dns-cloudflare 验证申请证书| CloudflareNet</span><br><span class="line">    Certbot --&gt;|证书挂载| Nginx</span><br><span class="line">    CertbotRenew --&gt;|周期执行 certbot renew| Certbot</span><br><span class="line">    CertbotRenew --&gt;|检测到续期成功后 reload 服务| Nginx</span><br><span class="line">    CertbotRenew --&gt;|可选: docker restart gitea| Gitea</span><br></pre></td></tr></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202509230945356.png" alt="image-20250923094526592" style="zoom:33%;" />

<h5 id="为内网环境部署HTTPS证书"><a href="#为内网环境部署HTTPS证书" class="headerlink" title="为内网环境部署HTTPS证书"></a>为内网环境部署HTTPS证书</h5><p><strong>使用Let’s Encrypt免费证书（需公网域名）</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在内网服务器安装certbot</span></span><br><span class="line">sudo apt install certbot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过DNS验证申请证书（无需开放80/443端口）</span></span><br><span class="line">certbot certonly --manual --preferred-challenges dns -d your-domain.com</span><br></pre></td></tr></table></figure>

<p>按提示在域名DNS添加TXT记录验证所有权，证书将生成在 <code>/etc/letsencrypt/live/your-domain.com/</code></p>
<h6 id="需要配置自动续期"><a href="#需要配置自动续期" class="headerlink" title="需要配置自动续期"></a>需要配置自动续期</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">每月自动续期</span></span><br><span class="line">sudo certbot renew --quiet --post-hook &quot;systemctl reload nginx&quot;</span><br></pre></td></tr></table></figure>

<h5 id="配置内网Nginx-HTTPS反向代理"><a href="#配置内网Nginx-HTTPS反向代理" class="headerlink" title="配置内网Nginx HTTPS反向代理"></a>配置内网Nginx HTTPS反向代理</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/sites-available/gitea</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> your-domain.com;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 证书路径（选择方案A或B的路径）</span></span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/your-domain.com/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/your-domain.com/privkey.pem;</span><br><span class="line">    <span class="comment"># 或自签名证书路径</span></span><br><span class="line">    <span class="comment"># ssl_certificate /etc/ssl/certs/your-domain.crt;</span></span><br><span class="line">    <span class="comment"># ssl_certificate_key /etc/ssl/private/your-domain.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 强化的SSL配置</span></span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> <span class="string">&#x27;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256&#x27;</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">10m</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:3000; <span class="comment"># 保持HTTP转发</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTP强制跳转HTTPS</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> your-domain.com;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="群晖Nginx"><a href="#群晖Nginx" class="headerlink" title="群晖Nginx"></a>群晖Nginx</h6><p>群晖的nginx配置方式有所不同,因为其本身有内置nginx占用了常用端口</p>
<blockquote>
<p>最好不要动群晖本身的nginx</p>
<p>群晖本身就提供了反向代理服务器的功能,操作位置为: 登录DSM -&gt; 进入 <strong>“控制面板”</strong> -&gt; <strong>“登录门户”</strong> -&gt; <strong>“高级”</strong> 选项卡 -&gt; <strong>“反向代理服务器”</strong>的功能</p>
</blockquote>
<p>由于群晖本身内部的实现就基于Nginx实现的反向代理443接口,因此,我们自建nginx来监听443端口会有冲突,可以通过<a href="#macvlan%E6%9D%A5%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA">macvlan</a>分配的ip地址中监听443端口,就可以监听443端口,并与群晖本身相独立,相关指令如下:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建macvlan网络</span></span><br><span class="line"><span class="attribute">docker</span> network create -d macvlan \</span><br><span class="line">  --subnet=<span class="number">192.168.8.0</span>/<span class="number">24</span> \</span><br><span class="line">  --gateway=<span class="number">192.168.8.1</span> \</span><br><span class="line">  --ip-range=<span class="number">192.168.8.200</span>/<span class="number">29</span> \</span><br><span class="line">  --aux-address=<span class="string">&quot;host=192.168.8.199&quot;</span> \</span><br><span class="line">  -o parent=eth1 \</span><br><span class="line">  nas-macvlan</span><br><span class="line"><span class="comment">#👆🏻这个nas-macvlan网络在NAS重启后会丢失📢📢📢  解决方案,参考下面的 macvlan网络持久化</span></span><br><span class="line"></span><br><span class="line">docker network inspect nas-macvlan<span class="comment">#查看新建的nas-macvlan网络</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动位于macvlan网络中的nginx服务</span></span><br><span class="line">docker run -d --name nginx-macvlan \</span><br><span class="line">  --network nas-macvlan --ip <span class="number">192.168.8.201</span> \</span><br><span class="line">  -v /volume1/docker/nginx/conf:/etc/nginx/conf.d:ro \</span><br><span class="line">  -v /volume1/docker/certbot/etc:/ssl:ro \</span><br><span class="line">  nginx:stable</span><br><span class="line"> </span><br><span class="line"><span class="comment">#启动位于macvlan网络中的gitea服务  这个gitea服务必须可以访问到certbot的证书的live和archive目录,这样才能证书可以后自动更新</span></span><br><span class="line">docker run -d --name gitea-macvlan --network nas-macvlan --ip <span class="number">192.168.8.202</span> --restart unless-stopped -p <span class="number">3000</span>:<span class="number">3000</span> --memory=<span class="string">&quot;4g&quot;</span> -e USER=git -e GITEA_CUSTOM=/data/gitea -v /volume1/docker/gitea/data:/data -v /volume1/docker/gitea/git:/git -v /volume1/docker/certbot/etc:/ssl gitea/gitea:latest</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证容器状态</span></span><br><span class="line"><span class="comment"># 检查IP地址</span></span><br><span class="line">docker inspect --format <span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> gitea-macvlan</span><br><span class="line"><span class="comment"># 检查重启策略</span></span><br><span class="line">docker inspect --format <span class="string">&#x27;&#123;&#123;.HostConfig.RestartPolicy.Name&#125;&#125;&#x27;</span> gitea-macvlan</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动位于macvlan网络中的内网穿透服务(此处必须要手动指明dns,可能是因为无法使用宿主机的dns服务器的原因,不指明无法正常连接cloudflare服务器进行内网穿透)</span></span><br><span class="line">docker run -d --name cloudflare-tunnel-macvlan -e TUNNEL_TOKEN=eyJhIjoiYWVlNmYyZDFlMWU2YTFjZTg3NTdl...   --dns <span class="number">192.168.8.1</span>   --dns <span class="number">223.5.5.5</span> --network nas-macvlan --ip <span class="number">192.168.8.203</span>  --restart unless-stopped --memory=<span class="string">&quot;4g&quot;</span> cloudflare/cloudflared:latest tunnel --<span class="literal">no</span>-autoupdate run</span><br></pre></td></tr></table></figure>

<p>注意一下,👆🏻的容器通过ssh创建的,在群晖nas中的自动重新启动策略是always,即即使正常退出也重启,在界面显示自动重启没有勾选是因为策略不是<code>always</code>,而是<code>unless-stopped</code>,所以实际上不影响出问题自动重启的功能</p>
<blockquote>
<p>更改配置的ip流程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 停止容器</span></span><br><span class="line">docker stop gitea-macvlan</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 断开当前网络</span></span><br><span class="line">docker network disconnect nas-macvlan gitea-macvlan</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 重新连接并指定IP</span></span><br><span class="line">docker network connect --ip 192.168.8.202 nas-macvlan gitea-macvlan</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 启动容器</span></span><br><span class="line">docker start gitea-macvlan</span><br></pre></td></tr></table></figure>
</blockquote>
<p>检查项目如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查配置项目是否已加载</span></span><br><span class="line">sudo nginx -T | grep &quot;gitea.conf&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查配置是否通过语法测试</span></span><br><span class="line">sudo nginx -t</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">应用配置更改</span></span><br><span class="line">sudo systemctl reload nginx</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查监听状态(不需要,因为与原本配置没有区别,原本配置也会监听tcp和tcp6)</span></span><br><span class="line">sudo netstat -tuln | grep :443</span><br></pre></td></tr></table></figure>

<p><strong>macvlan网络持久化</strong></p>
<p>设置开机后执行创建nas-macvlan的指令:</p>
<p><code>控制面板 - 任务计划 - 新增 - 触发的任务 - 用户定义的脚本 - 任务设置 - 用户定义的脚本 </code> 中填入:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh -c &#x27;count=0; until docker info &gt;/dev/null 2&gt;&amp;1; do if [ $count -ge 30 ]; then echo &quot;Docker未在预期时间内启动&quot;; exit 1; fi; count=$((count+1)); sleep 1; done; if ! docker network inspect nas-macvlan &gt;/dev/null 2&gt;&amp;1; then docker network create -d macvlan --subnet=192.168.8.0/24 --gateway=192.168.8.1 --ip-range=192.168.8.200/29 --aux-address=&quot;host=192.168.8.199&quot; -o parent=eth1 nas-macvlan; fi&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">待反馈信息的版本</span></span><br><span class="line">/bin/sh -c &#x27;count=0; until docker info &gt;/dev/null 2&gt;&amp;1; do if [ $count -ge 30 ]; then echo &quot;错误：Docker未在30秒内启动&quot;; exit 1; fi; count=$((count+1)); sleep 1; done; if docker network inspect nas-macvlan &gt;/dev/null 2&gt;&amp;1; then echo &quot;网络nas-macvlan已存在&quot;; else echo &quot;正在创建macvlan网络...&quot;; docker network create -d macvlan --subnet=192.168.8.0/24 --gateway=192.168.8.1 --ip-range=192.168.8.200/29 --aux-address=&quot;host=192.168.8.199&quot; -o parent=eth1 nas-macvlan &amp;&amp; echo &quot;网络创建成功&quot; || echo &quot;网络创建失败&quot;; fi&#x27;</span><br></pre></td></tr></table></figure>

<p>p.s. 在大多数系统的计划任务或脚本输入框中，我们需要将命令写为<strong>一行</strong>，用空格分隔各个参数</p>
<h5 id="内网DNS解析"><a href="#内网DNS解析" class="headerlink" title="内网DNS解析"></a>内网DNS解析</h5><ul>
<li>在路由器或内网DNS服务器将 <code>your-domain.com</code>解析到<strong>内网反向代理服务器IP</strong>（如 <code>192.168.8.201</code>）</li>
<li>或每台设备修改hosts：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.8.201 your-domain.com</span><br></pre></td></tr></table></figure>

<h4 id="gitea分支保护配置"><a href="#gitea分支保护配置" class="headerlink" title="gitea分支保护配置"></a>gitea分支保护配置</h4><p>Gitea 的分支保护设置对于企业规范而言，核心在于<strong>平衡代码质量、安全管控与团队协作效率</strong></p>
<table>
<thead>
<tr>
<th align="left">保护规则</th>
<th align="left">功能描述</th>
<th align="left">适用场景</th>
<th align="left">企业规范建议</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>禁止强制推送</strong></td>
<td align="left">防止覆盖历史提交，确保提交历史可追溯</td>
<td align="left">所有重要分支</td>
<td align="left">对所有保护分支开启</td>
</tr>
<tr>
<td align="left"><strong>要求Pull Request</strong></td>
<td align="left">强制代码审查流程，合并前必须通过PR</td>
<td align="left">所有重要分支</td>
<td align="left">对所有保护分支开启，根据分支重要性设置不同批准人数</td>
</tr>
<tr>
<td align="left"><strong>要求状态检查</strong></td>
<td align="left">确保CI测试通过，代码质量达标</td>
<td align="left">集成测试分支</td>
<td align="left">配置必要的状态检查，如构建、测试、lint检查</td>
</tr>
<tr>
<td align="left"><strong>要求签名提交</strong></td>
<td align="left">验证提交者身份，增强安全性和责任追溯</td>
<td align="left">安全敏感项目</td>
<td align="left">按需开启，通常用于核心库或高风险项目</td>
</tr>
<tr>
<td align="left"><strong>限制推送权限</strong></td>
<td align="left">指定特定用户或团队拥有推送权限</td>
<td align="left">核心代码分支</td>
<td align="left">通常仅授权技术负责人或核心维护者</td>
</tr>
</tbody></table>
<p>企业中的代码库通常需要保护以下关键分支：</p>
<ol>
<li><strong><a href="#%E7%94%9F%E4%BA%A7%E5%88%86%E6%94%AF">生产分支</a>（如 <code>main</code>或 <code>master</code>）</strong>: 这是最严格保护的分支，通常对应生产环境。</li>
<li><strong><a href="#%E5%BC%80%E5%8F%91%E5%88%86%E6%94%AF">开发分支</a>（如 <code>develop</code>）</strong>: 集成分支，用于合并各个功能分支，稳定性次于主分支但仍需保护。</li>
<li><strong><a href="#%E5%8F%91%E5%B8%83%E5%88%86%E6%94%AF">发布分支</a>（如 <code>release/*</code>）</strong>: 用于测试和准备发布的分支。</li>
<li><strong><a href="#%E7%83%AD%E4%BF%AE%E5%A4%8D%E5%88%86%E6%94%AF">热修复分支</a>（如 <code>hotfix/*</code>）</strong>: 用于紧急修复生产环境问题。</li>
</ol>
<h5 id="生产分支"><a href="#生产分支" class="headerlink" title="生产分支"></a>生产分支</h5><p>这是你的“黄金标准”，保护应该最为严格。</p>
<ul>
<li><strong>要求 Pull Request</strong>: <strong>必须开启</strong>。所有合并必须通过代码审查。</li>
<li><strong>所需批准数</strong>: <strong>建议至少 2 人</strong>。重要修改应获得多位核心成员的认可</li>
<li><strong>禁止强制推送</strong>: <strong>必须开启</strong>。防止历史提交被覆盖。</li>
<li><strong>要求状态检查</strong>: <strong>必须开启</strong>。必须通过所有CI流程（如编译、单元测试、集成测试、安全扫描等）才能合并。</li>
<li><strong>要求签名提交</strong>: <strong>按需开启</strong>。对于安全要求极高的项目，可以要求所有提交必须经过GPG签名验证。</li>
<li><strong>限制推送权限</strong>: <strong>强烈建议</strong>。通常只授权给团队负责人或少数核心成员，其他开发者通过PR协作。</li>
</ul>
<h5 id="开发分支"><a href="#开发分支" class="headerlink" title="开发分支"></a>开发分支</h5><p>开发分支是活动最频繁的集成分支，需在质量和效率间权衡。</p>
<ul>
<li><strong>要求 Pull Request</strong>: <strong>必须开启</strong>。功能分支合并到develop前必须经过审查。</li>
<li><strong>所需批准数</strong>: <strong>至少 1 人</strong>。通常由项目核心开发人员或团队负责人批准即可</li>
<li><strong>禁止强制推送</strong>: <strong>必须开启</strong>。</li>
<li><strong>要求状态检查</strong>: <strong>必须开启</strong>。至少需要通过基础CI构建和测试。</li>
<li><strong>限制推送权限</strong>: <strong>通常不开启</strong>，允许所有开发者创建指向develop的PR。但可根据团队成熟度调整。</li>
</ul>
<h5 id="分支命名规范"><a href="#分支命名规范" class="headerlink" title="分支命名规范"></a>分支命名规范</h5><p>清晰的分支命名能极大提升管理效率。推荐以下规范：</p>
<ul>
<li><strong>功能分支</strong>: <code>feat/简短功能描述</code>，例如 <code>feat/user-authentication</code></li>
<li><strong>修复分支</strong>: <code>fix/问题简要描述</code>，例如 <code>fix/login-validation</code></li>
<li><strong>文档分支</strong>: <code>docs/更新内容描述</code>，例如 <code>docs/api-reference</code></li>
<li><strong>重构分支</strong>: <code>refactor/修改模块描述</code>，例如 <code>refactor/database-layer</code></li>
<li><strong>发布分支</strong>: <code>release/版本号</code>，例如 <code>release/v1.2.0</code></li>
<li><strong>热修复分支</strong>: <code>hotfix/紧急问题描述</code>，例如 <code>hotfix/critical-security-patch</code></li>
</ul>
<h5 id="实际保护配置"><a href="#实际保护配置" class="headerlink" title="实际保护配置"></a>实际保护配置</h5><h2 id="certbot"><a href="#certbot" class="headerlink" title="certbot"></a>certbot</h2><p>比acme更好用</p>
<p><strong>Certbot</strong>是一个由Electronic Frontier Foundation （EFF）赞助的开源工具，用于自动化管理和部署SSL&#x2F;TLS证书。SSL&#x2F;TLS证书是用于加密网站与用户之间传输的数据的一种安全协议。Certbot的主要目的是使网站管理员能够轻松获取、部署和更新这些证书，以确保网站的安全性</p>
<p><a target="_blank" rel="noopener" href="https://github.com/certbot/certbot">github链接</a></p>
<p>Let’s Encrypt 采用 <strong>ACME 协议</strong>来自动化验证你是否真正控制着要申请证书的域名。上述流程中最常见的两种验证方式是：</p>
<table>
<thead>
<tr>
<th align="left">验证方式</th>
<th align="left">是否需要公网IP</th>
<th align="left">是否需要开放端口</th>
<th align="left">配合内网穿透的可行性</th>
<th align="left">推荐度</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>HTTP-01</strong></td>
<td align="left">间接需要（穿透服务器有即可）</td>
<td align="left">需要开80端口</td>
<td align="left"><strong>可行但麻烦</strong>，受穿透服务限制</td>
<td align="left">⭐⭐</td>
</tr>
<tr>
<td align="left"><strong>DNS-01</strong></td>
<td align="left"><strong>完全不需要</strong></td>
<td align="left"><strong>不需要</strong></td>
<td align="left"><strong>非常可行且简单</strong>，是最佳方案</td>
<td align="left">⭐⭐⭐⭐⭐</td>
</tr>
</tbody></table>
<ul>
<li>**HTTP-01 挑战 (HTTP-01 Challenge)**：这是最常用的方式。Certbot 会在你的服务器上（通常是80端口）临时生成一个特定的验证文件，Let’s Encrypt 的服务器会尝试通过公网访问这个文件（例如 <code>http://你的域名/.well-known/acme-challenge/某个令牌</code>）。如果你的服务器没有公网IP，或者80端口被防火墙阻挡，外界就无法访问到这个文件，验证自然会失败</li>
<li><strong>DNS-01 挑战 (DNS-01 Challenge)<strong>：这种方式下，Certbot 会提供一个特定的文本（TXT）记录，你需要手动或通过API自动将其添加到你的域名DNS配置中。Let’s Encrypt 随后会通过查询DNS来验证。这种方式</strong>不要求你的服务器有公网IP或开放端口</strong>，但需要你能够操作域名的DNS记录。这对于无法开放端口的服务器或申请通配符证书（*.\你的域名.com）非常有用。<ul>
<li>无论服务器在哪里（有无公网IP），运行 <code>certbot certonly --manual --preferred-challenges dns</code>。</li>
<li>Certbot 会给你提供一个随机生成的TXT记录值。</li>
<li><strong>手动（或通过API脚本自动）</strong> 到你的域名DNS管理后台（如阿里云、Cloudflare等），为你的域名添加这条TXT记录（例如 <code>_acme-challenge.example.com. IN TXT &quot;随机值&quot;</code>）。</li>
<li>确认记录添加后，回车继续。</li>
<li>Let’s Encrypt 会去查询域名的DNS记录，如果找到并匹配成功，就颁发证书。</li>
<li>成功后，别忘了从DNS中删除那条TXT记录（虽然不删也没大问题，但保持整洁为好）</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果服务器位于<strong>网络地址转换（NAT）</strong> 后面，或者由云服务提供商托管，但提供商<strong>集成了 Let’s Encrypt</strong>（例如某些云平台的负载均衡器或托管服务），那么你<strong>可能不需要</strong>直接在你的服务器实例上配置公网IP。证书的申请和验证过程可以由云平台在其基础设施层面代为完成</p>
</blockquote>
<p>为确保顺利申请证书，你的服务器和环境需满足以下条件</p>
<ul>
<li><strong>公网IP与开放端口</strong>：服务器需具备公网IP，并确保所需验证端口（HTTP-01验证需开放80端口）未被防火墙或云服务商的安全组阻挡。</li>
<li><strong>域名与DNS解析</strong>：你必须拥有一个已注册的域名，并已将该域名（如 <code>example.com</code>和 <code>www.example.com</code>）的DNS记录（通常是A记录或CNAME记录）正确解析到你的服务器公网IP。</li>
<li><strong>服务器环境</strong>：服务器需安装支持的操作系统（如Linux发行版），并具备命令行<code>sudo</code>权限。对于<strong>HTTP-01验证</strong>，需提前安装并运行Web服务器软件（如Nginx或Apache）；对于<strong>DNS-01验证</strong>，需具备域名DNS管理权限或API访问密钥。</li>
<li><strong>Certbot工具</strong>：在服务器上安装Certbot客户端。官方推荐通过Snap包安装，以获得最新版本和完整功能</li>
</ul>
<h3 id="安装流程"><a href="#安装流程" class="headerlink" title="安装流程"></a>安装流程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Debian/Ubuntu安装certbot</span></span><br><span class="line">apt update -y &amp;&amp; apt install -y certbot</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">CentOS安装certbot</span></span><br><span class="line">yum -y update &amp;&amp; yum -y install certbot</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Alpine Linux安装certbot</span></span><br><span class="line">apk update &amp;&amp; apk add certbot</span><br></pre></td></tr></table></figure>

<p>首先确保80和443端口未被占用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -s ipv4.ip.sb</span><br><span class="line">certbot certonly --standalone -d $yuming --email your@email.com --agree-tos --no-eff-ernewal</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">证书存放目录</span></span><br><span class="line">ls /etc/letsencrypt/live/</span><br></pre></td></tr></table></figure>

<h3 id="docker方案部署流程"><a href="#docker方案部署流程" class="headerlink" title="docker方案部署流程"></a>docker方案部署流程</h3><p>docker方式参考下面</p>
<table>
<thead>
<tr>
<th align="left">步骤</th>
<th align="left">操作内容</th>
<th align="left">关键信息&#x2F;命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>1. 选择验证方式</strong></td>
<td align="left">采用 <strong>DNS-01 验证</strong></td>
<td align="left">无需公网IP，需域名服务商API支持。</td>
</tr>
<tr>
<td align="left"><strong>2. 准备域名API凭证</strong></td>
<td align="left">从您的域名服务商（如Cloudflare）获取API密钥。</td>
<td align="left">例如Cloudflare的 <code>Global API Key</code>或 <code>Token</code>。</td>
</tr>
<tr>
<td align="left"><strong>3. 创建存储目录</strong></td>
<td align="left">在群晖上创建目录，用于持久化Certbot配置和证书。</td>
<td align="left"><code>mkdir -p /docker/certbot/&#123;etc,lib,log&#125;</code></td>
</tr>
<tr>
<td align="left"><strong>4. 首次申请证书</strong></td>
<td align="left">运行Certbot容器，使用DNS插件和API凭证申请证书。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><strong>5. 配置自动续期</strong></td>
<td align="left">创建续期脚本，并添加群晖计划任务。</td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="获取cloudflare-api-token"><a href="#获取cloudflare-api-token" class="headerlink" title="获取cloudflare api token"></a>获取cloudflare api token</h4><p><a target="_blank" rel="noopener" href="https://dash.cloudflare.com/profile/api-tokens">cloudflare获取api token链接</a></p>
<p>这个api token必须要有修改dns记录的权限</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202509151533238.png" alt="image-20250915153328475" style="zoom: 33%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202509151534850.png" alt="image-20250915153455139" style="zoom: 33%;" />

<p><strong>配置令牌权限和范围</strong>：</p>
<ul>
<li><strong>权限</strong>（Permissions）：确保权限范围是 <strong>Zone - DNS - Edit</strong>。这赋予了Token修改DNS记录的权限。</li>
<li><strong>资源范围</strong>（Resource scope）：选择 <strong>“包括”</strong> （Include） - <strong>“特定区域”</strong> （Specific zone），然后在下拉列表中选择你托管的那个域名。这样可以将Token的权限限制在仅管理该域名的DNS记录，遵循<strong>最小权限原则</strong>，更安全。</li>
</ul>
<p>完成配置后，点击 <strong>“继续到摘要”</strong> （Continue to summary）检查设置，确认无误后点击 <strong>“创建令牌”</strong> （Create Token）</p>
<h4 id="下载运行镜像申请证书"><a href="#下载运行镜像申请证书" class="headerlink" title="下载运行镜像申请证书"></a>下载运行镜像申请证书</h4><table>
<thead>
<tr>
<th align="left">镜像名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>certbot/certbot</code></td>
<td align="left"><strong>基础镜像</strong>，只包含核心的 certbot 功能，<strong>不包含任何 DNS 插件</strong>。</td>
</tr>
<tr>
<td align="left"><code>certbot/dns-cloudflare</code></td>
<td align="left"><strong>专用镜像</strong>，在基础镜像上<strong>额外预装了</strong> <code>certbot-dns-cloudflare</code>插件，支持 <code>--dns-cloudflare</code>参数。</td>
</tr>
</tbody></table>
<p>由于没有公网ip,所以需要采用 <strong>DNS-01 验证</strong>方式申请证书,因此需要的镜像是<code>certbot/dns-cloudflare</code></p>
<p>新建需要映射的文件夹和文件</p>
<ul>
<li>点击 <strong>添加文件夹</strong>。<ul>
<li><strong>文件夹</strong>：选择您之前创建的 <code>/docker/certbot/etc</code></li>
<li><strong>挂载路径</strong>：输入 <code>/etc/letsencrypt</code></li>
</ul>
</li>
<li>再次点击 <strong>添加文件夹</strong>。<ul>
<li><strong>文件夹</strong>：选择 <code>/docker/certbot/lib</code></li>
<li><strong>挂载路径</strong>：输入 <code>/var/lib/letsencrypt</code></li>
</ul>
</li>
<li>再次点击 <strong>添加文件夹</strong>。<ul>
<li><strong>文件夹</strong>：选择 <code>/docker/certbot/logs</code></li>
<li><strong>挂载路径</strong>：输入 <code>/var/log/letsencrypt</code></li>
</ul>
</li>
<li><strong>点击添加文件</strong>（这是一个重要技巧！）<ul>
<li><strong>文件</strong>：选择您创建的 <code>cloudflare.ini</code>凭证文件。</li>
<li><strong>挂载路径</strong>：输入 <code>/etc/letsencrypt/cloudflare.ini:ro</code>。最后的 <code>:ro</code>代表只读，更安全(群晖中不写:ro,而是手动选择只读)</li>
</ul>
</li>
</ul>
<p>cloudflare.ini中内容如下:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果您使用的是 Global API Key（不推荐，但可用）：</span></span><br><span class="line"><span class="attr">dns_cloudflare_email</span> = your_login_email@example.com</span><br><span class="line"><span class="attr">dns_cloudflare_api_key</span> = your_global_api_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者，如果您使用的是 API Token（推荐，更安全）：</span></span><br><span class="line"><span class="attr">dns_cloudflare_api_token</span> = your_api_token_here(这套方案采用这种方式,这里填入上一个流程获取到的cloudflare的api token)</span><br></pre></td></tr></table></figure>

<p>👆🏻要么使用 <code>dns_cloudflare_email</code>+ <code>dns_cloudflare_api_key</code>组合，要么<strong>单独使用</strong> <code>dns_cloudflare_api_token</code>。<strong>绝不能</strong>同时出现这三行</p>
<p>运行镜像的配置如下:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202509171736505.png" alt="image-20250917173621893" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">写成指令大概如下:</span></span><br><span class="line">docker run --rm \</span><br><span class="line">  --name certbot-ApplyOnce \</span><br><span class="line">  -p 443:443/tcp \</span><br><span class="line">  -p 80:80/tcp \</span><br><span class="line">  -v /docker/certbot/etc:/etc/letsencrypt \</span><br><span class="line">  -v /docker/certbot/lib:/var/lib/letsencrypt \</span><br><span class="line">  -v /docker/certbot/logs:/var/log/letsencrypt \</span><br><span class="line">  -v /docker/certbot/cloudflare.ini:/etc/letsencrypt/cloudflare.ini:ro \</span><br><span class="line">  -e PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin... \</span><br><span class="line">  -e LANG=C.UTF-8 \</span><br><span class="line">  -e GPG_KEY=7169605F62C751356D054A26A821E680... \</span><br><span class="line">  -e PYTHON_VERSION=3.12.10 \</span><br><span class="line">  -e PYTHON_SHA256=07ab697474595e06f06647417d3c7fa97d... \</span><br><span class="line">  -e EMAIL=xxxxxxxxxx@qq.com \</span><br><span class="line">  --memory=&quot;4g&quot; \</span><br><span class="line">  certbot/dns-cloudflare \</span><br><span class="line">  certonly --non-interactive --agree-tos --email xxxxxxxxxx@qq.com \</span><br><span class="line">  --dns-cloudflare --dns-cloudflare-credentials /etc/letsencrypt/cloudflare.ini \</span><br><span class="line">  --dns-cloudflare-propagation-seconds 30 \</span><br><span class="line">  -d nas.jhh1.site -d *.nas.jhh1.site</span><br></pre></td></tr></table></figure>

<p>运行后可以在日志<code>/docker/certbot/logs/...</code>中观察到如下内容表示成功,虽然docker消息会显示<code>意外中断</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Successfully received certificate.</span><br><span class="line">Certificate is saved at: /etc/letsencrypt/live/nas.xxxx.site/fullchain.pem</span><br><span class="line">Key is saved at:         /etc/letsencrypt/live/nas.xxxx.site/privkey.pem</span><br><span class="line">This certificate expires on 2025-12-16.</span><br></pre></td></tr></table></figure>

<p>生成的证书在此处: <code>ls -la /volume1/docker/certbot/etc/archive/nas.xxxx.site/</code>(不需要勾选显示隐藏就能看见)</p>
<p>在<code>/volume1/docker/certbot/etc/live/nas.xxxx.site/</code>里，您会找到以下几个符号链接文件(在群晖中默认被隐藏,在ssh中可以被看到),他们始终指向archive中的真实证书文件(真实证书文件名最后会带数字编号,更新后得以标识证书)</p>
<ul>
<li><code>fullchain.pem</code>- <strong>证书链文件</strong> (这是您需要在Web服务器中配置的证书文件)</li>
<li><code>privkey.pem</code>- <strong>私钥文件</strong> (这是您需要在Web服务器中配置的密钥文件)</li>
<li><code>cert.pem</code>- 证书文件</li>
<li><code>chain.pem</code>- 中间证书文件</li>
</ul>
<h4 id="自动续期"><a href="#自动续期" class="headerlink" title="自动续期"></a>自动续期</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[创建自动续期脚本] --&gt; B[赋予脚本执行权限]</span><br><span class="line">    B --&gt; C[登录群晖DSM后台]</span><br><span class="line">    C --&gt; D[打开控制面板 → 任务计划器]</span><br><span class="line">    D --&gt; E[创建新计划任务 → 用户定义的脚本]</span><br><span class="line">    E --&gt; F[设置任务执行计划：&lt;br&gt;例如：每月1号和15号 凌晨3点]</span><br><span class="line">    F --&gt; G[在任务设置中粘贴脚本路径]</span><br><span class="line">    G --&gt; H[保存并运行任务测试]</span><br><span class="line">    H --&gt; I[检查证书目录&lt;br&gt;确认续期成功]</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong>创建自动续期脚本</strong></p>
<p>建议放在一个固定的、有权限的目录，例如 <code>/docker/certbot/</code>目录下，方便管理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">记录当前证书的过期时间或修改时间</span></span><br><span class="line">CERT_FILE=&quot;/volume1/docker/certbot/etc/live/nas.jhh1.site/fullchain.pem&quot;</span><br><span class="line">BEFORE_RENEW=$(stat -c %Y &quot;$CERT_FILE&quot; 2&gt;/dev/null || echo 0)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">记录日志，方便排查</span></span><br><span class="line">echo &quot;==============================&quot;</span><br><span class="line">echo &quot;$(date +&quot;%Y-%m-%d %H:%M:%S&quot;): 开始执行证书续期检查&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行Certbot续期命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 --quiet 参数让输出更简洁，只打印错误或真正续期的信息</span></span><br><span class="line">docker run --rm --name certbot-renew \</span><br><span class="line">  -v /volume1/docker/certbot/etc:/etc/letsencrypt \</span><br><span class="line">  -v /volume1/docker/certbot/lib:/var/lib/letsencrypt \</span><br><span class="line">  -v /volume1/docker/certbot/logs:/var/log/letsencrypt \</span><br><span class="line">  -v /volume1/docker/certbot/cloudflare.ini:/etc/letsencrypt/cloudflare.ini:ro \</span><br><span class="line">  certbot/dns-cloudflare renew --non-interactive --quiet</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查状态并判断是否真的续期了</span></span><br><span class="line">if [ $? -eq 0 ]; then   #检查 Docker 容器的退出状态码  0：表示 Certbot 命令执行成功   非 0：表示执行过程中出现错误</span><br><span class="line">    AFTER_RENEW=$(stat -c %Y &quot;$CERT_FILE&quot;)</span><br><span class="line">    if [ &quot;$AFTER_RENEW&quot; -gt &quot;$BEFORE_RENEW&quot; ]; then</span><br><span class="line">        echo &quot;$(date): 证书已成功续期，新证书已生效。&quot;</span><br><span class="line">        #配置续期后自动重新加载服务</span><br><span class="line">    		# 重启群晖的Web Station（Nginx）以使新证书生效</span><br><span class="line">				#synosystemctl restart nginx</span><br><span class="line"></span><br><span class="line">				# 或者，如果您是单独为Gitea配置的反向代理，并且证书是独立使用的，可能需要重启Gitea容器</span><br><span class="line">				docker restart your_gitea_container_name  #名字参考部署gitea时候的容器名</span><br><span class="line">    else</span><br><span class="line">        echo &quot;$(date): 证书检查完成，无需续期（证书尚未到期）。&quot;</span><br><span class="line">    fi</span><br><span class="line">else</span><br><span class="line">    echo &quot;$(date): 证书续期过程中出现错误。&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>赋予脚本执行可读可写权限: <code>chmod +wrx ./renew_cert.sh</code></p>
<p>Certbot 的 <code>renew</code>命令有以下特点：</p>
<ul>
<li>如果证书<strong>未到期</strong>（距离过期时间超过30天），它会安静退出（状态码0），不做任何操作</li>
<li>如果证书<strong>即将到期</strong>（30天内），它会执行续期并退出（状态码0）</li>
<li>只有遇到<strong>错误</strong>时才会返回非零状态码</li>
</ul>
</li>
<li><p><strong>配置群晖计划任务</strong></p>
<ul>
<li>登录 DSM，打开 <strong>控制面板</strong> &gt; <strong>任务计划器</strong>。</li>
<li>点击 <strong>新增</strong> &gt; <strong>计划的任务</strong> &gt; <strong>用户定义的脚本</strong>。</li>
<li>在 <strong>常规</strong> 选项卡中：<ul>
<li><strong>任务</strong>：填写一个描述性名称，例如 <code>Certbot 证书自动续期</code>。</li>
<li><strong>用户账号</strong>：选择 <strong>root</strong>。这一点非常重要，因为普通用户可能没有足够的权限执行 Docker 命令。</li>
</ul>
</li>
<li>在 <strong>计划</strong> 选项卡中：<ul>
<li>设置执行频率。<strong>建议每月运行 1-2 次</strong>（例如，每月 1 号和 15 号的凌晨 3 点）。Let‘s Encrypt 证书会在到期前 30 天才允许续期，所以不需要每天检查。</li>
</ul>
</li>
<li>在 <strong>任务设置</strong> 选项卡中：<ul>
<li>在 <strong>用户定义的脚本</strong> 框中，输入<code>/bin/bash /volume1/docker/certbot/renew_cert.sh</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>验证自动续期是否工作</strong></p>
<ol>
<li><strong>手动测试</strong>：在“任务计划器”中，找到您创建的任务，选中它并点击 <strong>运行</strong>。然后检查脚本输出的日志或去证书目录查看时间戳。</li>
<li><strong>查看日志</strong>：脚本的执行日志会输出到您指定的位置。您也可以运行 <code>docker logs certbot-renew</code>（在任务运行时）来查看实时输出。</li>
<li><strong>检查证书</strong>：续期成功后，<code>/etc/letsencrypt/archive/您的域名/</code>目录下会生成新的证书文件（如 <code>cert2.pem</code>, <code>privkey2.pem</code>），而 <code>live</code>目录下的符号链接会更新指向这些新文件。</li>
</ol>
</li>
</ol>
<h4 id="使用证书"><a href="#使用证书" class="headerlink" title="使用证书"></a>使用证书</h4><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left"><a href="#%E7%BE%A4%E6%99%96%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%AF%81%E4%B9%A6">方案A: 群晖DSM管理证书</a></th>
<th align="left"><a href="#%E4%B8%BAGitea%E6%9C%AC%E8%BA%AB%E9%85%8D%E7%BD%AESSL%E8%AF%81%E4%B9%A6">方案B: Gitea容器管理证书</a></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>配置位置</strong></td>
<td align="left">群晖 <strong>控制面板 -&gt; 安全性 -&gt; 证书</strong></td>
<td align="left">Gitea 容器内部的 <strong><code>app.ini</code></strong> 配置文件</td>
</tr>
<tr>
<td align="left"><strong>自动续期</strong></td>
<td align="left"><strong>无法自动续期</strong>,需手动下载新证书并重新导入</td>
<td align="left"><strong>简单</strong>。指向Certbot的Live目录，续期后自动生效</td>
</tr>
<tr>
<td align="left"><strong>管理方式</strong></td>
<td align="left">图形化界面，简单直观</td>
<td align="left">需修改配置文件</td>
</tr>
<tr>
<td align="left"><strong>影响范围</strong></td>
<td align="left">影响整个DSM系统及所有相关服务</td>
<td align="left"><strong>仅影响Gitea一个服务</strong></td>
</tr>
<tr>
<td align="left"><strong>冲突风险</strong></td>
<td align="left">无</td>
<td align="left"><strong>无</strong>。两者是完全独立的</td>
</tr>
</tbody></table>
<h5 id="群晖中使用证书"><a href="#群晖中使用证书" class="headerlink" title="群晖中使用证书"></a>群晖中使用证书</h5><p>控制面板 - 安全性 - 证书 - 新增 - 新增新证书 - 导入证书 - 导入私钥,证书,中间证书 - 确定</p>
<p>控制面板 - 安全性 - 证书 - 设置 - 将域名设置到对应的证书</p>
<h5 id="为Gitea本身配置SSL证书"><a href="#为Gitea本身配置SSL证书" class="headerlink" title="为Gitea本身配置SSL证书"></a>为Gitea本身配置SSL证书</h5><p>Gitea是直接安装在群晖Docker中的，您可以跳过群晖DSM的证书设置，直接为Gitea容器配置SSL</p>
<p>p.s. 必须是 <strong>Gitea Docker 容器内部</strong> 能访问到的路径,这个路径的设置要参考<a href="#docker%E9%83%A8%E7%BD%B2Gitea">gitea容器本身部署的时候的文件映射</a></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="attr">ROOT_URL</span>  = https://nas.xxxx.site</span><br><span class="line"><span class="attr">CERT_FILE</span> = /ssl/live/nas.xxxx.site/fullchain.pem</span><br><span class="line"><span class="attr">KEY_FILE</span>  = /ssl/live/nas.xxxx.site/privkey.pem</span><br></pre></td></tr></table></figure>

<p>因为gitea的文件夹映射为:<code>/ssl   --&gt;   /volume1/docker/certbot/etc/</code></p>
<p>所以  <code>/ssl/live/nas.xxxx.site/privkey.pem   ---&gt;  /volume1/docker/certbot/etc/live/nas.xxxx.site/privkey.pem</code></p>
<p>重启Gitea容器。这样Gitea服务本身就直接提供了HTTPS</p>
<h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><p>🔄 <strong>Jenkins：灵活可扩展的自动化引擎</strong></p>
<p>Jenkins 是一个开源的、高度可扩展的持续集成和持续交付 (CI&#x2F;CD) 工具。它的核心价值在于自动化软件的构建、测试和部署流程。</p>
<ul>
<li><p><strong>它能做什么</strong>：</p>
<ul>
<li><strong>自动化流水线</strong>：通过丰富的插件生态系统（超1800个插件），支持与各种工具（如 Git、Maven、Docker、Kubernetes 等）集成，实现高度定制化的构建、测试、部署自动化。</li>
<li><strong>流水线即代码</strong>：使用 Jenkinsfile（基于 Groovy）定义流水线，实现复杂流程的版本化和可重复性。</li>
<li><strong>分布式构建</strong>：支持主从（Master-Agent）架构，可在多台机器上分布式执行构建任务，提升效率。</li>
</ul>
</li>
<li><p><strong>谁适合用</strong>：</p>
<ul>
<li>需要高度定制化和控制其 CI&#x2F;CD 流水线的团队。</li>
<li>技术栈多样，需要与大量第三方工具集成的场景。</li>
<li>需要注意的是，Jenkins 通常需要更多的维护和配置工作。</li>
</ul>
</li>
</ul>
<h2 id="私有云平台"><a href="#私有云平台" class="headerlink" title="私有云平台"></a>私有云平台</h2><h3 id="Nextcloud"><a href="#Nextcloud" class="headerlink" title="Nextcloud"></a>Nextcloud</h3><p>☁️ <strong>Nextcloud：开源私有云平台</strong></p>
<p>Nextcloud 是一个<strong>开源的文件同步与共享平台</strong>，允许你搭建属于自己的私有云服务。</p>
<ul>
<li><p><strong>它能做什么</strong>：</p>
<ul>
<li><strong>文件同步与共享</strong>：类似 Dropbox 或 Google Drive，你可以在不同设备间同步文件，并与他人安全共享。</li>
<li><strong>丰富的应用生态</strong>：通过安装应用，可以扩展出日历、联系人管理、在线文档编辑（Collabora Online）、视频会议（Talk）、任务管理等众多功能，成为一个完整的协作平台。</li>
<li><strong>数据掌控与隐私</strong>：所有数据都存储在你自己的服务器上，无需担心第三方云服务的隐私问题。</li>
</ul>
</li>
<li><p><strong>谁适合用</strong>：</p>
<ul>
<li>对数据隐私和安全非常重视的个人、团队或企业。</li>
<li>希望替代公有云服务（如百度网盘、Google Drive），完全掌控自己数据的用户。</li>
</ul>
</li>
</ul>
<h3 id="copyparty"><a href="#copyparty" class="headerlink" title="copyparty"></a>copyparty</h3><p><strong>开箱即用的文件服务器</strong></p>
<p>copyparty 最大的特色就是简单粗暴。整个服务器就是一个 Python 文件，不需要安装任何依赖，双击运行就能启动。</p>
<p>整个安装过程不到 30 秒，服务器启动后会自动监听 3923 端口，用浏览器打开 <a target="_blank" rel="noopener" href="http://localhost:3923/">localhost:3923</a> 就能看到熟悉的文件管理界面。</p>
<p>虽然在界面美观度和插件生态方面还比不上 NextCloud，但它的轻量简单易上手特性，让更多人能上手体验。</p>
<p>如果你正在寻找一个 “开箱即用” 的文件服务器解决方案，不妨试试这个只有一个文件的小工具。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/9001/copyparty">GitHub 项目地址</a></p>
<h1 id="域名相关"><a href="#域名相关" class="headerlink" title="域名相关"></a>域名相关</h1><h2 id="个人域名购买"><a href="#个人域名购买" class="headerlink" title="个人域名购买"></a>个人域名购买</h2><p>费用范围：首年 50元 - 200元人民币</p>
<ul>
<li><p><code>.com</code>、<code>.net</code> 等国际域名：约 60-120元&#x2F;年（首年常有优惠）。</p>
</li>
<li><p><code>.cn</code> 等国内域名：约 30-100元&#x2F;年（需实名认证）。</p>
</li>
<li><p>其他小众后缀（如 <code>.xyz</code>、<code>.site</code>）：可能低至 10元&#x2F;年（促销时）。</p>
</li>
<li><p><strong>备注</strong>：续费价格通常高于首年价，需留意服务商续费政策。</p>
</li>
</ul>
<p>热门后缀: com,cn,net  利于SEO收录和排名</p>
<p>冷门后缀: top,vip,love,icu   不利于SEO优化,但价格便宜</p>
<p><a href="#%E6%97%A0%E9%99%90%E9%82%AE%E5%9F%9F%E5%90%8D">无限邮域名也可以使用</a></p>
<h3 id="域名商"><a href="#域名商" class="headerlink" title="域名商"></a>域名商</h3><table>
<thead>
<tr>
<th>域名购买商</th>
<th>fxmjyxgs.net</th>
<th>fengxingmuju.cn</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://www.namesilo.com/?rid=6282766cf">Namesilo</a></td>
<td>15.95美金一年</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.namecheap.com/?msclkid=baec315c89f31d04241056ac1d734337&utm_source=bing&utm_medium=cpc&utm_campaign=Bing-NC-SearchAds-Brand-PureBrand-Exact-NEW-ROW&utm_term=namecheap&utm_content=Bing-SearchAds-Brand-PureBrand-ROW-Exact">namecheap</a></td>
<td>12.98美金一年</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.domain.com/">daomain</a></td>
<td>14.99美金一年</td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.godaddy.com/zh-sg">godaddy</a></td>
<td>1.04元首年</td>
<td></td>
</tr>
<tr>
<td>阿里云</td>
<td></td>
<td><a target="_blank" rel="noopener" href="https://wanwang.aliyun.com/domain/searchresult/?keyword=fengxingmuju&suffix=.net">10年  386</a></td>
</tr>
<tr>
<td>腾讯云</td>
<td></td>
<td></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.spaceship.com/">spaceship</a></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://search.bilibili.com/all?from_source=webcommentline_search&keyword=spaceship&seid=16994019166809224800&from_avid=114104429712793&from_comid=257480630033">spaceship</a> 的.top 很便宜</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12A9pYmEZh/">spaceship 的  10年 6位数+ xyz后缀域名50元</a></p>
<p>阿里云买这个域名↑，10年一共67</p>
<h3 id="将购买的域名连接到Cloudflare"><a href="#将购买的域名连接到Cloudflare" class="headerlink" title="将购买的域名连接到Cloudflare"></a>将购买的域名连接到Cloudflare</h3><p>主要是为了利用cloudflare提供的CDN加速,安全防护(如DDOS防御),免费SSL证书等服务</p>
<p>通常有两种主要方式</p>
<ul>
<li><strong>仅使用 Cloudflare 的 DNS 托管（更简单、可逆）</strong>：只将域名的 DNS 解析服务器改为 Cloudflare 的，域名注册商仍是 GoDaddy</li>
<li><strong>将域名完全转移到 Cloudflare（更彻底）</strong>：将域名的管理权从 GoDaddy 转移到 Cloudflare 注册商</li>
</ul>
<p>对于大多数用户，<strong>推荐第一种方式（DNS 托管）</strong>，因为它更简单快捷，且可逆</p>
<ol>
<li>在 Cloudflare <code>账户主页 - 域</code> 中添加域名</li>
</ol>
<ul>
<li>输入从 GoDaddy 购买的完整域名（例如 yourdomain.com），然后点击”继续”</li>
<li>Cloudflare 会自动扫描该域名现有的 DNS 记录。请仔细核对，确保所有必要的记录（如 A 记录、CNAME 记录、MX 记录等）都已正确导入。也可以在此手动添加或修改记录</li>
<li>选择套餐，免费计划通常足够个人使用。点击”继续”</li>
</ul>
<ol start="2">
<li>更改 GoDaddy 的名称服务器（NameServers）</li>
</ol>
<ul>
<li>这是最关键的一步。完成上一步后，Cloudflare 会提供两个（或更多）特定的名称服务器地址（通常类似于 lara.ns.cloudflare.com 和 vern.ns.cloudflare.com）。请完整准确地复制这些地址</li>
<li>登录GoDaddy 账户，进入域名管理后台</li>
<li>找到要管理的域名，点击”管理 DNS”或类似选项</li>
<li>找到”名称服务器”（NameServers）设置部分</li>
<li>选择”使用自定义名称服务器”（或类似选项），将 GoDaddy 默认的名称服务器删除，替换为 Cloudflare 提供的那两个地址</li>
<li>保存更改</li>
</ul>
<ol start="3">
<li>在 Cloudflare 完成并检查激活</li>
</ol>
<ul>
<li>回到 Cloudflare 界面，点击”完成”或类似按钮</li>
<li>Cloudflare 会开始检查名称服务器更改是否生效。此过程最多需要 24-48 小时（DNS 传播时间），但通常几分钟到几小时内就会完成</li>
<li>完成后，会收到 Cloudflare 的确认邮件，在 Cloudflare 仪表板上也能看到域名状态变为”有效”</li>
</ul>
<blockquote>
<p><strong>关闭 DNSSEC</strong>：如果您之前在 GoDaddy 启用了 <strong>DNSSEC</strong>，<strong>必须先将其关闭</strong>，否则在 Cloudflare 可能导致解析问题。您可以在 Cloudflare 添加域名成功后再重新配置 DNSSEC</p>
</blockquote>
<h2 id="SSL证书购买"><a href="#SSL证书购买" class="headerlink" title="SSL证书购买"></a>SSL证书购买</h2><p>免费证书（推荐个人使用）：</p>
<ul>
<li><p><strong>Let’s Encrypt</strong>：完全免费，支持自动续期，适用于企业官网,个人博客和小型网站。</p>
<blockquote>
<ul>
<li><strong>证书有效期短</strong>：Let’s Encrypt证书<strong>仅90天有效</strong>（行业主流商业证书为1年），需定期续订。</li>
<li><strong>自动续订机制</strong>：可通过工具（如Certbot）实现<strong>自动化续期</strong>，几乎无需人工干预。</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">自签名证书</th>
<th align="left">Let‘s Encrypt 证书</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>颁发机构</strong></td>
<td align="left">自己给自己签发</td>
<td align="left"><strong>Let’s Encrypt</strong> (一个受全球信任的非营利证书颁发机构CA)</td>
</tr>
<tr>
<td align="left"><strong>浏览器信任</strong></td>
<td align="left"><strong>不信任</strong>，会显示“不安全”警告</td>
<td align="left"><strong>完全信任</strong>，显示绿色锁头或安全标识</td>
</tr>
<tr>
<td align="left"><strong>安全性</strong></td>
<td align="left">加密强度可以很高，但身份无法被第三方验证</td>
<td align="left">加密强度高，且身份由可信的第三方（Let’s Encrypt）验证</td>
</tr>
<tr>
<td align="left"><strong>成本</strong></td>
<td align="left">免费</td>
<td align="left">免费</td>
</tr>
<tr>
<td align="left"><strong>获取难度</strong></td>
<td align="left">自己一行命令生成，非常简单</td>
<td align="left">需要验证您对域名的所有权（自动化的过程）</td>
</tr>
<tr>
<td align="left"><strong>有效期</strong></td>
<td align="left">可以任意设置，例如10年</td>
<td align="left"><strong>很短（90天）</strong>，强制要求自动化续期以提升安全</td>
</tr>
</tbody></table>
</li>
<li><p><strong>服务商赠送</strong>：部分云平台（如阿里云、腾讯云）购买服务器时赠送免费SSL证书。</p>
</li>
<li><p>付费证书：</p>
<ul>
<li><strong>DV证书</strong>（域名验证型）：50-500元&#x2F;年（适合个人）。</li>
<li><strong>OV&#x2F;EV证书</strong>（企业验证型）：500-2000元&#x2F;年（企业用途更多）。</li>
</ul>
</li>
<li><p><strong>备注</strong>：个人网站建议优先选择免费证书。</p>
</li>
</ul>
<blockquote>
<ul>
<li><p><strong>DV证书</strong>（Domain Validation）<br>✅ ​<strong>适合</strong>：个人博客、小型网站、测试环境。<br>❌ ​<strong>不适用</strong>：涉及用户隐私、支付等敏感信息的网站。</p>
</li>
<li><p><strong>OV证书</strong>（Organization Validation）<br>✅ ​<strong>适合</strong>：企业官网、电商平台、API服务。<br>❌ ​<strong>不适用</strong>：需要最高信任度的金融、政务场景。</p>
</li>
<li><p><strong>EV证书</strong>（Extended Validation）<br>✅ ​<strong>适合</strong>：银行、支付平台、政府机构、大型企业官网。<br>❌ ​<strong>不适用</strong>：个人或非敏感业务（成本过高）</p>
<p>EV证书的“绿色地址栏”在部分新浏览器（如Chrome 92+）中不再显示，但企业名称仍会展示在证书详情页</p>
</li>
</ul>
</blockquote>
<h2 id="网站备案（ICP备案）"><a href="#网站备案（ICP备案）" class="headerlink" title="网站备案（ICP备案）"></a>网站备案（ICP备案）</h2><ul>
<li><p><strong>费用</strong>：<strong>免费</strong>（官方流程不收费）。</p>
<p>代理服务费</p>
<p>（可选）：</p>
<ul>
<li>如果自行备案：0元（需自行准备材料并提交）。</li>
<li>通过服务商代理备案：约 300-1000元（协助资料审核和流程处理）。</li>
</ul>
</li>
<li><p><strong>耗时</strong>：约 10-20 个工作日（需配合管局审核）。</p>
</li>
</ul>
<h2 id="费用总结"><a href="#费用总结" class="headerlink" title="费用总结"></a>费用总结</h2><ul>
<li><p>最低成本</p>
<p>（自行操作）：</p>
<ul>
<li>域名（50元） + 免费SSL（0元） + 备案（0元） ≈ <strong>50元</strong>。</li>
</ul>
</li>
<li><p>常规成本</p>
<p>（含代理服务）：</p>
<ul>
<li>域名（100元） + 免费SSL（0元） + 备案代理（500元） ≈ <strong>600元</strong>。</li>
</ul>
</li>
<li><p>高端配置</p>
<p>（付费证书+代理服务）：</p>
<ul>
<li>域名（200元） + 付费SSL（2000元） + 备案代理（500元） ≈ <strong>2700元</strong>。</li>
</ul>
</li>
</ul>
<h1 id="公网ip申请"><a href="#公网ip申请" class="headerlink" title="公网ip申请"></a>公网ip申请</h1><p>难度评估</p>
<ul>
<li>中国移动: ipv4很难申请,拉专线</li>
<li>中国联通: 一般般,打电话给客服</li>
<li>中国电信: 一个月20元,就可以申请到公网ip</li>
</ul>
<p>话术: 今天打开监控,发现我们家的那个公网ipv4地址怎么没有了?之前装监控的时候有公网呀</p>
<p>结果: 广东电信实测失败…</p>
<h2 id="公网ip解决方案"><a href="#公网ip解决方案" class="headerlink" title="公网ip解决方案"></a>公网ip解决方案</h2><table>
<thead>
<tr>
<th align="center">方案</th>
<th align="center">成本</th>
<th align="center">速度</th>
<th align="center">难度</th>
<th align="center">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>IPv6 + DDNS</strong></td>
<td align="center">免费</td>
<td align="center">快（直连）</td>
<td align="center">中等</td>
<td align="center">外部设备支持 IPv6</td>
</tr>
<tr>
<td align="center"><strong>FRP 自建穿透</strong></td>
<td align="center">中</td>
<td align="center">快</td>
<td align="center">高</td>
<td align="center">高频访问、需自定义端口</td>
</tr>
<tr>
<td align="center"><strong>Zerotier 组网</strong></td>
<td align="center">免费</td>
<td align="center">中等</td>
<td align="center">低</td>
<td align="center">多设备互联、低频率访问</td>
</tr>
<tr>
<td align="center"><strong>花生壳商业服务</strong></td>
<td align="center">低-高</td>
<td align="center">中等</td>
<td align="center">低</td>
<td align="center">临时测试、小白用户</td>
</tr>
</tbody></table>
<h3 id="解决ipv4访问ipv6服务器的问题解决方案"><a href="#解决ipv4访问ipv6服务器的问题解决方案" class="headerlink" title="解决ipv4访问ipv6服务器的问题解决方案"></a>解决ipv4访问ipv6服务器的问题解决方案</h3><table>
<thead>
<tr>
<th align="center">方案</th>
<th align="center">成本</th>
<th align="center">实现难度</th>
<th align="center">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>双栈部署</strong></td>
<td align="center">高</td>
<td align="center">高</td>
<td align="center">企业有公网 IPv4&#x2F;IPv6 资源</td>
</tr>
<tr>
<td align="center"><strong>CDN 协议转换</strong></td>
<td align="center">低</td>
<td align="center">低</td>
<td align="center">快速兼容，适合大多数企业</td>
</tr>
<tr>
<td align="center"><strong>NAT64&#x2F;DNS64</strong></td>
<td align="center">中</td>
<td align="center">高</td>
<td align="center">实验性场景，依赖运营商支持</td>
</tr>
<tr>
<td align="center"><strong>IPv4 回退服务</strong></td>
<td align="center">高</td>
<td align="center">中</td>
<td align="center">对兼容性要求极高的关键业务</td>
</tr>
</tbody></table>
<p><strong>通过 CDN&#x2F;反向代理实现协议转换</strong></p>
<ul>
<li><p><strong>原理</strong>：使用支持 IPv4&#x2F;IPv6 双栈的 CDN 或反向代理服务，将 IPv4 流量自动转换为 IPv6 请求。</p>
</li>
<li><p>推荐工具：Cloudflare（免费版支持）：</p>
<ol>
<li>将域名 DNS 解析托管到 Cloudflare。</li>
<li>在 Cloudflare 中开启 <code>IPv6 兼容性</code> 和 <code>DNS 代理</code>。</li>
<li>Cloudflare 边缘节点会同时响应 IPv4&#x2F;IPv6 请求，并将流量转发到公司的 IPv6 源站。</li>
</ol>
<ul>
<li><p>Nginx 反向代理（自建）：nginx</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在具备双栈的代理服务器上配置</span></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;              <span class="comment"># IPv4</span></span><br><span class="line">    <span class="attribute">listen</span> [::]:<span class="number">80</span>;         <span class="comment"># IPv6</span></span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://[公司IPv6源站]:80;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>优点:</p>
<ul>
<li>无需公司源站支持 IPv4。</li>
<li>CDN 可缓存内容，提升访问速度。</li>
</ul>
</li>
<li><p><strong>缺点</strong>：依赖第三方服务（如 Cloudflare）或自建代理服务器。</p>
</li>
</ul>
<h2 id="替代方案"><a href="#替代方案" class="headerlink" title="替代方案"></a>替代方案</h2><ul>
<li><strong>若只需临时、低速访问DSM管理Docker</strong>：可使用<strong>QuickConnect</strong>，它适合临时从外网登录DSM后台来管理容器启停和设置</li>
<li><strong>若有公网IP且追求最佳速度</strong>：可考虑<strong>端口转发</strong>。但务必注意网络安全风险，仅映射必要端口，并使用强密码和非标端口号</li>
<li><strong>若要暴露Web服务（如博客、导航页）</strong>：<strong>Cloudflare Tunnel</strong>是首选。它无需公网IP，能自动提供HTTPS证书，安全性较好。</li>
<li><strong>若需访问所有协议的服务（如SSH、远程桌面、私有数据库）</strong>：<strong>Tailscale</strong>等零信任网络方案是最佳选择。它能在所有设备间建立加密通道，像在局域网内一样安全访问所有服务，配置也不复杂</li>
</ul>
<h3 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h3><blockquote>
<p>可以用IPv6开+cloudflare cdn代理支持IPv4,待后续了解</p>
</blockquote>
<p>不同ipv6地址特征</p>
<table>
<thead>
<tr>
<th align="left">地址类型</th>
<th align="left">前缀范围（十六进制）</th>
<th align="left">用途</th>
<th align="left">是否可全球路由</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>全球单播地址</strong> (公网IPv6)</td>
<td align="left"><code>2000::/3</code>(如 <code>2001:</code>, <code>2408:</code>, <code>2409:</code>, <code>240e:</code>)</td>
<td align="left">全球唯一，可直接访问互联网</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left"><strong>唯一本地地址</strong> (ULA, 内网IPv6)</td>
<td align="left"><code>fc00::/7</code>(通常 <code>fd00::/8</code>)</td>
<td align="left">类似IPv4的私有地址，限本地网络使用</td>
<td align="left">否</td>
</tr>
<tr>
<td align="left"><strong>链路本地地址</strong></td>
<td align="left"><code>fe80::/10</code></td>
<td align="left">仅在同一物理链路有效（如局域网通信）</td>
<td align="left">否</td>
</tr>
</tbody></table>
<h4 id="查看是否支持ipv6"><a href="#查看是否支持ipv6" class="headerlink" title="查看是否支持ipv6"></a>查看是否支持ipv6</h4><ul>
<li><strong>Windows系统</strong>：打开命令提示符（CMD）或 PowerShell，输入 <code>ipconfig</code>，查看以 “IPv6 地址” 标识的条目。</li>
<li><strong>Linux&#x2F;macOS系统</strong>：打开终端，输入 <code>ip -6 addr show</code>或 <code>ifconfig</code>，查看网卡信息。</li>
</ul>
<p>在输出信息中，寻找那些<strong>不以 <code>fe80</code>或 <code>fd</code>开头</strong>的IPv6地址。如果你看到的IPv6地址是以 <code>2001:</code>、<code>2408:</code>、<code>2409:</code>、<code>240e:</code>等开头的（属于 <code>2000::/3</code>范围），这很可能就是一个公网IPv6地址</p>
<p><strong>使用在线工具测试</strong></p>
<p>通过访问一些支持IPv6的测试网站，可以快速验证你的公网IPv6连通性和显示的地址。</p>
<ul>
<li>访问 <a target="_blank" rel="noopener" href="https://test-ipv6.com/">test-ipv6.com</a> 或 <a target="_blank" rel="noopener" href="https://ipv6-test.com/">ipv6-test.com</a></li>
<li>网站会自动检测你的IPv6连接状态。如果页面显示 <strong>“IPv6 访问优先”</strong>、给出了一个<strong>完整的IPv6地址</strong>（并且这个地址与你之前查看到的、以<code>2xxx</code>或<code>3xxx</code>开头的地址一致），或者测试分数很高（如10&#x2F;10），就说明你已成功连接到IPv6互联网，并且该地址是公网地址</li>
</ul>
<h4 id="路由器开启ipv6支持"><a href="#路由器开启ipv6支持" class="headerlink" title="路由器开启ipv6支持"></a>路由器开启ipv6支持</h4><p>以tplink企业路由器为例</p>
<ol>
<li><p>首先需要在<code>基本设置 - LAN设置</code>中启用ipv6</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202509151148244.png" alt="image-20250915114858281" style="zoom:25%;" />
</li>
<li><p>然后需要在<code>基本设置 - LAN设置 - SLAAC</code>中启用服务</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202509151149483.png" alt="image-20250915114935926" style="zoom:25%;" /></li>
</ol>
<blockquote>
<p>当开启SLAAC后，DHCPv6服务的开关变为不可操作的状态，<strong>这并非故障，而是TP-LINK路由器的一种智能设计</strong>。它强制用户采用业界推荐的 <strong>“SLAAC + 无状态DHCPv6”</strong> 的协同工作模式</p>
<table>
<thead>
<tr>
<th align="left">功能</th>
<th align="left">负责内容</th>
<th align="left">当前状态</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>SLAAC</strong></td>
<td align="left"><strong>分配IPv6地址</strong>（解决“我是谁”）</td>
<td align="left"><strong>已开启，工作正常</strong></td>
</tr>
<tr>
<td align="left"><strong>DHCPv6</strong></td>
<td align="left"><strong>分配DNS等信息</strong>（解决“如何找到别人”）</td>
<td align="left"><strong>被SLAAC联动开启，无需单独操作</strong></td>
</tr>
</tbody></table>
</blockquote>
<p>然后就可以在<code>基本设置 - LAN设置 - IPV6客户端列表</code>中查看ipv6的地址分配情况</p>
<h6 id="群晖nas开启ipv6"><a href="#群晖nas开启ipv6" class="headerlink" title="群晖nas开启ipv6"></a>群晖nas开启ipv6</h6><p>控制面板 - 网络 - 网络界面 - <code>找到正在使用的局域网,右键 - 编辑</code> - IPv6 - <code>IPv6设置改为自动</code> - 确定</p>
<h6 id="解决动态变化的IPv6地址"><a href="#解决动态变化的IPv6地址" class="headerlink" title="解决动态变化的IPv6地址"></a>解决动态变化的IPv6地址</h6><p>IPv6地址是动态变化的</p>
<ul>
<li>虽然运营上粉皮儿的IPv6前缀通常比较固定,但设备通过SLAAC生成的地址后缀可能会变(尤其是隐私拓展地址)</li>
<li><strong>解决方案</strong>: 为需要访问的设备(如NAS)配置静态IPv6地址</li>
</ul>
<h3 id="内网穿透方案"><a href="#内网穿透方案" class="headerlink" title="内网穿透方案"></a>内网穿透方案</h3><p><a href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F">参考内网穿透</a></p>
<h1 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h1><table>
<thead>
<tr>
<th align="center">服务名称</th>
<th align="center">免费带宽</th>
<th align="center">免费流量</th>
<th align="center">免费隧道数</th>
<th align="center">实名认证</th>
<th align="center">支持协议</th>
<th align="center">特点与注意事项</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>cpolar</strong></td>
<td align="center">1Mbps</td>
<td align="center"><strong>不限流量</strong></td>
<td align="center">4条</td>
<td align="center">否</td>
<td align="center">TCP、HTTP、HTTPS</td>
<td align="center">流量不限是显著优势，带宽适中，隧道数较多,<strong>每 24 小时会变化的公网地址(付费解决)</strong></td>
</tr>
<tr>
<td align="center"><strong>Sakura Frp</strong></td>
<td align="center"><strong>10Mbps</strong></td>
<td align="center">每月5GB</td>
<td align="center">2条</td>
<td align="center"><strong>是</strong></td>
<td align="center">TCP、UDP、HTTP、HTTPS</td>
<td align="center"><strong>免费带宽较大</strong>，通过每日签到可获取额外免费流量</td>
</tr>
<tr>
<td align="center"><strong>NATAPP</strong></td>
<td align="center">1Mbps</td>
<td align="center"><strong>不限流量</strong></td>
<td align="center">2条</td>
<td align="center"><strong>是</strong></td>
<td align="center">TCP、HTTP、HTTPS</td>
<td align="center">不限流量，但免费版域名或端口可能不定时强制更换</td>
</tr>
<tr>
<td align="center"><strong>花生壳</strong></td>
<td align="center">1Mbps</td>
<td align="center">每月1GB</td>
<td align="center">2条</td>
<td align="center"><strong>是</strong></td>
<td align="center">TCP、HTTP、HTTPS</td>
<td align="center">老牌服务，需6元认证费，免费版流量较少</td>
</tr>
<tr>
<td align="center"><strong>飞鸽</strong></td>
<td align="center">0.5Mbps</td>
<td align="center"><strong>不限流量</strong></td>
<td align="center">1条</td>
<td align="center">否</td>
<td align="center">TCP、HTTP、UDP</td>
<td align="center">带宽较低，解压即用无需安装，适合临时轻量级需求</td>
</tr>
</tbody></table>
<p><strong>备选方案：自建内网穿透</strong>：如果你拥有<strong>一台具有公网IP的云服务器</strong>（国内或海外均可），可以考虑使用 <strong>FRP</strong> 或 <strong>OpenVPN</strong> 等开源工具自建内网穿透服务。这种方式前期投入较高（需要服务器成本），但长期来看更灵活、可控，且无商业服务的额度限制</p>
<p>对于绝大多数<strong>个人用户</strong>——无论是远程访问家庭NAS、调试开发中的Web项目，还是运行一个小型博客——Cloudflare Tunnel <strong>免费版提供的带宽和无限流量是完全足够且非常划算的</strong>。</p>
<h2 id="cloudflare方案"><a href="#cloudflare方案" class="headerlink" title="cloudflare方案"></a>cloudflare方案</h2><blockquote>
<p>cloudflare的<strong>域名安全配置</strong>:</p>
<p>1️⃣<strong>进入 SSL&#x2F;TLS 设置</strong></p>
<ol>
<li><strong>进入域名管理</strong>，左侧菜单栏点击 <strong>SSL&#x2F;TLS</strong>。</li>
<li>默认进入 <strong>概述</strong> 页面，找到 <strong>SSL&#x2F;TLS 加密模式</strong>。</li>
<li>点击 <strong>配置</strong> 进入详细设置。</li>
</ol>
<p>2️⃣ <strong>选择合适的 SSL&#x2F;TLS 模式</strong></p>
<ol>
<li><p>默认 SSL&#x2F;TLS 模式为 “灵活”</p>
<p>，需要改成：</p>
<ul>
<li><p><strong>完全（Full）</strong>：适用于一般场景（安全性较高）。</p>
<p>风险: 内网中可能面临<strong>中间人攻击风险</strong>,如果有这种风险,需要采用下面的完全(严格)模式</p>
</li>
<li><p><strong>完全（严格）（Full (strict)）</strong>：适用于指向服务器的域名，但<strong>服务器需安装有效 SSL 证书</strong>。(可以使用<strong>Let’s Encrypt 证书</strong>,搭配90天自动续期服务)</p>
</li>
</ul>
</li>
<li><p><strong>如果域名不指向服务器，仅做跳转或解析，可选择“完全”模式</strong>。</p>
</li>
<li><p><strong>点击保存</strong>，完成 SSL&#x2F;TLS 加密设置。</p>
</li>
</ol>
<p><strong>3️⃣ 开启边缘证书（Edge Certificates）</strong></p>
<ol>
<li><strong>点击 “边缘证书” 选项</strong>。</li>
<li>Cloudflare 会自动申请并管理 <strong>托管证书</strong>。</li>
<li><strong>下拉找到 “始终使用 HTTPS” 选项</strong>，点击 <strong>开启</strong>（可选，但推荐）。</li>
<li>这样可以确保所有 HTTP 请求都自动跳转到 HTTPS，提高安全性</li>
</ol>
<p>p.s. 可通过 <a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/">SSL Labs 测试工具</a> 验证加密强度</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=EntniY-sFH4">参考视频教程</a></p>
<p><a target="_blank" rel="noopener" href="https://skilladd.org/2025/04/12/10.cloudflare%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/">参考博客</a></p>
<p><strong>Zero Trust</strong>: cloud flare提供的内网穿透服务</p>
<p>必须现有一个托管在cloudflare的域名</p>
<p>Zero Trust界面中 - 网络 - Tunnels - 添加隧道 - 选择Cloudflared</p>
<p>按照安装要求进行相应安装cloudflare连接器,然后就可以转到隧道管理中配置内网穿透的具体服务了:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202504281658159.png" alt="image-20250428165816614" style="zoom: 67%;" />

<p>就可以实现内网穿透了</p>
<blockquote>
<p>但是要注意内网穿透没法将设备直接暴露到公网,只能暴露某个端口</p>
</blockquote>
<h3 id="群晖部署Cloudflare-Tunnel"><a href="#群晖部署Cloudflare-Tunnel" class="headerlink" title="群晖部署Cloudflare Tunnel"></a>群晖部署Cloudflare Tunnel</h3><p>Cloudflare Tunnel能把 NAS 低频访问的内网服务，用最低成本稳定暴露到外网。关键数据全程 SSL 加密，比自建 FRP 省了服务器钱还不用操心 DDoS 防护‌</p>
<p>使用outlook邮箱可以无手机注册</p>
<p>然后再试用outlook账号注册cloudflare</p>
<p>要先在cloudflare新建隧道,新建后继续下面的步骤</p>
<p>群晖通过docker部署cloudflare隧道连接器</p>
<p><a href="#docker%E9%83%A8%E7%BD%B2Gitea">docker部署gitea参考</a></p>
<ol>
<li><p><strong>下载镜像:</strong> 打开群晖的 <strong>Container Manager</strong>，进入“镜像仓库”页面;搜索 <code>cloudflare/cloudflared</code>，选择并下载 <strong>latest</strong> (最新) 标签的镜像</p>
</li>
<li><p><strong>创建容器:</strong> 在“映像”中找到下载好的 <code>cloudflare/cloudflared</code>镜像，点击“启动”</p>
</li>
<li><p>按照下面进行配置</p>
</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202509121517518.png" alt="image-20250912151754618" style="zoom:33%;" />

<p>注意网络一定要设置为<code>host模式</code>,命令要设置为<code>tunnel run</code></p>
<p><strong>总结一下配置</strong></p>
<table>
<thead>
<tr>
<th align="center">选项卡</th>
<th align="center">设置项</th>
<th align="center">推荐配置</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>执行命令</strong></td>
<td align="center">Entrypoint</td>
<td align="center"><code>cloudflared --no-autoupdate</code>（保持不变）</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">命令</td>
<td align="center"><code>tunnel run</code></td>
</tr>
<tr>
<td align="center"><strong>环境</strong></td>
<td align="center">变量 (新增)</td>
<td align="center"><code>TUNNEL_TOKEN</code></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">值 (新增)</td>
<td align="center"><code>eyJhIjoi...（您的真实Token）</code></td>
</tr>
<tr>
<td align="center"><strong>网络</strong></td>
<td align="center">网络模式</td>
<td align="center"><strong>建议选择“使用与 Docker Host 相同的网络”</strong></td>
</tr>
</tbody></table>
<p>配置完成后需要告诉cloudflare哪个公网域名对应哪个内网服务</p>
<ol>
<li>在 Cloudflare Zero Trust 面板中，进入你刚创建的隧道的配置页面。</li>
<li>点击 <strong>“Public Hostnames”</strong> 选项卡，然后点击 <strong>“Add a public hostname”</strong>。</li>
<li>配置你的服务映射：<ul>
<li><strong>Subdomain</strong>: 输入你喜欢的子域名前缀，如 <code>nas</code>、<code>dsm</code>。</li>
<li><strong>Domain</strong>: 从下拉菜单中选择一个你托管在 Cloudflare 上的域名。</li>
<li><strong>Service</strong>: 选择 <strong>HTTP</strong> 或 <strong>HTTPS</strong>。</li>
<li><strong>URL</strong>: 填写你的群晖服务在内网的地址和端口。例如：<ul>
<li>访问 DSM 管理界面: <code>http://localhost:5000</code></li>
<li>访问 Docker 中的某个 Web 服务: <code>http://localhost:3000</code></li>
</ul>
</li>
</ul>
</li>
<li>点击“Save”保存。现在，你就可以通过你配置的公网域名（例如 <code>https://nas.yourdomain.com</code>）安全地访问内网服务了</li>
</ol>
<p>到此就部署成功了</p>
<h2 id="自建服务器内网穿透"><a href="#自建服务器内网穿透" class="headerlink" title="自建服务器内网穿透"></a>自建服务器内网穿透</h2><p>使用 <strong>frp</strong> 或 <strong>ngrok</strong> 将宿主机端口映射到公网</p>
<h1 id="无限邮域名"><a href="#无限邮域名" class="headerlink" title="无限邮域名"></a>无限邮域名</h1><p><a target="_blank" rel="noopener" href="https://www.spaceship.com/application/domain-list-application/">参考链接</a></p>
<p>在spaceship购买无限邮域名,site后缀会特别便宜</p>
<p>另外免费方式: 在cloudflare上配置一个域名，然后找到电子邮件配置邮件路由就可以</p>
<h1 id="技巧记录"><a href="#技巧记录" class="headerlink" title="技巧记录"></a>技巧记录</h1><p><code>ssh -o ProxyCommand=&quot;none&quot; Qian0407@192.168.8.6</code>绕开代理,连接ssh,不然会显示ssh被127.0.0.1断开连接</p>
<h1 id="路由器配置"><a href="#路由器配置" class="headerlink" title="路由器配置"></a>路由器配置</h1><h2 id="静态ip注意"><a href="#静态ip注意" class="headerlink" title="静态ip注意"></a>静态ip注意</h2><p>路由器的客户端列表不会显示所有设备的ip地址,如果是静态设置(手动配置ip地址的设备)在客户端列表中不可见</p>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left"><strong>静态地址分配 (DHCP保留)</strong></th>
<th align="left"><strong>静态设置 (手动配置)</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>配置位置</strong></td>
<td align="left"><strong>路由器</strong>的管理界面</td>
<td align="left">每台<strong>终端设备</strong>的操作系统内</td>
</tr>
<tr>
<td align="left"><strong>管理方式</strong></td>
<td align="left"><strong>集中式管理</strong>，所有IP在一个地方分配和查看</td>
<td align="left"><strong>分散式管理</strong>，需要登录每台设备修改</td>
</tr>
<tr>
<td align="left"><strong>可靠性</strong></td>
<td align="left"><strong>非常高</strong>。IP地址由权威的DHCP服务器分配，绝对不会有冲突。</td>
<td align="left"><strong>较低</strong>。容易因人为失误导致IP冲突，造成网络中断。</td>
</tr>
<tr>
<td align="left"><strong>灵活性</strong></td>
<td align="left"><strong>高</strong>。更改IP地址只需在路由器上操作，设备无感知。</td>
<td align="left"><strong>低</strong>。更改IP需要逐台设备操作，非常繁琐。</td>
</tr>
<tr>
<td align="left"><strong>迁移性</strong></td>
<td align="left"><strong>高</strong>。设备拿到新网络会自动获取新IP，无需重新配置。</td>
<td align="left"><strong>低</strong>。设备换网络后仍需手动设置，否则无法上网。</td>
</tr>
<tr>
<td align="left"><strong>所需知识</strong></td>
<td align="left"><strong>较低</strong>。只需知道设备的MAC地址。</td>
<td align="left"><strong>较高</strong>。需要正确填写IP、子网掩码、网关、DNS。</td>
</tr>
<tr>
<td align="left"><strong>推荐场景</strong></td>
<td align="left"><strong>绝大多数情况</strong>，尤其是家庭、中小企业环境。</td>
<td align="left"><strong>极特殊情况</strong>，如：无DHCP服务的纯静态网络、网络设备（交换机、路由器自身）、临时测试。</td>
</tr>
</tbody></table>
<h2 id="路由器防火墙"><a href="#路由器防火墙" class="headerlink" title="路由器防火墙"></a>路由器防火墙</h2><p>一般被称为虚拟服务器</p>
<p>将某个内网ip的某个端口对外开放</p>
<h1 id="网络设备盘点"><a href="#网络设备盘点" class="headerlink" title="网络设备盘点"></a>网络设备盘点</h1><h2 id="云管理交换机"><a href="#云管理交换机" class="headerlink" title="云管理交换机"></a>云管理交换机</h2><h3 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h3><p>VLAN（Virtual Local Area Network，虚拟局域网）最核心、最根本的作用是可以实现”将一个物理交换机虚拟成多个独立的逻辑交换机”的效果</p>
<h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><ul>
<li><strong>传统交换机（无VLAN）：</strong> 所有端口都处于同一个广播域中。一台电脑发送的广播数据包（如ARP请求），会被交换机转发给<strong>所有其他端口</strong>上的设备。整个交换机就像一个大的、开放的房间，大家都能听到彼此的喊话。</li>
<li><strong>启用VLAN的交换机：</strong> 您可以将不同的端口划分到不同的VLAN中。例如：<ul>
<li>将端口1-8划分到 <strong>VLAN 10</strong>（比如给财务部使用）</li>
<li>将端口9-16划分到 <strong>VLAN 20</strong>（比如给市场部使用）</li>
<li><strong>效果：</strong> 此时，VLAN 10和VLAN 20就相当于两个完全独立的虚拟交换机。<ul>
<li><strong>广播隔离：</strong> 一台连接在VLAN 10端口上的电脑发送广播包，这个包<strong>只会</strong>被转发到其他属于VLAN 10的端口。VLAN 20的端口完全收不到任何VLAN 10的流量，反之亦然。</li>
<li><strong>通信隔离：</strong> 即使两台电脑都接在同一台物理交换机上，但如果它们属于不同的VLAN，它们之间<strong>默认也无法直接通信</strong>，就像接在了两台完全不同的交换机上一样。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="TL-SG2024D"><a href="#TL-SG2024D" class="headerlink" title="TL-SG2024D"></a>TL-SG2024D</h3><p><a target="_blank" rel="noopener" href="https://resource.tp-link.com.cn/pc/docCenter/showDoc?productId=1237&type=PRODUCT_INTRODUCTION&id=1649854042010101">说明书</a>   <a target="_blank" rel="noopener" href="https://service.tp-link.com.cn/download/20227/TL-SG2024D%20V3.0%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C%201.0.0.pdf">tplink云管理交换机用户手册</a></p>
<p>TP-LINK全新开发推出的“云交换系列”全千兆云管理交换机，提供更为高效、简单、安全、易用的远程管理方式，支持智能开局、自动配置组网、异常告警等功能，无需专业IT运维人员，小白也能轻松上手；采用新一代高性能硬件和软件平台，提供灵活、高性价比的全千兆端口，支持灵活的802.1Q VLAN、端口监控、端口汇聚、QoS、带宽控制等基础网络管理功能，易于管理维护，适用于校园、酒店及企业园区网络接入应用场景</p>
<p>一键切换工作模式</p>
<ul>
<li>云管理模式：交换机支持VLAN、端口汇聚、端口监控等网管功能，可以通过商云APP、商用网络云平台、本地界面进行管理和维护。</li>
<li>VLAN隔离模式：交换机不支持网管功能，并且部分端口相互隔离，详⻅安装手册相关说明。</li>
<li>标准交换模式：交换机不支持网管功能，并且所有端口均可以自由通信</li>
</ul>
<h1 id="局域网扫描工具"><a href="#局域网扫描工具" class="headerlink" title="局域网扫描工具"></a>局域网扫描工具</h1><table>
<thead>
<tr>
<th align="left">特性维度</th>
<th align="left">Angry IP Scanner</th>
<th align="left">Advanced IP Scanner</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>macOS 支持</strong></td>
<td align="left">✅ <strong>明确支持</strong> (Linux, Windows, Mac OS X)</td>
<td align="left">Windows</td>
</tr>
<tr>
<td align="left"><strong>免费性</strong></td>
<td align="left">✅ <strong>完全免费</strong> (开源)</td>
<td align="left">✅ <strong>免费</strong></td>
</tr>
<tr>
<td align="left"><strong>主要功能特点</strong></td>
<td align="left">快速扫描IP地址和端口、支持自定义IP范围、数据导出、插件扩展、命令行界面</td>
<td align="left">快速扫描局域网设备、显示设备信息（IP, MAC地址）、远程开关机（WOL）、访问共享资源</td>
</tr>
<tr>
<td align="left"><strong>用户友好性</strong></td>
<td align="left">界面简洁，提供图形界面和命令行界面</td>
<td align="left">强调易于使用，提供图形化界面</td>
</tr>
<tr>
<td align="left"><strong>额外优势</strong></td>
<td align="left">跨平台兼容性佳、无需安装（便携版）、开源</td>
<td align="left">绿色免安装、支持Radmin远程控制</td>
</tr>
<tr>
<td align="left">官网</td>
<td align="left"><a target="_blank" rel="noopener" href="https://angryip.org/">官网</a></td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.advanced-ip-scanner.com/cn/">官网</a></td>
</tr>
</tbody></table>
<h1 id="部署问题盘点"><a href="#部署问题盘点" class="headerlink" title="部署问题盘点"></a>部署问题盘点</h1><h2 id="群晖默认nginx与docker-nginx端口冲突"><a href="#群晖默认nginx与docker-nginx端口冲突" class="headerlink" title="群晖默认nginx与docker nginx端口冲突"></a>群晖默认nginx与docker nginx端口冲突</h2><p>常见解决方案:</p>
<ul>
<li><p><strong>释放默认端口</strong>,通过修改DSM的Nginx配置,将80&#x2F;443改成其他端口,比如8080&#x2F;8443. 注意 DSM 系统升级可能会恢复配置，需使用计划任务定时执行脚本 <a target="_blank" rel="noopener" href="https://www.himiku.com/archives/use-your-own-nginx-in-synology-nas.html">参考做法: 群晖 DSM 停用内置 Nginx</a></p>
</li>
<li><p><strong>使用独立 IP</strong>：给反向代理容器分配一个单独的局域网 IP（如通过 Docker macvlan），使它不与 DSM 共享 IP。这样反向代理可以在该 IP 的 80&#x2F;443 上运行，而 DSM 自带服务绑定在另一 IP 上。例如 Andy 的案例中，他将 NPM 容器分配到 192.168.0.201，让它独立监听 80&#x2F;443 。下图示意了这种网络布局：Docker 容器和 DSM 主机各自拥有不同 IP，反向代理可独占端口。<a target="_blank" rel="noopener" href="https://andyyang.co.uk/replace-synology-nas-reverse-proxy/#:~:text=192,by%20the%20default%20reverse%20proxy">参考做法</a></p>
</li>
<li><p><strong>更换端口</strong>：如果不想改系统 Nginx，可以让容器监听其他端口（如 8443、8080），并在 DSM 侧进行端口映射或转发。不过这样访问时需要指定非标准端口，或使用额外的 HTTP 到 HTTPS 转发（如 stream 模块或 DSM 自带转发）</p>
<p>stream方案注意:</p>
</li>
</ul>
<h3 id="使用独立IP方案"><a href="#使用独立IP方案" class="headerlink" title="使用独立IP方案"></a>使用独立IP方案</h3><ol>
<li><p>SSH登录到群晖NAS,查看宿主机的物理网卡名<code>ip link</code>,通常是 eth0 或者类似 ovs_eth0（取决于你是否用了群晖的虚拟网络层）</p>
</li>
<li><p>创建一个 <a href="#macvlan">Macvlan 网络</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d macvlan \</span><br><span class="line">  --subnet=192.168.8.0/24 \</span><br><span class="line">  --gateway=192.168.8.1 \</span><br><span class="line">  -o parent=eth0 \</span><br><span class="line">  macvlan_net</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--subnet：局域网的子网</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--gateway：局域网网关</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">parent=eth0：替换为你实际的物理网卡名</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">macvlan_net：这个是网络的名字，可以自己定义</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动容器并绑定独立 IP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name my-nginx \</span><br><span class="line">  --network macvlan_net \</span><br><span class="line">  --ip 192.168.8.115 \</span><br><span class="line">  -v /path/to/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">  -p 80:80 -p 443:443 \</span><br><span class="line">  nginx:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--ip 192.168.8.115：这是容器在局域网的固定 IP</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 可以省略，因为容器直接在独立 IP 上监听，不需要映射到宿主机</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置域名解析</p>
<p>在路由器或本地 DNS 中，把 nas.jhh1.site 解析到 192.168.8.115</p>
</li>
</ol>
<blockquote>
<p> <strong>注意事项</strong></p>
<ul>
<li><strong>宿主机访问容器问题</strong>：Macvlan 模式下，宿主机（群晖本身）默认不能直接访问这个容器 IP。如果需要 DSM 本身访问容器（例如 DSM 的备份任务访问 192.168.8.115:443），你需要再建一个 <strong>macvlan bridge</strong> 或者用 ipvlan 替代。</li>
<li><strong>防火墙</strong>：检查群晖和路由器的防火墙设置，确保放行 80&#x2F;443 到 192.168.8.115。</li>
<li><strong>DHCP 冲突</strong>：务必在路由器 DHCP 池之外选择 IP，或者在路由器里给容器 IP 做静态绑定。</li>
</ul>
</blockquote>
<h3 id="macvlan"><a href="#macvlan" class="headerlink" title="macvlan"></a>macvlan</h3><p><strong>简单定义</strong>：macvlan 是 Docker（Linux 内核）的一种网络驱动，把容器虚拟成网络上的独立设备：每个容器拥有自己的 MAC 地址和 IP，像一台真实主机那样直接出现在 L2 网络上（交换机能识别它的 MAC）。</p>
<blockquote>
<p>物理网口,即使是两个网口各自有独立的ip地址,也会在nginx层面涉及到互相之间端口占用的影响,而使用macvlan方案是真正意义上可以不互相占用的</p>
</blockquote>
<p><strong>解决的问题</strong>：当你想让容器直接在局域网中拥有独立 IP（并可以占用标准端口 80&#x2F;443），而不与宿主机（群晖 DSM 自带服务）端口冲突时，macvlan 非常合适。</p>
<p><strong>应用场景</strong>：反向代理（Nginx）直接对外提供 HTTPS；把容器暴露成局域网内独立服务；在多服务／多 IP 下避免端口冲突。</p>
<h4 id="工作原理-1"><a href="#工作原理-1" class="headerlink" title="工作原理"></a>工作原理</h4><ul>
<li>macvlan 在宿主物理网口上创建虚拟网口（子接口），容器的网口直接挂在这个虚拟网口上，容器发出的帧带自己的 MAC，物理交换机会像对待物理主机一样转发。</li>
<li><strong>parent</strong>：你需要指定一个物理网卡作为 parent（例如 eth0, bond0, ovs_eth0 等），macvlan 会基于它创建虚拟接口。</li>
<li><strong>主机与容器隔离</strong>：宿主机（host）默认<strong>不能</strong>直接访问 macvlan 上的容器 IP（因为主机和容器处于不同的 L2 接口）。这通常是优点（隔离），但也带来需要额外配置以便 host 访问的尴尬。</li>
<li>支持 VLAN（如果你的网络需要 802.1Q 标签，可以在 parent 上用子接口如 eth0.10）。</li>
</ul>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><p>优点</p>
<ul>
<li>容器看起来像局域网内真实主机：直接使用标准端口 80&#x2F;443，不需要宿主端口映射。</li>
<li>几乎原生网速，延迟低（无 DNAT&#x2F;SNAT）</li>
<li>便于把容器放到已有网络策略 &#x2F; 路由里（如静态 IP、路由器防火墙规则等）</li>
</ul>
<p>缺点 &#x2F; 限制</p>
<ul>
<li><strong>宿主机默认无法访问容器 IP</strong>（需要特殊配置才能从 DSM 访问容器的 IP）。</li>
<li>一些家用路由器 &#x2F; 交换机或 ISP 提供的设备可能会限制一个物理端口上的多个 MAC，或者对 Wi-Fi 客户端行为不友好（尤其某些 ISP 网关或 Wi-Fi 中继）。</li>
<li>容器在网络上直接可见，安全性依赖你在容器内配置的防护（而不是 Docker NAT 隔离）。</li>
<li>需要知道宿主机物理接口名称，并具有对其操作权限（在群晖上需要 SSH）。</li>
</ul>
<p>替代方案说明</p>
<ul>
<li>host 网络模式：容器直接和宿主共享网络栈（能访问 host 的接口），但你无法分配独立 IP。</li>
<li>ipvlan：与 macvlan 类似，但在某些场景（比如需要更低开销）更合适；此外 ipvlan 在 host &lt;-&gt; container 通信上有不同行为。一般入门用 macvlan 更直观。</li>
</ul>
<h4 id="使宿主机能和macvlan容器互通-可选"><a href="#使宿主机能和macvlan容器互通-可选" class="headerlink" title="使宿主机能和macvlan容器互通(可选)"></a>使宿主机能和macvlan容器互通(可选)</h4><p>如前所述，<strong>macvlan 默认内核会阻止宿主和其 macvlan “子设备”互通</strong>（这是内核设计&#x2F;安全隔离），若你需要从 NAS 上直接访问&#x2F;调试容器（或容器访问 NAS，只是局域网内别的机器能访问容器就行），需要在宿主上建立一个 macvlan 虚拟接口（shim）并给它一个 IP（通常是 –aux-address 保留的那个）。这是社区推荐的解决办法</p>
<p>示例命令（继续用上面假设）:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 macvlan 虚拟设备（仅在内存，不会重启后保留）</span></span><br><span class="line">ip link add macvlan-shim link ovs_eth0 type macvlan mode bridge</span><br><span class="line">ip addr add 192.168.8.199/32 dev macvlan-shim     # 这个 IP 同 aux-address 保持一致</span><br><span class="line">ip link set macvlan-shim up</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">告诉宿主到容器网段走 macvlan-shim（ip-range）</span></span><br><span class="line">ip route add 192.168.8.200/29 dev macvlan-shim</span><br></pre></td></tr></table></figure>

<p>验证：宿主上 ping 192.168.8.200（容器 IP）应该可达（容器已运行的情况下）</p>
<p><strong>持久化</strong>：上面这些命令是临时的，重启会丢失。建议用 DSM 的 控制面板 → 任务计划程序 新建一个“开机&#x2F;登录时运行”的任务，以 root 身份运行一个小脚本来恢复这几个 ip link &#x2F; ip addr &#x2F; ip route（脚本示例我会在下面给出）</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"></a><div class="post-copyright__author_name">ZEROKO14</div><div class="post-copyright__author_desc">zeroko14's blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://che77a38.github.io/posts/%E8%BF%90%E7%BB%B4/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://che77a38.github.io/posts/%E8%BF%90%E7%BB%B4/')">运维</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://che77a38.github.io/posts/%E8%BF%90%E7%BB%B4/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=运维&amp;url=https://che77a38.github.io/posts/%E8%BF%90%E7%BB%B4/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://che77a38.github.io" target="_blank">ZEROKO14的个人博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E8%BF%90%E7%BB%B4/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>运维<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E9%80%9A%E4%BF%A1%E6%8A%80%E6%9C%AF/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">硬件通信技术</div></div></a></div><div class="next-post pull-right"><a href="/posts/%E8%99%9A%E6%8B%9F%E5%8C%96%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">虚拟化相关</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">欢迎来到ZEROKO14的个人博客</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ZEROKO14</h1><div class="author-info__desc">zeroko14's blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/che77a38" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3%E5%A5%BD%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">1.</span> <span class="toc-text">运维相关好用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#iperf3"><span class="toc-number">1.1.</span> <span class="toc-text">iperf3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.1.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A8%81%E8%81%94%E9%80%9A%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">威联通安装方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EECC"><span class="toc-number">2.</span> <span class="toc-text">关于ECC</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows%E4%B8%8A%E7%9A%84%E8%BF%90%E7%BB%B4%E6%8C%87%E4%BB%A4%E7%9B%98%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">Windows上的运维指令盘点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows%E4%BA%8B%E4%BB%B6%E6%9F%A5%E7%9C%8B%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">Windows事件查看器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E4%B8%8E%E4%BD%9C%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">核心功能与作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">打开方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88"><span class="toc-number">5.</span> <span class="toc-text">网站快速部署方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF"><span class="toc-number">5.1.</span> <span class="toc-text">Linux控制面板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Websoft9"><span class="toc-number">5.1.1.</span> <span class="toc-text">Websoft9</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.2.</span> <span class="toc-text">部署自己的项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E5%85%AC%E5%85%B1%E5%AD%90%E5%9F%9F%E5%90%8D"><span class="toc-number">5.2.1.</span> <span class="toc-text">临时公共子域名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Coolify"><span class="toc-number">5.2.2.</span> <span class="toc-text">Coolify</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%8D%E8%B4%B9%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%98%E7%82%B9"><span class="toc-number">6.</span> <span class="toc-text">免费云服务器盘点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E8%87%AA%E6%89%98%E7%AE%A1%E9%A1%B9%E7%9B%AE%E7%9B%98%E7%82%B9"><span class="toc-number">7.</span> <span class="toc-text">开源自托管项目盘点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">git服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GitLab"><span class="toc-number">7.1.1.</span> <span class="toc-text">GitLab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitbucket"><span class="toc-number">7.1.2.</span> <span class="toc-text">gitbucket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gitea"><span class="toc-number">7.1.3.</span> <span class="toc-text">Gitea</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker%E9%83%A8%E7%BD%B2Gitea"><span class="toc-number">7.1.3.1.</span> <span class="toc-text">docker部署Gitea</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">7.1.3.2.</span> <span class="toc-text">权限注意事项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E5%85%B6%E4%BB%96%E9%A1%B9%E7%9B%AE%E8%BF%81%E7%A7%BB%E5%88%B0gitea%E6%B5%81%E7%A8%8B"><span class="toc-number">7.1.3.3.</span> <span class="toc-text">将其他项目迁移到gitea流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%8E%9F%E5%A7%8B%E5%87%AD%E8%AF%81-%E5%8F%AF%E9%80%89"><span class="toc-number">7.1.3.3.1.</span> <span class="toc-text">删除原始凭证(可选)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E6%B5%81%E7%A8%8B"><span class="toc-number">7.1.3.3.2.</span> <span class="toc-text">迁移流程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gitea%E9%85%8D%E7%BD%AE"><span class="toc-number">7.1.3.4.</span> <span class="toc-text">gitea配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%A4%96%E7%BD%91%E5%9F%9F%E5%90%8D%E7%BB%9F%E4%B8%80%E8%AE%BE%E7%BD%AE"><span class="toc-number">7.1.3.5.</span> <span class="toc-text">内外网域名统一设置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Gitea%E9%93%BE%E6%8E%A5%E5%86%85%E5%A4%96%E7%BD%91%E6%98%BE%E7%A4%BA%E4%B8%80%E8%87%B4"><span class="toc-number">7.1.3.5.1.</span> <span class="toc-text">Gitea链接内外网显示一致</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E5%A4%96%E7%BD%91%E8%AE%BF%E9%97%AE%E4%B8%80%E8%87%B4"><span class="toc-number">7.1.3.5.2.</span> <span class="toc-text">内外网访问一致</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C"><span class="toc-number">7.1.4.</span> <span class="toc-text">最终效果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%A4%96%E7%BD%91%E5%9F%9F%E5%90%8D%E7%BB%9F%E4%B8%80%E8%AE%BE%E7%BD%AE%E6%A0%87%E5%87%86%E6%B5%81%E7%A8%8B"><span class="toc-number">7.1.4.1.</span> <span class="toc-text">内外网域名统一设置标准流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2HTTPS%E8%AF%81%E4%B9%A6"><span class="toc-number">7.1.4.1.1.</span> <span class="toc-text">为内网环境部署HTTPS证书</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F"><span class="toc-number">7.1.4.1.1.1.</span> <span class="toc-text">需要配置自动续期</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%91Nginx-HTTPS%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">7.1.4.1.2.</span> <span class="toc-text">配置内网Nginx HTTPS反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BE%A4%E6%99%96Nginx"><span class="toc-number">7.1.4.1.2.1.</span> <span class="toc-text">群晖Nginx</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E7%BD%91DNS%E8%A7%A3%E6%9E%90"><span class="toc-number">7.1.4.1.3.</span> <span class="toc-text">内网DNS解析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gitea%E5%88%86%E6%94%AF%E4%BF%9D%E6%8A%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">7.1.4.2.</span> <span class="toc-text">gitea分支保护配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E5%88%86%E6%94%AF"><span class="toc-number">7.1.4.2.1.</span> <span class="toc-text">生产分支</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%88%86%E6%94%AF"><span class="toc-number">7.1.4.2.2.</span> <span class="toc-text">开发分支</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E6%94%AF%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-number">7.1.4.2.3.</span> <span class="toc-text">分支命名规范</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BF%9D%E6%8A%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">7.1.4.2.4.</span> <span class="toc-text">实际保护配置</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#certbot"><span class="toc-number">7.2.</span> <span class="toc-text">certbot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B"><span class="toc-number">7.2.1.</span> <span class="toc-text">安装流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E6%96%B9%E6%A1%88%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B"><span class="toc-number">7.2.2.</span> <span class="toc-text">docker方案部署流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96cloudflare-api-token"><span class="toc-number">7.2.2.1.</span> <span class="toc-text">获取cloudflare api token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6"><span class="toc-number">7.2.2.2.</span> <span class="toc-text">下载运行镜像申请证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F"><span class="toc-number">7.2.2.3.</span> <span class="toc-text">自动续期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%81%E4%B9%A6"><span class="toc-number">7.2.2.4.</span> <span class="toc-text">使用证书</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BE%A4%E6%99%96%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%AF%81%E4%B9%A6"><span class="toc-number">7.2.2.4.1.</span> <span class="toc-text">群晖中使用证书</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BAGitea%E6%9C%AC%E8%BA%AB%E9%85%8D%E7%BD%AESSL%E8%AF%81%E4%B9%A6"><span class="toc-number">7.2.2.4.2.</span> <span class="toc-text">为Gitea本身配置SSL证书</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins"><span class="toc-number">7.3.</span> <span class="toc-text">Jenkins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E4%BA%91%E5%B9%B3%E5%8F%B0"><span class="toc-number">7.4.</span> <span class="toc-text">私有云平台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nextcloud"><span class="toc-number">7.4.1.</span> <span class="toc-text">Nextcloud</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copyparty"><span class="toc-number">7.4.2.</span> <span class="toc-text">copyparty</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E7%9B%B8%E5%85%B3"><span class="toc-number">8.</span> <span class="toc-text">域名相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E5%9F%9F%E5%90%8D%E8%B4%AD%E4%B9%B0"><span class="toc-number">8.1.</span> <span class="toc-text">个人域名购买</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E5%95%86"><span class="toc-number">8.1.1.</span> <span class="toc-text">域名商</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%B4%AD%E4%B9%B0%E7%9A%84%E5%9F%9F%E5%90%8D%E8%BF%9E%E6%8E%A5%E5%88%B0Cloudflare"><span class="toc-number">8.1.2.</span> <span class="toc-text">将购买的域名连接到Cloudflare</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL%E8%AF%81%E4%B9%A6%E8%B4%AD%E4%B9%B0"><span class="toc-number">8.2.</span> <span class="toc-text">SSL证书购买</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%AB%99%E5%A4%87%E6%A1%88%EF%BC%88ICP%E5%A4%87%E6%A1%88%EF%BC%89"><span class="toc-number">8.3.</span> <span class="toc-text">网站备案（ICP备案）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%B9%E7%94%A8%E6%80%BB%E7%BB%93"><span class="toc-number">8.4.</span> <span class="toc-text">费用总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AC%E7%BD%91ip%E7%94%B3%E8%AF%B7"><span class="toc-number">9.</span> <span class="toc-text">公网ip申请</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E7%BD%91ip%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">9.1.</span> <span class="toc-text">公网ip解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3ipv4%E8%AE%BF%E9%97%AEipv6%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">9.1.1.</span> <span class="toc-text">解决ipv4访问ipv6服务器的问题解决方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88"><span class="toc-number">9.2.</span> <span class="toc-text">替代方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6"><span class="toc-number">9.2.1.</span> <span class="toc-text">IPv6</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81ipv6"><span class="toc-number">9.2.1.1.</span> <span class="toc-text">查看是否支持ipv6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E5%BC%80%E5%90%AFipv6%E6%94%AF%E6%8C%81"><span class="toc-number">9.2.1.2.</span> <span class="toc-text">路由器开启ipv6支持</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BE%A4%E6%99%96nas%E5%BC%80%E5%90%AFipv6"><span class="toc-number">9.2.1.2.0.1.</span> <span class="toc-text">群晖nas开启ipv6</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%A8%E6%80%81%E5%8F%98%E5%8C%96%E7%9A%84IPv6%E5%9C%B0%E5%9D%80"><span class="toc-number">9.2.1.2.0.2.</span> <span class="toc-text">解决动态变化的IPv6地址</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%96%B9%E6%A1%88"><span class="toc-number">9.2.2.</span> <span class="toc-text">内网穿透方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-number">10.</span> <span class="toc-text">内网穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudflare%E6%96%B9%E6%A1%88"><span class="toc-number">10.1.</span> <span class="toc-text">cloudflare方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BE%A4%E6%99%96%E9%83%A8%E7%BD%B2Cloudflare-Tunnel"><span class="toc-number">10.1.1.</span> <span class="toc-text">群晖部署Cloudflare Tunnel</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-number">10.2.</span> <span class="toc-text">自建服务器内网穿透</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E9%99%90%E9%82%AE%E5%9F%9F%E5%90%8D"><span class="toc-number">11.</span> <span class="toc-text">无限邮域名</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7%E8%AE%B0%E5%BD%95"><span class="toc-number">12.</span> <span class="toc-text">技巧记录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">13.</span> <span class="toc-text">路由器配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81ip%E6%B3%A8%E6%84%8F"><span class="toc-number">13.1.</span> <span class="toc-text">静态ip注意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">13.2.</span> <span class="toc-text">路由器防火墙</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E7%9B%98%E7%82%B9"><span class="toc-number">14.</span> <span class="toc-text">网络设备盘点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%91%E7%AE%A1%E7%90%86%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">14.1.</span> <span class="toc-text">云管理交换机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VLAN"><span class="toc-number">14.1.1.</span> <span class="toc-text">VLAN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">14.1.1.1.</span> <span class="toc-text">工作原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TL-SG2024D"><span class="toc-number">14.1.2.</span> <span class="toc-text">TL-SG2024D</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B1%80%E5%9F%9F%E7%BD%91%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7"><span class="toc-number">15.</span> <span class="toc-text">局域网扫描工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98%E7%9B%98%E7%82%B9"><span class="toc-number">16.</span> <span class="toc-text">部署问题盘点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E6%99%96%E9%BB%98%E8%AE%A4nginx%E4%B8%8Edocker-nginx%E7%AB%AF%E5%8F%A3%E5%86%B2%E7%AA%81"><span class="toc-number">16.1.</span> <span class="toc-text">群晖默认nginx与docker nginx端口冲突</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%8B%AC%E7%AB%8BIP%E6%96%B9%E6%A1%88"><span class="toc-number">16.1.1.</span> <span class="toc-text">使用独立IP方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macvlan"><span class="toc-number">16.1.2.</span> <span class="toc-text">macvlan</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1"><span class="toc-number">16.1.2.1.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">16.1.2.2.</span> <span class="toc-text">优缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E5%AE%BF%E4%B8%BB%E6%9C%BA%E8%83%BD%E5%92%8Cmacvlan%E5%AE%B9%E5%99%A8%E4%BA%92%E9%80%9A-%E5%8F%AF%E9%80%89"><span class="toc-number">16.1.2.3.</span> <span class="toc-text">使宿主机能和macvlan容器互通(可选)</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E7%89%A9%E7%90%86/" title="物理">物理</a><time datetime="2025-09-29T01:48:42.561Z" title="发表于 2025-09-29 09:48:42">2025-09-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%B7%A5%E4%B8%9A%E7%9B%B8%E5%85%B3/" title="工业相关">工业相关</a><time datetime="2025-02-14T03:04:40.761Z" title="发表于 2025-02-14 11:04:40">2025-02-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%9B%B8%E5%85%B3/" title="嵌入式相关">嵌入式相关</a><time datetime="2025-02-14T03:04:40.761Z" title="发表于 2025-02-14 11:04:40">2025-02-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA/" title="操作系统">操作系统</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%AE%A1%E7%BB%84/" title="计算机组成原理">计算机组成原理</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="ZEROKO14" target="_blank">ZEROKO14</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu"></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">74</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>1</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 0.88rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 0.88rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 0.88rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 0.88rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 0.88rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 0.88rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 0.88rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 0.88rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 0.88rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 0.88rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 0.88rem;">ppt<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 0.88rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 0.88rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 0.88rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 0.88rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 0.88rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">基础<sup>6</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">杂项<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%89%A9%E7%90%86/" style="font-size: 0.88rem;">物理<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">逆向<sup>5</sup></a><a href="/tags/%E9%AD%94%E6%B3%95/" style="font-size: 0.88rem;">魔法<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>