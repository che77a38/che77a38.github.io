<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>FPS逆向 | ZEROKO14的个人博客</title><meta name="keywords" content="FPS"><meta name="author" content="ZEROKO14"><meta name="copyright" content="ZEROKO14"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="FPS逆向"><meta name="application-name" content="FPS逆向"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="FPS逆向"><meta property="og:url" content="https://che77a38.github.io/posts/FPS%E9%80%86%E5%90%91%E9%9A%8F%E7%AC%94/index.html"><meta property="og:site_name" content="ZEROKO14的个人博客"><meta property="og:description" content="fps辅助整体分析    FPS游戏特性导致的，需要非常高的实时性，不能过度的网络验证 绘制部分可以使用透明窗口覆盖在游戏上，非常难以检测 自瞄部分，捕捉准星数据，准星路径曲线不规则或有中断（不能平滑，人类操作鼠标非常不圆滑） 连续爆头的行为检测行为数据异常等等  相关基础角度计算 tan，cos，"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta property="article:author" content="ZEROKO14"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta name="description" content="fps辅助整体分析    FPS游戏特性导致的，需要非常高的实时性，不能过度的网络验证 绘制部分可以使用透明窗口覆盖在游戏上，非常难以检测 自瞄部分，捕捉准星数据，准星路径曲线不规则或有中断（不能平滑，人类操作鼠标非常不圆滑） 连续爆头的行为检测行为数据异常等等  相关基础角度计算 tan，cos，"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://che77a38.github.io/posts/FPS%E9%80%86%E5%90%91%E9%9A%8F%E7%AC%94/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: ZEROKO14","link":"链接: ","source":"来源: ZEROKO14的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZEROKO14的个人博客',
  title: 'FPS逆向',
  postAI: '',
  pageFillDescription: '相关基础, 角度计算, 快捷键写法, 绘制的三种方法, 3维坐标转屏幕算法, 不需要矩阵, 总结, 相关代码截取, 需要矩阵, 缩放和位移矩阵, 旋转矩阵, 绕z轴旋转矩阵, 绕x轴旋转矩阵, 绕y轴旋转矩阵, 矩阵变换总结, 找矩阵总结, 世界坐标转换为屏幕坐标, 相关代码截取, 朝向（准星）, 矩阵补充, CE找数据技巧, dbg配合ce找下属偏移的高级技巧, CS1.6的逆向, 找内存数据, 找矩阵, 口袋西游逆向, 基本数据, 找矩阵, 突袭的逆向, 基本数据, 找矩阵, UE4逆向, UE4引擎特点, Battle Royale Trainer逆向, 基本数据, 找人物特征, 排除做废对象, 人物存活判断, 武器相关, 骨骼数据, 找朝向, 找矩阵, 上面项目代码盘点, entityAround.h, paint.h, stdafx.h, dllmain.cpp, entityAround.cpp, paint.cpp, Unity逆向, Unity找数据特殊技巧, 逃离塔科夫逆向, 绘制相关, openGl和D3D绘制, opengl, 自建窗口外部绘制, 相关代码, 预编译.h, D3D绘制.h, D3D绘制.cpp, 调用例子, GDI泄露, 双缓冲辅助整体分析游戏特性导致的需要非常高的实时性不能过度的网络验证绘制部分可以使用透明窗口覆盖在游戏上非常难以检测自瞄部分捕捉准星数据准星路径曲线不规则或有中断不能平滑人类操作鼠标非常不圆滑连续爆头的行为检测行为数据异常等等相关基础角度计算函数参数为弧度弧度为表示度返回值为弧度角度弧度弧度角度了解线性代数向量内积是一个向量在另一个向量上的投影长度乘以另一个向量的长度比如和的向量内积为矩阵的乘法快捷键写法是键码按下执行里面的指令再按下停止执行里面的指令绘制的三种方法优完全不闪代码简单缺非常容易被检测游戏窗口上自行绘制优适中缺会闪自己创建窗口在自己创建的窗口上绘制优稳定缺麻烦一点会闪需要通信维坐标转屏幕算法两种坐标求导算法需要矩阵不需要矩阵不需要矩阵摄像机到准星的距离分辨率屏幕水平分辨率水平差角度屏幕的差分辨率摄像机到准星的距离分辨率差角度屏幕的差分辨率屏幕水平分辨率水平屏幕的差分辨率屏幕水平分辨率水平差角度因为屏幕的左上角为向右为变大向下为变大因此可知屏幕上指向敌人的坐标就是屏幕的差分辨率水平分辨率垂直水平垂直分辨率水平分辨率屏幕的差分辨率屏幕垂直分辨率垂直差角度屏幕的差分辨率屏幕水平分辨率水平差角度屏幕上指向敌人的坐标就是屏幕的差分辨率垂直分辨率总结屏幕坐标屏幕水平分辨率水平差角度水平分辨率屏幕坐标屏幕水平分辨率水平差角度垂直分辨率算法如下坐标结构弧度转角度弧度弧度角度转弧度角度角度世界坐标转屏幕坐标非矩阵坐标结构屏幕坐标水平角度差垂直角度差水平取窗口信息水平分辨率垂直分辨率获取屏幕分辨率伪函数摄像机到准星的距离分辨率水平分辨率角度转弧度水平高低最大可视角度弧度转角度垂直分辨率摄像机到准星的距离分辨率水平角度差水平垂直角度差高低最大可视角度不在屏幕范围内水平差摄像机到准星的距离分辨率角度转弧度水平角度差屏幕坐标水平差水平分辨率垂直差摄像机到准星的距离分辨率角度转弧度垂直角度差屏幕坐标垂直差垂直分辨率无矩阵方式为获取人物与目标的世界坐标高度差和世界水平距离来得到人物和目标的夹角再通过人物准星减去目标夹角或反过来来确定准星偏转角度差再通过准星偏转角度差和游戏宽高分辨率来转换成屏幕坐标进行绘图这种方式得到的坐标绘制多多少少有误差下面用到矩阵的方式无误差相关代码截取窗口句柄窗口尺寸信息分辨率宽分辨率高外窗口尺寸信息外窗口分辨率宽外窗口分辨率高视角矩阵位矩阵地址位矩阵地址取窗口信息位非矩阵绘制未完善画板句柄画刷句柄字体句柄画笔老的画板句柄老的画刷句柄老的画笔世界坐标转屏幕坐标无矩阵世界坐标转屏幕坐标世界坐标转屏幕坐标位画线从屏幕下方中间出发到两点画线画框针对头脚坐标画框画矩形写字绘制更换画刷更换画笔世界坐标转屏幕坐标非矩阵屏幕坐标水平角度差高低角度差获得窗口信息含有边框及全屏幕坐标世界坐标转屏幕坐标非矩阵屏幕坐标水平角度差高低角度差高低可视角度水平角度差高低角度差高低可视角度不在屏幕范围内水平差水平角度差屏幕坐标水平差高度差高低角度差屏幕坐标高度差计算朝向函数参考水平朝向确定第一象限第二象限第三象限第四象限垂直朝向确定上方必须加负数因为游戏逆向朝上转视角是负数下方计算朝向目标头部和自己准星朝向的角度差顺时针为正逆时针为负跨轴的两种情况防止超出水平转向区间需要矩阵矩阵分行主序与列主序主要是和的区别行主序乘以列主序乘以缩放和位移矩阵行主序列主序平移缩放后的坐标如下乘以列主序第一结论行主序最后一列列主序最后一行走路跳会发生改变不代表别的动作不改变旋转矩阵绕轴旋转矩阵绕轴旋转矩阵表示点逆时针旋转角度或坐标系顺时针旋转角度行主序列主序绕轴顺时针旋转后的坐标如下乘以列主序第二结论水平转动的情况行主序第三列不变列主序第三行不变绕轴旋转矩阵绕轴旋转矩阵表示点逆时针旋转角度或坐标系顺时针旋转角度行主序列主序绕轴顺时针旋转后的坐标如下乘以列主序第三结论高低朝向改变的时候行主序第一行不变列主序第一列不变绕轴旋转矩阵绕轴旋转矩阵表示点逆时针旋转角度或坐标系顺时针旋转角度行主序列主序绕轴顺时针旋转后的坐标如下乘以列主序矩阵变换总结找矩阵总结分类行主序列主序总结第一结论行主序最后一列列主序最后一行走路跳会发生改变只影响这行或列不代表别的动作不改变第二结论水平转动的情况行主序第三列或第二列不变列主序第三行或第二行不变第三结论高低朝向改变的时候行主序第一行不变列主序第一列不变下面的结论不绝对第四结论矩阵第一个值往往是到之间的只有一部分第五结论行主序第一行第三个或第二个元素是固定的列主序第一列的第三个或第二个元素是第六结论开倍镜第一个值会乘以相应的倍数这个是绝对的第七结论列主序最后两列前三值相似行主序最后两行前三值相似只做参考第八结论随便走不动准星会有一行或一列个在变化如果只朝或前进那么也只改变个值即行主序最后一列第一个与列主序最后一行第一个当沿着或方向走也不变跳就只有三个值在一行或一列变化第八结论矩阵不符合可参考下面的专题经验找矩阵的时候一批次只用确定一次找矩阵的时候优先找多号码段连排的基本步骤鼠标移动搜变动人物移动跳跃等搜不变动如果剩余过多尝试不绝对结论减少数量风险剩余不多数量的情况下每个打开看看移动是不是四个连着的数据改变跳跃是不是三个连着的数据改变找矩阵实例找矩阵世界坐标转换为屏幕坐标剪辑坐标理解为三维世界的切片坐标标准化设备坐标就是将剪辑坐标的范围缩小至到如图世界坐标剪辑坐标坐标世界坐标转换为剪辑坐标剪辑坐标和分辨率没有任何关系世界坐标矩阵乘以剪辑坐标剪辑坐标剪辑坐标剪辑坐标剪辑坐标如果小于表示在屏幕外剪辑坐标转换为坐标剪辑坐标剪辑坐标剪辑坐标剪辑坐标剪辑坐标剪辑坐标无用坐标屏幕坐标实际上就是坐标系的转换坐标系转换成屏幕分辨率坐标系目标点的坐标屏幕坐标差显示器分辨率宽目标点的坐标屏幕坐标差显示器分辨率高上面两个公式可知目标点的屏幕坐标差目标点的坐标显示器分辨率宽目标点的屏幕坐标差目标点的坐标显示器分辨率高因此坐标屏幕坐标算法计算如下目标点的屏幕坐标目标点的坐标分辨率宽分辨率宽目标点的屏幕坐标分辨率高目标点的坐标分辨率高坐标点和坐标点均适用说明四象限全适用相关代码截取窗口句柄窗口尺寸信息分辨率宽分辨率高外窗口尺寸信息外窗口分辨率宽外窗口分辨率高视角矩阵位矩阵地址位矩阵地址取窗口信息位非矩阵绘制未完善画板句柄画刷句柄字体句柄画笔老的画板句柄老的画刷句柄老的画笔世界坐标转屏幕坐标无矩阵世界坐标转屏幕坐标世界坐标转屏幕坐标位画线从屏幕下方中间出发到两点画线画框针对头脚坐标画框画矩形写字绘制更换画刷更换画笔世界坐标转屏幕坐标非矩阵屏幕坐标水平角度差高低角度差获得窗口信息含有边框及全屏幕坐标世界坐标转屏幕坐标位刷新矩阵世界坐标世界坐标配合矩阵算出裁剪坐标目前只考虑了列主序还需要考虑行主序的情况剪辑坐标如果小于表示在屏幕外坐标世界坐标转屏幕坐标位刷新矩阵世界坐标世界坐标配合矩阵算出裁剪坐标目前只考虑了列主序还需要考虑行主序的情况剪辑坐标如果小于表示在屏幕外坐标朝向准星准星数据寻找在游戏中横轴是可以无限原地转圈的而竖轴上下大概在度左右所以往往比更合适用来当作这一数据的突破口那么假设准星数据做了处理应该如何找到瞄准呢搜索出与准星坐标相关的地址后移动鼠标进行访问断就有可能断到相关的函数朝向极大概率是浮点数需要找到轴坐标对应的朝向矩阵补充通常情况下中会采用的矩阵这里说的横矩阵是列主序列矩阵是行主序荒野行动横矩阵第排第列的数光标朝天看的时候是朝地下是此结论通用性待验证补充一个列矩阵比例列矩阵矩阵最常见的两种矩阵第一种横矩阵格式上下这就是上图中荒野行动那种比例第二种横矩阵格式上下比例特征除了其他所有数值在间普通食物横矩阵和竖矩阵的矩阵头在这个区间针对自动瞄准应该如何检测模拟类自瞄一所提供的所有按键操作鼠标操作类接口函数全部由游戏安全系统接管二既然了相关函数那么就可以被突破被还原还要在代码段上下防止被还原在上多次套多设防御关卡三检测鼠标轨迹和移动速度没有谁可以一直直线移动鼠标内存类自瞄一所提供的所有写内存类接口如函数全部由游戏安全系统接管检测到非自身或者未知程序调用该类型函数对游戏进行操作时将其踢下线二同模拟类自瞄第二条三同模拟类自瞄第三条四加密鼠标横轴坐标且多个地址同步准星数据当非法修改了准星位置即准星数据不同步即可知道非法修改了内存那么接下来同笔者一起分析透视自瞄究竟是如何实现的呢其实只要实现了自瞄就相当于实现了透视只是需要开发者通过一系列算法将其绘制在屏幕上而已而实现自瞄对于有相关工作经验的人来说也算不上难一套公式几乎通杀所有自瞄算法可以简单的分为两种一种通过玩家坐标和准星位置进行计算一种为矩阵自瞄计算模型骨骼等等其实两种自瞄本质意义上区别不大各有各的好处只不过第二种更为精准第一种则更为方便需要的数据更少自己封装内存模块用到的打开进程打开当前进程写内存关闭句柄读取内存整数保护内存读内存字节集提示自身进程权限获取当前进程取一个窗口的标题寻找窗口句柄获取窗口客户区获取窗口类名终止进程获取快照信息获取遍历快照的第一个进程获取遍历快照的下一个进程获取遍历快照的第一个模块获取遍历快照的下一个模块环境数量游戏类型数组世界地址人物坐标血量阵容飞天地址找数据技巧找数据技巧排除栈地址排除上显示的数据信息排除追踪到服务器模块的情况如果本机有服务器的话大量的字符表示的是字符串或开头的字节大概率是浮点数对于服务器和客户端模块都在本地的游戏使用一些确定是服务器数据的数据来找来源来源于的模块大概率就是服务器模块追任何偏移如果能直接搜索到对应基地址则可直接使用基地址可以通过内的来判断这个有几个参数而不仅仅是通过找前的数量配合找下属偏移的高级技巧角色对象附近地址的属性都可以直接尝试定位甚至可以到搜所有相同结果找所有结果中最靠近对象地址附近的结果然后通过所有结果中最靠近对象地址对象首地址来得到猜测的偏移这时候直接在最靠近对象的地址下访问断看能不能断到偏移就是猜测偏移的地址该技巧使用实例针对单机游戏如下无限子弹通过对子弹数下写入断就可以断到断到的位置往上翻找子弹数减少修改此处可以无限子弹往上追上层一定会追到射击射击附近应该有射速相关的参数可能是射击间隔作为参数也可能是别的老游戏每个枪可能都有一个射击但是往上追会追到一个通用的射击每个进行屏蔽来确定哪个是负责后坐力的简单粗暴把负责后坐力的掉将改成参数字节数就实现了没有后坐力找无敌可以到血量下写入断点断到的位置的很可能就是扣血掉就不扣血了放雷的中掉所有可能跳过将雷的数量减一放入某地址的操作就实现了疯狂丢雷无间隔逆向注意点下图这样的一个堆栈地址的情况要这么处理的逆向找内存数据通过客户端或服务端来搜数据排查服务端的模块是哪一个找血量数据如下只有蓝标数据真正可以修改目标血量说明这个数据是服务端数据到中下写入断点来确定服务器模块击中目标的瞬间断到下图位置观察红线标记的模块可知服务器模块应该就是可对其他数据进行下断确定不经过该模块回头发现只有鼠标经过指向目标才变回来的是个基地址第三行数据往上追的过程中经过了模块因此最终确定到第二行数据才是真是数据而不是第三行在中追第二行数据得出队友血量的地址可见地址存的是游戏中鼠标指向不同的人下标会改变从开始可能是一个下标敌人存的血量填的是即原因是敌人血量不可见同时也看不到自己的血量为因此遍历实体血量比对数组项之间的差异结构体大小为公式分析得出的目的是因为我们找到的有可能并不是数组项的起始地址和下标是边界外游戏目前数据只有是队友是敌人打死队友发现其对应的生命不归零因此需要找死亡标志假如我们设为起始数组项地址是为了使后面的偏移项都是正数下标从开始减掉使得下标本来从开始变成从开始阵容表示恐怖分子表示反恐精英是观察者死亡标记表示死亡表示活着超出范围的此项也为血量死亡不清零敌人和自己的血量均没有意义我们还要找坐标的数据结构通过反复让敌人行动找到了坐标锁定才能触发屏闪的位置不锁定什么反应都没有的情况下硬件写入断点直接崩溃发现必须找到是不锁定的情况下修改坐标人物抖动以下这个才是真正要找的目标坐标发现他是一个基地址并且在其附近发现了目标的名称下硬件访问断点开始追该地址断在的两个位置分别是下图两次标黄往上追都不好追追丢了但可以猜测出最末一层的结构体偏移为尝试不直接断坐标数据而是断前后几个数据之一断到的位置往上追一层偏移放开断点后发现上一层偏移的地址中存的值变成了即这个地址是个临时的地址也不能用尝试在名字下访问断断下的位置发现有一个基地址偏移因此大概率是可以追到数据结构的上图可知遍历名字算式为的范围为指向为表示遍历结束确定结构体首地址上图可知坐标比名字大前面有知道名字的末层偏移是因此名字的末层偏移为因此结构体数组首地址为所以结构体数组首地址算式为超出人物数量的结构体数组项全为加入的人物再把人物删除掉后并不会初始化该数组但是名称最前面的一个字节会变成等于结束遍历中间可能出现空坐标但该项也一定不为空注意遍历要跳过自己因为自己该项也是名称名字为空的话代表这个结构没有玩家或玩家已死亡人物模型字符串比如等等等等该数值不断循环从加到仅当处于本人范围内才变化范围外不变化可用于判断对应玩家是否处在本人坐标数据获取范围内坐标坐标超出范围不变化变化说明在范围内自己的坐标不变化坐标坐标坐标为表示该项不存在观察发现数组不一定是顺序存放由于上面结构并没有本人坐标因此下面逆向本人坐标找本人坐标的时候其特点是锁定数值后修改数值人物产生位移解除锁定后动下人物人物瞬移回来另外一种情况是锁定后修改不断的人物屏闪这种内存也能用但是最好不要下断太快了容易崩溃要注意移动到一个位置后要等他完全静止才搜变动因为有些内存更改比较慢上面非屏闪情况就是这种本人坐标屏闪非常快坐标坐标坐标不屏闪但慢慢会跳转个不同的坐标完全不跳转也不屏闪锁定修改后完全没反应最快意外发现朝向数据但是只可以显示朝向数据却无法改变准星朝向本地必然还有一个内存存着真正可以控制准星的数据垂直朝向范围是向上为负到向下为正水平朝向范围是到左到右在中简单观察了一下初步确认不是来自于的服务器数据利用上面找到的朝向数值来找真正的准星内存可以修改准星位置的内存数据垂直朝向范围是向上为负到向下为正水平朝向范围是到左到右的方向是坐标增大方向是坐标减小的方向的方向是坐标增大方向是坐标减小的方向找矩阵找矩阵方法总结找矩阵总结按照上述方法找到的矩阵地址为口袋西游逆向口袋西游逆向参见详见和课骨骼和模型不一定有绝对坐标但是一般都有相对坐标基本数据人物数据中心点中心点中心点中心点到对顶点的差中心点到对顶点的差中心点到对顶点的差立方体下顶点坐标斜对角立方体下顶点坐标斜对角立方体下顶点坐标斜对角立方体上顶点坐标斜对角立方体上顶点坐标斜对角立方体上顶点坐标斜对角周围遍历为对象数量对象数量周围对象周围对象周围对象死亡标志位为死亡周围对象血量未被攻击过是中心点中心点中心点中心点到对顶点的差中心点到对顶点的差中心点到对顶点的差立方体下顶点坐标斜对角立方体下顶点坐标斜对角立方体下顶点坐标斜对角立方体上顶点坐标斜对角立方体上顶点坐标斜对角立方体上顶点坐标斜对角找矩阵找矩阵方法总结找矩阵总结矩阵头地址为也可以突袭的逆向基本数据目标血为人物数据水平朝向顺时针递增竖直朝向到从下到上角色血量血量小于等于为死亡周围遍历为玩家数量玩家数量头头头水平朝向顺时针递增竖直朝向到从下到上身高角色血量血量小于等于为死亡未分析阵营找矩阵找矩阵方法总结找矩阵总结矩阵头地址逆向引擎特点增加新对象时即更换物品时物品从不可见无中生有内存几乎一直在增加世界中所有万物都在数组结构中存在数组数量物品从不可见无中生有的情况数量会增加游戏只要不退出而是当前地图重新开始数量也会增加只有游戏退出或更换地图重新开始数量才会重置同时存数组数量的地址也会发生变化子弹未命中的情况下不会增加实体子弹只有命中的情况下才会增加实体数组数量几乎没有减少的可能基本上一直在增加的坐标特点坐标的内存数据符合以下规律这个特点不绝对在结构对比工具中因为后的和下的被合并误识别为类型因此是如图在内存中的矩阵的前面不远处都符合不绝对全为浮点数的浮点数在内存中为矩阵在内存中的特征码不绝对矩阵上图中红框第三列永远不变不绝对四处走动时最后一行除了其他个都变沿着走两个值改变跳跃时最后一行除了和第一个其他两个变不绝对第一个值到不绝对矩阵下方那排都是参考矩阵逆向吃鸡模拟器基本数据世界数组的项数量该数组中还包含所有的报废对象要找个标志加以区分如果要找到玩家们还需要玩家标志取巧追到头为的低字节地址就是数组起始地址的地址检查发现本人对象首地址也在该世界数组中世界中对象首地址为坐标地址对象首地址对象首地址对象首地址世界对象数组地址世界对象数组地址世界对象数组地址宏观解读世界对象地址得到的是对象结构首地址再进入一个存放了坐标信息的结构首地址再取到坐标或值因为世界数组项非常杂乱什么都有因此需要找人物标志和作废对象标志找人物标志找人物标志首先要知道人物对象首地址可以是自己的也可以是敌人通过自己的数据向上追几层看看有没有多个对象存在可以通过宏观解读去找可以断到人物的位置通过自己的数据判断是否有访问断点往上追两层可以追到断下几个对象地址的情况如下图但由于该游戏访问硬断会崩溃因此采取进行访问代码扫描在到中依次分析以此找到人物对象再将人物对象和其他对象在中做对比分析此位置可以断到多个人物对象通过查看对应坐标可确定是人物对象地址通过上图黄标处多次断下的可以得到所有人物对象地址找人物特征用比对工具如上图前一组两列是两个人物后一组是其他对象黄标处那两个很可能是人物特征如果对象首地址虚表这个条件更稳定更靠谱或者对象首地址即十进制等等还有很多条件也可以不止一种标志比如偏移等等则可判断是人物重点对象首地址的位置代表的指针往往是指向虚表的在非虚继承的情况下虚函数表指针是存在于类的顶部的其一样代表表示对象具有同样的成员函数即对象具有同样的行为模板因此对象首地址是最好用于判断是否同类对象的偏移排除做废对象类似和和这样的位置都可以判断我们发现做废对象虚表指针也会改变因此只需要使用上面人物标志的判断方式就可以避开做废对象人物存活判断搜索找到自身血量的地址然后通过上面找到的自己对象地址通过自己血量地址自己对象首地址得到血量偏移角色对象附近地址的属性都可以直接这样尝试定位甚至可以到搜所有相同结果找所有结果中最靠近对象地址附近的结果然后通过所有结果中最靠近对象地址对象首地址来得到猜测的偏移这时候直接在最靠近对象的地址下访问断看能不能断到偏移就是猜测偏移的地址血量地址为人物对象首地址人物死亡后血量会武器相关人物对象下存在一些数组结构即地址数量的组合找到一个数组刚好和人物身上的武器数相同的数组结构当把手榴弹掏出来的时候数组数量还会加进到数组首地址中数组形式存储的这几个对象一般是对应号键对应的武器顺序对应到武器对象下可找到诸如射击间隔射速武器朝向后坐力等浮点数数据还有子弹数等射速和后坐力等数据往往是武器创建后就固定的浮点数可通过找武器对象下的浮点数避开地址类型数据防止崩溃同时避开会变化的浮点数因为那很可能是武器朝向进行清后游戏中尝试射击后还原来找到后坐力射速数据的位置射速武器对象浮点数射速射击的间隔炸弹没有该参数炸弹应该和枪结构不一致后坐力武器对象浮点数初始上下抖动幅度武器对象浮点数后续上下抖动幅度武器对象浮点数左右抖动幅度骨骼数据骨骼数据一般存有相对于人物参考点坐标的偏移坐标人物参考点坐标可能有别于人物位置坐标通过身体上坐标变化比较多的身体部位来找骨骼数据骨骼数据同样在人物对象下骨骼数据往往是即使人站着的位置不动骨骼数据也会轻微晃动人物在微微晃动骨骼坐标数据如下黄标的是骨骼相对人物参考点坐标的偏移坐标黄标上一行应该是骨骼的朝向信息上图也可以看出这个骨骼的结构是个数组每个数组项占字节因此外围还存在数组地址和数组数量找的过程找到相对骨骼坐标地址后访问断往上追追到下面地址处地址截图追到此处继续往上追发现非常难追了尝试用分析此处用到的找偏移的理论方法有两个值均到中搜索发现其中一个有存放他的地址离对象首地址非常近上图猜测偏移结果为证实对象头地址对象头地址偏移地址为对象头地址对象头地址偏移地址为对象头地址对象头地址偏移地址为对象头地址为或但发现无论是还是都是一样的结果数组首地址是存在因此数组数量应该也在附近果然在位置看到了对象头地址的数量上面找到的只是相对参考点的偏移坐标因此需要人物参考点坐标可以在到对象头地址下去找参考点坐标按照逻辑猜测应该在这里对象头地址骨骼基准坐标对象头地址骨骼基准坐标对象头地址骨骼基准坐标骨骼基准坐标大概率比人物位置坐标要低一般是人物脚下的位置还是实际到游戏中绘制一下看看是不是骨骼基准坐标最可靠找朝向水平朝向值有到到到非常多种但很少出现特别大的值通过简单的搜索后再通过手动修改来确定找到的是不是正确朝向断到两个点通过目标对象首地址配合找到目标数据此处用到的找偏移的理论方法角色头地址水平朝向地址水平朝向值地图正东为顺时针递增角色头地址垂直朝向地址仰角从为水平值俯角从为水平值找矩阵矩阵地址其中的来源涉及非常复杂的加密流程但是他是不变的上面项目代码盘点回到目录跳转到源文件三维坐标结构朝向结构死亡标志位友方单位标志位无矩阵方式为获取人物与目标的世界坐标高度差和世界水平距离来得到人物和目标的夹角再通过人物准星减去目标夹角或反过来来确定准星偏转角度差通过准星偏转角度差来和游戏宽高分辨率来转换为屏幕坐标进行绘图无矩阵画框因为头和脚的差填入的是手动填入的固定值并且画框的时候目标框体的宽高比也是固定值等等因此会有诸多问题朝向对象的头部角度以正轴为底朝向对象的脚部角度以正轴为底朝向目标头部和自己准星朝向的角度差顺时针为正逆时针为负朝向目标脚部和自己准星朝向的角度差最靠近准星的对象口袋西游突袭吃鸡模拟器计算朝向调试工具回到目录跳转到源文件窗口句柄窗口尺寸信息分辨率宽分辨率高外窗口尺寸信息外窗口分辨率宽外窗口分辨率高视角矩阵位矩阵地址位矩阵地址取窗口信息位非矩阵绘制未完善画板句柄画刷句柄字体句柄画笔老的画板句柄老的画刷句柄老的画笔世界坐标转屏幕坐标无矩阵世界坐标转屏幕坐标世界坐标转屏幕坐标位画线从屏幕下方中间出发到两点画线画框针对头脚坐标画框画矩形写字绘制更换画刷更换画笔世界坐标转屏幕坐标非矩阵屏幕坐标水平角度差高低角度差横向量乘矩阵函数创建窗口需要针对游戏进行修正只支持位位需要进行修改回到目录标准系统包含文件的包含文件或是经常使用但不常更改的特定于项目的包含文件从头中排除极少使用的资料头文件在此处引用程序需要的其他头文件回到目录跳转到头文件定义应用程序的入口点无矩阵绘制流程调试展示信息刷新数据后显示来看看从开始遍历跳过自己死循环不断绘制的过程从开始遍历跳过自己死亡的跳过绘制流程是否使用矩阵方式矩阵方式脚坐标是否能转换成屏幕坐标该函数内部避免了在角色身后绘制的情况能转换成屏幕坐标的才绘制头坐标是否能转换成屏幕坐标该函数内部避免了在角色身后绘制的情况能转换成屏幕坐标的才绘制非矩阵方式脚坐标是否能转换成屏幕坐标该函数内部避免了在角色身后绘制的情况能转换成屏幕坐标的才绘制头坐标是否能转换成屏幕坐标该函数内部避免了在角色身后绘制的情况能转换成屏幕坐标的才绘制头和脚都在屏幕范围内才绘制是朋友不绘制画框按下开关绘制绘制画框屏幕坐标屏幕坐标第号按下右键校准刚好指到头修改内存准星数据非矩阵有问题不行按下彻底退出口袋西游口袋西游按下开关绘制按下彻底退出突袭按下开关绘制按下彻底退出吃鸡模拟器绘制排除死的和友军的按下开关绘制按下彻底退出用于储存自建窗口的句柄测试的释放按下退出消息循环回调函数背景颜色注册窗口类创建窗口扩展风格透明窗口类名指针自建窗口窗口名指针窗口的风格初始水平位置初始垂直位置宽度游戏水平窗口分辨率屏幕水平分辨率由于此两项是初始位置所以写什么都行反正下面会实时修正高度游戏窗口垂直分辨率屏幕垂直分辨率应用程序实例的句柄用户自定义的变量显示窗口更新窗口消息循环置顶窗口读取当前的主框架的保证主框架前置然后再恢复到正常状态分发消息解释消息按下退出消息循环回调函数针对每款游戏提供全局工具透明窗口绘制针对每款游戏实现获取自己的窗口的宽高位置信息更新窗口这里是为了清空上一次的绘制绘制矩形区别似乎只有下面这个类针对位不断地跟我们的窗口重合前清除原有绘画前更新绘画目标为新建窗口对应的后准星绘制准星负数高度负数宽度一半宽度三分之一宽度按下打开射线绘制下面的画线有问题禁用指定动态链接库的和通知自建窗口回到目录跳转到头文件初始化值未判断离得远的敌人的框体消除读取自己的阵营号位置是自己最小角度差和初始值从开始遍历跳过自己遍历到了真正的边界直接结束跳过无用的数组项真正是计算朝向获取离准星最近的对象用于自瞄是没死的敌人并且在我们的自瞄范围中获取离准星最近的对象未攻击的血量为自己的人物也加进去因为游戏是第三人称人物本身也是在游戏中的从开始遍历跳过无效数据吃鸡模拟器遍历世界数组真实的对象数量排除不可以访问的指针不符合人物特征同时排除了作废对象排除死亡人物只有未死亡的才记录了所以默认都是未死亡数量水平朝向确定第一象限第二象限第三象限第四象限垂直朝向确定上方必须加负数因为游戏逆向朝上转视角是负数下方计算朝向目标头部和自己准星朝向的角度差顺时针为正逆时针为负跨轴的两种情况防止超出水平转向区间加上输出头特征编码转换回到目录跳转到头文件获得窗口信息含有边框及全屏幕坐标删除原来的句柄最大不在屏幕范围内世界坐标转屏幕坐标非矩阵屏幕坐标水平角度差高低角度差高低可视角度水平角度差高低角度差高低可视角度不在屏幕范围内水平差水平角度差屏幕坐标水平差高度差高低角度差屏幕坐标高度差刷新矩阵世界坐标世界坐标配合矩阵算出裁剪坐标目前只考虑了列主序还需要考虑行主序的情况剪辑坐标如果小于表示在屏幕外坐标刷新矩阵世界坐标世界坐标配合矩阵算出裁剪坐标目前只考虑了列主序还需要考虑行主序的情况剪辑坐标如果小于表示在屏幕外坐标从屏幕下方中间点开始画顶边左边右边底边负数高度负数宽度一半宽度三分之一宽度删除原来的字体句柄逆向一切基于对象他们可以有各种属性中叫做组件有像的属性其包含位置旋转和比例等这样的数据的脚本由编写建立在方法中写在不同的类中以继承方法其中一些方法如下这个方法只被调用一次这份方法每一个被调用一次这个方法每一帧被调用一次这是绘制方法的文件结构中所有的脚本被编译为两个他们被称为和他们在文件夹中其他的在文件夹中是引擎代码和其他系统代码找数据特殊技巧语言编译出来的中的语言实际上是框架中的中间语言该语言的文件可以跨平台运行于虚拟机可以将语言写的文件基本完美反编译出源代码而的职责是把语言的文件转换为原生的系统二进制文件如何区分游戏是采用技术还是不采用技术文件同目录下有的一般为采用了技术文件夹所在目录没有什么但可以进行加密隐藏该文件参考原神所在目录进入文件夹中的子目录中有个文件夹所在目录有一大堆文件此时文件同目录下没有即为未采用机制将中所有类型信息保存到的文件通过解析文件可以获得代码中的类型方法字段等等信息游戏偏移层级比较多因此最优先的方法就是在找到人物的基本属性一般找血量后找到赋值的汇编段取对象地址即可这是最方便的做法下面是不用的前提下快速找到数组数组和人数一般满足一定的偏移关系不绝对而且可以直接找到人物的数组没有其他对象干扰找其他物品外部的方式似乎是通过找因此完全可以从人数入手二者关系如下为人数地址为数组在位中大多数情况是位大多数情况是逃离塔科夫逆向先追人物坐标经过一个逆向注意点下图这样的一个堆栈地址的情况要如下图这么处理未能最后但追到下面的偏移角色坐标地址追骨骼中途会遇到会崩溃的情况此时只能使用硬件访问数据断点来断放开断点前先跟踪往上追的内存放开断点的时候如果发现内存中的值骤变了说明他是个临时的值这时候可以用搜的方式往上找绘制相关除了注入后的进行绘制外还有如下绘制方法和绘制简单粗暴但容易被检测开始渲染函数一个参数是画一个点画线等等关闭渲染函数一个参数函数在中利用函数关闭我们不想让他显示的渲染检测方面主要是的对抗自建窗口外部绘制反外挂最艰难的一种绘制方法优点不闪烁检测难度大了创建一个透明窗口同步分辨率透明窗口跟随游戏移动置顶透明窗口自己的窗口上画框框架代码参考窗口特征枚举检测截图检测可以使用防止自己的外部窗口被截图相关代码配置属性目录包含目录选中库根目录下的文件夹属性目录引用目录选中库根目录下的或文件夹属性目录库目录选中库根目录下的或文件夹预编译绘制预编译相关的一些东西如果不想用变量用全局变量的话千万别再头文件声明在文件声明后再在头文件类型名变量名辅助窗口句柄窗口矩形窗口宽窗口高注册窗口需要用到的窗口类画矩形文字之类的单独放在这个函数里窗口消息处理函数初始化创建透明窗口游戏窗口句柄绘制函数窗口消息循环画线绘制文字画框绘制开始绘制结束绘制绘制初始化创建设备辅助窗口句柄创建字体创建透明窗口游戏窗口句柄绘制函数绘制函数游戏窗口句柄游戏窗口句柄绘制函数初始化窗口类注册窗口创建窗口出错提示创建窗口窗口矩形窗口宽窗口矩形窗口矩形窗口高窗口矩形窗口矩形辅助窗口句柄窗口宽窗口高显示窗口辅助窗口句柄辅助窗口句柄初始化窗口消息循环使辅助窗口一直盖在游戏窗口上窗口矩形窗口宽窗口矩形窗口矩形窗口高窗口矩形窗口矩形窗口矩形窗口高辅助窗口句柄窗口矩形窗口矩形窗口宽窗口高处理窗口消息辅助窗口句柄就是这里调用了我们的画框画线之类的函数画线绘制文字画框绘制开始绘制结束调用例子绘制线粗红色绘制绘制开始画线线粗画框线粗绘制文字吾无法无天绘制结束游戏窗口开始创建透明窗口游戏窗口绘制窗口消息循环开始输入关闭泄露注意点出来的对象都要用来释放出来的都要用来释放得出的要用来释放每次获取到的都不一样我理解成开了个拷贝因此即使是同一个窗口句柄多次也要每一个对应一个才能防止对象泄露双缓冲闪烁的原因是清除画布后绘制的时间较长导致出现闪烁的现象双缓冲使用内容缓冲来解决与多个画图操作相关的闪烁问题启用双缓冲后所有画图操作会首先呈现到内存缓冲而不是屏幕上的绘图图面所有画图操作完成后内存缓冲会直接复制到与之关联的绘图图面由于屏幕上仅执行一个图形操作因此与复杂画图操作相关的图像闪烁可得以消除',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-01 15:51:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://th.bing.com/th/id/OIP.wtmjepfWPBvn26uz7s18dgHaHa?rs=1&amp;pid=ImgDetMain"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ZEROKO14的个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 1.05rem;">AI<sup>1</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 1.05rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 1.05rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 1.05rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 1.05rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 1.05rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 1.05rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 1.05rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 1.05rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 1.05rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 1.05rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 1.05rem;">ppt<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 1.05rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 1.05rem;">vue<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 1.05rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 1.05rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 1.05rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 1.05rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">基础<sup>6</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 1.05rem;">杂项<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%89%A9%E7%90%86/" style="font-size: 1.05rem;">物理<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">逆向<sup>5</sup></a><a href="/tags/%E9%AD%94%E6%B3%95/" style="font-size: 1.05rem;">魔法<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9D%82%E9%A1%B9/" itemprop="url">杂项</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/FPS/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>FPS</span></a></span></div></div><h1 class="post-title" itemprop="name headline">FPS逆向</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-11-24T09:33:30.022Z" title="发表于 2023-11-24 17:33:30">2023-11-24</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-01-01T07:51:00.593Z" title="更新于 2024-01-01 15:51:00">2024-01-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="FPS逆向"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新加坡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新加坡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://che77a38.github.io/posts/FPS%E9%80%86%E5%90%91%E9%9A%8F%E7%AC%94/"><header><a class="post-meta-categories" href="/categories/%E6%9D%82%E9%A1%B9/" itemprop="url">杂项</a><a href="/tags/FPS/" tabindex="-1" itemprop="url">FPS</a><h1 id="CrawlerTitle" itemprop="name headline">FPS逆向</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ZEROKO14</span><time itemprop="dateCreated datePublished" datetime="2023-11-24T09:33:30.022Z" title="发表于 2023-11-24 17:33:30">2023-11-24</time><time itemprop="dateCreated datePublished" datetime="2024-01-01T07:51:00.593Z" title="更新于 2024-01-01 15:51:00">2024-01-01</time></header><p>fps辅助整体分析</p>
<span id="more"></span>

<ul>
<li>FPS游戏特性导致的，需要非常高的实时性，不能过度的网络验证</li>
<li>绘制部分可以使用透明窗口覆盖在游戏上，非常难以检测</li>
<li>自瞄部分，捕捉准星数据，准星路径曲线不规则或有中断（不能平滑，人类操作鼠标非常不圆滑）</li>
<li>连续爆头的行为检测行为数据异常等等</li>
</ul>
<h1 id="相关基础"><a href="#相关基础" class="headerlink" title="相关基础"></a>相关基础</h1><h2 id="角度计算"><a href="#角度计算" class="headerlink" title="角度计算"></a>角度计算</h2><ul>
<li>tan，cos，sin函数，<strong>参数为弧度</strong>，弧度为π表示180度。</li>
<li>atan2，acos2，asin2，<strong>返回值为弧度</strong>。</li>
</ul>
<p>$$<br>角度&#x3D;(弧度*180)&#x2F;π<br>$$</p>
<p>$$<br>弧度&#x3D;(角度*π)&#x2F;180<br>$$</p>
<p><strong>了解线性代数:</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.bilibili.com/video/BV1ys411472E" alt="线性代数本质系列|720x360"></p>
<p>向量内积是一个向量在另一个向量上的投影长度乘以另一个向量的长度</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//比如：[1,3]和[3,0]的向量内积为：</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">3</span>]*[<span class="number">3</span>,<span class="number">0</span>]=<span class="number">3</span>+<span class="number">0</span>=<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>矩阵的乘法：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202201221330618.png" alt="image-20220122133019389"></p>
<h2 id="快捷键写法"><a href="#快捷键写法" class="headerlink" title="快捷键写法"></a>快捷键写法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(GetKeyState(VK_F1)&amp;<span class="number">1</span>)<span class="comment">//VK_F1是键码</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//按下F1执行里面的指令,再按下F1停止执行里面的指令</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="绘制的三种方法"><a href="#绘制的三种方法" class="headerlink" title="绘制的三种方法"></a>绘制的三种方法</h2><ol>
<li>hook d3d&#x2F;opengl<ul>
<li>优:完全不闪,代码简单</li>
<li>缺:非常容易被检测</li>
</ul>
</li>
<li>游戏窗口上自行绘制<ul>
<li>优:适中</li>
<li>缺:会闪</li>
</ul>
</li>
<li>自己创建窗口,在自己创建的窗口上绘制<ul>
<li>优:稳定</li>
<li>缺:麻烦一点,会闪,需要通信</li>
</ul>
</li>
</ol>
<h1 id="3维坐标转屏幕算法"><a href="#3维坐标转屏幕算法" class="headerlink" title="3维坐标转屏幕算法"></a>3维坐标转屏幕算法</h1><p>两种坐标求导算法</p>
<ul>
<li>需要矩阵</li>
<li>不需要矩阵</li>
</ul>
<h2 id="不需要矩阵"><a href="#不需要矩阵" class="headerlink" title="不需要矩阵"></a>不需要矩阵</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202201221928872.png" alt="image-20220122192831457"><br>$$<br>摄像机到准星的距离分辨率&#x3D;\frac{\frac{屏幕水平分辨率}{2}}{\tan{\frac{水平FOV}{2}}}<br>$$<br>$$<br>\tan{x差角度}&#x3D;\frac{屏幕的x差分辨率}{摄像机到准星的距离分辨率}<br>$$</p>
<p>$$<br>\tan{x差角度}&#x3D;\frac{屏幕的x差分辨率}{\frac{\frac{屏幕水平分辨率}{2}}{\tan{\frac{水平FOV}{2}}}}<br>$$</p>
<p>$$<br>屏幕的x差分辨率&#x3D;\frac{\frac{屏幕水平分辨率}{2}}{\tan{\frac{水平FOV}{2}}}\times\tan{x差角度}<br>$$</p>
<p>因为屏幕的左上角为(0,0)，向右为x变大，向下为y变大，因此可知：</p>
<p><strong>屏幕上指向敌人的x坐标</strong>就是:<strong>屏幕的x差分辨率+水平分辨率&#x2F;2</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202201221515481.png" alt="image-20220122151558943"><br>$$<br>\frac{垂直FOV}{水平FOV}&#x3D;\frac{垂直分辨率}{水平分辨率}<br>$$<br>$$<br>屏幕的y差分辨率&#x3D;\frac{\frac{屏幕垂直分辨率}{2}}{\tan{\frac{垂直FOV}{2}}}\times\tan{y差角度}<br>$$</p>
<p>$$<br>屏幕的y差分辨率&#x3D;\frac{\frac{屏幕水平分辨率}{2}}{\tan{\frac{水平FOV}{2}}}\times\tan{y差角度}<br>$$</p>
<p><strong>屏幕上指向敌人的y坐标</strong>就是:<strong>屏幕的y差分辨率+垂直分辨率&#x2F;2</strong></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><p>$$<br>屏幕坐标X&#x3D;\frac{\frac{屏幕水平分辨率}{2}}{\tan{\frac{水平FOV}{2}}}\times\tan{x差角度}+\frac{水平分辨率}{2}<br>$$</p>
<p>$$<br>屏幕坐标Y&#x3D;\frac{\frac{屏幕水平分辨率}{2}}{\tan{\frac{水平FOV}{2}}}\times\tan{y差角度}+\frac{垂直分辨率}{2}<br>$$</p>
<p>算法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> 坐标结构</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> X,Y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> 弧度转角度(<span class="type">float</span> 弧度)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> 弧度*<span class="number">180</span>/PI;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> 角度转弧度(<span class="type">float</span> 角度)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> 角度*PI/<span class="number">180</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> 世界坐标转屏幕坐标_非矩阵(坐标结构&amp; 屏幕坐标,<span class="type">float</span> 水平角度差,<span class="type">float</span> 垂直角度差,<span class="type">float</span> 水平FOV)</span><br><span class="line">&#123;</span><br><span class="line">    取窗口信息(水平分辨率，垂直分辨率);<span class="comment">//获取屏幕分辨率(伪函数)</span></span><br><span class="line">    <span class="type">float</span> 摄像机到准星的距离分辨率=水平分辨率/<span class="number">2</span>/(<span class="built_in">tan</span>(角度转弧度(水平FOV/<span class="number">2</span>)));</span><br><span class="line">    <span class="type">float</span> 高低最大可视角度=弧度转角度(<span class="built_in">atan2</span>(垂直分辨率/<span class="number">2</span>,摄像机到准星的距离分辨率));</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(水平角度差)&gt;水平FOV/<span class="number">2</span>||<span class="built_in">fabs</span>(垂直角度差)&gt;高低最大可视角度)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//不在屏幕范围内</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> 水平差=摄像机到准星的距离分辨率*<span class="built_in">tan</span>(角度转弧度(水平角度差));</span><br><span class="line">    屏幕坐标.X=水平差+水平分辨率/<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> 垂直差=摄像机到准星的距离分辨率*<span class="built_in">tan</span>(角度转弧度(垂直角度差));</span><br><span class="line">    屏幕坐标.Y=垂直差+垂直分辨率/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>无矩阵方式为:获取人物与目标的世界坐标高度差和世界水平距离来得到人物和目标的夹角,再通过人物准星减去目标夹角(或反过来)来确定准星偏转<strong>角度差</strong>,再通过准星偏转角度差和游戏宽高分辨率来转换成屏幕坐标进行绘图</p>
<p>这种方式得到的坐标绘制多多少少有误差,下面用到矩阵的方式无误差</p>
<h3 id="相关代码截取"><a href="#相关代码截取" class="headerlink" title="相关代码截取"></a>相关代码截取</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point2D</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">float</span> X, Y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span>  <span class="title">Vector4</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">float</span> x;</span><br><span class="line">	<span class="type">float</span> y;</span><br><span class="line">	<span class="type">float</span> z;</span><br><span class="line">	<span class="type">float</span> w;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Paint</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">	HWND m_hWnd;<span class="comment">//窗口句柄</span></span><br><span class="line">	RECT m_wndRect;<span class="comment">//窗口尺寸信息</span></span><br><span class="line">	<span class="type">int</span> m_resolutionWidth;<span class="comment">//分辨率宽</span></span><br><span class="line">	<span class="type">int</span> m_resolutionHeight;<span class="comment">//分辨率高</span></span><br><span class="line">	RECT m_outsideWnd;<span class="comment">//外窗口尺寸信息</span></span><br><span class="line">	<span class="type">int</span> m_outsideWndWidth;<span class="comment">//外窗口分辨率宽</span></span><br><span class="line">	<span class="type">int</span> m_outsideWndHeight;<span class="comment">//外窗口分辨率高</span></span><br><span class="line">	<span class="type">float</span> m_viewMatrix[<span class="number">16</span>];<span class="comment">//视角矩阵</span></span><br><span class="line">	DWORD m_matrixAddr32;<span class="comment">//32位矩阵地址</span></span><br><span class="line">	DWORD64 m_matrixAddr64;<span class="comment">//64位矩阵地址</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//取窗口信息</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">getWndInfo</span><span class="params">()</span>;</span><br><span class="line">public:</span><br><span class="line">	Paint(HWND hWnd,DWORD matrixAddr=<span class="literal">NULL</span>, COLORREF brushColor=RGB(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>), COLORREF penColor=RGB(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">	<span class="comment">//64位非矩阵绘制未完善</span></span><br><span class="line">	Paint(HWND hWnd, DWORD64 matrixAddr, COLORREF brushColor = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), COLORREF penColor = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	Paint();</span><br><span class="line">	~Paint();</span><br><span class="line">	HDC hdc;<span class="comment">//画板句柄</span></span><br><span class="line">	HBRUSH hBrush;<span class="comment">//画刷句柄</span></span><br><span class="line">	HFONT hfont;<span class="comment">//字体句柄</span></span><br><span class="line">	HPEN hPen;<span class="comment">//画笔</span></span><br><span class="line">	<span class="comment">//HDC hOldDc;//老的画板句柄</span></span><br><span class="line">	<span class="comment">//HBRUSH hOldBrush;//老的画刷句柄</span></span><br><span class="line">	<span class="comment">//HPEN hOldPen;//老的画笔</span></span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标(无矩阵)</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPointWithoutMatrix</span><span class="params">(Point2D&amp; screenPoint,<span class="type">const</span> Orientation&amp; angleDiff)</span>;</span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPoint</span><span class="params">(Point2D&amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span>;</span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标64位</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPoint64</span><span class="params">(Point2D&amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span>;</span><br><span class="line">	<span class="comment">//画线(从屏幕下方中间出发到(x,y))</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line">	<span class="comment">//两点画线</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> xTo, <span class="type">int</span> yTo)</span>;</span><br><span class="line">	<span class="comment">//画框</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintFrame</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, <span class="type">int</span> h, <span class="type">int</span> thick)</span>;</span><br><span class="line">	<span class="comment">//针对头脚坐标画框</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintFrameByFootAndHead</span><span class="params">(Point2D footPoiny,Point2D headPoint,<span class="type">int</span> thick)</span>;</span><br><span class="line">	<span class="comment">//画矩形</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintRect</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> w,<span class="type">int</span> h)</span>;</span><br><span class="line">	<span class="comment">//写字</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintText</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,COLORREF color,<span class="type">const</span> <span class="type">char</span>* text)</span>;</span><br><span class="line">	<span class="comment">//绘制</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">beginPaint</span><span class="params">()</span>;</span><br><span class="line">	<span class="comment">//更换画刷</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">changeBrush</span><span class="params">(COLORREF brushColor)</span>;</span><br><span class="line">	<span class="comment">//更换画笔</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">changePen</span><span class="params">(<span class="type">int</span> penStyle,<span class="type">int</span> penWidth,COLORREF penColor)</span>;</span><br><span class="line">	<span class="type">bool</span> 世界坐标转屏幕坐标_非矩阵(Point2D&amp; 屏幕坐标, FLOAT  水平角度差, FLOAT 高低角度差);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">angleToRadian</span><span class="params">(<span class="type">float</span> angle)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (FLOAT)(angle*PI / <span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">float</span> <span class="title function_">radianToAngle</span><span class="params">(<span class="type">float</span> radian)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (FLOAT)(radian * <span class="number">180</span> / PI);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::getWndInfo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//获得窗口信息</span></span><br><span class="line">	GetClientRect(m_hWnd,&amp;m_wndRect);</span><br><span class="line">	m_resolutionWidth = m_wndRect.right - m_wndRect.left;</span><br><span class="line">	m_resolutionHeight = m_wndRect.bottom - m_wndRect.top;</span><br><span class="line">	GetWindowRect(m_hWnd, &amp;m_outsideWnd);  <span class="comment">//含有边框及全屏幕坐标</span></span><br><span class="line">	m_outsideWndWidth = m_outsideWnd.right - m_outsideWnd.left;</span><br><span class="line">	m_outsideWndHeight = m_outsideWnd.bottom - m_outsideWnd.top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> Paint::世界坐标转屏幕坐标_非矩阵(Point2D&amp; 屏幕坐标, FLOAT  水平角度差, FLOAT 高低角度差)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	getWndInfo();</span><br><span class="line">	FLOAT 高低可视角度 = (FLOAT)((<span class="type">double</span>)<span class="built_in">atan2</span>(m_resolutionHeight, m_resolutionWidth) * <span class="number">180</span> / <span class="number">3.1415</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(水平角度差) &gt; <span class="number">45</span> || <span class="built_in">fabs</span>(高低角度差) &gt; 高低可视角度)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">// 不在屏幕范围内</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> 水平差 = (<span class="type">int</span>)(<span class="built_in">tan</span>(水平角度差 * <span class="number">3.1416</span> / <span class="number">180</span>) * ((m_resolutionWidth) / <span class="number">2</span>));</span><br><span class="line">	屏幕坐标.X = (<span class="type">float</span>)(m_resolutionHeight / <span class="number">2</span> + 水平差);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> 高度差 = (<span class="type">int</span>)(<span class="built_in">tan</span>(高低角度差 * <span class="number">3.1416</span> / <span class="number">180</span>) * ((m_resolutionWidth) / <span class="number">2</span>));</span><br><span class="line">	屏幕坐标.Y = (<span class="type">float</span>)(m_resolutionHeight / <span class="number">2</span> + 高度差);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//计算朝向函数参考</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EntityAround::calOrientation</span><span class="params">(Point3D&amp; targetLoc,Orientation&amp; targetAngle,Orientation&amp; angleDiff)</span></span><br><span class="line">&#123;</span><br><span class="line">	FLOAT fov_X = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x195fe58</span>);</span><br><span class="line">	FLOAT fov_Y = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x195fe5c</span>);</span><br><span class="line">	FLOAT fov_Z = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x195fe60</span>);</span><br><span class="line">	FLOAT fov_horizon= *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x19E10C8</span>);</span><br><span class="line">	FLOAT fov_vertical = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x19E10C4</span>);</span><br><span class="line">	<span class="comment">//水平朝向确定</span></span><br><span class="line">	<span class="keyword">if</span> (targetLoc.X &gt;= fov_X&amp;&amp;targetLoc.Y &gt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第一象限</span></span><br><span class="line">		targetAngle.horizon= radianToAngle(<span class="built_in">atan2</span>(targetLoc.Y - fov_Y, targetLoc.X - fov_X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (targetLoc.X &lt;= fov_X&amp;&amp;targetLoc.Y &gt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第二象限</span></span><br><span class="line">		targetAngle.horizon = <span class="number">180</span>- radianToAngle(<span class="built_in">atan2</span>(targetLoc.Y - fov_Y, fov_X - targetLoc.X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (targetLoc.X &lt;= fov_X&amp;&amp;targetLoc.Y &lt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第三象限</span></span><br><span class="line">		targetAngle.horizon = <span class="number">180</span>+ radianToAngle(<span class="built_in">atan2</span>(fov_Y - targetLoc.Y, fov_X - targetLoc.X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (targetLoc.X &gt;= fov_X&amp;&amp;targetLoc.Y &lt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第四象限</span></span><br><span class="line">		targetAngle.horizon = <span class="number">360</span> - radianToAngle(<span class="built_in">atan2</span>(fov_Y - targetLoc.Y, targetLoc.X - fov_X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//垂直朝向确定</span></span><br><span class="line">	FLOAT distance = <span class="built_in">sqrt</span>((targetLoc.X - fov_X)*(targetLoc.X - fov_X) + (targetLoc.Y - fov_Y)*(targetLoc.Y - fov_Y));</span><br><span class="line">	<span class="keyword">if</span> (targetLoc.Z &gt;= fov_Z)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//上方</span></span><br><span class="line">		targetAngle.vertical = -radianToAngle(<span class="built_in">atan2</span>(targetLoc.Z - fov_Z, distance));<span class="comment">//必须加负数,因为游戏逆向朝上转视角是负数</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//下方</span></span><br><span class="line">		targetAngle.vertical = radianToAngle(<span class="built_in">atan2</span>(fov_Z - targetLoc.Z, distance));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//计算朝向目标头部和自己准星朝向的角度差(顺时针为正,逆时针为负)</span></span><br><span class="line">	angleDiff.horizon = fov_horizon - targetAngle.horizon;</span><br><span class="line">	<span class="keyword">if</span> (angleDiff.horizon&lt;=<span class="number">-180</span>)<span class="comment">//跨0轴的两种情况,防止超出水平转向区间</span></span><br><span class="line">	&#123;</span><br><span class="line">		angleDiff.horizon += <span class="number">360</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (angleDiff.horizon&gt;<span class="number">180</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		angleDiff.horizon -= <span class="number">360</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	angleDiff.vertical = targetAngle.vertical - fov_vertical;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="需要矩阵"><a href="#需要矩阵" class="headerlink" title="需要矩阵"></a>需要矩阵</h2><p>矩阵分行主序与列主序,主要是d3d和openGl的区别</p>
<ul>
<li><p>行主序(D3D)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a1 a2 a3 a4          x         a1*x+a2*y+a3*z+a4*w</span><br><span class="line">b1 b2 b3 b4    乘以  	y  =      b1*x+b2*y+b3*z+b4*w</span><br><span class="line">c1 c2 c3 c4          z         c1*x+c2*y+c3*z+c4*w</span><br><span class="line">d1 d2 d3 d4          w         d1*x+d2*y+d3*z+d4*w</span><br></pre></td></tr></table></figure>
</li>
<li><p>列主序(openGl)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">               a1 b1 c1 d1    a1*x+a2*y+a3*z+a4*w</span><br><span class="line">x,y,z,w  乘以  a2 b2 c2 d2  =  b1*x+b2*y+b3*z+b4*w</span><br><span class="line">              a3 b3 c3 d3     c1*x+c2*y+c3*z+c4*w</span><br><span class="line">              a4 b4 c4 d4     d1*x+d2*y+d3*z+d4*w</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="缩放和位移矩阵"><a href="#缩放和位移矩阵" class="headerlink" title="缩放和位移矩阵"></a>缩放和位移矩阵</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//行主序:(D3D)</span></span><br><span class="line">Sx <span class="number">0</span>  <span class="number">0</span>  Tx</span><br><span class="line"><span class="number">0</span>  Sy <span class="number">0</span>  Ty</span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  Sz Tz</span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>  Tw</span><br><span class="line"><span class="comment">//列主序:(openGl)</span></span><br><span class="line">Sx <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  Sy <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  Sz <span class="number">0</span></span><br><span class="line">Tx Ty Tz Tw</span><br><span class="line">  </span><br><span class="line"><span class="comment">//平移缩放后的坐标如下</span></span><br><span class="line">                  Sx*x+w*Tx</span><br><span class="line">x,y,z,w乘以列主序= Sy*y+w*Ty</span><br><span class="line">  							 Sz*z+w*Tz</span><br><span class="line">                 w*Tw</span><br></pre></td></tr></table></figure>

<p><strong>[第一结论]</strong> : 行主序最后一列,列主序最后一行,走路,跳,会发生改变,不代表别的动作不改变</p>
<h3 id="旋转矩阵"><a href="#旋转矩阵" class="headerlink" title="旋转矩阵"></a><strong>旋转矩阵</strong></h3><h4 id="绕z轴旋转矩阵"><a href="#绕z轴旋转矩阵" class="headerlink" title="绕z轴旋转矩阵"></a>绕z轴旋转矩阵</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">绕z轴旋转矩阵(A表示点逆时针旋转角度 或 坐标系顺时针旋转角度)</span><br><span class="line"><span class="comment">//行主序</span></span><br><span class="line">cosA   -sinA  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">sinA   cosA   <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>      <span class="number">0</span>      <span class="number">1</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"><span class="comment">//列主序</span></span><br><span class="line">cosA   sinA   <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">-sinA  cosA   <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>      <span class="number">0</span>      <span class="number">1</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>  <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//绕z轴顺时针旋转后的坐标如下:</span></span><br><span class="line">                 xcosA-ysinA</span><br><span class="line">x,y,z,w乘以列主序= xsinA+yconsA</span><br><span class="line">                 z</span><br><span class="line">                 w</span><br></pre></td></tr></table></figure>

<p><strong>[第二结论]</strong> : 水平转动的情况,行主序第三列不变,列主序第三行不变</p>
<h4 id="绕x轴旋转矩阵"><a href="#绕x轴旋转矩阵" class="headerlink" title="绕x轴旋转矩阵"></a>绕x轴旋转矩阵</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">绕x轴旋转矩阵(A表示点逆时针旋转角度 或 坐标系顺时针旋转角度)</span><br><span class="line"><span class="comment">//行主序</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0</span>     <span class="number">0</span>      <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  conA  -sinA  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  sinA  cosA   <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>     <span class="number">0</span>      <span class="number">1</span></span><br><span class="line"><span class="comment">//列主序</span></span><br><span class="line"><span class="number">1</span>  <span class="number">0</span>     <span class="number">0</span>      <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  conA  sinA   <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  -sinA cosA   <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>     <span class="number">0</span>      <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//绕x轴顺时针旋转后的坐标如下:</span></span><br><span class="line">                 x</span><br><span class="line">x,y,z,w乘以列主序= -zsinA+yconsA</span><br><span class="line">                 ysinA+zcosA</span><br><span class="line">                 w</span><br></pre></td></tr></table></figure>

<p><strong>[第三结论]</strong> : 高低朝向改变的时候,行主序第一行不变,列主序第一列不变</p>
<h4 id="绕y轴旋转矩阵"><a href="#绕y轴旋转矩阵" class="headerlink" title="绕y轴旋转矩阵"></a>绕y轴旋转矩阵</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//绕y轴旋转矩阵(A表示点逆时针旋转角度 或 坐标系顺时针旋转角度)</span></span><br><span class="line"><span class="comment">//行主序</span></span><br><span class="line">cosA  <span class="number">0</span>  sinA  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>     <span class="number">1</span>  <span class="number">0</span>     <span class="number">0</span></span><br><span class="line">-sinA <span class="number">0</span>  cosA  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>  <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"><span class="comment">//列主序</span></span><br><span class="line">cosA  <span class="number">0</span>  -sinA <span class="number">0</span></span><br><span class="line"><span class="number">0</span>     <span class="number">1</span>  <span class="number">0</span>     <span class="number">0</span></span><br><span class="line">sinA  <span class="number">0</span>  cosA  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>     <span class="number">0</span>  <span class="number">0</span>     <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//绕y轴顺时针旋转后的坐标如下:</span></span><br><span class="line">                 xcosA+zsinA</span><br><span class="line">x,y,z,w乘以列主序= y</span><br><span class="line">                 -xsinA+zcosA</span><br><span class="line">                 w</span><br></pre></td></tr></table></figure>

<h3 id="矩阵变换总结"><a href="#矩阵变换总结" class="headerlink" title="矩阵变换总结"></a>矩阵变换总结</h3><h3 id="找矩阵总结"><a href="#找矩阵总结" class="headerlink" title="找矩阵总结"></a><strong>找矩阵总结</strong></h3><p>分类</p>
<ul>
<li>行主序(D3D)</li>
<li>列主序(openGl)</li>
</ul>
<p>总结</p>
<ul>
<li><strong>[第一结论]</strong> : 行主序最后一列,列主序最后一行,走路,跳,会发生改变(只影响这行或列),不代表别的动作不改变)</li>
<li><strong>[第二结论]</strong> : 水平转动的情况,行主序第三列(或第二列)不变,列主序第三行(或第二行)不变</li>
<li><strong>[第三结论]</strong> : 高低朝向改变的时候,行主序第一行不变,列主序第一列不变</li>
</ul>
<p>下面的结论不绝对</p>
<ul>
<li>**[第四结论]**矩阵第一个值往往是-1到1之间的(只有一部分)</li>
<li>**[第五结论]**行主序第一行第三个(或第二个)元素是固定的0,列主序第一列的第三个(或第二个)元素是0</li>
<li>**[第六结论]**开倍镜,第一个值会乘以相应的倍数(这个是绝对的)</li>
<li>**[第七结论]**列主序最后两列前三值相似,行主序最后两行前三值相似(只做参考)</li>
<li>**[第八结论]**随便走,不动准星,会有一行或一列4个在变化(如果只朝x或y前进,那么也只改变3个值,即行主序最后一列第一个与列主序最后一行第一个当沿着x或y方向走也不变),跳就只有三个值在一行或一列变化[第八结论UE4矩阵不符合,可参考下面的UE4专题]</li>
</ul>
<p>经验:</p>
<ul>
<li>找矩阵的时候一批次只用确定一次</li>
<li>找矩阵的时候,优先找多号码段连排的</li>
</ul>
<p><strong>基本步骤</strong></p>
<ol>
<li>鼠标移动,搜变动</li>
<li>人物移动,跳跃等搜不变动</li>
<li>如果剩余过多尝试不绝对结论减少数量(风险)</li>
<li>剩余不多数量的情况下,每个打开看看移动是不是四个连着的数据改变,跳跃是不是三个连着的数据改变</li>
</ol>
<p>[找矩阵实例](# 找矩阵)</p>
<h3 id="世界坐标转换为屏幕坐标"><a href="#世界坐标转换为屏幕坐标" class="headerlink" title="世界坐标转换为屏幕坐标"></a><strong>世界坐标转换为屏幕坐标</strong></h3><blockquote>
<p><strong>剪辑坐标</strong>:理解为三维世界的切片</p>
</blockquote>
<p><strong>NDC坐标</strong>(标准化设备坐标)</p>
<p>就是将剪辑坐标的范围缩小至-1到1,如图:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202203211338236.png" alt="img"></p>
<p><strong>世界坐标–&gt;剪辑坐标–&gt;NDC坐标</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//世界坐标转换为剪辑坐标(剪辑坐标和分辨率没有任何关系)</span></span><br><span class="line"><span class="comment">//世界坐标  *     矩阵</span></span><br><span class="line">                a0  a1  a2  a3</span><br><span class="line">x,y,z,w   乘以   a4  a5  a6  a7</span><br><span class="line">                a8  a9  a10 a11</span><br><span class="line">                a12 a13 a14 a15</span><br><span class="line">                  </span><br><span class="line">剪辑坐标x   =   a0*x+a4*y+a8*z+a12*w</span><br><span class="line">剪辑坐标y   =   a1*x+a5*y+a9*z+a13*w</span><br><span class="line">剪辑坐标z   =   a2*x+a6*y+a10*z+a14*w</span><br><span class="line">剪辑坐标w   =   a3*x+a7*y+a11*z+a15*w</span><br><span class="line"><span class="comment">//剪辑坐标w如果小于0表示在屏幕外!!!!!!!!!!!!!!!!!!!!!!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//剪辑坐标转换为NDC坐标</span></span><br><span class="line">NDC.x=剪辑坐标x/剪辑坐标w</span><br><span class="line">NDC.y=剪辑坐标y/剪辑坐标w</span><br><span class="line">NDC.z=剪辑坐标z/剪辑坐标w <span class="comment">//无用                 </span></span><br></pre></td></tr></table></figure>

<p><strong>NDC坐标–&gt;屏幕坐标</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202203211629382.png" alt="捕获"></p>
<p>实际上就是坐标系的转换,NDC坐标系转换成屏幕分辨率坐标系.</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202203211712682.jpeg" alt="截屏2022-03-21 17.12.02"  />
$$
\frac{目标点的NDC坐标X}{2}=\frac{屏幕坐标差x}{显示器分辨率宽}
\\
\\
\frac{目标点的NDC坐标y}{2}=\frac{屏幕坐标差y}{显示器分辨率高}
$$

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//上面两个公式可知:</span></span><br><span class="line">目标点的屏幕坐标差x=目标点的NDC坐标X*显示器分辨率宽/<span class="number">2</span></span><br><span class="line">目标点的屏幕坐标差y=目标点的NDC坐标y*显示器分辨率高/<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>因此<strong>NDC坐标—&gt;屏幕坐标算法</strong>计算如下:<br>$$<br>目标点的屏幕坐标x&#x3D;\frac{目标点的NDC坐标X\times分辨率宽}{2}+\frac{分辨率宽}{2}<br>$$<br>$$<br>目标点的屏幕坐标y&#x3D;\frac{分辨率高}{2}-\frac{目标点的NDC坐标y\times分辨率高}{2}<br>$$</p>
<p>坐标点A和坐标点B均适用,说明四象限全适用.</p>
<h3 id="相关代码截取-1"><a href="#相关代码截取-1" class="headerlink" title="相关代码截取"></a>相关代码截取</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point2D</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">float</span> X, Y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span>  <span class="title">Vector4</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">float</span> x;</span><br><span class="line">	<span class="type">float</span> y;</span><br><span class="line">	<span class="type">float</span> z;</span><br><span class="line">	<span class="type">float</span> w;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Paint</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">	HWND m_hWnd;<span class="comment">//窗口句柄</span></span><br><span class="line">	RECT m_wndRect;<span class="comment">//窗口尺寸信息</span></span><br><span class="line">	<span class="type">int</span> m_resolutionWidth;<span class="comment">//分辨率宽</span></span><br><span class="line">	<span class="type">int</span> m_resolutionHeight;<span class="comment">//分辨率高</span></span><br><span class="line">	RECT m_outsideWnd;<span class="comment">//外窗口尺寸信息</span></span><br><span class="line">	<span class="type">int</span> m_outsideWndWidth;<span class="comment">//外窗口分辨率宽</span></span><br><span class="line">	<span class="type">int</span> m_outsideWndHeight;<span class="comment">//外窗口分辨率高</span></span><br><span class="line">	<span class="type">float</span> m_viewMatrix[<span class="number">16</span>];<span class="comment">//视角矩阵</span></span><br><span class="line">	DWORD m_matrixAddr32;<span class="comment">//32位矩阵地址</span></span><br><span class="line">	DWORD64 m_matrixAddr64;<span class="comment">//64位矩阵地址</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//取窗口信息</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">getWndInfo</span><span class="params">()</span>;</span><br><span class="line">public:</span><br><span class="line">	Paint(HWND hWnd,DWORD matrixAddr=<span class="literal">NULL</span>, COLORREF brushColor=RGB(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>), COLORREF penColor=RGB(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">	<span class="comment">//64位非矩阵绘制未完善</span></span><br><span class="line">	Paint(HWND hWnd, DWORD64 matrixAddr, COLORREF brushColor = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), COLORREF penColor = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	Paint();</span><br><span class="line">	~Paint();</span><br><span class="line">	HDC hdc;<span class="comment">//画板句柄</span></span><br><span class="line">	HBRUSH hBrush;<span class="comment">//画刷句柄</span></span><br><span class="line">	HFONT hfont;<span class="comment">//字体句柄</span></span><br><span class="line">	HPEN hPen;<span class="comment">//画笔</span></span><br><span class="line">	<span class="comment">//HDC hOldDc;//老的画板句柄</span></span><br><span class="line">	<span class="comment">//HBRUSH hOldBrush;//老的画刷句柄</span></span><br><span class="line">	<span class="comment">//HPEN hOldPen;//老的画笔</span></span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标(无矩阵)</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPointWithoutMatrix</span><span class="params">(Point2D&amp; screenPoint,<span class="type">const</span> Orientation&amp; angleDiff)</span>;</span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPoint</span><span class="params">(Point2D&amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span>;</span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标64位</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPoint64</span><span class="params">(Point2D&amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span>;</span><br><span class="line">	<span class="comment">//画线(从屏幕下方中间出发到(x,y))</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line">	<span class="comment">//两点画线</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> xTo, <span class="type">int</span> yTo)</span>;</span><br><span class="line">	<span class="comment">//画框</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintFrame</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, <span class="type">int</span> h, <span class="type">int</span> thick)</span>;</span><br><span class="line">	<span class="comment">//针对头脚坐标画框</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintFrameByFootAndHead</span><span class="params">(Point2D footPoiny,Point2D headPoint,<span class="type">int</span> thick)</span>;</span><br><span class="line">	<span class="comment">//画矩形</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintRect</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> w,<span class="type">int</span> h)</span>;</span><br><span class="line">	<span class="comment">//写字</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintText</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,COLORREF color,<span class="type">const</span> <span class="type">char</span>* text)</span>;</span><br><span class="line">	<span class="comment">//绘制</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">beginPaint</span><span class="params">()</span>;</span><br><span class="line">	<span class="comment">//更换画刷</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">changeBrush</span><span class="params">(COLORREF brushColor)</span>;</span><br><span class="line">	<span class="comment">//更换画笔</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">changePen</span><span class="params">(<span class="type">int</span> penStyle,<span class="type">int</span> penWidth,COLORREF penColor)</span>;</span><br><span class="line">	<span class="type">bool</span> 世界坐标转屏幕坐标_非矩阵(Point2D&amp; 屏幕坐标, FLOAT  水平角度差, FLOAT 高低角度差);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::getWndInfo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//获得窗口信息</span></span><br><span class="line">	GetClientRect(m_hWnd,&amp;m_wndRect);</span><br><span class="line">	m_resolutionWidth = m_wndRect.right - m_wndRect.left;</span><br><span class="line">	m_resolutionHeight = m_wndRect.bottom - m_wndRect.top;</span><br><span class="line">	GetWindowRect(m_hWnd, &amp;m_outsideWnd);  <span class="comment">//含有边框及全屏幕坐标</span></span><br><span class="line">	m_outsideWndWidth = m_outsideWnd.right - m_outsideWnd.left;</span><br><span class="line">	m_outsideWndHeight = m_outsideWnd.bottom - m_outsideWnd.top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector4 <span class="title function_">RowVecTimesMatrix</span><span class="params">(<span class="type">const</span> Vector4&amp; rowVec, <span class="type">float</span> matrix[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	Vector4 retVec;</span><br><span class="line">	retVec.x = rowVec.x*matrix[<span class="number">0</span>] + rowVec.y*matrix[<span class="number">4</span>] + rowVec.z*matrix[<span class="number">8</span>] + rowVec.w*matrix[<span class="number">12</span>];</span><br><span class="line">	retVec.y = rowVec.x*matrix[<span class="number">1</span>] + rowVec.y*matrix[<span class="number">5</span>] + rowVec.z*matrix[<span class="number">9</span>] + rowVec.w*matrix[<span class="number">13</span>];</span><br><span class="line">	retVec.z = rowVec.x*matrix[<span class="number">2</span>] + rowVec.y*matrix[<span class="number">6</span>] + rowVec.z*matrix[<span class="number">10</span>] + rowVec.w*matrix[<span class="number">14</span>];</span><br><span class="line">	retVec.w = rowVec.x*matrix[<span class="number">3</span>] + rowVec.y*matrix[<span class="number">7</span>] + rowVec.z*matrix[<span class="number">11</span>] + rowVec.w*matrix[<span class="number">15</span>];</span><br><span class="line">	<span class="keyword">return</span> retVec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//世界坐标转屏幕坐标32位</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">Paint::worldPointToScreenPoint</span><span class="params">(Point2D &amp; screenPoint,<span class="type">const</span> Point3D&amp; targetWorldPoint)</span></span><br><span class="line">&#123;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	<span class="comment">//刷新矩阵</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;m_viewMatrix, (PVOID)m_matrixAddr32, <span class="keyword">sizeof</span>(m_viewMatrix));</span><br><span class="line">	Vector4 worldLocation = &#123; targetWorldPoint.X,targetWorldPoint.Y,targetWorldPoint.Z,<span class="number">1</span>&#125;;<span class="comment">//世界坐标</span></span><br><span class="line">	<span class="comment">//世界坐标配合矩阵算出裁剪坐标(目前只考虑了列主序,还需要考虑行主序的情况)</span></span><br><span class="line">	Vector4 cutLocation= RowVecTimesMatrix(worldLocation, m_viewMatrix);</span><br><span class="line">	<span class="keyword">if</span> (cutLocation.w&lt;<span class="number">0.0</span>)<span class="comment">//剪辑坐标w如果小于0,表示在屏幕外</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Point2D NDC;<span class="comment">//ndc坐标</span></span><br><span class="line">	NDC.X = cutLocation.x / cutLocation.w;</span><br><span class="line">	NDC.Y = cutLocation.y / cutLocation.w;</span><br><span class="line">	screenPoint.X = (NDC.X*m_resolutionWidth + m_resolutionWidth) / <span class="number">2</span>;</span><br><span class="line">	screenPoint.Y = (m_resolutionHeight - m_resolutionHeight*NDC.Y) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//世界坐标转屏幕坐标64位</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">Paint::worldPointToScreenPoint64</span><span class="params">(Point2D &amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span></span><br><span class="line">&#123;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	<span class="comment">//刷新矩阵</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;m_viewMatrix, (DWORD64*)m_matrixAddr64, <span class="keyword">sizeof</span>(m_viewMatrix));</span><br><span class="line">	Vector4 worldLocation = &#123; targetWorldPoint.X,targetWorldPoint.Y,targetWorldPoint.Z,<span class="number">1</span> &#125;;<span class="comment">//世界坐标</span></span><br><span class="line">																						   <span class="comment">//世界坐标配合矩阵算出裁剪坐标(目前只考虑了列主序,还需要考虑行主序的情况)</span></span><br><span class="line">	Vector4 cutLocation = RowVecTimesMatrix(worldLocation, m_viewMatrix);</span><br><span class="line">	<span class="keyword">if</span> (cutLocation.w &lt; <span class="number">0.0f</span>)<span class="comment">//剪辑坐标w如果小于0,表示在屏幕外</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Point2D NDC;<span class="comment">//ndc坐标</span></span><br><span class="line">	NDC.X = cutLocation.x / cutLocation.w;</span><br><span class="line">	NDC.Y = cutLocation.y / cutLocation.w;</span><br><span class="line">	screenPoint.X = (NDC.X*m_resolutionWidth + m_resolutionWidth) / <span class="number">2</span>;</span><br><span class="line">	screenPoint.Y = (m_resolutionHeight - m_resolutionHeight*NDC.Y) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="朝向（准星）"><a href="#朝向（准星）" class="headerlink" title="朝向（准星）"></a>朝向（准星）</h2><p>准星数据寻找</p>
<p>在fps游戏中，横轴是可以无限原地转圈的，而竖轴上下大概在180度左右，所以Y往往比X更合适用来当作这一数据的突破口。那么假设准星数据做了处理，应该如何找到瞄准call呢？搜索出与准星坐标相关的地址后，移动鼠标进行访问断，就有可能断到相关的函数。</p>
<p>朝向极大概率是浮点数。</p>
<p>需要找到x,y轴坐标对应的朝向。</p>
<h1 id="矩阵补充"><a href="#矩阵补充" class="headerlink" title="矩阵补充"></a>矩阵补充</h1><p>通常情况下Dx9中会采用4*4的矩阵</p>
<p>这里说的横矩阵是列主序,列矩阵是行主序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/image-20210514115116708.png" alt="image-20210514115116708"></p>
<p> &#x2F;&#x2F;荒野行动横矩阵第3排，第4列的数，光标朝天看的时候是1，朝地下是-1。（此结论通用性待验证）</p>
<p>补充一个3*4列矩阵</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X X X x</span><br><span class="line">X X X y</span><br><span class="line">X X X z</span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> 比例</span><br><span class="line"><span class="number">3</span>*<span class="number">4</span>（列矩阵）</span><br></pre></td></tr></table></figure>

<p>UE4矩阵</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">UE4最常见的两种矩阵</span><br><span class="line">//第一种横矩阵格式（上+下-）（这就是上图中荒野行动那种）</span><br><span class="line">xxx xxx 0 xxxx</span><br><span class="line">xxx xxx 0 xxxx</span><br><span class="line">xxx xxx 0 xxxx</span><br><span class="line"> X   Y 比例 Z</span><br><span class="line">//第二种横矩阵格式(上-下+)</span><br><span class="line">xxx xxx xxxx 0</span><br><span class="line">xxx xxx xxxx 0</span><br><span class="line">xxx xxx xxxx 0</span><br><span class="line"> X   Y   Z  比例</span><br><span class="line"> //特征：除了XYZ，其他所有数值在（-2，+2）间</span><br></pre></td></tr></table></figure>

<p>普通食物4*4横矩阵和竖矩阵的矩阵头在这个区间（-2，+2）</p>
<p>针对自动瞄准，应该如何检测：</p>
<p>1、模拟类自瞄</p>
<p>一、Hook windows所提供的所有按键操作、鼠标操作类接口，函数全部由游戏安全系统接管。</p>
<p>二、既然Hook了相关函数，那么就可以被突破，Hook被还原，还要在代码段上下crc，防止被还原Hook，在crc上多次套crc，多设防御关卡。</p>
<p>三、检测鼠标轨迹和移动速度，没有谁可以一直直线移动鼠标。</p>
<p>2、内存类自瞄</p>
<p>一、Hook windows所提供的所有“写内存”类接口，如WriteProcessMemory（），函数全部由游戏安全系统接管，检测到非自身或者未知程序调用该类型函数对游戏进行操作时，将其踢下线。</p>
<p>二、同模拟类自瞄第二条。</p>
<p>三、同模拟类自瞄第三条。</p>
<p>四、加密鼠标横轴（x坐标），且多个地址同步准星数据，当非法修改了准星位置，即准星数据不同步，即可知道非法修改了内存。</p>
<p>​    那么接下来，同笔者一起分析，透视自瞄究竟是如何实现的呢？</p>
<p>​    其实只要实现了自瞄，就相当于实现了透视，只是需要开发者通过一系列算法将其绘制在屏幕上而已。而实现自瞄，对于有相关工作经验的人来说，也算不上难，一套公式，几乎“通杀”所有FPS。自瞄算法可以简单的分为两种，一种通过玩家坐标和准星位置进行计算，一种为”矩阵自瞄“，计算模型骨骼等等，其实两种自瞄本质意义上区别不大，各有各的好处，只不过第二种更为精准，第一种则更为方便，需要的数据更少。</p>
<p>自己封装内存模块用到的api</p>
<ol>
<li>打开进程&#x3D;&#x3D;&#x3D;OpenProcess</li>
<li>打开当前进程&#x3D;&#x3D;&#x3D;OpenProcess</li>
<li>写内存&#x3D;&#x3D;&#x3D;WriteProcessMemory</li>
<li>关闭句柄&#x3D;&#x3D;&#x3D;CloseHandle</li>
<li>读取内存整数&#x3D;&#x3D;&#x3D;ReadProcessMemory</li>
<li>保护内存&#x3D;&#x3D;&#x3D;VirtualQueryEx</li>
<li>读内存字节集&#x3D;&#x3D;&#x3D;ReadProcessMemory</li>
<li>提示自身进程权限&#x3D;&#x3D;&#x3D;RtlAdjustPrivilege</li>
<li>获取当前进程id&#x3D;&#x3D;&#x3D;GetCurrentProcessId</li>
<li>取一个窗口的标题&#x3D;&#x3D;&#x3D;GetWindowTextA</li>
<li>寻找窗口句柄&#x3D;&#x3D;&#x3D;FindWindowExA</li>
<li>获取窗口客户区&#x3D;&#x3D;&#x3D;GetClientRect</li>
<li>获取窗口类名&#x3D;&#x3D;&#x3D;GetClassNameA</li>
<li>终止进程&#x3D;&#x3D;&#x3D;TerminateProcess</li>
<li>获取快照信息&#x3D;&#x3D;&#x3D;CreateToolhelp32Snapshot</li>
<li>获取遍历快照的第一个进程&#x3D;&#x3D;&#x3D;Process32First</li>
<li>获取遍历快照的下一个进程&#x3D;&#x3D;&#x3D;Process32Next</li>
<li>获取遍历快照的第一个模块&#x3D;&#x3D;&#x3D;MODULE32First</li>
<li>获取遍历快照的下一个模块&#x3D;&#x3D;&#x3D;MODULE32Next</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">UE4</span></span><br><span class="line"><span class="title class_">Count</span>(环境数量)→  -游戏类型  → 数组<span class="title class_">Actor</span></span><br><span class="line">↓                               ↓</span><br><span class="line"><span class="title class_">Uworld</span>（世界地址）            人物坐标<span class="variable constant_">XYZ</span>  血量 阵容  飞天</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X</span><br><span class="line">Y</span><br><span class="line">Z地址&quot;UE4Game-Win64-Shipping.exe&quot;+02CC5F50]+588]+158]+1D8</span><br><span class="line"></span><br><span class="line">[[[[[7FF714B28BF0+88+rcx*3*8+8]+10]+50]+270]+158]+1D0==233F0434FE0</span><br></pre></td></tr></table></figure>



<h1 id="CE找数据技巧"><a href="#CE找数据技巧" class="headerlink" title="CE找数据技巧"></a>CE找数据技巧</h1><p>找数据技巧：排除栈地址，排除ui上显示的数据信息，排除追踪到服务器模块的情况（如果本机有服务器的话）</p>
<p>大量30~80的字符表示的是ascii字符串，4或C开头的4字节大概率是浮点数</p>
<p>对于服务器和客户端模块都在本地的游戏,使用一些确定是服务器数据的数据来找来源,来源于的模块大概率就是服务器模块</p>
<p><strong>追任何偏移,如果CE能直接搜索到对应基地址,则可直接使用基地址</strong></p>
<p>可以通过call内的ret来判断这个call有几个参数,而不仅仅是通过找call前的push数量</p>
<h2 id="dbg配合ce找下属偏移的高级技巧"><a href="#dbg配合ce找下属偏移的高级技巧" class="headerlink" title="dbg配合ce找下属偏移的高级技巧"></a>dbg配合ce找下属偏移的高级技巧</h2><p><strong>角色对象附近地址的属性都可以直接尝试定位,甚至可以到CE搜所有相同结果,找所有结果中最靠近对象地址附近的结果,然后通过 <code>所有结果中最靠近对象地址-对象首地址</code>来得到猜测的偏移.这时候直接在最靠近对象的地址下访问断,看能不能断到偏移就是猜测偏移的地址</strong>   <a href="#%E9%AA%A8%E9%AA%BC%E6%95%B0%E6%8D%AE">该技巧使用实例</a></p>
<p>针对单机游戏如下:</p>
<p>无限子弹通过对子弹数下写入断就可以断到,断到的位置往上翻找子弹数减少1,修改此处可以无限子弹.往上追上层call一定会追到射击call,射击call附近应该有射速相关的参数,可能是射击间隔作为参数,也可能是别的;(老游戏每个枪可能都有一个射击call,但是往上追会追到一个通用的射击call).每个call进行屏蔽,来确定哪个是负责后坐力的,简单粗暴把负责后坐力的nop掉,将call改成<code>add esp,参数字节数</code>,就实现了没有后坐力.找无敌可以到血量下写入断点,断到的位置的call很可能就是扣血call,nop掉就不扣血了.放雷的call中,nop掉[所有可能跳过将雷的数量减一放入某地址的操作],就实现了疯狂丢雷无间隔.</p>
<hr>
<p>逆向注意点:下图这样的lea一个堆栈地址的情况,要这么处理</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204171641184.jpeg" alt="逆向注意点"></p>
<h1 id="CS1-6的逆向"><a href="#CS1-6的逆向" class="headerlink" title="CS1.6的逆向"></a>CS1.6的逆向</h1><h2 id="找内存数据"><a href="#找内存数据" class="headerlink" title="找内存数据"></a>找内存数据</h2><p>通过客户端或服务端来搜数据排查服务端的模块是哪一个</p>
<p>找血量数据如下:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202202161531874.png" alt="00001"></p>
<p>只有蓝标数据真正可以修改目标血量,说明这个数据是服务端数据,到x32dbg中下写入断点来确定服务器模块,击中目标的瞬间断到下图位置</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202202161531371.png" alt="213213123"></p>
<p>观察红线标记的模块,可知服务器模块应该就是mp.dll,可对其他数据进行下断确定不经过该模块.</p>
<p>回头发现,只有鼠标经过指向目标才变回来的是个基地址,第三行数据往上追的过程中经过了mp.dll模块,因此最终确定到第二行数据才是真是数据,而不是第三行.</p>
<p>在x32dbg中追第二行数据:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202202161600416.png" alt="999999999999"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">得出队友血量的地址=[<span class="number">0x1A17CB8</span>]*<span class="number">0x68</span>+<span class="number">0x1A2565C</span></span><br><span class="line"><span class="comment">//可见0x1A17CB8地址存的是2(游戏中鼠标指向不同的人,下标会改变,从0开始),可能是一个下标.敌人存的血量填的是100即0x64,原因是敌人血量不可见,同时也看不到自己的血量(为0)</span></span><br><span class="line">  因此遍历实体血量:n*<span class="number">0x68</span>+<span class="number">0x1A2565C</span></span><br></pre></td></tr></table></figure>

<p>比对数组项之间的差异,结构体大小为0x68(公式分析得出),-0x30的目的是因为我们找到的有可能并不是数组项的起始地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202202161654479.png" alt="987887"></p>
<p>0和5下标是边界外,游戏目前数据只有1~4,1,2,4是队友,3是敌人</p>
<p>打死队友发现其对应的生命不归零,因此需要找死亡标志</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//假如我们设n*0x68+0x1A2565C-0x68为起始数组项地址(-0x68是为了使后面的偏移项都是正数)</span></span><br><span class="line"><span class="comment">//n*0x68+h1.exe+0x62565C-0x68    n下标从1开始(减掉68使得下标本来&quot;从0开始&quot;变成&quot;从1开始&quot;)</span></span><br><span class="line">+<span class="number">0x4E</span> BYTE  	<span class="comment">//阵容,1表示恐怖分子,2表示反恐精英,0是观察者</span></span><br><span class="line">+<span class="number">0x60</span>	BYTE		<span class="comment">//死亡标记:1表示死亡,0表示活着,超出范围的此项也为1</span></span><br><span class="line">+<span class="number">0x68</span> DWORD  	<span class="comment">//血量,死亡不清零,敌人和自己的血量均没有意义</span></span><br></pre></td></tr></table></figure>

<p>我们还要找坐标的数据结构:</p>
<p>通过反复让敌人行动找到了坐标,锁定才能触发屏闪的位置,不锁定什么反应都没有的情况,下硬件写入断点直接崩溃.</p>
<p>发现必须找到是不锁定的情况下修改坐标人物抖动以下,这个才是真正要找的目标坐标.发现他是一个基地址:h1.exe+1B5A998</p>
<p>并且在其附近发现了目标的名称</p>
<p>下硬件访问断点开始追该地址</p>
<p>断在的两个位置(分别是下图两次标黄)往上追都不好追,追丢了.但可以猜测出最末一层的结构体偏移为0x188</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202202162322962.png" alt="54646546"></p>
<p>尝试不直接断坐标数据,而是断前后几个数据之一,断到的位置往上追一层偏移,放开断点后发现上一层偏移的地址中存的值变成了0,即这个地址是个临时的地址,也不能用</p>
<p>尝试在名字下访问断,断下的位置发现有一个基地址偏移,因此大概率是可以追到数据结构的.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202202162313907.png" alt="747474"></p>
<p>上图可知:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//遍历名字算式为:0x2F5A6C8+0x24C*N</span></span><br><span class="line"><span class="comment">//N的范围为0~31,指向为0表示遍历结束</span></span><br></pre></td></tr></table></figure>

<p>确定结构体首地址:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/202202162327528.png" alt="786474345"></p>
<p>上图可知坐标比名字大0x84,前面有知道名字的末层偏移是0x188</p>
<p>因此名字的末层偏移为0x104</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//因此结构体数组首地址为0x2F5A6C8-0x104=0x2F5A5C4</span></span><br><span class="line"><span class="comment">//所以结构体数组首地址算式为h1.exe+0x1B5A5C4+0x24C*N</span></span><br><span class="line"><span class="comment">//超出人物数量的结构体数组项全为0,加入的人物再把人物删除掉后并不会初始化该数组,但是名称最前面的一个字节会变成00</span></span><br><span class="line">+<span class="number">0x0</span>  	DWORD		<span class="comment">//等于0结束遍历(中间可能出现空坐标,但该项也一定不为空)&gt;&gt;&gt;注意遍历要跳过自己,因为自己该项也是0	</span></span><br><span class="line">+<span class="number">0x104</span>	ASCII		<span class="comment">//名称		名字为空的话,代表这个结构没有玩家,或玩家已死亡</span></span><br><span class="line">+<span class="number">0x130</span>  ASCII   <span class="comment">//人物模型字符串    比如:guerilla,leet等等等等</span></span><br><span class="line">+<span class="number">0x180</span>  FLOAT   <span class="comment">//该数值不断循环从0加到60,仅当处于本人范围内才变化,范围外不变化		可用于判断对应玩家是否处在本人坐标数据获取范围内</span></span><br><span class="line">+<span class="number">0x188</span>  FLOAT		X坐标   <span class="comment">//坐标超出范围不变化,变化说明在范围内;自己的坐标不变化</span></span><br><span class="line">+<span class="number">0x18C</span>	FLOAT		Y坐标</span><br><span class="line">+<span class="number">0x190</span>	FLOAT		Z坐标		<span class="comment">//坐标为0表示该项不存在,观察发现数组不一定是顺序存放</span></span><br></pre></td></tr></table></figure>

<p>由于上面结构并没有本人坐标,因此下面逆向本人坐标</p>
<p><strong>找本人坐标的时候,其特点是锁定数值后,修改数值,人物产生位移,解除锁定后,动下人物,人物瞬移回来</strong></p>
<p>另外一种情况是锁定后,修改,不断的人物屏闪,这种内存也能用,但是最好不要下断,太快了,容易崩溃</p>
<p><strong>要注意移动到一个位置后要等他完全静止才搜变动,因为有些内存更改比较慢(上面非屏闪情况就是这种)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//本人坐标:(屏闪,非常快)</span></span><br><span class="line">h1.exe+<span class="number">1B</span>5A528	FLOAT	X坐标</span><br><span class="line">h1.exe+<span class="number">1B</span>5A52C	FLOAT	Y坐标</span><br><span class="line">h1.exe+<span class="number">1B</span>5A530	FLOAT	Z坐标</span><br><span class="line"><span class="comment">//不屏闪但慢慢会跳转(3个不同的X坐标)</span></span><br><span class="line">h1.exe+<span class="number">19E3</span>F28</span><br><span class="line">h1.exe+<span class="number">19f</span>0750</span><br><span class="line">h1.exe+<span class="number">19F</span>4A08</span><br><span class="line"><span class="comment">//完全不跳转,也不屏闪,锁定修改后完全没反应(最快)</span></span><br><span class="line">h1.exe+<span class="number">195F</span>E58</span><br><span class="line"><span class="comment">//意外发现朝向数据(但是只可以显示朝向数据,却无法改变准星朝向,本地必然还有一个内存存着真正可以控制准星的数据)</span></span><br><span class="line">h1.exe+<span class="number">1B</span>5A508	FLOAT	垂直朝向		<span class="comment">//范围是-89(向上为负)到89(向下为正)</span></span><br><span class="line">h1.exe+<span class="number">1B</span>5A50C	FLOAT	水平朝向		<span class="comment">//范围是360到0(左到右)</span></span><br></pre></td></tr></table></figure>

<p>在x32dbg中简单观察了一下,初步确认不是来自于mp.dll的服务器数据</p>
<p>利用上面找到的朝向数值来找真正的准星内存:(可以修改准星位置的内存数据)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h1.exe+<span class="number">19E10</span>C4	FLOAT	垂直朝向		<span class="comment">//范围是-89(向上为负)到89(向下为正)</span></span><br><span class="line">h1.exe+<span class="number">19E10</span>C8	FLOAT	水平朝向		<span class="comment">//范围是360到0(左到右)</span></span><br><span class="line"><span class="comment">//0的方向是坐标x增大方向,180是坐标x减小的方向</span></span><br><span class="line"><span class="comment">//90的方向是坐标y增大方向,270是坐标y减小的方向</span></span><br></pre></td></tr></table></figure>

<h2 id="找矩阵"><a href="#找矩阵" class="headerlink" title="找矩阵"></a>找矩阵</h2><p>[找矩阵方法总结](# 找矩阵总结)</p>
<p>按照上述方法找到的矩阵地址为: <code>0x2c20100</code>  &#x3D;  <code>hl.exe+1820100</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202203281715489.png" alt="image-20220328171548251"></p>
<h1 id="口袋西游逆向"><a href="#口袋西游逆向" class="headerlink" title="口袋西游逆向"></a>口袋西游逆向</h1><p>口袋西游逆向参见详见51和53课</p>
<p>骨骼和模型不一定有绝对坐标,但是一般都有相对坐标</p>
<h2 id="基本数据"><a href="#基本数据" class="headerlink" title="基本数据"></a>基本数据</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//人物数据</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">3</span>C    <span class="comment">//X</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">40</span>    <span class="comment">//Y</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">44</span>    <span class="comment">//Z</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">560</span>   <span class="comment">//X中心点</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">564</span>   <span class="comment">//Y中心点</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">568</span>   <span class="comment">//Z中心点</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">56</span>C   <span class="comment">//X中心点到对顶点的X差</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">570</span>   <span class="comment">//Y中心点到对顶点的Y差</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">574</span>   <span class="comment">//Z中心点到对顶点的Z差</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">578</span>   <span class="comment">//立方体下顶点X坐标(斜对角)</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">57</span>C   <span class="comment">//立方体下顶点Y坐标(斜对角)</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">580</span>   <span class="comment">//立方体下顶点Z坐标(斜对角)</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">584</span>   <span class="comment">//立方体上顶点X坐标(斜对角)</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">588</span>   <span class="comment">//立方体上顶点Y坐标(斜对角)</span></span><br><span class="line">[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">28</span>]+<span class="number">58</span>C   <span class="comment">//立方体上顶点Z坐标(斜对角)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//周围遍历    N为[0,对象数量)</span></span><br><span class="line">[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">5</span>C   <span class="comment">//对象数量</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">3</span>C   <span class="comment">//周围对象X</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">40</span>   <span class="comment">//周围对象Y</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">44</span>   <span class="comment">//周围对象Z</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+ED   <span class="comment">//死亡标志位,1为死亡(BYTE)</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">138</span>  <span class="comment">//周围对象血量(未被攻击过是0)</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>C4  <span class="comment">//X中心点</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>C8  <span class="comment">//Y中心点</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>CC  <span class="comment">//Z中心点</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>D0  <span class="comment">//X中心点到对顶点的X差</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>D4  <span class="comment">//Y中心点到对顶点的Y差</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>D8  <span class="comment">//Z中心点到对顶点的Z差</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>DC  <span class="comment">//立方体下顶点X坐标(斜对角)</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2E0</span>  <span class="comment">//立方体下顶点Y坐标(斜对角)</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2E4</span>  <span class="comment">//立方体下顶点Z坐标(斜对角)</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2E8</span>  <span class="comment">//立方体上顶点X坐标(斜对角)</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2</span>EC  <span class="comment">//立方体上顶点Y坐标(斜对角)</span></span><br><span class="line">[[[[[[[D0DF1C]+<span class="number">1</span>C]+<span class="number">8</span>]+<span class="number">20</span>]+<span class="number">58</span>]+N*<span class="number">4</span>]+<span class="number">4</span>]+<span class="number">2F</span>0  <span class="comment">//立方体上顶点Z坐标(斜对角)</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202203301720046.png" alt="image-20220330172058752"></p>
<h2 id="找矩阵-1"><a href="#找矩阵-1" class="headerlink" title="找矩阵"></a>找矩阵</h2><p>[找矩阵方法总结](# 找矩阵总结)</p>
<p>矩阵头地址为:  <code>[[[ELEMENTCLIENT.EXE+0x90DF1C]+14]+8]+E8</code></p>
<p><code>[ELEMENTCLIENT.EXE+92E5D0]+E8</code>  也可以</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202203281641926.png" alt="image-20220328164120672"></p>
<h1 id="突袭的逆向"><a href="#突袭的逆向" class="headerlink" title="突袭的逆向"></a>突袭的逆向</h1><h2 id="基本数据-1"><a href="#基本数据-1" class="headerlink" title="基本数据"></a>基本数据</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//目标血2  [[[587c10]+n*4]+0xEC]  n为[0,[587C18]-1]</span></span><br><span class="line"><span class="comment">//人物数据</span></span><br><span class="line">[<span class="number">587</span>C0C]+<span class="number">28</span>   <span class="comment">//X</span></span><br><span class="line">[<span class="number">587</span>C0C]+<span class="number">2</span>C   <span class="comment">//Y</span></span><br><span class="line">[<span class="number">587</span>C0C]+<span class="number">30</span>   <span class="comment">//Z</span></span><br><span class="line">[<span class="number">587</span>C0C]+<span class="number">34</span>   <span class="comment">//水平朝向顺时针递增360</span></span><br><span class="line">[<span class="number">587</span>C0C]+<span class="number">38</span>   <span class="comment">//竖直朝向-90到90,从下到上</span></span><br><span class="line">[<span class="number">587</span>C0C]+EC   <span class="comment">//角色血量(血量小于等于0为死亡)</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//周围遍历    N为[1,玩家数量)</span></span><br><span class="line"><span class="number">587</span>C18  <span class="comment">//玩家数量</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">4</span>    <span class="comment">//头X</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">8</span>    <span class="comment">//头Y</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+C    <span class="comment">//头Z</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">28</span>   <span class="comment">//X</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">2</span>C   <span class="comment">//Y</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">30</span>   <span class="comment">//Z</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">34</span>   <span class="comment">//水平朝向顺时针递增360</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">38</span>   <span class="comment">//竖直朝向-90到90,从下到上</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+<span class="number">50</span>   <span class="comment">//身高</span></span><br><span class="line">[[<span class="number">587</span>C10]+n*<span class="number">4</span>]+EC   <span class="comment">//角色血量(血量小于等于0为死亡)</span></span><br><span class="line"><span class="comment">//未分析阵营</span></span><br></pre></td></tr></table></figure>

<h2 id="找矩阵-2"><a href="#找矩阵-2" class="headerlink" title="找矩阵"></a>找矩阵</h2><p>[找矩阵方法总结](# 找矩阵总结)</p>
<p>矩阵头地址: <code>ac_client.exe+17AFE0</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202203281721643.png" alt="image-20220328172108435"></p>
<h1 id="UE4逆向"><a href="#UE4逆向" class="headerlink" title="UE4逆向"></a>UE4逆向</h1><h2 id="UE4引擎特点"><a href="#UE4引擎特点" class="headerlink" title="UE4引擎特点"></a>UE4引擎特点</h2><ul>
<li>增加新对象时,即更换物品时(物品从不可见无中生有)内存几乎一直在增加</li>
<li>世界中所有万物都在数组结构中,存在数组数量(物品从不可见无中生有的情况,数量会增加,游戏只要不退出而是当前地图重新开始,数量也会增加;只有游戏退出或更换地图重新开始,数量才会重置,同时存数组数量的地址也会发生变化)</li>
<li>子弹未命中的情况下不会增加实体,子弹只有命中的情况下才会增加实体</li>
</ul>
<p>数组数量:几乎没有减少的可能,基本上一直在增加</p>
<p><strong>UE4的坐标特点:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//坐标的内存数据符合以下规律</span></span><br><span class="line">x  y  z  <span class="number">0</span></span><br><span class="line"><span class="number">1</span>  <span class="number">1</span>  <span class="number">1</span>  <span class="number">0</span></span><br><span class="line"><span class="comment">//这个特点不绝对</span></span><br></pre></td></tr></table></figure>

<p>在CE结构对比工具中,因为z后的0和x下的1被合并误识别为double类型,因此是如图:</p>
<p>在内存中:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202203311945720.png" alt="image-20220331194527584"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UE4的矩阵的前面不远处都符合(不绝对):</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span> <span class="number">0</span>(全为浮点数)</span><br><span class="line"></span><br><span class="line"><span class="comment">//1的浮点数在内存中为:0x3F800000</span></span><br><span class="line"><span class="comment">//UE4矩阵在内存中的特征码:(不绝对)</span></span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">80</span> <span class="number">3F</span> <span class="number">00</span> <span class="number">00</span> <span class="number">80</span> <span class="number">3F</span> <span class="number">00</span> <span class="number">00</span> <span class="number">80</span> <span class="number">3F</span> <span class="number">00</span> <span class="number">00</span> <span class="number">80</span> <span class="number">3F</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">80</span> <span class="number">3F</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">80</span> <span class="number">3F</span> <span class="number">00</span> <span class="number">00</span> <span class="number">80</span> <span class="number">3F</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br></pre></td></tr></table></figure>

<p>UE4矩阵:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202203311927800.png" alt="image-20220331192721545"></p>
<ul>
<li>上图中红框第三列0,0,0,x永远不变.(不绝对)</li>
<li>四处走动时,最后一行除了1其他3个都变(沿着x,y走两个值改变);跳跃时,最后一行除了1和第一个,其他两个变(不绝对)</li>
<li>第一个值-1.19到+1.19(不绝对)</li>
<li>矩阵下方那排都是0,0,0,1?</li>
</ul>
<p>参考pubg矩阵:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204021406705.png" alt="image-20220402140648459"></p>
<h2 id="Battle-Royale-Trainer逆向"><a href="#Battle-Royale-Trainer逆向" class="headerlink" title="Battle Royale Trainer逆向"></a>Battle Royale Trainer逆向</h2><p>吃鸡模拟器</p>
<h3 id="基本数据-2"><a href="#基本数据-2" class="headerlink" title="基本数据"></a>基本数据</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204051307338.jpeg" alt="笔记图"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//COUNT 世界数组的项数量(该数组中还包含所有的报废对象,要找个标志加以区分,如果要找到玩家们,还需要玩家标志)</span></span><br><span class="line">[[<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>+<span class="number">2</span>AF0FB8]+<span class="number">138</span>]+<span class="number">0xB8</span><span class="comment">//CE取巧</span></span><br><span class="line"><span class="comment">//x64dbg追到头为:</span></span><br><span class="line">[[[[[<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>+<span class="number">2</span>AD9F30]+[([<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>+<span class="number">2B</span>00648]+<span class="number">40</span>)]的低<span class="number">4</span>字节*<span class="number">3</span>*<span class="number">8</span>]+<span class="number">20</span>]+c0]+<span class="number">138</span>]+<span class="number">0xB8</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//COUNT地址-8就是:数组起始地址的地址:</span></span><br><span class="line">[[<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>+<span class="number">2</span>AF0FB8]+<span class="number">138</span>]+<span class="number">0xB0</span></span><br><span class="line"><span class="comment">//检查发现,本人对象首地址也在该世界数组中</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//世界中对象首地址:(N为[0,COUNT-1])</span></span><br><span class="line">[[[<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>+<span class="number">2</span>AF0FB8]+<span class="number">138</span>]+<span class="number">0xB0</span>]+N*<span class="number">8</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//坐标地址:</span></span><br><span class="line">[对象首地址+<span class="number">158</span>]+<span class="number">190</span>   X</span><br><span class="line">[对象首地址+<span class="number">158</span>]+<span class="number">194</span>   Y</span><br><span class="line">[对象首地址+<span class="number">158</span>]+<span class="number">198</span>   Z</span><br><span class="line">[[世界对象数组地址+n*<span class="number">8</span>]+<span class="number">158</span>]+<span class="number">190</span>     X</span><br><span class="line">[[世界对象数组地址+n*<span class="number">8</span>]+<span class="number">158</span>]+<span class="number">194</span>     Y</span><br><span class="line">[[世界对象数组地址+n*<span class="number">8</span>]+<span class="number">158</span>]+<span class="number">198</span>     Z</span><br><span class="line"><span class="comment">//宏观解读:</span></span><br><span class="line">  [世界对象地址+n*<span class="number">8</span>]得到的是对象结构首地址,再+<span class="number">158</span>]进入一个存放了坐标信息的结构首地址.再+<span class="number">190</span>]取到坐标x或y值</span><br><span class="line">  </span><br><span class="line"><span class="comment">//因为世界数组项非常杂乱,什么都有,因此需要找人物标志和作废对象标志</span></span><br><span class="line"><span class="comment">//找人物标志.找人物标志首先要知道人物对象首地址,可以是自己的,也可以是敌人;通过自己的数据向上追几层看看有没有多个对象存在(可以通过宏观解读去找可以断到人物的位置)</span></span><br><span class="line"><span class="comment">//通过自己的数据判断是否有访问断点往上追两层可以追到断下几个对象地址的情况(如下图),但由于该游戏x64dbg访问硬断会崩溃,因此采取CE进行访问代码扫描,在到x64dbg中依次分析,以此找到人物对象;再将人物对象和其他对象在CE中做对比分析.</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204041829938.png" alt="image-20220404182919564"></p>
<p>此位置可以断到多个人物对象,通过查看对应坐标可确定是人物对象地址.通过上图黄标处多次断下的rcx可以得到所有人物对象地址.</p>
<h4 id="找人物特征"><a href="#找人物特征" class="headerlink" title="找人物特征"></a>找人物特征</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204041754643.jpeg" alt="笔记图"></p>
<p>用ce比对工具如上图(前一组两列是两个人物,后一组是其他对象),黄标处那两个很可能是人物特征</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果:</span></span><br><span class="line">	[对象首地址+<span class="number">0</span>]==  BattleRoyaleTrainer-Win64-Shipping.exe + <span class="number">0x1D45740</span><span class="comment">//虚表,这个条件更稳定更靠谱</span></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">	[对象首地址+<span class="number">0xB9</span>]==<span class="number">0x200</span>(即十进制<span class="number">512</span>)<span class="comment">//等等还有很多条件也可以,不止一种标志,比如0x50偏移等等</span></span><br><span class="line"><span class="comment">//则:</span></span><br><span class="line">	可判断是人物</span><br></pre></td></tr></table></figure>

<p><strong>[ 重点 ]</strong>  <strong>对象首地址+0的位置,代表的指针往往是指向虚表的(在非虚继承的情况下，虚函数表指针是存在于类的顶部的).其一样代表表示对象具有同样的成员函数(即对象具有同样的行为模板),因此[对象首地址+0]是最好用于判断是否同类对象的偏移.</strong></p>
<h4 id="排除做废对象"><a href="#排除做废对象" class="headerlink" title="排除做废对象"></a>排除做废对象</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204051047668.jpeg" alt="笔记图"></p>
<p>类似+0和+18和+35这样的位置都可以判断</p>
<p>我们发现做废对象,虚表指针也会改变,因此只需要使用上面人物标志的判断方式就可以避开做废对象.</p>
<h4 id="人物存活判断"><a href="#人物存活判断" class="headerlink" title="人物存活判断"></a>人物存活判断</h4><p>CE搜索找到自身血量的地址,然后通过上面找到的自己对象地址,通过<code>自己血量地址-自己对象首地址</code>得到血量偏移**(角色对象附近地址的属性都可以直接这样尝试定位,甚至可以到CE搜所有相同结果,找所有结果中最靠近对象地址附近的结果,然后通过 <code>所有结果中最靠近对象地址-对象首地址</code>来得到猜测的偏移.这时候直接在最靠近对象的地址下访问断,看能不能断到偏移就是猜测偏移的地址 )**</p>
<p>血量地址为: <code>人物对象首地址+0x7CC</code></p>
<p>人物死亡后,血量会&lt;&#x3D;0</p>
<h4 id="武器相关"><a href="#武器相关" class="headerlink" title="武器相关"></a>武器相关</h4><p><strong>人物对象下存在一些数组结构,即地址+数量的组合.找到一个数组刚好和人物身上的武器数相同的数组结构,当把手榴弹掏出来的时候,数组数量还会加1.</strong></p>
<p>进到数组首地址中,数组形式存储的这几个对象一般是对应1,2,3号键对应的武器.(顺序对应)</p>
<p><strong>到武器对象下</strong>,可找到诸如射击间隔(射速),武器朝向,后坐力等浮点数数据,还有子弹数等.</p>
<p><strong>射速和后坐力</strong>等数据往往是武器<strong>创建后就固定的浮点数</strong></p>
<p><strong>可通过找武器对象下的浮点数(避开地址类型数据,防止崩溃,同时避开会变化的浮点数,因为那很可能是武器朝向)进行清0后游戏中尝试射击后还原,来找到后坐力,射速数据的位置.</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//射速</span></span><br><span class="line">武器对象+<span class="number">39</span>C  浮点数   射速(射击的间隔)   炸弹没有该参数,炸弹应该和枪结构不一致</span><br><span class="line"><span class="comment">//后坐力</span></span><br><span class="line">武器对象+<span class="number">680</span>  浮点数   初始上下抖动幅度</span><br><span class="line">武器对象+<span class="number">684</span>  浮点数   后续上下抖动幅度</span><br><span class="line">武器对象+<span class="number">6</span>A4  浮点数   左右抖动幅度</span><br></pre></td></tr></table></figure>

<h4 id="骨骼数据"><a href="#骨骼数据" class="headerlink" title="骨骼数据"></a>骨骼数据</h4><p>骨骼数据一般存有相对于人物参考点坐标的偏移坐标(人物参考点坐标可能有别于人物位置坐标)</p>
<p>通过身体上坐标变化比较多的身体部位来找骨骼数据</p>
<p>骨骼数据同样在人物对象下</p>
<p>骨骼数据往往是即使人站着的位置不动,骨骼数据也会轻微晃动(人物在微微晃动)</p>
<p>骨骼坐标数据如下:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204061736996.jpeg" alt="捕获"></p>
<p>黄标的是骨骼相对人物参考点坐标的偏移坐标;黄标上一行应该是骨骼的朝向信息,上图也可以看出这个骨骼的结构是个数组,每个re数组项占0x30字节.因此外围还存在数组地址和数组数量</p>
<p><strong>[找的过程]</strong>    找到相对骨骼坐标地址后访问断往上追,追到下面地址处:</p>
<p>00007FF7A1EB25D9地址截图:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204091405305.JPG" alt="捕获"></p>
<p>追到此处继续往上追发现非常难追了,尝试用ce分析.      <a href="#dbg%E9%85%8D%E5%90%88ce%E6%89%BE%E4%B8%8B%E5%B1%9E%E5%81%8F%E7%A7%BB%E7%9A%84%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7">此处用到的找偏移的理论方法</a></p>
<p>rbx有两个值,均到CE中搜索,发现其中一个有存放他的地址离对象首地址非常近.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204091415645.jpeg" alt="捕获"></p>
<p>上图猜测偏移结果为378</p>
<p>证实:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204091425024.jpeg" alt="捕获"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[[对象头地址+<span class="number">378</span>]+<span class="number">698</span>+[[对象头地址+<span class="number">378</span>]+<span class="number">6</span>DC]*<span class="number">10</span>]+n*<span class="number">30</span>+<span class="number">10</span>  <span class="comment">//偏移地址X   n为[1,0x43]</span></span><br><span class="line">[[对象头地址+<span class="number">378</span>]+<span class="number">698</span>+[[对象头地址+<span class="number">378</span>]+<span class="number">6</span>DC]*<span class="number">10</span>]+n*<span class="number">30</span>+<span class="number">14</span>  <span class="comment">//偏移地址Y   n为[1,0x43]</span></span><br><span class="line">[[对象头地址+<span class="number">378</span>]+<span class="number">698</span>+[[对象头地址+<span class="number">378</span>]+<span class="number">6</span>DC]*<span class="number">10</span>]+n*<span class="number">30</span>+<span class="number">18</span>  <span class="comment">//偏移地址Z   n为[1,0x43]</span></span><br><span class="line"><span class="comment">//[[对象头地址+378]+6DC]*10]为0或1,但发现,无论是0还是1都是一样的结果</span></span><br><span class="line"><span class="comment">//数组首地址是存在+698,因此数组数量应该也在附近,果然在+6A0位置看到了68(0x44)</span></span><br><span class="line">[对象头地址+<span class="number">378</span>]+<span class="number">6</span>A0    <span class="comment">//n的数量</span></span><br></pre></td></tr></table></figure>

<p>上面找到的只是相对参考点的偏移坐标,因此需要<strong>人物参考点坐标</strong>.可以在到对象[头地址+378]下去找参考点坐标.按照逻辑猜测应该在这里</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[对象头地址+<span class="number">378</span>]+<span class="number">190</span>  <span class="comment">//骨骼基准坐标X</span></span><br><span class="line">[对象头地址+<span class="number">378</span>]+<span class="number">194</span>  <span class="comment">//骨骼基准坐标Y</span></span><br><span class="line">[对象头地址+<span class="number">378</span>]+<span class="number">198</span>  <span class="comment">//骨骼基准坐标Z</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204091521692.jpeg" alt="捕获"></p>
<p>骨骼基准坐标大概率比人物位置坐标要低,一般是人物脚下的位置.还是实际到游戏中绘制一下看看是不是骨骼基准坐标最可靠.</p>
<h3 id="找朝向"><a href="#找朝向" class="headerlink" title="找朝向"></a>找朝向</h3><p>水平朝向值有-PI到+PI,0到360,-1到+1,非常多种.但很少出现特别大的值.</p>
<p>通过CE简单的搜索后,再通过手动修改来确定找到的是不是正确朝向</p>
<p>断到两个点,通过目标对象首地址配合CE找到目标数据  <a href="#dbg%E9%85%8D%E5%90%88ce%E6%89%BE%E4%B8%8B%E5%B1%9E%E5%81%8F%E7%A7%BB%E7%9A%84%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7">此处用到的找偏移的理论方法</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[角色头地址+<span class="number">350</span>]+<span class="number">36</span>C    <span class="type">float</span>    <span class="comment">//水平朝向地址</span></span><br><span class="line"><span class="comment">//水平朝向值0~360,地图正东为0/360,顺时针递增</span></span><br><span class="line">[角色头地址+<span class="number">350</span>]+<span class="number">368</span>    <span class="type">float</span>    <span class="comment">//垂直朝向地址</span></span><br><span class="line"><span class="comment">//仰角从0~89.9   0为水平值</span></span><br><span class="line"><span class="comment">//俯角从360~270  360为水平值</span></span><br></pre></td></tr></table></figure>

<h3 id="找矩阵-3"><a href="#找矩阵-3" class="headerlink" title="找矩阵"></a>找矩阵</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202203311927800.png" alt="image-20220331192721545"></p>
<p>矩阵地址:   <code>[[&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;+2ADA268]+24D08*8+8]+0x280</code>   </p>
<p>其中24D08的来源涉及非常复杂的加密流程,但是他是不变的.</p>
<h1 id="上面项目代码盘点"><a href="#上面项目代码盘点" class="headerlink" title="上面项目代码盘点"></a>上面项目代码盘点</h1><ul>
<li><a href="#entityAround.h">entityAround.h</a></li>
<li><a href="#paint.h">paint.h</a></li>
<li><a href="#stdafx.h">stdafx.h</a></li>
<li><a href="#dllmain.cpp">dllmain.cpp</a></li>
<li><a href="#entityAround.cpp">entityAround.cpp</a></li>
<li><a href="#paint.cpp">paint.cpp</a></li>
</ul>
<h2 id="entityAround-h"><a href="#entityAround-h" class="headerlink" title="entityAround.h"></a>entityAround.h</h2><p><a href="#%E4%B8%8A%E9%9D%A2%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%9B%98%E7%82%B9">回到目录</a>         <a href="#entityAround.cpp">跳转到源文件</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//三维坐标结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point3D</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">float</span> X;</span><br><span class="line">    <span class="type">float</span> Y;</span><br><span class="line">    <span class="type">float</span> Z;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//朝向结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Orientation</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">/* data */</span></span><br><span class="line">    <span class="type">float</span> horizon;</span><br><span class="line">    <span class="type">float</span> vertical;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Entity</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">/* data */</span></span><br><span class="line">    Point3D headPoint;</span><br><span class="line">    Point3D footPoint;</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    BYTE isDeath;<span class="comment">//死亡标志位</span></span><br><span class="line">    <span class="type">bool</span> isFriend;<span class="comment">//友方单位标志位</span></span><br><span class="line">	<span class="comment">//无矩阵方式为:获取人物与目标的世界坐标高度差和世界水平距离来得到人物和目标的夹角,</span></span><br><span class="line">	<span class="comment">//再通过人物准星减去目标夹角(或反过来)来确定准星偏转角度差, 通过准星偏转角度差来和游戏宽高分辨率来转换为屏幕坐标进行绘图</span></span><br><span class="line">	<span class="comment">//(无矩阵画框因为头和脚的差填入的是手动填入的固定值,并且画框的时候,目标框体的宽高比也是固定值等等,因此会有诸多问题)</span></span><br><span class="line">    Orientation headAngle;<span class="comment">//朝向对象的头部角度(以x正轴为底)</span></span><br><span class="line">    Orientation footAngle;<span class="comment">//朝向对象的脚部角度(以x正轴为底)</span></span><br><span class="line">    Orientation headAngleDifference;<span class="comment">//朝向目标头部和自己准星朝向的角度差(顺时针为正,逆时针为负)</span></span><br><span class="line">    Orientation footAngleDifference;<span class="comment">//朝向目标脚部和自己准星朝向的角度差</span></span><br><span class="line">	<span class="type">bool</span> isNotNull=<span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI 3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EntityAround</span>&#123;</span></span><br><span class="line">public:</span><br><span class="line">    Entity entity[<span class="number">0x100</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> entityNum;</span><br><span class="line">	Entity closeToFrontSizeEntity ;<span class="comment">//最靠近准星的对象</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">flashEntityAround_cs</span><span class="params">()</span>;<span class="comment">//CS1.6</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">flashEntityAround_koudaixiyou</span><span class="params">()</span>;<span class="comment">//口袋西游</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">flashEntityAround_tuxi</span><span class="params">()</span>;<span class="comment">//突袭</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">flashEntityAround_chijimoniqi</span><span class="params">()</span>;<span class="comment">//吃鸡模拟器</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算朝向</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">calOrientation</span><span class="params">(Point3D&amp; targetLoc,Orientation&amp; targetAngle,Orientation&amp; angleDiff)</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">radianToAngle</span><span class="params">(<span class="type">float</span> radian)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">angleToRadian</span><span class="params">(<span class="type">float</span> angle)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调试工具</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">myOutPutDebug</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* pszFormat, ...)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="paint-h"><a href="#paint-h" class="headerlink" title="paint.h"></a>paint.h</h2><p><a href="#%E4%B8%8A%E9%9D%A2%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%9B%98%E7%82%B9">回到目录</a>          <a href="#paint.cpp">跳转到源文件</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;entityAround.h&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point2D</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">float</span> X, Y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span>  <span class="title">Vector4</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">float</span> x;</span><br><span class="line">	<span class="type">float</span> y;</span><br><span class="line">	<span class="type">float</span> z;</span><br><span class="line">	<span class="type">float</span> w;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Paint</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">	HWND m_hWnd;<span class="comment">//窗口句柄</span></span><br><span class="line">	RECT m_wndRect;<span class="comment">//窗口尺寸信息</span></span><br><span class="line">	<span class="type">int</span> m_resolutionWidth;<span class="comment">//分辨率宽</span></span><br><span class="line">	<span class="type">int</span> m_resolutionHeight;<span class="comment">//分辨率高</span></span><br><span class="line">	RECT m_outsideWnd;<span class="comment">//外窗口尺寸信息</span></span><br><span class="line">	<span class="type">int</span> m_outsideWndWidth;<span class="comment">//外窗口分辨率宽</span></span><br><span class="line">	<span class="type">int</span> m_outsideWndHeight;<span class="comment">//外窗口分辨率高</span></span><br><span class="line">	<span class="type">float</span> m_viewMatrix[<span class="number">16</span>];<span class="comment">//视角矩阵</span></span><br><span class="line">	DWORD m_matrixAddr32;<span class="comment">//32位矩阵地址</span></span><br><span class="line">	DWORD64 m_matrixAddr64;<span class="comment">//64位矩阵地址</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//取窗口信息</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">getWndInfo</span><span class="params">()</span>;</span><br><span class="line">public:</span><br><span class="line">	Paint(HWND hWnd,DWORD matrixAddr=<span class="literal">NULL</span>, COLORREF brushColor=RGB(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>), COLORREF penColor=RGB(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">	<span class="comment">//64位非矩阵绘制未完善</span></span><br><span class="line">	Paint(HWND hWnd, DWORD64 matrixAddr, COLORREF brushColor = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), COLORREF penColor = RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	Paint();</span><br><span class="line">	~Paint();</span><br><span class="line">	HDC hdc;<span class="comment">//画板句柄</span></span><br><span class="line">	HBRUSH hBrush;<span class="comment">//画刷句柄</span></span><br><span class="line">	HFONT hfont;<span class="comment">//字体句柄</span></span><br><span class="line">	HPEN hPen;<span class="comment">//画笔</span></span><br><span class="line">	<span class="comment">//HDC hOldDc;//老的画板句柄</span></span><br><span class="line">	<span class="comment">//HBRUSH hOldBrush;//老的画刷句柄</span></span><br><span class="line">	<span class="comment">//HPEN hOldPen;//老的画笔</span></span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标(无矩阵)</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPointWithoutMatrix</span><span class="params">(Point2D&amp; screenPoint,<span class="type">const</span> Orientation&amp; angleDiff)</span>;</span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPoint</span><span class="params">(Point2D&amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span>;</span><br><span class="line">	<span class="comment">//世界坐标转屏幕坐标64位</span></span><br><span class="line">	<span class="type">bool</span> <span class="title function_">worldPointToScreenPoint64</span><span class="params">(Point2D&amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span>;</span><br><span class="line">	<span class="comment">//画线(从屏幕下方中间出发到(x,y))</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line">	<span class="comment">//两点画线</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> xTo, <span class="type">int</span> yTo)</span>;</span><br><span class="line">	<span class="comment">//画框</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintFrame</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, <span class="type">int</span> h, <span class="type">int</span> thick)</span>;</span><br><span class="line">	<span class="comment">//针对头脚坐标画框</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintFrameByFootAndHead</span><span class="params">(Point2D footPoiny,Point2D headPoint,<span class="type">int</span> thick)</span>;</span><br><span class="line">	<span class="comment">//画矩形</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintRect</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> w,<span class="type">int</span> h)</span>;</span><br><span class="line">	<span class="comment">//写字</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">paintText</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,COLORREF color,<span class="type">const</span> <span class="type">char</span>* text)</span>;</span><br><span class="line">	<span class="comment">//绘制</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">beginPaint</span><span class="params">()</span>;</span><br><span class="line">	<span class="comment">//更换画刷</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">changeBrush</span><span class="params">(COLORREF brushColor)</span>;</span><br><span class="line">	<span class="comment">//更换画笔</span></span><br><span class="line">	<span class="type">void</span> <span class="title function_">changePen</span><span class="params">(<span class="type">int</span> penStyle,<span class="type">int</span> penWidth,COLORREF penColor)</span>;</span><br><span class="line">	<span class="type">bool</span> 世界坐标转屏幕坐标_非矩阵(Point2D&amp; 屏幕坐标, FLOAT  水平角度差, FLOAT 高低角度差);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//横向量乘矩阵函数</span></span><br><span class="line">Vector4 <span class="title function_">RowVecTimesMatrix</span><span class="params">(<span class="type">const</span> Vector4&amp; rowVec, <span class="type">float</span> matrix[<span class="number">16</span>])</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建窗口</span></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="type">int</span> nShowCmd)</span>;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">windowProc</span><span class="params">(HWND hMyWnd, UINT msg, WPARAM wParam, LPARAM lParam)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要针对游戏进行修正,只支持32位,64位需要进行修改</span></span><br><span class="line"><span class="type">void</span>  <span class="title function_">drawTransparentWnd</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<h2 id="stdafx-h"><a href="#stdafx-h" class="headerlink" title="stdafx.h"></a>stdafx.h</h2><p><a href="#%E4%B8%8A%E9%9D%A2%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%9B%98%E7%82%B9">回到目录</a>         </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stdafx.h : 标准系统包含文件的包含文件，</span></span><br><span class="line"><span class="comment">// 或是经常使用但不常更改的</span></span><br><span class="line"><span class="comment">// 特定于项目的包含文件</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;targetver.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIN32_LEAN_AND_MEAN             <span class="comment">// 从 Windows 头中排除极少使用的资料</span></span></span><br><span class="line"><span class="comment">// Windows 头文件: </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span>  在此处引用程序需要的其他头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;string&quot;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br></pre></td></tr></table></figure>

<h2 id="dllmain-cpp"><a href="#dllmain-cpp" class="headerlink" title="dllmain.cpp"></a>dllmain.cpp</h2><p><a href="#%E4%B8%8A%E9%9D%A2%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%9B%98%E7%82%B9">回到目录</a>             <a href="#dllmain.h">跳转到头文件</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dllmain.cpp : 定义 DLL 应用程序的入口点。</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;paint.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;entityAround.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mainThread</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//	//无矩阵绘制流程</span></span><br><span class="line"><span class="comment">//	Paint paint(FindWindow(NULL,L&quot;Counter-Strike&quot;),0x2C20100);</span></span><br><span class="line"><span class="comment">//	EntityAround entityAround;</span></span><br><span class="line"><span class="comment">//	entityAround.flashEntityAround_cs();</span></span><br><span class="line"><span class="comment">//	//调试展示信息</span></span><br><span class="line"><span class="comment">//	char tmp2[999];</span></span><br><span class="line"><span class="comment">//	sprintf(tmp2, &quot;cs1.6 g_baseAroundLoc:%X  g_baseAroundInfo:%X &quot;, (DWORD)GetModuleHandleA(&quot;hl.exe&quot;) + 0x1B5A5C4, (DWORD)GetModuleHandleA(&quot;hl.exe&quot;) + 0x62565C);</span></span><br><span class="line"><span class="comment">//	OutputDebugStringA(tmp2);</span></span><br><span class="line"><span class="comment">//	//刷新数据后显示来看看</span></span><br><span class="line"><span class="comment">//	for (int i = 1; i &lt; entityAround.entityNum; i++)//从1开始遍历跳过自己</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		char tmp[999];</span></span><br><span class="line"><span class="comment">//		sprintf(tmp, &quot;cs1.6 No.%d hp:%d foot(%f,%f,%f) head(%f,%f,%f) isFriend:%d isDeath:%d&quot;,i+1, entityAround.entity[i].hp</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].footPoint.X</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].footPoint.Y</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].footPoint.Z</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].headPoint.X</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].headPoint.Y</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].headPoint.Z</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].isFriend</span></span><br><span class="line"><span class="comment">//			, entityAround.entity[i].isDeath);</span></span><br><span class="line"><span class="comment">//		</span></span><br><span class="line"><span class="comment">//		OutputDebugStringA(tmp);</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	OutputDebugStringA(&quot;==========================================&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	//死循环,不断绘制的过程</span></span><br><span class="line"><span class="comment">//	while (true)</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		entityAround.flashEntityAround_cs();</span></span><br><span class="line"><span class="comment">//		Point2D entityFootPoint2d, entityHeadPoint2d;</span></span><br><span class="line"><span class="comment">//		for (int i = 0; i &lt; entityAround.entityNum; i++)//从1开始遍历跳过自己</span></span><br><span class="line"><span class="comment">//		&#123;</span></span><br><span class="line"><span class="comment">//			if (entityAround.entity[i].isDeath)</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				continue;//死亡的跳过绘制流程</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">////是否使用矩阵方式</span></span><br><span class="line"><span class="comment">//#if 0</span></span><br><span class="line"><span class="comment">//			//矩阵方式!!!!!!!!!!!!!!!!!!</span></span><br><span class="line"><span class="comment">//			//脚坐标是否能转换成屏幕坐标(该函数内部避免了在角色身后绘制的情况),能转换成屏幕坐标的才绘制</span></span><br><span class="line"><span class="comment">//			if (!paint.worldPointToScreenPoint(entityFootPoint2d, entityAround.entity[i].footPoint))</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				continue;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//			//头坐标是否能转换成屏幕坐标(该函数内部避免了在角色身后绘制的情况),能转换成屏幕坐标的才绘制</span></span><br><span class="line"><span class="comment">//			if (!paint.worldPointToScreenPoint(entityHeadPoint2d, entityAround.entity[i].headPoint))</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				continue;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//#else</span></span><br><span class="line"><span class="comment">//			//非矩阵方式!!!!!!!!!!!!!!!!!!</span></span><br><span class="line"><span class="comment">//			//脚坐标是否能转换成屏幕坐标(该函数内部避免了在角色身后绘制的情况),能转换成屏幕坐标的才绘制</span></span><br><span class="line"><span class="comment">//			if (!paint.worldPointToScreenPointWithoutMatrix(entityFootPoint2d, entityAround.entity[i].footAngleDifference))</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				continue;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//			//头坐标是否能转换成屏幕坐标(该函数内部避免了在角色身后绘制的情况),能转换成屏幕坐标的才绘制</span></span><br><span class="line"><span class="comment">//			if (!paint.worldPointToScreenPointWithoutMatrix(entityHeadPoint2d, entityAround.entity[i].headAngleDifference))</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				continue;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//#endif </span></span><br><span class="line"><span class="comment">//			//头和脚都在屏幕范围内才绘制</span></span><br><span class="line"><span class="comment">//			if (entityAround.entity[i].isFriend)//是朋友不绘制</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				continue;</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//			//画框</span></span><br><span class="line"><span class="comment">//			if (GetKeyState(VK_F3) &amp; 1)//按下F3开关绘制</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				float entityHeight = entityFootPoint2d.Y - entityHeadPoint2d.Y;</span></span><br><span class="line"><span class="comment">//				//myOutPutDebug(&quot;height:%f&quot;, entityHeight);</span></span><br><span class="line"><span class="comment">//				paint.paintFrame(entityHeadPoint2d.X - entityHeight / 4, entityHeadPoint2d.Y, entityHeight / 2, entityHeight, 1);</span></span><br><span class="line"><span class="comment">//				//paint.paintText(entityFootPoint2d.X, entityFootPoint2d.Y, RGB(255, 0, 0), &quot;foot&quot;);</span></span><br><span class="line"><span class="comment">//				//paint.paintText(entityHeadPoint2d.X, entityHeadPoint2d.Y, RGB(255, 0, 0), &quot;head&quot;);</span></span><br><span class="line"><span class="comment">//				//float head =  entityHeadPoint2d.Y - entityFootPoint2d.Y;</span></span><br><span class="line"><span class="comment">//				//float width = head / 2;</span></span><br><span class="line"><span class="comment">//				//float center = width / -2;</span></span><br><span class="line"><span class="comment">//				//float extra = head / -6;</span></span><br><span class="line"><span class="comment">//				//FPS_绘制.画框((int)(屏幕坐标_j.x + center), (int)屏幕坐标_j.y, (int)width, (int)(head - extra), 1);</span></span><br><span class="line"><span class="comment">//				//paint.paintFrame(entityFootPoint2d.X + center, entityFootPoint2d.Y, width, head - extra, 1);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//			//myOutPutDebug(&quot;cs1.6 第%d号  foot(%f,%f)  head(%f,%f)&quot;, i + 1, entityFootPoint2d.X, entityFootPoint2d.Y, entityHeadPoint2d.X, entityHeadPoint2d.Y);</span></span><br><span class="line"><span class="comment">//			</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//			if (entityAround.closeToFrontSizeEntity.isNotNull)</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				if (GetAsyncKeyState(VK_RBUTTON) )//按下右键</span></span><br><span class="line"><span class="comment">//				&#123;</span></span><br><span class="line"><span class="comment">//					//校准</span></span><br><span class="line"><span class="comment">//					Point3D targetPoint = entityAround.closeToFrontSizeEntity.footPoint;</span></span><br><span class="line"><span class="comment">//					targetPoint.Z += 56;//刚好指到头</span></span><br><span class="line"><span class="comment">//					Orientation targetAngle, targetAngleDiffer;</span></span><br><span class="line"><span class="comment">//					entityAround.calOrientation(targetPoint, targetAngle, targetAngleDiffer);</span></span><br><span class="line"><span class="comment">//					//修改内存准星数据(非矩阵有问题!!!!!)</span></span><br><span class="line"><span class="comment">//					*(FLOAT*)((DWORD)GetModuleHandleA(&quot;hl.exe&quot;) + 0x19E10C4) = targetAngle.vertical;</span></span><br><span class="line"><span class="comment">//					*(FLOAT*)((DWORD)GetModuleHandleA(&quot;hl.exe&quot;) + 0x19E10C8) = targetAngle.horizon;</span></span><br><span class="line"><span class="comment">//					//SetCursorPos(entityHeadPoint2d.X, entityHeadPoint2d.Y);//不行</span></span><br><span class="line"><span class="comment">//				&#125;</span></span><br><span class="line"><span class="comment">//				</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//		</span></span><br><span class="line"><span class="comment">//		if (GetKeyState(VK_F2)&amp;1)//按下F2彻底退出</span></span><br><span class="line"><span class="comment">//		&#123;</span></span><br><span class="line"><span class="comment">//			break;</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//		Sleep(1);</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//口袋西游</span></span><br><span class="line">	<span class="comment">//DWORD matrixAddr = (*(DWORD*)0xD2E5D0) + 0xE8;</span></span><br><span class="line">	<span class="comment">//Paint paint(FindWindow(NULL, L&quot;口袋西游&quot;), matrixAddr);</span></span><br><span class="line">	<span class="comment">//EntityAround entityAround; </span></span><br><span class="line">	<span class="comment">//while (true)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	entityAround.flashEntityAround_koudaixiyou();</span></span><br><span class="line">	<span class="comment">//	for (int i = 0; i &lt; entityAround.entityNum; i++)</span></span><br><span class="line">	<span class="comment">//	&#123;</span></span><br><span class="line">	<span class="comment">//		Point2D entityFootPoint2d, entityHeadPoint2d;</span></span><br><span class="line">	<span class="comment">//		if (!paint.worldPointToScreenPoint(entityFootPoint2d, entityAround.entity[i].footPoint))</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			continue;</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//		if (!paint.worldPointToScreenPoint(entityHeadPoint2d, entityAround.entity[i].headPoint))</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			continue;</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//		if (GetKeyState(VK_F3) &amp; 1)//按下F3开关绘制</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			paint.paintText(entityFootPoint2d.X, entityFootPoint2d.Y, RGB(255, 0, 0), &quot;foot&quot;);</span></span><br><span class="line">	<span class="comment">//			paint.paintText(entityHeadPoint2d.X, entityHeadPoint2d.Y, RGB(255, 0, 0), &quot;head&quot;);</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//	Sleep(1);</span></span><br><span class="line">	<span class="comment">//	if (GetKeyState(VK_F2) &amp; 1)//按下F2彻底退出</span></span><br><span class="line">	<span class="comment">//	&#123;</span></span><br><span class="line">	<span class="comment">//		break;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//突袭</span></span><br><span class="line">	<span class="comment">//Paint paint(FindWindow(NULL, L&quot;AssaultCube&quot;), 0x57AFE0);</span></span><br><span class="line">	<span class="comment">//EntityAround entityAround;</span></span><br><span class="line">	<span class="comment">//while (true)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	entityAround.flashEntityAround_tuxi();</span></span><br><span class="line">	<span class="comment">//	for (int i = 0; i &lt; entityAround.entityNum; i++)</span></span><br><span class="line">	<span class="comment">//	&#123;</span></span><br><span class="line">	<span class="comment">//		Point2D entityFootPoint2d, entityHeadPoint2d;</span></span><br><span class="line">	<span class="comment">//		if (!paint.worldPointToScreenPoint(entityFootPoint2d, entityAround.entity[i].footPoint))</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			continue;</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//		if (!paint.worldPointToScreenPoint(entityHeadPoint2d, entityAround.entity[i].headPoint))</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			continue;</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//		if (entityAround.entity[i].isDeath)</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			continue;</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//		if (GetKeyState(VK_F3) &amp; 1)//按下F3开关绘制</span></span><br><span class="line">	<span class="comment">//		&#123;</span></span><br><span class="line">	<span class="comment">//			paint.paintText(entityFootPoint2d.X, entityFootPoint2d.Y, RGB(255, 0, 0), &quot;foot&quot;);</span></span><br><span class="line">	<span class="comment">//			paint.paintText(entityHeadPoint2d.X, entityHeadPoint2d.Y, RGB(255, 0, 0), &quot;head&quot;);</span></span><br><span class="line">	<span class="comment">//		&#125;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//	Sleep(1);</span></span><br><span class="line">	<span class="comment">//	if (GetKeyState(VK_F2) &amp; 1)//按下F2彻底退出</span></span><br><span class="line">	<span class="comment">//	&#123;</span></span><br><span class="line">	<span class="comment">//		break;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//吃鸡模拟器绘制</span></span><br><span class="line">	DWORD64 matrixAddr = *(DWORD64*)(*(DWORD64*)((DWORD64)GetModuleHandleA(<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>) + <span class="number">0x2ADA268</span>) + <span class="number">0x24D08</span> * <span class="number">8</span> + <span class="number">8</span>) + <span class="number">0x280</span>;</span><br><span class="line">	myOutPutDebug(<span class="string">&quot;matrix: %llx&quot;</span>, matrixAddr);</span><br><span class="line">	Paint <span class="title function_">paint</span><span class="params">(FindWindow(<span class="string">L&quot;UnrealWindow&quot;</span>, <span class="number">0</span>), matrixAddr)</span>;</span><br><span class="line">	EntityAround entityArround;</span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		entityArround.flashEntityAround_chijimoniqi();</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (<span class="type">int</span>)entityArround.entityNum; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//if (entityArround.entity[i].isFriend || entityArround.entity[i].isDeath)//排除死的和友军的</span></span><br><span class="line">			<span class="comment">//&#123;</span></span><br><span class="line">			<span class="comment">//	continue;</span></span><br><span class="line">			<span class="comment">//&#125;</span></span><br><span class="line">			Point2D screenFootPoint, screenHeadPoint;</span><br><span class="line">			<span class="type">float</span> footTmp = entityArround.entity[i].footPoint.Z;</span><br><span class="line">			entityArround.entity[i].headPoint.X = entityArround.entity[i].footPoint.X;</span><br><span class="line">			entityArround.entity[i].headPoint.Y = entityArround.entity[i].footPoint.Y;</span><br><span class="line">			entityArround.entity[i].headPoint.Z = entityArround.entity[i].footPoint.Z+<span class="number">60</span>;</span><br><span class="line">			entityArround.entity[i].footPoint.Z = footTmp <span class="number">-100</span>;</span><br><span class="line">			<span class="keyword">if</span> (paint.worldPointToScreenPoint64(screenFootPoint, entityArround.entity[i].footPoint))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (paint.worldPointToScreenPoint64(screenHeadPoint, entityArround.entity[i].headPoint))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (GetKeyState(VK_F3) &amp; <span class="number">1</span>)<span class="comment">//按下F3开关绘制</span></span><br><span class="line">					&#123;</span><br><span class="line">						paint.paintFrameByFootAndHead(screenFootPoint, screenHeadPoint, <span class="number">1</span>);</span><br><span class="line">						<span class="comment">//paint.paintText(screenFootPoint.X, screenFootPoint.Y, RGB(255, 0, 0), &quot;foot&quot;);</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">			Sleep(<span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (GetKeyState(VK_F2) &amp; <span class="number">1</span>)<span class="comment">//按下F2彻底退出</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HWND hMyWnd;<span class="comment">//用于储存自建窗口的句柄</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="type">int</span> nShowCmd)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//测试hdc的释放</span></span><br><span class="line">	<span class="comment">//while (1)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	Paint paintTest(FindWindow(L&quot;Valve001&quot;, 0), (DWORD)GetModuleHandleA(&quot;hl.exe&quot;) + 0x1820100);</span></span><br><span class="line">	<span class="comment">//	ReleaseDC(paintTest.m_hWnd, paintTest.hdc);</span></span><br><span class="line">	<span class="comment">//	paintTest.hdc = GetDC(paintTest.m_hWnd);</span></span><br><span class="line">	<span class="comment">//	ReleaseDC(paintTest.m_hWnd, paintTest.hdc);</span></span><br><span class="line">	<span class="comment">//	if (GetKeyState(VK_F3) &amp; 1)//按下F3退出消息循环</span></span><br><span class="line">	<span class="comment">//	&#123;</span></span><br><span class="line">	<span class="comment">//		myOutPutDebug(&quot;test quit&quot;);</span></span><br><span class="line">	<span class="comment">//		return 0;</span></span><br><span class="line">	<span class="comment">//	&#125;</span></span><br><span class="line">	<span class="comment">//	Sleep(10);</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	myOutPutDebug(<span class="string">&quot;begin&quot;</span>);</span><br><span class="line">	::WNDCLASSEXA winClass;</span><br><span class="line">	winClass.lpszClassName = <span class="string">&quot;zijiandialog&quot;</span>;</span><br><span class="line">	winClass.cbSize = <span class="keyword">sizeof</span>(::WNDCLASSEX);</span><br><span class="line">	winClass.style = CS_HREDRAW | CS_VREDRAW | CS_OWNDC | CS_DBLCLKS;</span><br><span class="line">	winClass.lpfnWndProc = windowProc;<span class="comment">//回调函数</span></span><br><span class="line">	winClass.hInstance = hInstance;</span><br><span class="line">	winClass.hIcon = <span class="number">0</span>;</span><br><span class="line">	winClass.hIconSm = <span class="number">0</span>;</span><br><span class="line">	winClass.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);</span><br><span class="line">	winClass.hbrBackground = <span class="literal">NULL</span>;<span class="comment">//(HBRUSH)(BLACK_BRUSH); // 背景颜色</span></span><br><span class="line">	winClass.lpszMenuName = <span class="literal">NULL</span>;</span><br><span class="line">	winClass.cbClsExtra = <span class="number">0</span>;</span><br><span class="line">	winClass.cbWndExtra = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	RegisterClassExA(&amp;winClass);<span class="comment">//注册窗口类</span></span><br><span class="line"></span><br><span class="line">								<span class="comment">//创建窗口</span></span><br><span class="line">	hMyWnd = CreateWindowExA(</span><br><span class="line">		<span class="number">128</span> | <span class="number">32</span> | <span class="number">8</span> | WS_EX_LAYERED,<span class="comment">// 扩展风格  透明窗口 WS_EX_LAYERED</span></span><br><span class="line">		<span class="string">&quot;zijiandialog&quot;</span>,<span class="comment">//类名指针</span></span><br><span class="line">		<span class="string">&quot;自建窗口&quot;</span>,<span class="comment">//窗口名指针</span></span><br><span class="line">		WS_EX_LAYERED | <span class="number">0</span> | <span class="number">0x10000</span> | <span class="number">0x20000</span> | <span class="number">0x2000000</span> | WS_POPUP,<span class="comment">//窗口的风格 </span></span><br><span class="line">		<span class="number">100</span>,<span class="comment">//初始水平位置</span></span><br><span class="line">		<span class="number">100</span>,<span class="comment">//初始垂直位置</span></span><br><span class="line">		GetSystemMetrics(SM_CXSCREEN) * <span class="number">640</span> / <span class="number">1920</span>,<span class="comment">//宽度   游戏水平窗口分辨率/屏幕水平分辨率   由于此两项是初始位置,所以写什么都行,反正下面会实时修正</span></span><br><span class="line">		GetSystemMetrics(SM_CYSCREEN) * <span class="number">480</span> / <span class="number">1080</span>,<span class="comment">//高度   游戏窗口垂直分辨率/屏幕垂直分辨率  </span></span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		<span class="number">0</span>,</span><br><span class="line">		hInstance,<span class="comment">//应用程序实例的句柄  </span></span><br><span class="line">		<span class="number">0</span><span class="comment">//用户自定义的变量</span></span><br><span class="line">		);</span><br><span class="line">	myOutPutDebug(<span class="string">&quot;hMyWnd: %d   error: %d&quot;</span>, hMyWnd, GetLastError());</span><br><span class="line">	SetWindowPos(hMyWnd, (HWND)<span class="number">-1</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">19</span>);</span><br><span class="line">	ShowWindow(hMyWnd, SW_NORMAL);<span class="comment">//显示窗口</span></span><br><span class="line">	UpdateWindow(hMyWnd);<span class="comment">//更新窗口</span></span><br><span class="line">	SetWindowLongA(hMyWnd, <span class="number">-20</span>, <span class="number">589992</span>);</span><br><span class="line">	SetLayeredWindowAttributes(hMyWnd, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">	SetLayeredWindowAttributes(hMyWnd, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//window 消息循环</span></span><br><span class="line">	MSG msg = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//置顶窗口</span></span><br><span class="line">		::SetWindowPos(hMyWnd, HWND_TOPMOST, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, SWP_NOSIZE | SWP_NOMOVE);</span><br><span class="line">		<span class="comment">//读取当前的主框架的style</span></span><br><span class="line">		DWORD dwStyle = ::GetWindowLong(hMyWnd, GWL_EXSTYLE);</span><br><span class="line">		<span class="keyword">if</span> (!((dwStyle &amp; WS_EX_TOPMOST) == WS_EX_TOPMOST))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//保证主框架前置，然后再恢复到正常状态</span></span><br><span class="line">			SetWindowPos(hMyWnd, HWND_NOTOPMOST, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, SWP_NOSIZE | SWP_NOMOVE);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (msg.message == WM_ERASEBKGND)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (msg.message == WM_DESTROY || msg.message == WM_CLOSE || msg.message == WM_QUIT)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (PeekMessage(&amp;msg, hMyWnd, <span class="number">0</span>, <span class="number">0</span>, PM_REMOVE))</span><br><span class="line">		&#123;</span><br><span class="line">			DispatchMessage((&amp;msg));<span class="comment">//分发消息</span></span><br><span class="line">			TranslateMessage(&amp;msg);<span class="comment">//解释消息	</span></span><br><span class="line">		&#125;</span><br><span class="line">		Sleep(<span class="number">10</span>);</span><br><span class="line">		<span class="keyword">if</span> (GetKeyState(VK_F3) &amp; <span class="number">1</span>)<span class="comment">//按下F3退出消息循环</span></span><br><span class="line">		&#123;</span><br><span class="line">			myOutPutDebug(<span class="string">&quot;quit&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//回调函数</span></span><br><span class="line">LRESULT CALLBACK <span class="title function_">windowProc</span><span class="params">(HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span> (msg)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_PAINT:</span><br><span class="line">		drawTransparentWnd();<span class="comment">//针对每款游戏提供!!!!!!!!!</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_SIZE:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> WM_CLOSE:</span><br><span class="line">	<span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">		PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> DefWindowProc(hWnd, msg, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EntityAround entityAround;<span class="comment">//全局工具</span></span><br><span class="line"></span><br><span class="line">HBRUSH hBrush;</span><br><span class="line">HDC hdc;</span><br><span class="line">Point2D screenFootPoint, screenHeadPoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">//透明窗口绘制(针对每款游戏实现)!!!!!!!!!</span></span><br><span class="line"><span class="type">void</span>  <span class="title function_">drawTransparentWnd</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	RECT myWnd;</span><br><span class="line">	GetClientRect(hMyWnd, &amp;myWnd);<span class="comment">//获取自己的窗口的宽高位置信息</span></span><br><span class="line">								  <span class="comment">//InvalidateRect(hMyWnd, &amp;myWnd, TRUE);</span></span><br><span class="line">								  <span class="comment">//UpdateWindow(hMyWnd);//更新窗口 </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//这里是为了清空上一次的绘制</span></span><br><span class="line">	hdc = GetDC(hMyWnd);</span><br><span class="line">	hBrush = CreateSolidBrush(RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	FillRect(hdc, &amp;myWnd, hBrush);<span class="comment">//绘制矩形</span></span><br><span class="line"></span><br><span class="line">	DeleteObject(hBrush);</span><br><span class="line">	<span class="comment">//区别似乎只有下面这个类...</span></span><br><span class="line">	Paint <span class="title function_">paintMyWnd</span><span class="params">(FindWindow(<span class="string">L&quot;Valve001&quot;</span>, <span class="number">0</span>), (DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x1820100</span>)</span>;<span class="comment">//针对32位</span></span><br><span class="line">	paintMyWnd.getWndInfo();</span><br><span class="line">	<span class="comment">//不断地跟我们的窗口重合</span></span><br><span class="line">	MoveWindow(hMyWnd, paintMyWnd.m_outsideWnd.left + (paintMyWnd.m_outsideWndWidth - paintMyWnd.m_resolutionWidth) / <span class="number">2</span>, paintMyWnd.m_outsideWnd.top + (paintMyWnd.m_outsideWndHeight - paintMyWnd.m_resolutionHeight - (paintMyWnd.m_outsideWndWidth - paintMyWnd.m_resolutionWidth) / <span class="number">2</span>), paintMyWnd.m_outsideWnd.right- paintMyWnd.m_outsideWnd.left, paintMyWnd.m_outsideWnd.bottom- paintMyWnd.m_outsideWnd.top, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	entityAround.flashEntityAround_cs();</span><br><span class="line">	<span class="comment">//myOutPutDebug(&quot;前hMyWnd: %d   hdc: %d&quot;, (DWORD)hMyWnd, (DWORD)paintMyWnd.hdc);</span></span><br><span class="line">	ReleaseDC(paintMyWnd.m_hWnd, paintMyWnd.hdc);<span class="comment">//清除原有hdc</span></span><br><span class="line">	paintMyWnd.m_hWnd = hMyWnd;</span><br><span class="line">	paintMyWnd.hdc = hdc;<span class="comment">//绘画前更新绘画目标为新建窗口对应的hdc</span></span><br><span class="line">	<span class="comment">//myOutPutDebug(&quot;后hMyWnd: %d   hdc: %d&quot;, (DWORD)hMyWnd, (DWORD)paintMyWnd.hdc);</span></span><br><span class="line">	paintMyWnd.paintText(paintMyWnd.m_resolutionWidth / <span class="number">2</span>, paintMyWnd.m_resolutionHeight / <span class="number">2</span>, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="string">&quot;准星&quot;</span>);<span class="comment">//绘制准星</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (<span class="type">int</span>)entityAround.entityNum; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (entityAround.entity[i].isDeath)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (entityAround.entity[i].isFriend)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		Point3D footPoint = &#123; entityAround.entity[i].footPoint.X ,entityAround.entity[i].footPoint.Y ,entityAround.entity[i].footPoint.Z &#125;;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (paintMyWnd.worldPointToScreenPoint(screenFootPoint, footPoint))</span><br><span class="line">		&#123;</span><br><span class="line">			Point3D headPoint = &#123; entityAround.entity[i].headPoint.X ,entityAround.entity[i].headPoint.Y ,entityAround.entity[i].headPoint.Z &#125;;</span><br><span class="line">			<span class="keyword">if</span> (paintMyWnd.worldPointToScreenPoint(screenHeadPoint, headPoint))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">float</span> head = (<span class="type">float</span>)screenHeadPoint.Y - (<span class="type">float</span>)screenFootPoint.Y;<span class="comment">//  负数高度</span></span><br><span class="line">				<span class="type">float</span> width = head / <span class="number">2</span>;   <span class="comment">//  负数宽度</span></span><br><span class="line">				<span class="type">float</span> center = width / <span class="number">-2</span>;  <span class="comment">//  一半宽度</span></span><br><span class="line">				<span class="type">float</span> extra = head / <span class="number">-6</span>;   <span class="comment">//  三分之一 宽度</span></span><br><span class="line"></span><br><span class="line">				paintMyWnd.paintFrame((<span class="type">int</span>)(screenFootPoint.X + center), (<span class="type">int</span>)screenFootPoint.Y, (<span class="type">int</span>)width, (<span class="type">int</span>)(head - extra), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">//DeleteObject(hBrush);</span></span><br><span class="line"></span><br><span class="line">				<span class="type">char</span> healthChar[<span class="number">255</span>];</span><br><span class="line">				sprintf_s(healthChar, <span class="keyword">sizeof</span>(healthChar), <span class="string">&quot;%d&quot;</span>, entityAround.entity[i].hp);</span><br><span class="line">				paintMyWnd.paintText((<span class="type">int</span>)screenFootPoint.X, (<span class="type">int</span>)screenFootPoint.Y, RGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), healthChar);</span><br><span class="line">				<span class="keyword">if</span> (GetKeyState(VK_F4) &amp; <span class="number">1</span>)<span class="comment">//按下F2打开射线绘制</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">//下面的画线有问题</span></span><br><span class="line">					paintMyWnd.paintLine((<span class="type">int</span>)screenFootPoint.X, (<span class="type">int</span>)screenFootPoint.Y);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//ReleaseDC(hMyWnd, hdc);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL APIENTRY <span class="title function_">DllMain</span><span class="params">( HMODULE hModule,</span></span><br><span class="line"><span class="params">                       DWORD  ul_reason_for_call,</span></span><br><span class="line"><span class="params">                       LPVOID lpReserved</span></span><br><span class="line"><span class="params">					 )</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">		<span class="comment">//禁用指定动态链接库 (DLL) 的 DLL_THREAD_ATTACH 和 DLL_THREAD_DETACH 通知</span></span><br><span class="line">		DisableThreadLibraryCalls(hModule);</span><br><span class="line">		<span class="comment">//CreateThread(0, 0, (LPTHREAD_START_ROUTINE)mainThread, 0, 0, 0);</span></span><br><span class="line">		CreateThread(<span class="number">0</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)WinMain, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);<span class="comment">//自建窗口</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">	<span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">	<span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="entityAround-cpp"><a href="#entityAround-cpp" class="headerlink" title="entityAround.cpp"></a>entityAround.cpp</h2><p><a href="#%E4%B8%8A%E9%9D%A2%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%9B%98%E7%82%B9">回到目录</a>            <a href="#entityAround.h">跳转到头文件</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;entityAround.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line">DWORD g_baseAroundLoc = (DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>)+<span class="number">0x1B5A5C4</span>;</span><br><span class="line">DWORD g_baseAroundInfo = (DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x62565C</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化值(未判断离得远的敌人的框体消除)</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EntityAround::flashEntityAround_cs</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//读取自己的阵营</span></span><br><span class="line">	BYTE myCam = *(BYTE*)(g_baseAroundInfo + <span class="number">0x68</span> * <span class="number">0</span> + <span class="number">0x4E</span>);<span class="comment">//0号位置是自己</span></span><br><span class="line">	entityNum = <span class="number">0</span>;</span><br><span class="line">	closeToFrontSizeEntity.isNotNull = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//最小角度差和初始值</span></span><br><span class="line">	<span class="type">float</span> theMiniAngleDiffSum = <span class="number">999</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; <span class="number">32</span>; i++)<span class="comment">//从1开始遍历,跳过自己</span></span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="keyword">if</span> (*(DWORD*)g_baseAroundLoc+<span class="number">0x24C</span>*i==<span class="number">0</span>)<span class="comment">//遍历到了真正的边界直接结束</span></span><br><span class="line">    	&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">		<span class="keyword">if</span> (*(DWORD*)g_baseAroundLoc + <span class="number">0x24C</span> * i+<span class="number">0x190</span> == <span class="number">0</span>)<span class="comment">//跳过无用的数组项</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//真正是entity</span></span><br><span class="line">		entity[entityNum].footPoint.X = *(FLOAT*)(g_baseAroundLoc + <span class="number">0x24C</span> * i + <span class="number">0x188</span>);</span><br><span class="line">		entity[entityNum].footPoint.Y = *(FLOAT*)(g_baseAroundLoc + <span class="number">0x24C</span> * i + <span class="number">0x18C</span>);</span><br><span class="line">		entity[entityNum].footPoint.Z = *(FLOAT*)(g_baseAroundLoc + <span class="number">0x24C</span> * i + <span class="number">0x190</span>)<span class="number">-52</span> ;</span><br><span class="line">		entity[entityNum].headPoint.X = *(FLOAT*)(g_baseAroundLoc + <span class="number">0x24C</span> * i + <span class="number">0x188</span>);</span><br><span class="line">		entity[entityNum].headPoint.Y = *(FLOAT*)(g_baseAroundLoc + <span class="number">0x24C</span> * i + <span class="number">0x18C</span>);</span><br><span class="line">		entity[entityNum].headPoint.Z = *(FLOAT*)(g_baseAroundLoc + <span class="number">0x24C</span> * i + <span class="number">0x190</span>)+<span class="number">10</span> ;</span><br><span class="line">		<span class="keyword">if</span> (myCam== *(BYTE*)(g_baseAroundInfo + <span class="number">0x68</span> * i + <span class="number">0x4E</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			entity[entityNum].isFriend = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			entity[entityNum].isFriend = <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		entity[entityNum].isDeath = *(BYTE*)(g_baseAroundInfo + <span class="number">0x68</span> * i + <span class="number">0x60</span>);</span><br><span class="line">		entity[entityNum].hp= *(DWORD*)(g_baseAroundInfo + <span class="number">0x68</span> * i + <span class="number">0x68</span>);</span><br><span class="line">		<span class="comment">//计算朝向</span></span><br><span class="line">		calOrientation(entity[entityNum].footPoint, entity[entityNum].footAngle, entity[entityNum].footAngleDifference);</span><br><span class="line">		calOrientation(entity[entityNum].headPoint, entity[entityNum].headAngle, entity[entityNum].headAngleDifference);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取离准星最近的对象(用于自瞄)</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">fabs</span>(entity[entityNum].headAngleDifference.horizon)&lt;<span class="number">45</span>&amp;&amp;<span class="built_in">fabs</span>(entity[entityNum].headAngleDifference.vertical)&lt;<span class="number">35</span>&amp;&amp;!entity[entityNum].isFriend&amp;&amp;!entity[entityNum].isDeath)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 是没死的敌人,并且在我们的自瞄范围中</span></span><br><span class="line">			<span class="type">float</span> tmp = <span class="built_in">fabs</span>(entity[entityNum].headAngleDifference.horizon) + <span class="built_in">fabs</span>(entity[entityNum].headAngleDifference.vertical);</span><br><span class="line">			<span class="keyword">if</span> (tmp &lt; theMiniAngleDiffSum)</span><br><span class="line">			&#123;</span><br><span class="line">				theMiniAngleDiffSum = tmp;</span><br><span class="line">				closeToFrontSizeEntity = entity[entityNum];<span class="comment">//获取离准星最近的对象</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		entityNum++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">EntityAround::flashEntityAround_koudaixiyou</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	DWORD temp = *(DWORD*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x8</span>)) + <span class="number">0x20</span>);</span><br><span class="line">	entityNum = *(DWORD*)(temp + <span class="number">0x5C</span>);</span><br><span class="line">	DWORD entityBase = *(DWORD*)(temp + <span class="number">0x58</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (<span class="type">int</span>)entityNum; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		entity[i].footPoint.X = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x2DC</span>);</span><br><span class="line">		entity[i].footPoint.Y = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x2E0</span>);</span><br><span class="line">		entity[i].footPoint.Z = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x2E4</span>);</span><br><span class="line">		entity[i].headPoint.X = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x2E8</span>);</span><br><span class="line">		entity[i].headPoint.Y = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x2EC</span>);</span><br><span class="line">		entity[i].headPoint.Z = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x2F0</span>);</span><br><span class="line">		entity[i].isFriend = <span class="number">0</span>;</span><br><span class="line">		entity[i].hp= *(DWORD*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x138</span>);<span class="comment">//未攻击的血量为0</span></span><br><span class="line">		entity[i].isDeath = *(BYTE*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0xED</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//自己的人物也加进去,因为游戏是第三人称,人物本身也是在游戏中的.</span></span><br><span class="line">	entityNum++;</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].footPoint.X = *(FLOAT*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x28</span>)) + <span class="number">0x578</span>);</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].footPoint.Y = *(FLOAT*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x28</span>)) + <span class="number">0x57C</span>);</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].footPoint.Z = *(FLOAT*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x28</span>)) + <span class="number">0x580</span>);</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].headPoint.X = *(FLOAT*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x28</span>)) + <span class="number">0x584</span>);</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].headPoint.Y = *(FLOAT*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x28</span>)) + <span class="number">0x588</span>);</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].headPoint.Z = *(FLOAT*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x28</span>)) + <span class="number">0x58C</span>);</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].isFriend = <span class="number">0</span>;</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].hp = *(DWORD*)((*(DWORD*)((*(DWORD*)((*(DWORD*)<span class="number">0xD0DF1C</span>) + <span class="number">0x1C</span>)) + <span class="number">0x28</span>)) + <span class="number">0x288</span>);</span><br><span class="line">	entity[entityNum - <span class="number">1</span>].isDeath = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">EntityAround::flashEntityAround_tuxi</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	entityNum = *(DWORD*)<span class="number">0x587C18</span>;</span><br><span class="line">	DWORD entityBase = *(DWORD*)<span class="number">0x587C10</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; (<span class="type">int</span>)entityNum; i++)<span class="comment">//从1开始遍历跳过无效数据</span></span><br><span class="line">	&#123;</span><br><span class="line">		entity[i].footPoint.X = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x28</span>);</span><br><span class="line">		entity[i].footPoint.Y = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x2C</span>);</span><br><span class="line">		entity[i].footPoint.Z = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x30</span>);</span><br><span class="line">		entity[i].headPoint.X = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x4</span>);</span><br><span class="line">		entity[i].headPoint.Y = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0x8</span>);</span><br><span class="line">		entity[i].headPoint.Z = *(FLOAT*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0xC</span>);</span><br><span class="line">		entity[i].isFriend = <span class="number">0</span>;</span><br><span class="line">		entity[i].hp = *(DWORD*)(*(DWORD*)(entityBase + <span class="number">0x4</span> * i) + <span class="number">0xEC</span>);</span><br><span class="line">		<span class="keyword">if</span> (entity[i].hp&lt;=<span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			entity[i].isDeath = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			entity[i].isDeath = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//吃鸡模拟器遍历</span></span><br><span class="line">DWORD64 worldAddress = (DWORD64)GetModuleHandleA(<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>) + <span class="number">0x2AF0FB8</span>;</span><br><span class="line">DWORD64 humanVirtualTableFlag = (DWORD64)GetModuleHandleA(<span class="string">&quot;BattleRoyaleTrainer-Win64-Shipping.exe&quot;</span>) + <span class="number">0x1D45740</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">EntityAround::flashEntityAround_chijimoniqi</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	__try</span><br><span class="line">	&#123;</span><br><span class="line">		DWORD worldCount = *(DWORD*)(*(DWORD64*)(*(DWORD64*)worldAddress + <span class="number">0x30</span>) + <span class="number">0xB8</span>);</span><br><span class="line">		DWORD64 worldArrayAddr = *(DWORD64*)(*(DWORD64*)(*(DWORD64*)worldAddress + <span class="number">0x30</span>) + <span class="number">0xB0</span>);</span><br><span class="line">		<span class="comment">//myOutPutDebug(&quot;世界数组: %x  %llx&quot;, worldCount, worldArrayAddr);</span></span><br><span class="line">		<span class="type">int</span> realNo = <span class="number">0</span>;<span class="comment">//真实的对象数量</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (<span class="type">int</span>)worldCount; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			DWORD64 object = *(DWORD64*)(worldArrayAddr + i * <span class="number">8</span>);</span><br><span class="line">			<span class="keyword">if</span> (IsBadReadPtr((DWORD64*)object,<span class="number">8</span>))<span class="comment">//排除不可以访问的指针</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (*(DWORD64*)object!= humanVirtualTableFlag )<span class="comment">//不符合人物特征,同时排除了作废对象</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			entity[realNo].hp = (DWORD)*(FLOAT*)(object + <span class="number">0x7CC</span>);</span><br><span class="line">			<span class="keyword">if</span> (entity[realNo].hp&lt;=<span class="number">0</span>)<span class="comment">//排除死亡人物</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			entity[realNo].footPoint.X = *(FLOAT*)(*(DWORD64*)(object + <span class="number">0x158</span>) + <span class="number">0x190</span>);</span><br><span class="line">			entity[realNo].footPoint.Y = *(FLOAT*)(*(DWORD64*)(object + <span class="number">0x158</span>) + <span class="number">0x194</span>);</span><br><span class="line">			entity[realNo].footPoint.Z = *(FLOAT*)(*(DWORD64*)(object + <span class="number">0x158</span>) + <span class="number">0x198</span>);</span><br><span class="line">			entity[realNo].isFriend = <span class="number">0</span>;</span><br><span class="line">			entity[realNo].isDeath = <span class="number">0</span>;<span class="comment">//只有未死亡的才记录了,所以默认都是未死亡</span></span><br><span class="line">			realNo++;</span><br><span class="line">		&#125;</span><br><span class="line">		entityNum = realNo;</span><br><span class="line">		myOutPutDebug(<span class="string">&quot;数量:%d&quot;</span>, realNo);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	__except (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		myOutPutDebug(<span class="string">&quot;something wrong1&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">EntityAround::calOrientation</span><span class="params">(Point3D&amp; targetLoc,Orientation&amp; targetAngle,Orientation&amp; angleDiff)</span></span><br><span class="line">&#123;</span><br><span class="line">	FLOAT fov_X = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x195fe58</span>);</span><br><span class="line">	FLOAT fov_Y = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x195fe5c</span>);</span><br><span class="line">	FLOAT fov_Z = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x195fe60</span>);</span><br><span class="line">	FLOAT fov_horizon= *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x19E10C8</span>);</span><br><span class="line">	FLOAT fov_vertical = *(FLOAT*)((DWORD)GetModuleHandleA(<span class="string">&quot;hl.exe&quot;</span>) + <span class="number">0x19E10C4</span>);</span><br><span class="line">	<span class="comment">//水平朝向确定</span></span><br><span class="line">	<span class="keyword">if</span> (targetLoc.X &gt;= fov_X&amp;&amp;targetLoc.Y &gt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第一象限</span></span><br><span class="line">		targetAngle.horizon= radianToAngle(<span class="built_in">atan2</span>(targetLoc.Y - fov_Y, targetLoc.X - fov_X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (targetLoc.X &lt;= fov_X&amp;&amp;targetLoc.Y &gt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第二象限</span></span><br><span class="line">		targetAngle.horizon = <span class="number">180</span>- radianToAngle(<span class="built_in">atan2</span>(targetLoc.Y - fov_Y, fov_X - targetLoc.X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (targetLoc.X &lt;= fov_X&amp;&amp;targetLoc.Y &lt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第三象限</span></span><br><span class="line">		targetAngle.horizon = <span class="number">180</span>+ radianToAngle(<span class="built_in">atan2</span>(fov_Y - targetLoc.Y, fov_X - targetLoc.X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (targetLoc.X &gt;= fov_X&amp;&amp;targetLoc.Y &lt;= fov_Y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//第四象限</span></span><br><span class="line">		targetAngle.horizon = <span class="number">360</span> - radianToAngle(<span class="built_in">atan2</span>(fov_Y - targetLoc.Y, targetLoc.X - fov_X));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//垂直朝向确定</span></span><br><span class="line">	FLOAT distance = <span class="built_in">sqrt</span>((targetLoc.X - fov_X)*(targetLoc.X - fov_X) + (targetLoc.Y - fov_Y)*(targetLoc.Y - fov_Y));</span><br><span class="line">	<span class="keyword">if</span> (targetLoc.Z &gt;= fov_Z)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//上方</span></span><br><span class="line">		targetAngle.vertical = -radianToAngle(<span class="built_in">atan2</span>(targetLoc.Z - fov_Z, distance));<span class="comment">//必须加负数,因为游戏逆向朝上转视角是负数</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//下方</span></span><br><span class="line">		targetAngle.vertical = radianToAngle(<span class="built_in">atan2</span>(fov_Z - targetLoc.Z, distance));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//计算朝向目标头部和自己准星朝向的角度差(顺时针为正,逆时针为负)</span></span><br><span class="line">	angleDiff.horizon = fov_horizon - targetAngle.horizon;</span><br><span class="line">	<span class="keyword">if</span> (angleDiff.horizon&lt;=<span class="number">-180</span>)<span class="comment">//跨0轴的两种情况,防止超出水平转向区间</span></span><br><span class="line">	&#123;</span><br><span class="line">		angleDiff.horizon += <span class="number">360</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (angleDiff.horizon&gt;<span class="number">180</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		angleDiff.horizon -= <span class="number">360</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	angleDiff.vertical = targetAngle.vertical - fov_vertical;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">angleToRadian</span><span class="params">(<span class="type">float</span> angle)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (FLOAT)(angle*PI / <span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">myOutPutDebug</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* pszFormat, ...)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> szbufFormat[<span class="number">0x1000</span>];</span><br><span class="line">	<span class="type">char</span> szbufFormat_Game[<span class="number">0x1100</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	va_list argList;</span><br><span class="line">	va_start(argList, pszFormat);</span><br><span class="line">	vsprintf_s(szbufFormat, pszFormat, argList);</span><br><span class="line">	strcat_s(szbufFormat_Game, <span class="string">&quot;FPS &quot;</span>);<span class="comment">// 加上输出头特征</span></span><br><span class="line">	strcat_s(szbufFormat_Game, szbufFormat);</span><br><span class="line">	OutputDebugStringA(szbufFormat_Game);<span class="comment">// 编码转换</span></span><br><span class="line">	va_end(argList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">radianToAngle</span><span class="params">(<span class="type">float</span> radian)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (FLOAT)(radian * <span class="number">180</span> / PI);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="paint-cpp"><a href="#paint-cpp" class="headerlink" title="paint.cpp"></a>paint.cpp</h2><p><a href="#%E4%B8%8A%E9%9D%A2%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%9B%98%E7%82%B9">回到目录</a>                <a href="#paint.h">跳转到头文件</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;paint.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::getWndInfo</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//获得窗口信息</span></span><br><span class="line">	GetClientRect(m_hWnd,&amp;m_wndRect);</span><br><span class="line">	m_resolutionWidth = m_wndRect.right - m_wndRect.left;</span><br><span class="line">	m_resolutionHeight = m_wndRect.bottom - m_wndRect.top;</span><br><span class="line">	GetWindowRect(m_hWnd, &amp;m_outsideWnd);  <span class="comment">//含有边框及全屏幕坐标</span></span><br><span class="line">	m_outsideWndWidth = m_outsideWnd.right - m_outsideWnd.left;</span><br><span class="line">	m_outsideWndHeight = m_outsideWnd.bottom - m_outsideWnd.top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Paint::Paint(HWND hWnd, DWORD matrixAddr,COLORREF brushColor,COLORREF penColor)</span><br><span class="line">&#123;</span><br><span class="line">	m_hWnd = hWnd;</span><br><span class="line">	m_matrixAddr32 = matrixAddr;</span><br><span class="line">	<span class="keyword">if</span> (matrixAddr!=<span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;m_viewMatrix, (VOID*)m_matrixAddr32, <span class="keyword">sizeof</span>(m_viewMatrix));</span><br><span class="line">	&#125;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	hdc = GetDC(hWnd);</span><br><span class="line">	hBrush = CreateSolidBrush(brushColor);</span><br><span class="line">	hPen = CreatePen(PS_SOLID, <span class="number">1</span>, penColor);</span><br><span class="line">	DeleteObject(SelectObject(hdc,hBrush));</span><br><span class="line">	DeleteObject(SelectObject(hdc, hPen));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Paint::Paint(HWND hWnd, DWORD64 matrixAddr64, COLORREF brushColor, COLORREF penColor)</span><br><span class="line">&#123;</span><br><span class="line">	m_hWnd = hWnd;</span><br><span class="line">	m_matrixAddr64 = matrixAddr64;</span><br><span class="line">	<span class="keyword">if</span> (matrixAddr64 != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;m_viewMatrix, (VOID*)m_matrixAddr64, <span class="keyword">sizeof</span>(m_viewMatrix));</span><br><span class="line">	&#125;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	hdc = GetDC(hWnd);</span><br><span class="line">	hBrush = CreateSolidBrush(brushColor);</span><br><span class="line">	hPen = CreatePen(PS_SOLID, <span class="number">1</span>, penColor);</span><br><span class="line">	DeleteObject(SelectObject(hdc, hBrush)) ;<span class="comment">//删除原来的句柄</span></span><br><span class="line">	DeleteObject(SelectObject(hdc, hPen));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Paint::Paint()</span><br><span class="line">&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Paint::~Paint()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (hdc)</span><br><span class="line">	&#123;</span><br><span class="line">		ReleaseDC(m_hWnd,hdc);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (hBrush)</span><br><span class="line">	&#123;</span><br><span class="line">		DeleteObject(hBrush);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (hPen)</span><br><span class="line">	&#123;</span><br><span class="line">		DeleteObject(hPen);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">Paint::worldPointToScreenPointWithoutMatrix</span><span class="params">(Point2D &amp; screenPoint, <span class="type">const</span> Orientation&amp; angleDiff)</span></span><br><span class="line">&#123;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	<span class="comment">//最大</span></span><br><span class="line">	<span class="type">float</span> maxVerticalViewAngle = radianToAngle(<span class="built_in">atan2</span>(m_resolutionHeight, m_resolutionWidth));</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(angleDiff.horizon) &gt; <span class="number">45</span> || <span class="built_in">fabs</span>(angleDiff.vertical) &gt; maxVerticalViewAngle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//不在屏幕范围内</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> horizonDiff = (<span class="type">int</span>)(<span class="built_in">tan</span>(angleToRadian(angleDiff.horizon))*((m_resolutionWidth) / <span class="number">2</span>));</span><br><span class="line">	screenPoint.X = (<span class="type">float</span>)(m_resolutionWidth / <span class="number">2</span> + horizonDiff);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> verticalDiff = (<span class="type">int</span>)(<span class="built_in">tan</span>(angleToRadian(angleDiff.vertical))*((m_resolutionWidth) / <span class="number">2</span>));</span><br><span class="line">	screenPoint.Y = (<span class="type">float</span>)(m_resolutionHeight / <span class="number">2</span> + verticalDiff);</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::changeBrush</span><span class="params">(COLORREF brushColor)</span></span><br><span class="line">&#123;</span><br><span class="line">	hBrush = CreateSolidBrush(brushColor);</span><br><span class="line">	<span class="keyword">if</span> (hdc&amp;&amp;hBrush)</span><br><span class="line">	&#123;</span><br><span class="line">		DeleteObject(SelectObject(hdc, hBrush));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::changePen</span><span class="params">(<span class="type">int</span> penStyle, <span class="type">int</span> penWidth, COLORREF penColor)</span></span><br><span class="line">&#123;</span><br><span class="line">	hPen = CreatePen(penStyle, penWidth, penColor);</span><br><span class="line">	<span class="keyword">if</span> (hdc&amp;&amp;hPen)</span><br><span class="line">	&#123;</span><br><span class="line">		DeleteObject(SelectObject(hdc, hPen) );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> Paint::世界坐标转屏幕坐标_非矩阵(Point2D&amp; 屏幕坐标, FLOAT  水平角度差, FLOAT 高低角度差)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	getWndInfo();</span><br><span class="line">	FLOAT 高低可视角度 = (FLOAT)((<span class="type">double</span>)<span class="built_in">atan2</span>(m_resolutionHeight, m_resolutionWidth) * <span class="number">180</span> / <span class="number">3.1415</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">fabs</span>(水平角度差) &gt; <span class="number">45</span> || <span class="built_in">fabs</span>(高低角度差) &gt; 高低可视角度)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">// 不在屏幕范围内</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> 水平差 = (<span class="type">int</span>)(<span class="built_in">tan</span>(水平角度差 * <span class="number">3.1416</span> / <span class="number">180</span>) * ((m_resolutionWidth) / <span class="number">2</span>));</span><br><span class="line">	屏幕坐标.X = (<span class="type">float</span>)(m_resolutionHeight / <span class="number">2</span> + 水平差);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> 高度差 = (<span class="type">int</span>)(<span class="built_in">tan</span>(高低角度差 * <span class="number">3.1416</span> / <span class="number">180</span>) * ((m_resolutionWidth) / <span class="number">2</span>));</span><br><span class="line">	屏幕坐标.Y = (<span class="type">float</span>)(m_resolutionHeight / <span class="number">2</span> + 高度差);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">Paint::worldPointToScreenPoint</span><span class="params">(Point2D &amp; screenPoint,<span class="type">const</span> Point3D&amp; targetWorldPoint)</span></span><br><span class="line">&#123;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	<span class="comment">//刷新矩阵</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;m_viewMatrix, (PVOID)m_matrixAddr32, <span class="keyword">sizeof</span>(m_viewMatrix));</span><br><span class="line">	Vector4 worldLocation = &#123; targetWorldPoint.X,targetWorldPoint.Y,targetWorldPoint.Z,<span class="number">1</span>&#125;;<span class="comment">//世界坐标</span></span><br><span class="line">	<span class="comment">//世界坐标配合矩阵算出裁剪坐标(目前只考虑了列主序,还需要考虑行主序的情况)</span></span><br><span class="line">	Vector4 cutLocation= RowVecTimesMatrix(worldLocation, m_viewMatrix);</span><br><span class="line">	<span class="keyword">if</span> (cutLocation.w&lt;<span class="number">0.0</span>)<span class="comment">//剪辑坐标w如果小于0,表示在屏幕外</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Point2D NDC;<span class="comment">//ndc坐标</span></span><br><span class="line">	NDC.X = cutLocation.x / cutLocation.w;</span><br><span class="line">	NDC.Y = cutLocation.y / cutLocation.w;</span><br><span class="line">	screenPoint.X = (NDC.X*m_resolutionWidth + m_resolutionWidth) / <span class="number">2</span>;</span><br><span class="line">	screenPoint.Y = (m_resolutionHeight - m_resolutionHeight*NDC.Y) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">Paint::worldPointToScreenPoint64</span><span class="params">(Point2D &amp; screenPoint, <span class="type">const</span> Point3D&amp; targetWorldPoint)</span></span><br><span class="line">&#123;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	<span class="comment">//刷新矩阵</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;m_viewMatrix, (DWORD64*)m_matrixAddr64, <span class="keyword">sizeof</span>(m_viewMatrix));</span><br><span class="line">	Vector4 worldLocation = &#123; targetWorldPoint.X,targetWorldPoint.Y,targetWorldPoint.Z,<span class="number">1</span> &#125;;<span class="comment">//世界坐标</span></span><br><span class="line">																						   <span class="comment">//世界坐标配合矩阵算出裁剪坐标(目前只考虑了列主序,还需要考虑行主序的情况)</span></span><br><span class="line">	Vector4 cutLocation = RowVecTimesMatrix(worldLocation, m_viewMatrix);</span><br><span class="line">	<span class="keyword">if</span> (cutLocation.w &lt; <span class="number">0.0f</span>)<span class="comment">//剪辑坐标w如果小于0,表示在屏幕外</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Point2D NDC;<span class="comment">//ndc坐标</span></span><br><span class="line">	NDC.X = cutLocation.x / cutLocation.w;</span><br><span class="line">	NDC.Y = cutLocation.y / cutLocation.w;</span><br><span class="line">	screenPoint.X = (NDC.X*m_resolutionWidth + m_resolutionWidth) / <span class="number">2</span>;</span><br><span class="line">	screenPoint.Y = (m_resolutionHeight - m_resolutionHeight*NDC.Y) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::paintLine</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">	getWndInfo();</span><br><span class="line">	<span class="comment">//从屏幕下方中间点开始画</span></span><br><span class="line">	MoveToEx(hdc, m_resolutionWidth / <span class="number">2</span>, m_resolutionHeight, <span class="number">0</span>);</span><br><span class="line">	LineTo(hdc, x, y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::paintLine</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> xTo, <span class="type">int</span> yTo)</span></span><br><span class="line">&#123;</span><br><span class="line">	MoveToEx(hdc,x, y, <span class="number">0</span>);</span><br><span class="line">	LineTo(hdc, xTo, yTo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::paintFrame</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> w,<span class="type">int</span> h,<span class="type">int</span> thick)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//顶边</span></span><br><span class="line">	paintRect(x, y, w, thick);</span><br><span class="line">	<span class="comment">//左边</span></span><br><span class="line">	paintRect(x, y+thick, thick, h-thick);</span><br><span class="line">	<span class="comment">//右边</span></span><br><span class="line">	paintRect(x+w-thick, y+thick, thick, h-thick);</span><br><span class="line">	<span class="comment">//底边</span></span><br><span class="line">	paintRect(x+thick, y+h-thick, w<span class="number">-2</span>*thick, thick);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::paintFrameByFootAndHead</span><span class="params">(Point2D footPoiny, Point2D headPoint, <span class="type">int</span> thick)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">float</span> head = headPoint.Y - footPoiny.Y;	<span class="comment">//负数高度</span></span><br><span class="line">	<span class="type">float</span> width = head / <span class="number">2</span>;	<span class="comment">//负数宽度</span></span><br><span class="line">	<span class="type">float</span> center = width / <span class="number">-2</span>;	<span class="comment">//一半宽度</span></span><br><span class="line">	<span class="type">float</span> extra = head / <span class="number">-6</span>;	<span class="comment">//三分之一宽度</span></span><br><span class="line">	paintFrame((<span class="type">int</span>)(footPoiny.X + center), (<span class="type">int</span>)footPoiny.Y, (<span class="type">int</span>)width, (<span class="type">int</span>)(head - extra), thick);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::paintRect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, <span class="type">int</span> h)</span></span><br><span class="line">&#123;</span><br><span class="line">	RECT rect = &#123; x,y,x + w,y + h &#125;;</span><br><span class="line">	FillRect(hdc, &amp;rect, hBrush);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Paint::paintText</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, COLORREF color, <span class="type">const</span> <span class="type">char</span> * text)</span></span><br><span class="line">&#123;</span><br><span class="line">	SetTextAlign(hdc, TA_CENTER | TA_NOUPDATECP);</span><br><span class="line">	SetBkColor(hdc, RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	SetBkMode(hdc, TRANSPARENT);</span><br><span class="line">	SetTextColor(hdc, color);</span><br><span class="line">	DeleteObject(SelectObject(hdc, hfont));<span class="comment">//删除原来的字体句柄</span></span><br><span class="line">	TextOutA(hdc, x, y, text, <span class="built_in">strlen</span>(text));</span><br><span class="line">	DeleteObject(hfont);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Vector4 <span class="title function_">RowVecTimesMatrix</span><span class="params">(<span class="type">const</span> Vector4&amp; rowVec, <span class="type">float</span> matrix[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	Vector4 retVec;</span><br><span class="line">	retVec.x = rowVec.x*matrix[<span class="number">0</span>] + rowVec.y*matrix[<span class="number">4</span>] + rowVec.z*matrix[<span class="number">8</span>] + rowVec.w*matrix[<span class="number">12</span>];</span><br><span class="line">	retVec.y = rowVec.x*matrix[<span class="number">1</span>] + rowVec.y*matrix[<span class="number">5</span>] + rowVec.z*matrix[<span class="number">9</span>] + rowVec.w*matrix[<span class="number">13</span>];</span><br><span class="line">	retVec.z = rowVec.x*matrix[<span class="number">2</span>] + rowVec.y*matrix[<span class="number">6</span>] + rowVec.z*matrix[<span class="number">10</span>] + rowVec.w*matrix[<span class="number">14</span>];</span><br><span class="line">	retVec.w = rowVec.x*matrix[<span class="number">3</span>] + rowVec.y*matrix[<span class="number">7</span>] + rowVec.z*matrix[<span class="number">11</span>] + rowVec.w*matrix[<span class="number">15</span>];</span><br><span class="line">	<span class="keyword">return</span> retVec;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Unity逆向"><a href="#Unity逆向" class="headerlink" title="Unity逆向"></a>Unity逆向</h1><p>Unity一切基于GameObjects对象,他们可以有各种属性(unity中叫做components组件),有像transform的属性,其包含位置,旋转和比例等这样的数据.</p>
<p>unity的脚本由C#编写,建立在方法中,写在不同的类中以继承MonoBehaviour方法.</p>
<p>其中一些方法如下:</p>
<ul>
<li><code>void Start()</code>  这个方法只被调用一次</li>
<li><code>void Update()</code> 这份方法每一个tick被调用一次</li>
<li><code>void FixedUpdate()</code>  这个方法每一帧被调用一次</li>
<li><code>void OnGUI()</code>  这是绘制方法</li>
</ul>
<p>Unity的文件结构</p>
<p>Unity中所有的脚本被编译为两个DLLs,他们被称为 <code>Assembly-CSharp</code> 和 <code>Assembly-CSharp-firstpass</code>,他们在 <code>Gamename_Date-&gt;Managed</code> 文件夹中,其他的dll在文件夹中是引擎代码,和其他系统代码</p>
<h2 id="Unity找数据特殊技巧"><a href="#Unity找数据特殊技巧" class="headerlink" title="Unity找数据特殊技巧:"></a>Unity找数据特殊技巧:</h2><p>C#语言编译出来的dll中的语言实际上是IL(.NET框架中的中间语言),该语言的文件可以跨平台运行于<strong>mono</strong>虚拟机.<strong>dnspy</strong>可以将IL语言写的文件基本完美反编译出C#源代码.而<strong>il2cpp</strong>的职责是把IL语言的文件转换为原生的系统二进制文件.</p>
<p>如何区分unity游戏是采用il2cpp技术还是不采用il2cpp技术</p>
<ul>
<li>exe文件同目录下有GameAssembly.dll的一般为采用了il2cpp技术(Metadata文件夹所在目录没有什么dll),但可以进行加密隐藏该文件,参考原神</li>
<li>exe所在目录进入xxxData文件夹中的子目录中有个Metadata文件夹所在目录有一大堆dll文件(此时exe文件同目录下没有GameAssembly.dll)即为未采用il2cpp</li>
</ul>
<p>il2cpp机制将C#中所有类型信息保存到global-metadata.dat的文件,通过解析global-metadata文件,可以获得C#代码中的类型,方法,字段等等信息</p>
<p>unity游戏偏移层级比较多,因此最优先的方法就是hook,在找到人物的基本属性(一般找血量)后找到赋值的汇编段inline hook取对象地址即可,这是最方便的做法</p>
<p>下面是不用hook的前提下快速找到数组:</p>
<ul>
<li>数组和人数一般满足一定的偏移关系(不绝对)</li>
<li>而且unity可以直接找到人物的数组,没有其他对象干扰(找其他物品外部的方式似乎是通过找GameObjectManager).因此完全可以<strong>从人数入手</strong>.</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//二者关系如下:</span></span><br><span class="line"><span class="number">0</span>x********+<span class="number">0</span>x??为人数地址</span><br><span class="line"><span class="number">0</span>x********]+<span class="number">0x10</span>+<span class="number">0x4</span>*i为数组</span><br><span class="line"><span class="comment">//0x??在32位中大多数情况是0xC,64位大多数情况是0x18</span></span><br></pre></td></tr></table></figure>









<h2 id="逃离塔科夫逆向"><a href="#逃离塔科夫逆向" class="headerlink" title="逃离塔科夫逆向"></a>逃离塔科夫逆向</h2><p>**[1]**先追人物坐标</p>
<p>经过一个逆向注意点:下图这样的lea一个堆栈地址的情况,要如下图这么处理</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202204171641184.jpeg" alt="逆向注意点"></p>
<p>未能最后,但追到下面的偏移:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[[[[[rcx+<span class="number">40</span>]+<span class="number">20</span>]+<span class="number">10</span>]+<span class="number">10</span>]+<span class="number">38</span>]+<span class="number">18</span>]    <span class="comment">//角色坐标X地址</span></span><br></pre></td></tr></table></figure>

<p>**[2]**追骨骼</p>
<p>中途会遇到F2会崩溃的情况,此时只能使用硬件访问数据断点来断</p>
<p>放开断点前先跟踪往上追的内存,放开断点的时候,如果发现内存中的值骤变了,说明他是个临时的值,这时候,可以用CE搜的方式往上找</p>
<h1 id="绘制相关"><a href="#绘制相关" class="headerlink" title="绘制相关"></a>绘制相关</h1><p>除了注入后的dll进行gdi绘制外,还有如下绘制方法</p>
<h2 id="openGl和D3D绘制"><a href="#openGl和D3D绘制" class="headerlink" title="openGl和D3D绘制"></a>openGl和D3D绘制</h2><p>简单粗暴,但容易被检测</p>
<h3 id="opengl"><a href="#opengl" class="headerlink" title="opengl"></a>opengl</h3><p>glBegin  开始渲染函数     一个参数 0 - 9  0是画一个点,1画线等等…</p>
<p>glDisable 关闭渲染函数     一个参数</p>
<p>hook  glbegin函数,在hook中利用glDisable函数关闭我们不想让他显示的渲染</p>
<p>检测方面主要是 “CRC的对抗”</p>
<h2 id="自建窗口外部绘制"><a href="#自建窗口外部绘制" class="headerlink" title="自建窗口外部绘制"></a>自建窗口外部绘制</h2><p>反外挂最艰难的一种绘制方法</p>
<p>优点:不闪烁,检测难度大了</p>
<ol>
<li>创建一个透明窗口</li>
<li>同步分辨率</li>
<li>透明窗口跟随游戏移动</li>
<li>置顶透明窗口</li>
<li>自己的窗口上画框</li>
</ol>
<p>框架代码参考 <code>/Desktop/FPS/csDLL</code></p>
<p>窗口特征枚举检测,截图检测( 可以使用<code>SetWindowDisplayAffinity</code>防止自己的外部窗口被截图)</p>
<h3 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h3><p>配置:</p>
<ul>
<li>属性-VC++目录-包含目录:选中D3D9库根目录DirectSDK下的include文件夹</li>
<li>属性-VC++目录-引用目录:选中D3D9库根目录DirectSDK下的<code>Lib\x86</code>或<code>Lib\x64</code>文件夹</li>
<li>属性-VC++目录-库目录:选中D3D9库根目录DirectSDK下的<code>Lib\x86</code>或<code>Lib\x64</code>文件夹</li>
</ul>
<h4 id="预编译-h"><a href="#预编译-h" class="headerlink" title="预编译.h"></a>预编译.h</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;d3d9.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;d3dx9.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;d3d9.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;d3dx9.lib&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dwmapi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;dwmapi.lib&quot;</span>)</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br></pre></td></tr></table></figure>

<h4 id="D3D绘制-h"><a href="#D3D绘制-h" class="headerlink" title="D3D绘制.h"></a>D3D绘制.h</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;预编译.h&quot;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">D3D相关的一些东西</span></span><br><span class="line"><span class="comment">如果不想用static变量用全局变量的话，千万别再头文件声明，在cpp文件声明后</span></span><br><span class="line"><span class="comment">再在头文件extern 类型名 变量名</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> MARGINS Margin;</span><br><span class="line"><span class="type">static</span> LPDIRECT3D9              g_pD3D = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">static</span> LPDIRECT3DDEVICE9        g_pd3dDevice = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">static</span> D3DPRESENT_PARAMETERS    g_d3dpp = &#123;&#125;;</span><br><span class="line"><span class="type">static</span> ID3DXLine* pLine = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> ID3DXFont* Font;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> HWND 辅助窗口句柄, GameHwnd;</span><br><span class="line"><span class="type">static</span> RECT 窗口矩形;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> 窗口宽, 窗口高;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//注册窗口需要用到的窗口类</span></span><br><span class="line"><span class="type">static</span> WNDCLASSEX wClass;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//画矩形，文字之类的单独放在这个函数里</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span><span class="params">(*Draw)</span><span class="params">()</span>;</span><br><span class="line"><span class="type">static</span> Draw Render;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//窗口消息处理函数</span></span><br><span class="line">LRESULT <span class="title function_">WinProc</span><span class="params">(HWND hWnd, UINT Message, WPARAM wParam, LPARAM lParam)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> 初始化D3D();</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 创建透明窗口(HWND 游戏窗口句柄, Draw 绘制函数);</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 窗口消息循环();</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 画线(D3DCOLOR Color, <span class="type">float</span> X1, <span class="type">float</span> Y1, <span class="type">float</span> X2, <span class="type">float</span> Y2, <span class="type">float</span> Width);</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 绘制文字(<span class="type">float</span> X, <span class="type">float</span> Y, <span class="type">const</span> <span class="type">char</span>* Str, D3DCOLOR Color);</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 画框(<span class="type">float</span> X, <span class="type">float</span> Y, <span class="type">float</span> W, <span class="type">float</span> H, <span class="type">float</span> Width, D3DCOLOR Color);</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 绘制开始();</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 绘制结束();</span><br></pre></td></tr></table></figure>

<h4 id="D3D绘制-cpp"><a href="#D3D绘制-cpp" class="headerlink" title="D3D绘制.cpp"></a>D3D绘制.cpp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;D3D绘制.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">bool</span> 初始化D3D()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> ((g_pD3D = Direct3DCreate9(D3D_SDK_VERSION)) == <span class="literal">NULL</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">// 创建D3D设备</span></span><br><span class="line">	ZeroMemory(&amp;g_d3dpp, <span class="keyword">sizeof</span>(g_d3dpp));</span><br><span class="line">	g_d3dpp.Windowed = TRUE;</span><br><span class="line">	g_d3dpp.SwapEffect = D3DSWAPEFFECT_DISCARD;</span><br><span class="line">	g_d3dpp.BackBufferFormat = D3DFMT_UNKNOWN;</span><br><span class="line">	g_d3dpp.EnableAutoDepthStencil = TRUE;</span><br><span class="line">	g_d3dpp.AutoDepthStencilFormat = D3DFMT_D16;</span><br><span class="line">	g_d3dpp.PresentationInterval = D3DPRESENT_INTERVAL_ONE;</span><br><span class="line">	<span class="keyword">if</span> (g_pD3D-&gt;CreateDevice(D3DADAPTER_DEFAULT, D3DDEVTYPE_HAL, 辅助窗口句柄, D3DCREATE_HARDWARE_VERTEXPROCESSING, &amp;g_d3dpp, &amp;g_pd3dDevice) &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">if</span> (pLine == <span class="literal">NULL</span>)</span><br><span class="line">		D3DXCreateLine(g_pd3dDevice, &amp;pLine);</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//创建D3D字体</span></span><br><span class="line">	D3DXCreateFontW(g_pd3dDevice, <span class="number">16</span>, <span class="number">0</span>, FW_DONTCARE, D3DX_DEFAULT, FALSE, DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, DEFAULT_QUALITY, FF_DONTCARE, <span class="string">L&quot;Vernada&quot;</span>, &amp;Font);</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 创建透明窗口(HWND 游戏窗口句柄, Draw 绘制函数)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (绘制函数 == <span class="literal">NULL</span> || 游戏窗口句柄 == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line">	GameHwnd = 游戏窗口句柄;</span><br><span class="line">	Render = 绘制函数;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//初始化窗口类</span></span><br><span class="line">	wClass.cbClsExtra = <span class="literal">NULL</span>;</span><br><span class="line">	wClass.cbSize = <span class="keyword">sizeof</span>(WNDCLASSEX);</span><br><span class="line">	wClass.cbWndExtra = <span class="literal">NULL</span>;</span><br><span class="line">	wClass.hbrBackground = (HBRUSH)CreateSolidBrush(RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">	wClass.hCursor = LoadCursor(<span class="number">0</span>, IDC_ARROW);</span><br><span class="line">	wClass.hIcon = LoadIcon(<span class="number">0</span>, IDI_APPLICATION);</span><br><span class="line">	wClass.hIconSm = LoadIcon(<span class="number">0</span>, IDI_APPLICATION);</span><br><span class="line">	wClass.hInstance = GetModuleHandle(<span class="literal">NULL</span>);</span><br><span class="line">	wClass.lpfnWndProc = (WNDPROC)WinProc;</span><br><span class="line">	wClass.lpszClassName = <span class="string">L&quot; &quot;</span>;</span><br><span class="line">	wClass.lpszMenuName = <span class="string">L&quot; &quot;</span>;</span><br><span class="line">	wClass.style = CS_VREDRAW | CS_HREDRAW;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//注册窗口</span></span><br><span class="line">	<span class="keyword">if</span> (RegisterClassEx(&amp;wClass) == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(<span class="literal">NULL</span>, <span class="string">L&quot;创建窗口出错！&quot;</span>, <span class="string">L&quot;提示！&quot;</span>, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//创建窗口</span></span><br><span class="line">	GetWindowRect(GameHwnd, &amp;窗口矩形);</span><br><span class="line">	窗口宽 = 窗口矩形.right - 窗口矩形.left;</span><br><span class="line">	窗口高 = 窗口矩形.bottom - 窗口矩形.top;</span><br><span class="line">	辅助窗口句柄 = CreateWindowEx(WS_EX_TOPMOST | WS_EX_TRANSPARENT | WS_EX_LAYERED, <span class="string">L&quot; &quot;</span>, <span class="string">L&quot; &quot;</span>, WS_POPUP, <span class="number">1</span>, <span class="number">1</span>, 窗口宽, 窗口高, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//显示窗口</span></span><br><span class="line">	SetLayeredWindowAttributes(辅助窗口句柄, <span class="number">0</span>, RGB(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), LWA_COLORKEY);</span><br><span class="line">	ShowWindow(辅助窗口句柄, SW_SHOW);</span><br><span class="line"> </span><br><span class="line">	初始化D3D();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 窗口消息循环()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//使辅助窗口一直盖在游戏窗口上</span></span><br><span class="line">		<span class="keyword">if</span> (GameHwnd)</span><br><span class="line">		&#123;</span><br><span class="line">			GetWindowRect(GameHwnd, &amp;窗口矩形);</span><br><span class="line">			窗口宽 = 窗口矩形.right - 窗口矩形.left;</span><br><span class="line">			窗口高 = 窗口矩形.bottom - 窗口矩形.top;</span><br><span class="line">			DWORD dwStyle = GetWindowLong(GameHwnd, GWL_STYLE);</span><br><span class="line">			<span class="keyword">if</span> (dwStyle &amp; WS_BORDER)</span><br><span class="line">			&#123;</span><br><span class="line">				窗口矩形.top += <span class="number">23</span>;</span><br><span class="line">				窗口高 -= <span class="number">23</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			MoveWindow(辅助窗口句柄, 窗口矩形.left, 窗口矩形.top, 窗口宽, 窗口高, <span class="literal">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="comment">//处理窗口消息</span></span><br><span class="line">		MSG Message;</span><br><span class="line">		ZeroMemory(&amp;Message, <span class="keyword">sizeof</span>(Message));</span><br><span class="line">		<span class="keyword">if</span> (PeekMessage(&amp;Message, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, PM_REMOVE))</span><br><span class="line">		&#123;</span><br><span class="line">			DispatchMessage(&amp;Message);</span><br><span class="line">			TranslateMessage(&amp;Message);</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		Sleep(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">	<span class="keyword">if</span> (g_pd3dDevice) &#123; g_pd3dDevice-&gt;Release(); g_pd3dDevice = <span class="literal">NULL</span>; &#125;</span><br><span class="line">	<span class="keyword">if</span> (g_pD3D) &#123; g_pD3D-&gt;Release(); g_pD3D = <span class="literal">NULL</span>; &#125;</span><br><span class="line">	CloseWindow(辅助窗口句柄);</span><br><span class="line"> </span><br><span class="line">	::UnregisterClass(wClass.lpszClassName, wClass.hInstance);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">LRESULT <span class="title function_">WinProc</span><span class="params">(HWND hWnd, UINT Message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span> (Message)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_PAINT:</span><br><span class="line">		<span class="keyword">if</span>(g_pd3dDevice)Render();<span class="comment">//就是这里调用了我们的画框画线之类的函数</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">case</span> WM_CREATE:</span><br><span class="line">		DwmExtendFrameIntoClientArea(hWnd, &amp;Margin);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">	&#123;</span><br><span class="line">		g_pD3D-&gt;Release();</span><br><span class="line">		g_pd3dDevice-&gt;Release();</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> DefWindowProc(hWnd, Message, wParam, lParam);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 画线(D3DCOLOR Color, <span class="type">float</span> X1, <span class="type">float</span> Y1, <span class="type">float</span> X2, <span class="type">float</span> Y2, <span class="type">float</span> Width)</span><br><span class="line">&#123;</span><br><span class="line">	D3DXVECTOR2 Vertex[<span class="number">2</span>] = &#123; &#123;X1,Y1&#125;,&#123;X2,Y2&#125; &#125;;</span><br><span class="line">	pLine-&gt;SetWidth(Width);</span><br><span class="line">	pLine-&gt;Draw(Vertex, <span class="number">2</span>, Color);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 绘制文字(<span class="type">float</span> X, <span class="type">float</span> Y, <span class="type">const</span> <span class="type">char</span>* Str, D3DCOLOR Color)</span><br><span class="line">&#123;</span><br><span class="line">	RECT Rect = &#123; (LONG)X,(LONG)Y &#125;;</span><br><span class="line">	Font-&gt;DrawTextA(<span class="literal">NULL</span>, Str, <span class="number">-1</span>, &amp;Rect, DT_CALCRECT, Color);</span><br><span class="line">	Font-&gt;DrawTextA(<span class="literal">NULL</span>, Str, <span class="number">-1</span>, &amp;Rect, DT_LEFT, Color);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 画框(<span class="type">float</span> X, <span class="type">float</span> Y, <span class="type">float</span> W, <span class="type">float</span> H, <span class="type">float</span> Width, D3DCOLOR Color)</span><br><span class="line">&#123;</span><br><span class="line">	D3DXVECTOR2 Vertex[<span class="number">5</span>] = &#123; &#123;X,Y&#125;,&#123;X + W,Y&#125;,&#123;X + W,Y + H&#125;,&#123;X,Y + H&#125;,&#123;X,Y&#125; &#125;;</span><br><span class="line">	pLine-&gt;SetWidth(Width);</span><br><span class="line">	pLine-&gt;Draw(Vertex, <span class="number">5</span>, Color);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 绘制开始()</span><br><span class="line">&#123;</span><br><span class="line">	g_pd3dDevice-&gt;Clear(<span class="number">0</span>, <span class="number">0</span>, D3DCLEAR_TARGET, <span class="number">0</span>, <span class="number">1.0f</span>, <span class="number">0</span>);</span><br><span class="line">	g_pd3dDevice-&gt;BeginScene();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 绘制结束()</span><br><span class="line">&#123;</span><br><span class="line">	g_pd3dDevice-&gt;EndScene();</span><br><span class="line">	g_pd3dDevice-&gt;Present(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="调用例子"><a href="#调用例子" class="headerlink" title="调用例子"></a>调用例子</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;D3D绘制.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> 线粗 = <span class="number">2</span>;</span><br><span class="line">D3DCOLOR 红色 = D3DCOLOR_ARGB(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> 绘制()</span><br><span class="line">&#123;</span><br><span class="line">	绘制开始();</span><br><span class="line">	画线(D3DCOLOR_ARGB(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">20</span>, <span class="number">20</span>, <span class="number">66</span>, <span class="number">66</span>,线粗);</span><br><span class="line">	画框(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, 线粗, D3DCOLOR_ARGB(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>));</span><br><span class="line">	绘制文字(<span class="number">200</span>, <span class="number">200</span>, <span class="string">&quot;吾无法无天&quot;</span>, D3DCOLOR_ARGB(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>));</span><br><span class="line">	绘制结束();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">HWND 游戏窗口 = (HWND)<span class="number">0x50A00</span>;</span><br><span class="line"><span class="type">void</span> 开始()</span><br><span class="line">&#123;</span><br><span class="line">	创建透明窗口(游戏窗口, 绘制);</span><br><span class="line">	窗口消息循环();</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, (LPTHREAD_START_ROUTINE)开始, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;输入233关闭:&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		<span class="type">int</span> a=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; a;</span><br><span class="line">		<span class="keyword">if</span> (a == <span class="number">233</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="GDI泄露"><a href="#GDI泄露" class="headerlink" title="GDI泄露"></a>GDI泄露</h2><p><strong>[注意点]:  Create出来的GDI对象，都要用DeleteObject来释放；Create出来的DC，都要用DeleteDC来释放，GetDC得出的DC,要用ReleaseDC来释放。</strong></p>
<p>getDC每次获取到的都不一样,我理解成开了个拷贝.因此即使是getDC(同一个窗口句柄) 多次,也要每一个getDC对应一个releaseDC才能防止gdi对象泄露</p>
<h2 id="双缓冲"><a href="#双缓冲" class="headerlink" title="双缓冲"></a><strong>双缓冲</strong></h2><p>闪烁的原因是清除画布后，绘制的时间较长导致出现闪烁的现象</p>
<blockquote>
<p>双缓冲使用内容缓冲来解决与多个画图操作相关的闪烁问题。 启用双缓冲后，所有画图操作会首先呈现到内存缓冲而不是屏幕上的绘图图面。 所有画图操作完成后，内存缓冲会直接复制到与之关联的绘图图面。 由于屏幕上仅执行一个图形操作，因此与复杂画图操作相关的图像闪烁可得以消除</p>
</blockquote>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"></a><div class="post-copyright__author_name">ZEROKO14</div><div class="post-copyright__author_desc">zeroko14's blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://che77a38.github.io/posts/FPS%E9%80%86%E5%90%91%E9%9A%8F%E7%AC%94/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://che77a38.github.io/posts/FPS%E9%80%86%E5%90%91%E9%9A%8F%E7%AC%94/')">FPS逆向</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://che77a38.github.io/posts/FPS%E9%80%86%E5%90%91%E9%9A%8F%E7%AC%94/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=FPS逆向&amp;url=https://che77a38.github.io/posts/FPS%E9%80%86%E5%90%91%E9%9A%8F%E7%AC%94/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://che77a38.github.io" target="_blank">ZEROKO14的个人博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/FPS/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>FPS<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">进程与线程</div></div></a></div><div class="next-post pull-right"><a href="/posts/64%E4%BD%8D%E9%80%86%E5%90%91/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">64位逆向</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">欢迎来到ZEROKO14的个人博客</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ZEROKO14</h1><div class="author-info__desc">zeroko14's blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/che77a38" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">相关基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%92%E5%BA%A6%E8%AE%A1%E7%AE%97"><span class="toc-number">1.1.</span> <span class="toc-text">角度计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%86%99%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">快捷键写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">绘制的三种方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E7%BB%B4%E5%9D%90%E6%A0%87%E8%BD%AC%E5%B1%8F%E5%B9%95%E7%AE%97%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">3维坐标转屏幕算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9F%A9%E9%98%B5"><span class="toc-number">2.1.</span> <span class="toc-text">不需要矩阵</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.1.1.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E6%88%AA%E5%8F%96"><span class="toc-number">2.1.2.</span> <span class="toc-text">相关代码截取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E8%A6%81%E7%9F%A9%E9%98%B5"><span class="toc-number">2.2.</span> <span class="toc-text">需要矩阵</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E5%92%8C%E4%BD%8D%E7%A7%BB%E7%9F%A9%E9%98%B5"><span class="toc-number">2.2.1.</span> <span class="toc-text">缩放和位移矩阵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5"><span class="toc-number">2.2.2.</span> <span class="toc-text">旋转矩阵</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95z%E8%BD%B4%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">绕z轴旋转矩阵</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95x%E8%BD%B4%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">绕x轴旋转矩阵</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95y%E8%BD%B4%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">绕y轴旋转矩阵</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.3.</span> <span class="toc-text">矩阵变换总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E7%9F%A9%E9%98%B5%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.4.</span> <span class="toc-text">找矩阵总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%B1%8F%E5%B9%95%E5%9D%90%E6%A0%87"><span class="toc-number">2.2.5.</span> <span class="toc-text">世界坐标转换为屏幕坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%E6%88%AA%E5%8F%96-1"><span class="toc-number">2.2.6.</span> <span class="toc-text">相关代码截取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%9D%E5%90%91%EF%BC%88%E5%87%86%E6%98%9F%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">朝向（准星）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E8%A1%A5%E5%85%85"><span class="toc-number">3.</span> <span class="toc-text">矩阵补充</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CE%E6%89%BE%E6%95%B0%E6%8D%AE%E6%8A%80%E5%B7%A7"><span class="toc-number">4.</span> <span class="toc-text">CE找数据技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#dbg%E9%85%8D%E5%90%88ce%E6%89%BE%E4%B8%8B%E5%B1%9E%E5%81%8F%E7%A7%BB%E7%9A%84%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7"><span class="toc-number">4.1.</span> <span class="toc-text">dbg配合ce找下属偏移的高级技巧</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CS1-6%E7%9A%84%E9%80%86%E5%90%91"><span class="toc-number">5.</span> <span class="toc-text">CS1.6的逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">找内存数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E7%9F%A9%E9%98%B5"><span class="toc-number">5.2.</span> <span class="toc-text">找矩阵</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%A3%E8%A2%8B%E8%A5%BF%E6%B8%B8%E9%80%86%E5%90%91"><span class="toc-number">6.</span> <span class="toc-text">口袋西游逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE"><span class="toc-number">6.1.</span> <span class="toc-text">基本数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E7%9F%A9%E9%98%B5-1"><span class="toc-number">6.2.</span> <span class="toc-text">找矩阵</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%81%E8%A2%AD%E7%9A%84%E9%80%86%E5%90%91"><span class="toc-number">7.</span> <span class="toc-text">突袭的逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE-1"><span class="toc-number">7.1.</span> <span class="toc-text">基本数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E7%9F%A9%E9%98%B5-2"><span class="toc-number">7.2.</span> <span class="toc-text">找矩阵</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UE4%E9%80%86%E5%90%91"><span class="toc-number">8.</span> <span class="toc-text">UE4逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#UE4%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-number">8.1.</span> <span class="toc-text">UE4引擎特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Battle-Royale-Trainer%E9%80%86%E5%90%91"><span class="toc-number">8.2.</span> <span class="toc-text">Battle Royale Trainer逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE-2"><span class="toc-number">8.2.1.</span> <span class="toc-text">基本数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%BE%E4%BA%BA%E7%89%A9%E7%89%B9%E5%BE%81"><span class="toc-number">8.2.1.1.</span> <span class="toc-text">找人物特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E9%99%A4%E5%81%9A%E5%BA%9F%E5%AF%B9%E8%B1%A1"><span class="toc-number">8.2.1.2.</span> <span class="toc-text">排除做废对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E7%89%A9%E5%AD%98%E6%B4%BB%E5%88%A4%E6%96%AD"><span class="toc-number">8.2.1.3.</span> <span class="toc-text">人物存活判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A6%E5%99%A8%E7%9B%B8%E5%85%B3"><span class="toc-number">8.2.1.4.</span> <span class="toc-text">武器相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%A8%E9%AA%BC%E6%95%B0%E6%8D%AE"><span class="toc-number">8.2.1.5.</span> <span class="toc-text">骨骼数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E6%9C%9D%E5%90%91"><span class="toc-number">8.2.2.</span> <span class="toc-text">找朝向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E7%9F%A9%E9%98%B5-3"><span class="toc-number">8.2.3.</span> <span class="toc-text">找矩阵</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8A%E9%9D%A2%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%9B%98%E7%82%B9"><span class="toc-number">9.</span> <span class="toc-text">上面项目代码盘点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#entityAround-h"><span class="toc-number">9.1.</span> <span class="toc-text">entityAround.h</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#paint-h"><span class="toc-number">9.2.</span> <span class="toc-text">paint.h</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stdafx-h"><span class="toc-number">9.3.</span> <span class="toc-text">stdafx.h</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dllmain-cpp"><span class="toc-number">9.4.</span> <span class="toc-text">dllmain.cpp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#entityAround-cpp"><span class="toc-number">9.5.</span> <span class="toc-text">entityAround.cpp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#paint-cpp"><span class="toc-number">9.6.</span> <span class="toc-text">paint.cpp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unity%E9%80%86%E5%90%91"><span class="toc-number">10.</span> <span class="toc-text">Unity逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unity%E6%89%BE%E6%95%B0%E6%8D%AE%E7%89%B9%E6%AE%8A%E6%8A%80%E5%B7%A7"><span class="toc-number">10.1.</span> <span class="toc-text">Unity找数据特殊技巧:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%83%E7%A6%BB%E5%A1%94%E7%A7%91%E5%A4%AB%E9%80%86%E5%90%91"><span class="toc-number">10.2.</span> <span class="toc-text">逃离塔科夫逆向</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E7%9B%B8%E5%85%B3"><span class="toc-number">11.</span> <span class="toc-text">绘制相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#openGl%E5%92%8CD3D%E7%BB%98%E5%88%B6"><span class="toc-number">11.1.</span> <span class="toc-text">openGl和D3D绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#opengl"><span class="toc-number">11.1.1.</span> <span class="toc-text">opengl</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%BB%BA%E7%AA%97%E5%8F%A3%E5%A4%96%E9%83%A8%E7%BB%98%E5%88%B6"><span class="toc-number">11.2.</span> <span class="toc-text">自建窗口外部绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="toc-number">11.2.1.</span> <span class="toc-text">相关代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91-h"><span class="toc-number">11.2.1.1.</span> <span class="toc-text">预编译.h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#D3D%E7%BB%98%E5%88%B6-h"><span class="toc-number">11.2.1.2.</span> <span class="toc-text">D3D绘制.h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#D3D%E7%BB%98%E5%88%B6-cpp"><span class="toc-number">11.2.1.3.</span> <span class="toc-text">D3D绘制.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E4%BE%8B%E5%AD%90"><span class="toc-number">11.2.1.4.</span> <span class="toc-text">调用例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDI%E6%B3%84%E9%9C%B2"><span class="toc-number">11.3.</span> <span class="toc-text">GDI泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E7%BC%93%E5%86%B2"><span class="toc-number">11.4.</span> <span class="toc-text">双缓冲</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E7%89%A9%E7%90%86/" title="物理">物理</a><time datetime="2025-09-29T01:48:42.561Z" title="发表于 2025-09-29 09:48:42">2025-09-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%B7%A5%E4%B8%9A%E7%9B%B8%E5%85%B3/" title="工业相关">工业相关</a><time datetime="2025-02-14T03:04:40.761Z" title="发表于 2025-02-14 11:04:40">2025-02-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%9B%B8%E5%85%B3/" title="嵌入式相关">嵌入式相关</a><time datetime="2025-02-14T03:04:40.761Z" title="发表于 2025-02-14 11:04:40">2025-02-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA/" title="操作系统">操作系统</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%AE%A1%E7%BB%84/" title="计算机组成原理">计算机组成原理</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="ZEROKO14" target="_blank">ZEROKO14</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu"></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">74</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">57</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>1</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 0.88rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 0.88rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 0.88rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 0.88rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 0.88rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 0.88rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 0.88rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 0.88rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 0.88rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 0.88rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 0.88rem;">ppt<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 0.88rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 0.88rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 0.88rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 0.88rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 0.88rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">基础<sup>6</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%9D%82%E9%A1%B9/" style="font-size: 0.88rem;">杂项<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%89%A9%E7%90%86/" style="font-size: 0.88rem;">物理<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">逆向<sup>5</sup></a><a href="/tags/%E9%AD%94%E6%B3%95/" style="font-size: 0.88rem;">魔法<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>