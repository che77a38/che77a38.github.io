<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Prism | ZEROKO14的个人博客</title><meta name="keywords" content="WPF,C#"><meta name="author" content="ZEROKO14"><meta name="copyright" content="ZEROKO14"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Prism"><meta name="application-name" content="Prism"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="Prism"><meta property="og:url" content="https://che77a38.github.io/posts/prism/index.html"><meta property="og:site_name" content="ZEROKO14的个人博客"><meta property="og:description" content="此处记录prism框架的方方面面   MIT开源地址 Prism 是一个用于创建模块化和易于维护的应用程序的框架，它主要起到以下作用：  支持 MVVM 模式：提供了一些工具和类来帮助开发人员实现 MVVM 模式，使视图和模型之间的耦合度降低，提高了代码的可维护性和可测试性。 提供依赖注入容器：可以"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta property="article:author" content="ZEROKO14"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta name="description" content="此处记录prism框架的方方面面   MIT开源地址 Prism 是一个用于创建模块化和易于维护的应用程序的框架，它主要起到以下作用：  支持 MVVM 模式：提供了一些工具和类来帮助开发人员实现 MVVM 模式，使视图和模型之间的耦合度降低，提高了代码的可维护性和可测试性。 提供依赖注入容器：可以"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://che77a38.github.io/posts/prism/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: ZEROKO14","link":"链接: ","source":"来源: ZEROKO14的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZEROKO14的个人博客',
  title: 'Prism',
  postAI: '',
  pageFillDescription: 'Prism的初始化过程, vs插件支持, ride支持, 窗体切换, Region, 基本使用方法, 区域适配器, 自定义区域适配器, RegionManager, Module, 创建模块, 加载模块, 代码方式, Directory配置模块目录, App.Config配置模块目录, XAML配置模块目录, Prism控制何时加载模块, 视图注入, 依赖注入, ViewModelLocator, Prism中的MVVM, Prism与常见的MVVM框架区别, 如何在ViewModel实现基础绑定、Command、事件聚合器等操作, 实现基础绑定, BindableBase, 绑定多命令, 事件聚合器, 事件过滤, 实例, 取消订阅, 区域导航, 注册显示区域, 使用导航, 带参数导航, 控制导航过程, 获取导航请求参数, 是否拦截导航请求, 导航日志, 完整案例, App.xaml.cs, MainWindowViewModel.cs, MainWindow.xaml, ViewAViewModel.cs, ViewA.xaml, 对话服务, 实现对话框, 注册对话框, 使用Dialog, 封装Dialog API, 实例参考, 弹窗数据传递的核心机制, 传入及传出参数, 弹窗 ViewModel 实现 IDialogAware, 实现的对话框需要注册才能使用, 参数与返回值的封装, 对话框窗口外观设置此处记录框架的方方面面开源地址是一个用于创建模块化和易于维护的应用程序的框架它主要起到以下作用支持模式提供了一些工具和类来帮助开发人员实现模式使视图和模型之间的耦合度降低提高了代码的可维护性和可测试性提供依赖注入容器可以方便地管理应用程序中的依赖关系使代码更加简洁和易于理解支持模块化开发可以将应用程序拆分成多个模块每个模块可以独立开发测试和部署提高了开发效率和代码的复用性提供导航和视图切换功能可以方便地实现应用程序中的导航和视图切换使应用程序的用户体验更加流畅支持多种平台除了平台还支持其他平台如等使开发人员可以在不同的平台上使用相同的框架和技术在已经下架了在上架包含如下内容区域管理模块视图注入视图模型定位绑定相关事件聚合器导航对话框使用只需要在包中引入和是由开发的一个轻量级的依赖注入容器适用于应用程序它支持多种注入方式包括构造函数注入属性注入和方法注入是一个高性能的依赖注入容器支持多种生命周期管理和高级功能它的设计目标是提供更好的性能和更少的内存占用的初始化过程其实也是继承到的继承链上隔了一层插件支持提供了空白示例项目模块示例项目代码片段用户快速创建属性命令也提供了基于的项目模板因为是一个基于多个平台的框架支持要在中新建项目需要使用安装包然后在中新建项目的时候就可以看到有框架相关选择了窗体切换中的窗体显示使用下面的语法拿到当前主程序这行代码的作用是确保新创建的实例成为当前应用程序的主窗口以便用户可以看到并与其交互不明具体原因但还是加上好参考链接作为当中模块化的核心功能其主要目的是弱化了模块与模块之间的耦合关系在普遍的应用程序开发中界面上的元素及内容往往被固定基本使用方法定义的方式有两种一个是在界面指定另一种这是代码当中指定中指定自定义区域名代码创建指定的自定义区域名代码中给区域注册用户控件在区域中显示目录下的内容注意目录下的不能是页面或窗口只能是用户控件不然报错区域适配器区域适配器上面能在中能使用属性是因为官方给提供了区域适配器像就没有区域适配器提供了许多内置得自定义区域适配器以添加区域适配器为例新建名为类下面针对参考此处继承为你要针对的控件除了定义区域还有以下功能维护区域集合提供对区域的访问获得模块区域区域名这样就可以拿到导航容器合成视图区域导航定义区域下面贴个例子本质上来说对于一个应用程序而言特定功能的所有等都可以独立存在那么意味着每个独立的功能我们都可以称之为模块而往往实际上我们在一个项目当中他的结构通常是如下所示当我们开始考虑划分模块之间的关系的时候并且采用新的模块化解决方案结构将变成如下所示创建模块实现接口的类可以将该包标识为模块创建实际上是将模块独立与类库存在主程序通过加载类库添加模块以下步骤创建首先我们创建一个基于的应用程序暂且定义为接下来为定义一个类并且实现接口通知模块已被初始化执行诸如视图注册或任何其他模块初始化代码之类的操作在这里可以进行区域和模块的连接若有需要的话当一个模块被加载到应用程序中时首先调用应用于注册模块实现的任何服务或功能注册视图通过如下方式使用找回的实例通过注册视图加载模块保存了应用程序可以使用的模块信息该目录本质上是类的集合每个模块都在一个类中描述记录了模块的名称类型和位置等属性有几种典型的方法可以用来填充使其包含实例主程序配置模块目录配置方式如下代码方式配置文件磁盘目录定义自定义您应该使用的注册和发现机制取决于您的应用程序需要什么使用配置文件或文件可以使您的应用程序不需要引用模块使用目录可以使应用程序发现模块而无需在文件中指定它们代码方式在启动项目当中添加的应用打开重写方法如下所示手动代码导入模块需要重写的方法添加模块配置模块目录通过读取根目录文件夹查找模块目录扫描的方式导入模块需要重写该方法表示当前目录下的文件夹下当前目录是可执行文件的位置需要将模块需要的三个文件放到指定的文件夹上面是文件夹中中如这样的方式可以配合类库上右键属性生成事件生成后事件中添加如下内容这样就成功设置可以很简单的导入模块了配置模块目录然后为应用程序添加配置文件添加以下内容配置模块目录修改方法从指定文件读取模块配置创建模块名为文件添加模块信息控制何时加载模块应用程序可以尽快初始化模块称为在应用程序需要它们时初始化称为视图注入应用程序模块后每个子模块中的视图可以独立的进行依赖注入再使用来实现页面导航步骤利用进行导航功能使用将应用程序模块化将独立模块的视图服务使用注入到容器当中依赖注入盘点注册方法这是一种通用的注册方法用于将具体的实现类与接口或抽象类进行关联通过这种方式容器可以在需要时提供相应的实例用于将某个实现类注册为单例模式这意味着在整个应用程序的生命周期中只会创建一个该实现类的实例并在需要时进行共享允许你直接提供一个特定的实例进行注册这意味着容器将使用你提供的具体实例而不是创建新的实例表示注册为作用域范围内的单例在特定的作用域例如请求范围内会有一个唯一的实例通用注册单例注册实例注册作用域注册以最常用的单例注册为例这个示例中通过注册了单例实例其他代码可以通过接口来使用该单例服务如何使用该注册的单例手动注入方式最常用的构造函数注入单例的好处包括节省资源只创建一个对象避免了不必要的资源消耗一致性确保在整个系统中使用的是同一个对象易于管理和维护减少了对象的创建和销毁逻辑依赖注入的好处依赖注入通过接口来获取实例实现了依赖注入的原则提高了代码的灵活性和可维护性解耦使得代码不再直接依赖具体的实现类而是依赖接口在当中需要为与建立连接我们需要找到的中主要是两种建立连接的方式设置设置构造函数注入或设定第三方的框架标准的可能如下所示这些方式都可以建立关系但是这一切并不是想表达的内容甚至不建议你按上面的方式去做因为这样几乎打破了开发的所有原则我们把与的关系编码的方式通过命名的方式固定了下来通过静态类去维护的关系在当中你可以基于命名约定以及文件夹结构便能够轻松的将建议关联假设你已经为项目添加文件夹此时你的页面为则对应的名称为大致意思为这个字符串会重叠收纳注意不仅仅名字遵循约定并且要在文件夹下要在文件夹下当遵循了命名规范后此时还需要在当中声明允许当前自动装配这种命名约定和文件夹结构也可以在代码中修改此处略参考这里中的前面介绍了中如何与进行连接与常见的框架区别如果你了解当中的的作用就会发现众多框架都是基于这些进行扩展实现其通知绑定命令等功能对于不同的框架而言大体使用上会在声明方式上的差异以及特定功能上的差别如下图功能框架名通知命令聚合器模块化容器依赖注入导航对话各个框架之间都有各自的通知绑定事件聚合器等基础的功能而自带的依赖注入容器以及导航会话等功能可以为你提供更加强大的功能如何在实现基础绑定事件聚合器等操作实现基础绑定下面例子既有命令绑定也有属性绑定在当中需要用到绑定的控件的需要继承如下赋值如果有第二个参数可以传入一个方法通过返回来控制命令是否可执行在当中你可以使用及带参数的绑定端代码如下截取的内容更新绑定多命令复合命令对于单个而言只是触发单个对应的功能而复合命令是当中非常强大的功能简单来说是一个父命令它可以注册个子命令相关语法复合命令名初始化复合命令并给复合命令注册普通命令复合命令名复合命令名命令名复合命令名命令名当复合命令被激活它将触发对所有的子命令如果任意一个命令它将无法被激活如下所示此图中按下按钮后什么也不执行因为复合命令被禁用了假设复合命令被启用那么将会执行的是和实例初始化复合命令设置复合命令注册命令可以注册多个命令复合命令最终标题会被设置为会同时调用和事件聚合器事件聚合器事件聚合器负责接收订阅以及发布消息订阅者可以接收到发布者发送的内容功能盘点松耦合基于事件通讯多个发布者和订阅者微弱的事件过滤事件传递参数取消订阅订阅了一个消息接收的事件然后当中给指定该事件推送消息此时接收推送的内容创建事件发布订阅事件过滤在实际的开发过程当中我们往往会在多个位置订阅一个事件但是对于订阅者而言他并不需要接收任何消息事件过滤应运而生在当中我们可以指定为事件指定过滤条件设置条件为等于则接收消息关于当中的个参数详解发布事件时执行的回调委托枚举指定在哪个线程上接收委托回调在发布事件的线程上调用订阅者的委托回调在后台线程上调用订阅者的委托回调在线程上调用订阅者的委托回调通常用于更新如果为则保留对订阅者的引用因此它不会回收垃圾长期订阅需要保持状态的情况下设置为基本上可以这么认为只有贯穿程序一生的订阅才需要设置为临时订阅不再需要时要被释放资源的情况下设置为可选参数用于筛选事件通知订阅者可根据筛选条件来决定是否接收特定的事件通知返回表示接受通知返回表示不接受实例订阅一个消息回调函数不带订阅过滤器订阅一个消息回调函数只接受作为回调函数参数的发布信息发布消息触发消息回调作为回调函数的参数使用他可以去订阅一些消息针对订阅设置的消息回调函数自定义一个消息类型他的消息是一个字符串视图如下订阅发布点击订阅之后点击发布就会执行到自定义的函数取消订阅为注册的消息取消订阅提供二种方式取消订阅如下通过委托的方式取消订阅通过获取订阅者取消订阅订阅的时候返回区域导航在普遍的业务场景当中必不可少的是页面切换而就可以使用功能来进行页面导航实现区域导航需要满足两点基本条件注册显示区域注册导航页面注册显示区域注册视图类型或添加别名如果未指定别名名称默认为当中类型的名称添加别名默认名称注册时指定或添加别名指定指定并且添加别名使用导航在某窗口对应的文件中需要使用导航要在构造函数参数中接受并将该值存入成员属性中就可以使用来进行下述操作了的注册以及管理导航等我们可以使用接口所以我们现在便可以使用该接口实现导航功能调用了接口的方法并且传递了两个参数该参数为注册的区域名称该参数实际为我们上面注册过的导航页字符串类型对应的是我们注册页面的带参数导航导航页前传递一些参数则可以使用第一种方式键值对形式第二种方式类似地址传递参数控制导航过程该接口包含个方法每个方法中都包含当前导航的上下文如下所示导航完成前此处可以传递过来的参数以及是否允许导航等动作的控制调用以确定此实例是否可以处理导航请求否则新建实例当导航离开当前页时类似打开再打开时中的该方法被触发执行流程获取导航请求参数导航中允许我们传递参数用于在我们完成导航之前进行做对应的逻辑业务处理这时候我们便可以在方法中通过导航上下文中获取到传递的所有参数是否拦截导航请求接口该接口继承于所以它多了一个功能允许用户针对导航请求判断是否进行拦截确认导航温馨提示通过回调当前返回的确认结果决定是否启动该导航返回表示允许导航返回表示不允许导航导航日志导航日志其实就是对导航系统的一个管理功能理论上来说我们应该知道我们上一步导航的位置以及下一步导航的位置包括我们导航的历史记录以便于我们使用导航对应用程序可以灵活的控制该接口包含以下功能返回上一页是否可以返回上一页返回后一页是否可以返回后一页完整案例上完整代码参考新建两个视图和并在中注册两个界面此处要注册各种资源默认名为起名方式以及中对视图进行完善并绑定相关用于记录日志情况传递参数给参数传递的方式是通过键值对导航到带参数使用字符串导航带参数传递参数的另一种写法类似的写法顺便加上了获取上下文日志导航后拿到上下文日志导航到第三个参数设置导航完成的时候触发回调函数导航后拿到上下文日志向后导航向前导航上一步下一步打开打开这行代码在中定义了一个控件并使用框架的来将该控件与名为的区域关联起来这种关联允许在该区域内动态加载和管理与相关的视图继承用于实现通知继承用于实现导航可以使用代替就可以多一个方法用于判断是否允许导航是继承判断是否允许导航确认导航温馨提示固定格式重新创建实例的一个判断如果已经打开过当前实例的话如果打开过还返回一个的话他会创建一个新的实例覆盖原来的导航离开当前页时触发导航完成前接收用户传递的参数以及是否允许导航等控制接收键对应的值类型对话服务提供了一组对话服务封装了常用的对话框组件的功能注册对话及使用对话打开对话框传递参数关闭对话框返回参数回调通知对话结果实现对话框创建对话框注意通常是一组用户控件并且实现例子成功时构造返回结果返回出去也是键值对是否允许关闭当前窗口关闭时触发打开前触发用于接受参数注册对话框注册对话框三选一仅注册视图注册视图时绑定添加别名使用使用接口方法调用对话框调用我们通过注册时候的名称进行打开并且可以传递参数以及回调方法主要用于返回对话框的返回结果使用对话框实例对话框服务增加参数添加参数显示对话框不带参数显示对话框阳获取返回的结果封装对于常用的公共对话框我们可以封装成扩展方法以便于我们在应用程序的任何位置可以使用到它实例参考测试实例参考弹窗数据传递的核心机制传入数据给对话框对话框实现弹窗实现传出数据给父级窗口处理程序的对话框服务遵循以下流程参数传递调用弹窗时通过向弹窗传递初始参数结果回调弹窗关闭时通过返回用户输入的数据接口实现弹窗的需实现接口处理打开关闭和数据回传逻辑传入及传出参数在父窗口的中使用方法打开弹窗并通过传递参数默认文本传递初始值处理用户输入的数据也可以简写成测试输入内容弹窗的注册名称回调参数包含用户操作结果确定取消和返回的数据弹窗实现弹窗的需实现接口处理数据接收与返回对话框标题是否允许关闭当前窗口关闭时触发在关闭前提供了一个时机点来做一些处理打开前触发用于接受参数请求退出给外界提供的获取接口可以在对话框中添加按钮按钮绑定到命令确保对话框是通过调用事件来关闭的而不是通过直接关闭窗口的方式这样可以确保被正确传递实现的对话框需要注册才能使用在的模块或容器中注册弹窗注册时需要指定弹窗的和并为弹窗命名参数与返回值的封装为提高代码可维护性可封装自定义参数类在回调中使用通过强类型对象代替松散键值对减少硬编码风险对话框窗口外观设置定义了对话框的启动位置表示窗口将在屏幕中央启动决定窗口是否在任务栏中显示表示该窗口会在任务栏中显示定义窗口的大小行为表示窗口的大小将根据其内容自动调整以适应窗口中显示的内容的宽度和高度指定了窗口的样式通常用于工具窗口具有较小的标题栏和不同的外观适合用于辅助工具或面板使窗口不可被手动改变大小',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-13 16:34:58',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://th.bing.com/th/id/OIP.wtmjepfWPBvn26uz7s18dgHaHa?rs=1&amp;pid=ImgDetMain"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ZEROKO14的个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 1.05rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 1.05rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 1.05rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 1.05rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 1.05rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 1.05rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 1.05rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 1.05rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 1.05rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 1.05rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 1.05rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 1.05rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 1.05rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 1.05rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 1.05rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 1.05rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 1.05rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 1.05rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 1.05rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 1.05rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">基础<sup>3</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>1</sup></a><a href="/tags/%E7%A1%AC%E7%BC%96%E7%A0%81/" style="font-size: 1.05rem;">硬编码<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">27</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/WPF/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>WPF</span></a><a class="article-meta__tags" href="/tags/C/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>C#</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Prism</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-11-24T02:49:02.204Z" title="发表于 2023-11-24 10:49:02">2023-11-24</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-03-13T08:34:58.066Z" title="更新于 2025-03-13 16:34:58">2025-03-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Prism"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新加坡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新加坡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://che77a38.github.io/posts/prism/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><a href="/tags/WPF/" tabindex="-1" itemprop="url">WPF</a><a href="/tags/C/" tabindex="-1" itemprop="url">C#</a><h1 id="CrawlerTitle" itemprop="name headline">Prism</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ZEROKO14</span><time itemprop="dateCreated datePublished" datetime="2023-11-24T02:49:02.204Z" title="发表于 2023-11-24 10:49:02">2023-11-24</time><time itemprop="dateCreated datePublished" datetime="2025-03-13T08:34:58.066Z" title="更新于 2025-03-13 16:34:58">2025-03-13</time></header><p>此处记录prism框架的方方面面</p>
<span id="more"></span>

<p><a target="_blank" rel="noopener" href="https://github.com/PrismLibrary">MIT开源地址</a></p>
<p>Prism 是一个用于创建模块化和易于维护的应用程序的框架，它主要起到以下作用：</p>
<ul>
<li><strong>支持 MVVM 模式</strong>：提供了一些工具和类来帮助开发人员实现 MVVM 模式，使视图和模型之间的耦合度降低，提高了代码的可维护性和可测试性。</li>
<li><strong>提供依赖注入容器</strong>：可以方便地管理应用程序中的依赖关系，使代码更加简洁和易于理解。</li>
<li><strong>支持模块化开发</strong>：可以将应用程序拆分成多个模块，每个模块可以独立开发、测试和部署，提高了开发效率和代码的复用性。</li>
<li><strong>提供导航和视图切换功能</strong>：可以方便地实现应用程序中的导航和视图切换，使应用程序的用户体验更加流畅。</li>
<li><strong>支持多种平台</strong>：除了 WPF 平台，Prism 还支持其他平台，如 UWP、Xamarin.Forms 等，使开发人员可以在不同的平台上使用相同的框架和技术。</li>
</ul>
<p>Prism在vs2019已经下架了,在vs2022上架</p>
<p><a target="_blank" rel="noopener" href="https://docs.prismlibrary.com/docs/platforms/wpf/getting-started.html">Getting Started | Prism (prismlibrary.com)</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.bilibili.com/video/BV1Ei4y1F7du?p=3" alt="教程|720x360"></p>
<p>包含如下内容</p>
<ul>
<li>Region(区域管理)</li>
<li>Module(模块)</li>
<li>View Injection(视图注入)</li>
<li>ViewModelLocationProvider(视图模型定位)</li>
<li>Command(绑定相关)</li>
<li>Event Aggregator (事件聚合器)</li>
<li>Navigation(导航)</li>
<li>Dialog(对话框)</li>
</ul>
<p>使用prism只需要在nuget包中引入Prism.WPF和Prism.Dryloc</p>
<blockquote>
<ul>
<li><p><strong>Unity</strong>：<br>Unity 是由 Microsoft 开发的一个轻量级的依赖注入容器，适用于 .NET 应用程序。它支持多种注入方式，包括构造函数注入、属性注入和方法注入。</p>
</li>
<li><p><strong>DryIoc</strong>：</p>
<p>DryIoc 是一个高性能的依赖注入容器，支持多种生命周期管理和高级功能。它的设计目标是提供更好的性能和更少的内存占用。</p>
</li>
</ul>
</blockquote>
<h1 id="Prism的初始化过程"><a href="#Prism的初始化过程" class="headerlink" title="Prism的初始化过程"></a>Prism的初始化过程</h1><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202407181456681.png" alt="img" style="zoom: 50%;" />

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181038158.png" alt="image-20240618103848364"></p>
<p>PrismApplicationBase其实也是继承Application,App到Application的继承链上隔了一层PrismApplication</p>
<h1 id="vs插件支持"><a href="#vs插件支持" class="headerlink" title="vs插件支持"></a>vs插件支持</h1><p>Prism Template Pack</p>
<p>提供了:</p>
<ul>
<li><p>Blank Project (空白示例项目)</p>
</li>
<li><p>Module Project (模块示例项目)</p>
</li>
<li><p>代码片段(用户快速创建属性,命令)</p>
<p>propp – property (depends on BindableBase)<br>cmd - DelegateCommand<br>cmdg – DelegateCommand</p>
</li>
</ul>
<p><strong>Prism也提供了基于Xamarin的项目模板, 因为Prism是一个基于多个平台的框架</strong></p>
<h1 id="ride支持"><a href="#ride支持" class="headerlink" title="ride支持"></a>ride支持</h1><p>要在ride中新建prism项目,需要使用安装nuget包:Prism.Templates</p>
<p>然后在ride中新建项目的时候就可以看到有prism框架相关选择了</p>
<h1 id="窗体切换"><a href="#窗体切换" class="headerlink" title="窗体切换"></a>窗体切换</h1><p>prism中的窗体显示,使用下面的语法:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拿到当前主程序</span></span><br><span class="line"><span class="keyword">var</span> main = Application.Current.MainWindow;</span><br><span class="line"><span class="keyword">var</span> window=Container.Resolve&lt;MainWindow&gt;();</span><br><span class="line"><span class="comment">//这行代码的作用是确保新创建的MainWindow实例成为当前应用程序的主窗口，以便用户可以看到并与其交互</span></span><br><span class="line"><span class="comment">//不明具体原因,但还是加上好</span></span><br><span class="line">Application.Current.MainWindow = window;</span><br><span class="line">window.Show();</span><br><span class="line">main.Close();</span><br></pre></td></tr></table></figure>

<h1 id="Region"><a href="#Region" class="headerlink" title="Region"></a>Region</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zh7791/p/14086734.html">参考链接</a></p>
<p>Region作为Prism当中模块化的核心功能，其主要目的是弱化了模块与模块之间的耦合关系。<br>在普遍的应用程序开发中，界面上的元素及内容往往被固定。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181047724.png" alt="image-20240618104745163"></p>
<h2 id="基本使用方法"><a href="#基本使用方法" class="headerlink" title="基本使用方法"></a>基本使用方法</h2><p>定义Region的方式有两种，一个是在XAML界面指定，另一种这是代码当中指定。</p>
<p>XAML中指定:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ContentControl prism:RegionManager.RegionName=&quot;自定义区域名&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>代码创建:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RegionManager.SetRegionName(指定ContentControl的name,自定义区域名);</span><br></pre></td></tr></table></figure>

<p>代码中给区域注册用户控件</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">MainWindowViewModel</span>(<span class="params">IRegionManager regionManager</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="comment">//在ContentRegion区域中显示Views目录下的ContentView内容</span></span><br><span class="line">     regionManager.RegisterViewWithRegion(<span class="string">&quot;ContentRegion&quot;</span>, <span class="keyword">typeof</span>(Views.view1));</span><br><span class="line"> &#125;</span><br><span class="line"><span class="comment">//注意Views目录下的view1不能是页面或窗口,只能是用户控件,不然报错</span></span><br></pre></td></tr></table></figure>

<h2 id="区域适配器"><a href="#区域适配器" class="headerlink" title="区域适配器"></a>区域适配器</h2><p><strong>RegionAdapter区域适配器</strong></p>
<p>上面能在Grid中能使用<code>prism:RegionManager.RegionName</code>属性是因为官方给Grid提供了<strong>区域适配器</strong>,像StackPanel就没有区域适配器</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202407181457287.png" alt="img" style="zoom: 50%;" />

<blockquote>
<p>Prism提供了许多内置得RegionAdapter</p>
<ul>
<li>ContentControlRegionAdapter</li>
<li>ItemsControlRegionAdapter</li>
<li>SelectorRegionAdapter<br>- ComboBox<br>- ListBox<br>- Ribbon<br>- TabControl</li>
</ul>
</blockquote>
<h3 id="自定义区域适配器"><a href="#自定义区域适配器" class="headerlink" title="自定义区域适配器"></a>自定义区域适配器</h3><p>以添加StackPanel区域适配器为例</p>
<p>新建名为StackPanelRegion类</p>
<p>下面针对TabControl</p>
<p><a target="_blank" rel="noopener" href="https://wpfcsharpmetroui.blogspot.com/2019/11/how-to-create-custom-adapter-for-using.html#gsc.tab=0">TabControl参考此处</a></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">TabControlAdapter</span> : <span class="title">RegionAdapterBase</span>&lt;<span class="title">TabControl</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TabControlAdapter</span>(<span class="params">IRegionBehaviorFactory regionBehaviorFactory</span>) : <span class="title">base</span>(<span class="params">regionBehaviorFactory</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Adapt</span>(<span class="params">IRegion region, TabControl regionTarget</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            region.Views.CollectionChanged += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.Action == NotifyCollectionChangedAction.Add)</span><br><span class="line">                    <span class="keyword">foreach</span> (UserControl item <span class="keyword">in</span> e.NewItems)</span><br><span class="line">                    &#123;</span><br><span class="line">                        regionTarget.Items.Add(<span class="keyword">new</span> TabItem &#123; Header = item.Name, Content = item &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e.Action == NotifyCollectionChangedAction.Remove)</span><br><span class="line">                    <span class="keyword">foreach</span> (UserControl item <span class="keyword">in</span> e.OldItems)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">var</span> tabTodelete = regionTarget.Items.OfType&lt;TabItem&gt;().FirstOrDefault(n =&gt; n.Content == item);</span><br><span class="line">                        regionTarget.Items.Remove(tabTodelete);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IRegion <span class="title">CreateRegion</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SingleActiveRegion();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>继承<code>RegionAdapterBase&lt;T&gt;</code>  T为你要针对的控件</p>
<h2 id="RegionManager"><a href="#RegionManager" class="headerlink" title="RegionManager"></a>RegionManager</h2><p>除了定义区域,还有以下功能:</p>
<ul>
<li><p>维护区域集合</p>
</li>
<li><p>提供对区域的访问</p>
<p>获得模块区域: <code>var region = regionManager.Regions(&quot;区域名&quot;)</code></p>
<p>这样就可以拿到导航容器</p>
</li>
<li><p>合成视图</p>
</li>
<li><p>区域导航</p>
</li>
<li><p>定义区域</p>
</li>
</ul>
<p>下面贴个例子:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tabRegion = _regionManager.Regions[RegionNames.AnalysisTabRegion];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (tabRegion.Views.Any())</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> historyJournalView = _containerProvider.Resolve&lt;HistoryJournalView&gt;();</span><br><span class="line"><span class="keyword">var</span> historyDataView = _containerProvider.Resolve&lt;HistoryDataView&gt;();</span><br><span class="line"><span class="keyword">var</span> jobJournalView = _containerProvider.Resolve&lt;JobJournalView&gt;();</span><br><span class="line"></span><br><span class="line">tabRegion.Add(historyJournalView);</span><br><span class="line">tabRegion.Add(historyDataView);</span><br><span class="line">tabRegion.Add(jobJournalView);</span><br><span class="line"></span><br><span class="line">tabRegion.Activate(historyJournalView);</span><br></pre></td></tr></table></figure>

<h1 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h1><p>本质上来说，对于一个应用程序而言，特定功能的所有View、Logic.Service等都可以独立存在。那么意味着，每个独立的功能我们都可以称之为模块。而往往实际上，我们在一个项目当中，他的结构通常是如下所示：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181334035.png" alt="img" style="zoom: 25%;" />

<p>当我们开始考虑划分模块之间的关系的时候，并且采用新的模块化解决方案,结构将变成如下所示:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181336081.png" alt="img" style="zoom:25%;" />

<h2 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h2><p><em>实现</em><code>IModule</code><em>接口的类</em>可以将该包标识为模块</p>
<p>创建Module实际上是将模块独立与类库存在，主程序通过加载类库添加模块。以下步骤：<br>创建Module</p>
<p>首先, 我们创建一个基于WPF的应用程序, 暂且定义为ModuleA, 接下来为ModuleA定义一个类,并且实现IModule接口。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModuleAModule</span> : <span class="title">IModule</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 通知模块已被初始化。</span></span><br><span class="line">  			<span class="comment"><span class="doctag">///</span>	执行诸如视图注册或任何其他模块初始化代码之类的操作</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;containerProvider&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>(<span class="params">IContainerProvider containerProvider</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//在这里可以进行区域和模块的连接(若有需要的话)</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">  			<span class="comment"><span class="doctag">///</span> 当一个模块被加载到应用程序中时，首先调用RegisterTypes</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 应用于注册模块实现的任何服务或功能</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;containerRegistry&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//注册视图通过如下方式:</span></span><br><span class="line">          <span class="comment">//使用containerProvider找回Prism RegionManage的实例</span></span><br><span class="line">          <span class="keyword">var</span> regionManager = containerProvider.Resolve&lt;IRegionManager&gt;();</span><br><span class="line">          <span class="comment">//通过RegionManage注册视图</span></span><br><span class="line">        	regionManager.RegisterViewWithRegion(<span class="string">&quot;MyModuleView&quot;</span>, <span class="keyword">typeof</span>(Views.ThisModuleView));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="加载模块"><a href="#加载模块" class="headerlink" title="加载模块"></a>加载模块</h2><p><code>ModuleCatalog</code>保存了应用程序可以使用的模块信息。该目录本质上是<code>ModuleInfo</code>类的集合。每个模块都在一个<code>ModuleInfo</code>类中描述，记录了模块的名称、类型和位置等属性。有几种典型的方法可以用来填充<strong>ModuleCatalog</strong>，使其包含<strong>ModuleInfo</strong>实例</p>
<p>主程序配置模块目录<br>配置方式如下:</p>
<ul>
<li>(代码方式)Code</li>
<li>(配置文件)App.config</li>
<li>(磁盘目录)Disk&#x2F;Directory</li>
<li>(XAML定义)XAML</li>
<li>(自定义)Custom<br>Register Catalog with PrismApplication<br>Register Modules with Catalog</li>
</ul>
<p>您应该使用的注册和发现机制取决于您的应用程序需要什么。使用配置文件或XAML文件可以使您的应用程序不需要引用模块。使用目录可以使应用程序发现模块，而无需在文件中指定它们</p>
<h3 id="代码方式"><a href="#代码方式" class="headerlink" title="代码方式"></a>代码方式</h3><p>在启动项目当中,添加ModuleA的应用, 打开App.xaml.cs, 重写ConfigureModuleCatalog方法,如下所示:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Window <span class="title">CreateShell</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> Container.Resolve&lt;MainWindow&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//手动代码导入模块需要重写的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ConfigureModuleCatalog</span>(<span class="params">IModuleCatalog moduleCatalog</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//添加模块A</span></span><br><span class="line">    moduleCatalog.AddModule&lt;ModuleAModule&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Directory配置模块目录"><a href="#Directory配置模块目录" class="headerlink" title="Directory配置模块目录"></a>Directory配置模块目录</h3><p>通过读取根目录Modules文件夹查找模块</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span></span><br><span class="line">   &#123;</span><br><span class="line">			<span class="comment">//目录扫描的方式导入模块需要重写该方法   </span></span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IModuleCatalog <span class="title">CreateModuleCatalog</span>()</span></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> DirectoryModuleCatalog() &#123; ModulePath=<span class="string">@&quot;.\Modules&quot;</span> &#125;;<span class="comment">//表示当前目录下的Modules文件夹下,当前目录是可执行文件的位置</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>需要将模块需要的三个文件放到指定的文件夹(上面是Modules文件夹中)中,如:<code>Login.deps.json</code>,<code>Login.dll</code>,<code>Login.pdb</code></p>
<p>这样的方式可以配合类库上右键-属性0-生成-事件-生成后事件中添加如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xcopy &quot;$(ProjectDir)\bin\Debug\net6.0-windows\$(ProjectName).dll&quot; &quot;$(SolutionDir)\IonImplantationSystem\bin\Debug\net6.0-windows\Modules\&quot; /Y /S</span><br><span class="line">xcopy &quot;$(ProjectDir)\bin\Release\net6.0-windows\$(ProjectName).dll&quot; &quot;$(SolutionDir)\IonImplantationSystem\bin\Release\net6.0-windows\Modules\&quot; /Y /S</span><br></pre></td></tr></table></figure>

<p>这样就成功设置可以很简单的导入模块了</p>
<h3 id="App-Config配置模块目录"><a href="#App-Config配置模块目录" class="headerlink" title="App.Config配置模块目录"></a>App.Config配置模块目录</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IModuleCatalog <span class="title">CreateModuleCatalog</span>()</span></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> ConfigurationModuleCatalog();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>然后,为应用程序添加配置文件app.config, 添加以下内容:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;configSections&gt;</span><br><span class="line">    &lt;section name=&quot;modules&quot; type=&quot;Prism.Modularity.ModulesConfigurationSection, Prism.Wpf&quot; /&gt;</span><br><span class="line">  &lt;/configSections&gt;</span><br><span class="line">  &lt;startup&gt;</span><br><span class="line">  &lt;/startup&gt;</span><br><span class="line">  &lt;modules&gt;</span><br><span class="line">    &lt;module assemblyFile=&quot;ModuleA.dll&quot; moduleType=&quot;ModuleA.ModuleAModule, ModuleA, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot; moduleName=&quot;ModuleAModule&quot; startupLoaded=&quot;True&quot; /&gt;</span><br><span class="line">  &lt;/modules&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="XAML配置模块目录"><a href="#XAML配置模块目录" class="headerlink" title="XAML配置模块目录"></a>XAML配置模块目录</h3><p>修改CreateModuleCatalog方法, 从指定XAML文件读取模块配置</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> IModuleCatalog <span class="title">CreateModuleCatalog</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> XamlModuleCatalog(<span class="keyword">new</span> Uri(<span class="string">&quot;/Modules;component/ModuleCatalog.xaml&quot;</span>, UriKind.Relative));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建模块名为ModuleCatalog.xaml文件, 添加模块信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;m:ModuleCatalog xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br><span class="line">                    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">                    xmlns:m=&quot;clr-namespace:Prism.Modularity;assembly=Prism.Wpf&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;m:ModuleInfo ModuleName=&quot;ModuleAModule&quot; </span><br><span class="line">                  ModuleType=&quot;ModuleA.ModuleAModule, ModuleA, </span><br><span class="line">                  Version=1.0.0.0, Culture=neutral, PublicKeyToken=null&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/m:ModuleCatalog&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Prism控制何时加载模块"><a href="#Prism控制何时加载模块" class="headerlink" title="Prism控制何时加载模块"></a>Prism控制何时加载模块</h3><ul>
<li>应用程序可以尽快初始化模块，称为“when available”</li>
<li>在应用程序需要它们时初始化，称为“on-demand”</li>
</ul>
<h1 id="视图注入"><a href="#视图注入" class="headerlink" title="视图注入"></a>视图注入</h1><p>应用程序模块后，<strong>每个子模块中的视图可以独立的进行依赖注入</strong>。再使用<code>IRegionManager</code>来实现页面导航。</p>
<p>步骤：<br>1.利用Region进行导航功能。<br>2.使用Module将应用程序模块化。<br>3.将独立模块的视图、服务使用注入到容器当中。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModuleAModule</span> : <span class="title">IModule</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IRegionManager _regionManager;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ModuleAModule</span>(<span class="params">IRegionManager regionManager</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _regionManager = regionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>(<span class="params">IContainerProvider containerProvider</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _regionManager.RegisterViewWithRegion(<span class="string">&quot;ContentRegion&quot;</span>, <span class="keyword">typeof</span>(ViewA));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h1><p>盘点注册方法</p>
<ul>
<li>Register：这是一种通用的注册方法，用于将具体的实现类与接口或抽象类进行关联。通过这种方式，容器可以在需要时提供相应的实例。</li>
<li>RegisterSingleton：用于将某个实现类注册为单例模式。这意味着在整个应用程序的生命周期中，只会创建一个该实现类的实例，并在需要时进行共享。</li>
<li>RegisterInstance：允许你直接提供一个特定的实例进行注册。这意味着容器将使用你提供的具体实例，而不是创建新的实例。</li>
<li>RegisterScoped：表示注册为作用域范围内的单例。在特定的作用域（例如请求范围）内，会有一个唯一的实例。</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用注册</span></span><br><span class="line">containerRegistry.Register&lt;IService, MyServiceImpl&gt;(); </span><br><span class="line"><span class="comment">// 单例注册</span></span><br><span class="line">containerRegistry.RegisterSingleton&lt;IService, MyServiceImpl&gt;(); </span><br><span class="line"><span class="comment">// 实例注册</span></span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> MyServiceImpl();</span><br><span class="line">containerRegistry.RegisterInstance&lt;IService&gt;(instance); </span><br><span class="line"><span class="comment">// 作用域注册</span></span><br><span class="line">containerRegistry.RegisterScoped&lt;IService, MyServiceImpl&gt;(); </span><br></pre></td></tr></table></figure>

<p>以最常用的<strong>单例注册</strong>为例:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">containerRegistry.RegisterSingleton&lt;IService, MyServiceImpl&gt;();</span><br><span class="line"><span class="comment">//这个示例中，通过 containerRegistry 注册了单例实例。其他代码可以通过 IService 接口来使用该单例服务</span></span><br></pre></td></tr></table></figure>

<p>如何使用该注册的单例</p>
<p>手动注入方式:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyViewModel</span> : <span class="title">BindableBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IContainerProvider _containerProvider;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewModel</span>(<span class="params">IContainerProvider containerProvider</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _containerProvider = containerProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SomeMethod</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> myService = _containerProvider.Resolve&lt;IMyService&gt;();</span><br><span class="line">        myService.DoSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最常用的构造函数注入:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyViewModel</span> : <span class="title">BindableBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IMyService _myService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewModel</span>(<span class="params">IMyService myService</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _myService = myService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>单例的好处包括</p>
<ul>
<li>节省资源：只创建一个对象，避免了不必要的资源消耗。</li>
<li>一致性：确保在整个系统中使用的是同一个对象。</li>
<li>易于管理和维护：减少了对象的创建和销毁逻辑。</li>
</ul>
<p>依赖注入的好处:</p>
<ol>
<li>依赖注入：通过接口来获取实例，实现了依赖注入的原则，提高了代码的灵活性和可维护性。</li>
<li>解耦：使得代码不再直接依赖具体的实现类，而是依赖接口。</li>
</ol>
<h1 id="ViewModelLocator"><a href="#ViewModelLocator" class="headerlink" title="ViewModelLocator"></a>ViewModelLocator</h1><p><a href="#%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E4%B8%89%E7%A7%8D%E6%96%87%E4%BB%B6">在WPF当中,需要为View与ViewModel建立连接</a>, 我们需要找到View的DataContext</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181459009.png" alt="img" style="zoom:25%;" />

<p>wpf中主要是两种建立连接的方式</p>
<ul>
<li><p>XAML设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl.DataContext&gt;</span><br><span class="line">       &lt;.../&gt;</span><br><span class="line">&lt;/UserControl.DataContext&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Code设置 (构造函数注入 或 ViewModelLocator)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">ViewA</span> : <span class="title">UserControl</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ViewA</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    InitializeComponent();</span><br><span class="line">    <span class="keyword">this</span>.DataContext = <span class="literal">null</span>; <span class="comment">//设定</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>第三方的MVVM框架, 标准的ViewModelLocator可能如下所示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181500761.png" alt="img"></p>
<p>这些方式都可以建立View-ViewModel关系。<br>但是,这一切并不是Prism想表达的内容, 甚至不建议你按上面的方式去做, 因为这样几乎打破了开发的所有原则。<br>(我们把View与ViewModel的关系编码的方式通过<strong>命名的方式固定了下来</strong>, 通过静态类去维护ViewModel的关系…)</p>
<p>在Prism当中, 你可以<strong>基于命名约定以及文件夹结构</strong>, 便能够轻松的将View&#x2F;ViewModel建议关联</p>
<p>假设你已经为项目添加<strong>Views&#x2F;ViewModels</strong>文件夹。此时, 你的页面为ViewA, 则对应的ViewModel名称为 ViewAViewModel</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181714949.png" alt="img" style="zoom:25%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406181715026.png" alt="img" style="zoom:25%;" />

<p>大致意思为View这个字符串会重叠收纳</p>
<p>注意不仅仅名字遵循约定,并且View要在Views文件夹下,ViewModel要在ViewModels文件夹下</p>
<p>当遵循了命名规范后, 此时还需要在View当中声明,允许当前View自动装配ViewModel</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl x:Class=&quot;SettingBinding Context.Views.MainPage&quot;</span><br><span class="line">xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br><span class="line">xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">xmlns:prism=&quot;http://prismlibrary.com&quot;</span><br><span class="line">prism:ViewModelLocator.AutowireViewModel=&quot;True&quot; &gt;</span><br><span class="line"></span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>

<p>这种命名约定和文件夹结构也可以在代码中修改:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zh7791/p/14109905.html#%E6%9B%B4%E6%94%B9%E7%BA%A6%E5%AE%9A">此处略,参考这里</a></p>
<h1 id="Prism中的MVVM"><a href="#Prism中的MVVM" class="headerlink" title="Prism中的MVVM"></a>Prism中的MVVM</h1><p><a href="#ViewModelLocator">前面</a>介绍了Prism中ViewModel如何与View进行连接</p>
<h2 id="Prism与常见的MVVM框架区别"><a href="#Prism与常见的MVVM框架区别" class="headerlink" title="Prism与常见的MVVM框架区别"></a>Prism与常见的MVVM框架区别</h2><p>如果你了解WPF当中的ICommand, INotifyPropertyChanged的作用, 就会发现<br>众多框架都是基于这些进行扩展, 实现其通知、绑定、命令等功能</p>
<p>对于不同的MVVM框架而言, 大体使用上会在声明方式上的差异, 以及特定功能上的差别,如下图</p>
<table>
<thead>
<tr>
<th>功能↓ &#x2F; →框架名</th>
<th>Prism</th>
<th>Mvvmlight</th>
<th>Micorosoft.Toolkit.Mvvm</th>
</tr>
</thead>
<tbody><tr>
<td>通知</td>
<td>BindableBase</td>
<td>ViewModelBase</td>
<td>ObservableObject</td>
</tr>
<tr>
<td>命令</td>
<td>DelegateCommand</td>
<td>RelayCommand</td>
<td>Async&#x2F;RelayCommand</td>
</tr>
<tr>
<td>聚合器</td>
<td>IEventAggregator</td>
<td>IMessenger</td>
<td>IMessenger</td>
</tr>
<tr>
<td>模块化</td>
<td>√</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>容器</td>
<td>√</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>依赖注入</td>
<td>√</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>导航</td>
<td>√</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>对话</td>
<td>√</td>
<td>×</td>
<td>×</td>
</tr>
</tbody></table>
<p>各个框架之间都有各自的通知、绑定、事件聚合器等基础的功能, 而Prsim自带的<strong>依赖注入、容器、以及导航会话</strong>等功能, 可以为你提供更加强大的功能</p>
<h2 id="如何在ViewModel实现基础绑定、Command、事件聚合器等操作"><a href="#如何在ViewModel实现基础绑定、Command、事件聚合器等操作" class="headerlink" title="如何在ViewModel实现基础绑定、Command、事件聚合器等操作"></a>如何在ViewModel实现基础绑定、Command、事件聚合器等操作</h2><h3 id="实现基础绑定"><a href="#实现基础绑定" class="headerlink" title="实现基础绑定"></a>实现基础绑定</h3><p>下面例子既有命令绑定,也有属性绑定</p>
<h3 id="BindableBase"><a href="#BindableBase" class="headerlink" title="BindableBase"></a><strong>BindableBase</strong></h3><p>在Prism当中,需要用到绑定的控件的ViewModel需要继承ViewModel,如下:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestViewModel</span> : <span class="title">BindableBase</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TestViewModel</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//赋值</span></span><br><span class="line">    Message = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="comment">//DelegateCommand如果有第二个参数,可以传入一个方法,通过返回true/false来控制命令是否可执行</span></span><br><span class="line">    SendCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      Message = <span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">string</span> _message;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">string</span> Message</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> _message; &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123; _message = <span class="keyword">value</span>; RaisePropertyChanged(); &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//在Prism当中, 你可以使用DelegateCommand及带参数的Command</span></span><br><span class="line">   <span class="keyword">public</span> DelegateCommand SendCommand &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line">   <span class="comment">//public DelegateCommand&lt;string&gt; SendMessageCommand &#123; get;private set; &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>绑定端代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--截取的内容--&gt;</span><br><span class="line">xmlns:prism =&quot;http://prismlibrary.com/&quot;</span><br><span class="line">mc:Ignorable=&quot;d&quot;</span><br><span class="line">prism:ViewModelLocator.AutoWireViewModel=&quot;True&quot;</span><br><span class="line">Title=&quot;ViewA&quot; Height=&quot;450&quot; Width=&quot;800&quot;&gt;</span><br><span class="line">&lt;Grid&gt;</span><br><span class="line">  &lt;StackPanel&gt;</span><br><span class="line">    &lt;Button Width=&quot;100&quot; Height=&quot;30&quot; Content=&quot;更新TextBlock&quot; Command=&quot;&#123;Binding SendCommand&#125;&quot;/&gt;</span><br><span class="line">    &lt;TextBlock Text=&quot;&#123;Binding Message&#125;&quot; FontSize=&quot;38&quot; HorizontalAlignment=&quot;Center&quot;/&gt;</span><br><span class="line">  &lt;/StackPanel&gt;</span><br><span class="line"></span><br><span class="line">&lt;/Grid&gt;</span><br></pre></td></tr></table></figure>

<h3 id="绑定多命令"><a href="#绑定多命令" class="headerlink" title="绑定多命令"></a>绑定多命令</h3><p><strong>复合命令CompositeCommand</strong></p>
<p>对于单个Command而言, 只是触发单个对应的功能, 而复合命令是Prism当中非常强大的功能, CompositeCommand简单来说是一个父命令, 它可以注册N个子命令</p>
<p>相关语法</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> CompositeCommand 复合命令名 &#123;  <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="comment">//初始化复合命令,并给复合命令注册普通命令</span></span><br><span class="line">复合命令名 = <span class="keyword">new</span> CompositeCommand();</span><br><span class="line">复合命令名.RegisterCommand(命令名);</span><br><span class="line">复合命令名.RegisterCommand(命令名<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>当复合命令被激活,它将触发对所有的子命令, 如果任意一个命令CanExecute&#x3D;false,它将无法被激活,如下所示:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406190946036.png" alt="image-20240619094609395" style="zoom: 33%;" />

<p>此图中按下<code>Save All</code>按钮后什么也不执行,因为复合命令被禁用了,假设复合命令被启用,那么将会执行的是<code>Save A</code>和<code>Save C</code></p>
<p><strong>实例</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ViewAViewModel</span>: <span class="title">BindableBase</span></span><br><span class="line"> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="built_in">string</span> message;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">ViewAViewModel</span>()</span></span><br><span class="line">     &#123;</span><br><span class="line">Message = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">         SendCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">	Message = <span class="string">&quot;hello world!&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">         SendCommand2=<span class="keyword">new</span> DelegateCommand(() =&gt; &#123;</span><br><span class="line">             Message += <span class="string">&quot;zeroko14&quot;</span>;</span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="comment">//初始化复合命令</span></span><br><span class="line">         SendAll = <span class="keyword">new</span> CompositeCommand();</span><br><span class="line"><span class="comment">//设置复合命令注册命令,可以注册多个命令</span></span><br><span class="line">SendAll.RegisterCommand(SendCommand);</span><br><span class="line">SendAll.RegisterCommand(SendCommand2);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="built_in">string</span> Message</span><br><span class="line">		&#123;</span><br><span class="line"><span class="keyword">get</span> &#123; <span class="keyword">return</span> message; &#125;</span><br><span class="line"><span class="keyword">set</span> &#123; message = <span class="keyword">value</span>; RaisePropertyChanged(); &#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> DelegateCommand SendCommand &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">public</span> DelegateCommand SendCommand2 &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//复合命令</span></span><br><span class="line">     <span class="keyword">public</span> CompositeCommand SendAll &#123;  <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>最终标题会被设置为<code>hello world!zeroko14</code> ,<code>Command=&#123;Binding SendAll&#125;</code>会同时调用<code>SendCommand</code>和<code>SendCommand2</code></p>
<h2 id="事件聚合器"><a href="#事件聚合器" class="headerlink" title="事件聚合器"></a>事件聚合器</h2><p><strong>事件聚合器IEventAggregator</strong></p>
<p>事件聚合器负责接收订阅以及发布消息。订阅者可以接收到发布者发送的内容</p>
<p>功能盘点:</p>
<ul>
<li>松耦合基于事件通讯</li>
<li>多个发布者和订阅者</li>
<li>微弱的事件</li>
<li>过滤事件</li>
<li>传递参数</li>
<li>取消订阅</li>
</ul>
<p>AViewModel订阅了一个消息接收的事件, 然后BViewModel当中给指定该事件推送消息,此时AViewModel接收BViewModel推送的内容</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406191034231.png" alt="image-20240619103421409" style="zoom: 33%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建事件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SavedEvent</span> : <span class="title">PubSubEvent</span>&lt;<span class="title">string</span>&gt; &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发布</span></span><br><span class="line">IEventAggregator.GetEvent&lt;SavedEvent&gt;().Publish(<span class="string">&quot;some value&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//订阅</span></span><br><span class="line">IEventAggregator.GetEvent&lt;SavedEvent&gt;().Subscribe(message=&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//do something</span></span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="事件过滤"><a href="#事件过滤" class="headerlink" title="事件过滤"></a>事件过滤</h3><p>在实际的开发过程当中,我们往往会在多个位置订阅一个事件, 但是对于订阅者而言, 他并不需要接收任何消息,事件过滤Filtering Events应运而生</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406191036030.png" alt="image-20240619103615319" style="zoom:33%;" />

<p>在Prism当中, 我们可以指定为事件指定过滤条件</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">eventAggregator.GetEvent&lt;MessageSentEvent&gt;().Subscribe(</span><br><span class="line">  						 arg =&gt;&#123;</span><br><span class="line">                   <span class="comment">//do something</span></span><br><span class="line">               &#125;,</span><br><span class="line">               ThreadOption.PublisherThread,</span><br><span class="line">               <span class="literal">false</span>,</span><br><span class="line">               <span class="comment">//设置条件为token等于“MessageListViewModel” 则接收消息</span></span><br><span class="line">               message =&gt; message.token.Equals(<span class="keyword">nameof</span>(MessageListViewModel)));</span><br></pre></td></tr></table></figure>

<p>关于Subscribe当中的4个参数, 详解:</p>
<ol>
<li><code>action</code>: 发布事件时执行的回调委托。</li>
<li><code>ThreadOption</code>枚举: 指定在哪个线程上接收委托回调。<ul>
<li><code>PublisherThread</code>: 在发布事件的线程上调用订阅者的委托回调。</li>
<li><code>BackgroundThread</code>: 在后台线程上调用订阅者的委托回调。</li>
<li><code>UIThread</code>: 在UI线程上调用订阅者的委托回调（通常用于更新UI）</li>
</ul>
</li>
<li><code>keepSubscriberReferenceAlive</code>: 如果为true，则Prism.Events.PubSubEvent保留对订阅者的引用因此它不会回收垃圾。<ul>
<li>长期订阅,需要保持状态的情况下设置为true.(基本上可以这么认为,只有贯穿程序一生的订阅才需要设置为true)</li>
<li>临时订阅,不再需要时要被释放资源的情况下设置为false</li>
</ul>
</li>
<li><code>filter</code>: 可选参数，用于筛选事件通知，订阅者可根据筛选条件来决定是否接收特定的事件通知。返回true表示接受通知,返回false表示不接受</li>
</ol>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">prismTestNew.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ViewAViewModel</span>: <span class="title">BindableBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IEventAggregator eventAggregator;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> message;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewAViewModel</span>(<span class="params">IEventAggregator eventAggregator</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">			Message = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">            SendCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">			&#123;</span><br><span class="line">                <span class="comment">//订阅一个消息回调函数(不带订阅过滤器)</span></span><br><span class="line">                <span class="comment">//eventAggregator.GetEvent&lt;MessageEvent&gt;().Subscribe(OnMessageReceived);</span></span><br><span class="line">                <span class="comment">//订阅一个消息回调函数(只接受hello作为回调函数参数的发布信息)</span></span><br><span class="line">                eventAggregator.GetEvent&lt;MessageEvent&gt;().Subscribe(OnMessageReceived, ThreadOption.PublisherThread, <span class="literal">false</span>, (x) =&gt; &#123; <span class="keyword">return</span> x == <span class="string">&quot;hello&quot;</span>; &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            TriggerCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//发布消息触发消息回调(hello作为回调函数的参数)</span></span><br><span class="line">                eventAggregator.GetEvent&lt;MessageEvent&gt;().Publish(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//使用他可以去订阅一些消息</span></span><br><span class="line">            <span class="keyword">this</span>.eventAggregator = eventAggregator;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//针对订阅设置的消息回调函数</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnMessageReceived</span>(<span class="params"><span class="built_in">string</span> messageFromMessageEvent</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Message += messageFromMessageEvent + <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Message</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">get</span> &#123; <span class="keyword">return</span> message; &#125;</span><br><span class="line">			<span class="keyword">set</span> &#123; message = <span class="keyword">value</span>; RaisePropertyChanged(); &#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> DelegateCommand SendCommand &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DelegateCommand TriggerCommand &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//自定义一个消息类型,他的消息是一个字符串</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MessageEvent</span> : <span class="title">PubSubEvent</span>&lt;<span class="title">String</span>&gt;&#123; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视图如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Width=&quot;100&quot; Height=&quot;30&quot; Content=&quot;订阅&quot; Command=&quot;&#123;Binding SendCommand&#125;&quot; Margin=&quot;10&quot;/&gt;</span><br><span class="line">&lt;Button Width=&quot;100&quot; Height=&quot;30&quot; Content=&quot;发布&quot; Command=&quot;&#123;Binding TriggerCommand&#125;&quot; Margin=&quot;10&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>点击订阅之后,点击发布,就会执行到自定义的<code>OnMessageReceived</code>函数</p>
<h3 id="取消订阅"><a href="#取消订阅" class="headerlink" title="取消订阅"></a>取消订阅</h3><p>为注册的消息取消订阅, Prism提供二种方式取消订阅,如下:</p>
<ol>
<li><p>通过委托的方式取消订阅</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">event</span> = IEventAggregator.GetEvent&lt;MessageSentEvent&gt;();</span><br><span class="line"><span class="keyword">event</span>.Unsubscribe(OnMessageReceived);</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过获取订阅者token取消订阅</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">event</span> = eventAggregator.GetEvent&lt;MessageSentEvent&gt;();</span><br><span class="line"><span class="keyword">var</span> token = _event.Subscribe(OnMessageReceived);<span class="comment">//订阅的时候返回token</span></span><br><span class="line"><span class="keyword">event</span>.Unsubscribe(token);</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="区域导航"><a href="#区域导航" class="headerlink" title="区域导航"></a>区域导航</h1><p>在普遍的业务场景当中, 必不可少的是页面切换, 而Prism就可以使用Navigation功能来进行页面导航</p>
<p>prism实现区域导航,需要满足两点基本条件</p>
<ul>
<li>注册显示区域</li>
<li>注册导航页面</li>
</ul>
<h2 id="注册显示区域"><a href="#注册显示区域" class="headerlink" title="注册显示区域"></a>注册显示区域</h2><p>注册视图类型或添加别名, 如果未指定别名,名称默认为当中类型的名称</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModuleAModule</span> : <span class="title">IModule</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>(<span class="params">IContainerProvider containerProvider</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//添加别名 &quot;CustomName&quot;</span></span><br><span class="line">    containerRegistry.RegisterForNavigation&lt;ViewA&gt;(<span class="string">&quot;CustomName&quot;</span>);</span><br><span class="line">    <span class="comment">//默认名称 &quot;ViewB&quot;</span></span><br><span class="line">    containerRegistry.RegisterForNavigation&lt;ViewB&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册时指定ViewModel或添加别名</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ModuleAModule</span> : <span class="title">IModule</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>(<span class="params">IContainerProvider containerProvider</span>)</span></span><br><span class="line">       &#123;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="comment">//指定ViewModel</span></span><br><span class="line">           containerRegistry.RegisterForNavigation&lt;ViewA, ViewAViewModel&gt;();</span><br><span class="line">           <span class="comment">//指定ViewModel并且添加别名</span></span><br><span class="line">           containerRegistry.RegisterForNavigation&lt;ViewB, ViewBViewModel&gt;(<span class="string">&quot;CustomName&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用导航"><a href="#使用导航" class="headerlink" title="使用导航"></a>使用导航</h2><p>在某窗口对应的viewModel文件中需要使用导航,要在构造函数参数中接受IRegionManager regionManager,并将该值存入成员属性中,就可以使用regionManager来进行下述操作了</p>
<p>Region的注册以及管理、导航等, 我们可以使用IRegionManager接口,所以,我们现在便可以使用该接口实现导航功能</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IRegionManager regionManager = …;</span><br><span class="line">regionManager.RequestNavigate(<span class="string">&quot;RegionName&quot;</span>, <span class="string">&quot;ViewName&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>调用了IRegionManager接口的RequestNavigate方法, 并且传递了两个参数:</p>
<ul>
<li><code>RegionName</code>: 该参数为注册的区域名称</li>
<li><code>ViewName</code>: 该参数实际为我们上面注册过的导航页, 字符串类型, 对应的是我们注册页面的nameof</li>
</ul>
<h3 id="带参数导航"><a href="#带参数导航" class="headerlink" title="带参数导航"></a>带参数导航</h3><p>导航页前传递一些参数, 则可以使用NavigationParameters</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种方式</span></span><br><span class="line"><span class="keyword">var</span> param = <span class="keyword">new</span> NavigationParameters();</span><br><span class="line"><span class="comment">//键值对形式</span></span><br><span class="line">param.Add(<span class="string">&quot;Parameter&quot;</span>, param);</span><br><span class="line">_regionManger.RequestNavigate(<span class="string">&quot;RegionName&quot;</span>, <span class="string">&quot;ViewName&quot;</span>, param);</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式</span></span><br><span class="line"><span class="comment">//类似URL地址传递参数</span></span><br><span class="line">_regionManger.RequestNavigate(<span class="string">&quot;RegionName&quot;</span>, <span class="string">&quot;ViewName?id=1&amp;Name=xiaoming&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="控制导航过程"><a href="#控制导航过程" class="headerlink" title="控制导航过程"></a>控制导航过程</h2><p><strong>INavigationAware</strong><br>该接口包含3个方法, 每个方法中都包含当前导航的上下文, 如下所示:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsNavigationTarget</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedFrom</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>OnNavigatedTo</code>: 导航完成前, 此处可以传递过来的参数以及是否允许导航等动作的控制。</li>
<li><code>IsNavigationTarget</code>: 调用以确定此实例是否可以处理导航请求。否则新建实例</li>
<li><code>OnNavigatedFrom</code>: 当导航离开当前页时, 类似打开A, 再打开B时, A中的该方法被触发。</li>
</ul>
<p>执行流程:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406191437848.png" alt="image-20240619143706078" style="zoom: 33%;" />

<h3 id="获取导航请求参数"><a href="#获取导航请求参数" class="headerlink" title="获取导航请求参数"></a>获取导航请求参数</h3><p>导航中允许我们传递参数, 用于在我们完成导航之前, 进行做对应的逻辑业务处理。这时候, 我们便可以在OnNavigatedTo方法中通过导航上下文中获取到传递的所有参数</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> id = navigationContext.Parameters.GetValue&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> name = navigationContext.Parameters[<span class="string">&quot;Name&quot;</span>].ToString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="是否拦截导航请求"><a href="#是否拦截导航请求" class="headerlink" title="是否拦截导航请求"></a>是否拦截导航请求</h3><p><strong>IConfirmNavigationRequest接口</strong>:该接口继承于<code>INavigationAware</code>, 所以, 它多了一个功能: 允许用户针对导航请求判断是否进行拦截</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406191443827.png" alt="image-20240619144337205" style="zoom:33%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfirmNavigationRequest</span>(<span class="params">NavigationContext navigationContext, Action&lt;<span class="built_in">bool</span>&gt; continuationCallback</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">bool</span> result = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (MessageBox.Show(<span class="string">&quot;确认导航?&quot;</span>, <span class="string">&quot;温馨提示&quot;</span>, MessageBoxButton.YesNo) == MessageBoxResult.No)</span><br><span class="line">    result = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//通过回调当前返回的确认结果,决定是否启动该导航</span></span><br><span class="line">  continuationCallback(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回true表示允许导航,返回false表示不允许导航</span></span><br></pre></td></tr></table></figure>

<h2 id="导航日志"><a href="#导航日志" class="headerlink" title="导航日志"></a>导航日志</h2><p><strong>Navigation Journal导航日志</strong>, 其实就是对导航系统的一个管理功能, 理论上来说, 我们应该知道我们上一步导航的位置、以及下一步导航的位置, 包括我们导航的历史记录。以便于我们使用导航对应用程序可以灵活的控制。</p>
<p>IRegionNavigationJournal<br>该接口包含以下功能:</p>
<ul>
<li><code>GoBack()</code> : 返回上一页</li>
<li><code>CanGoBack</code> : 是否可以返回上一页</li>
<li><code>GoForward()</code>: 返回后一页</li>
<li><code>CanGoForward</code> : 是否可以返回后一页</li>
</ul>
<h2 id="完整案例"><a href="#完整案例" class="headerlink" title="完整案例"></a>完整案例</h2><p><a target="_blank" rel="noopener" href="https://github.com/che77a38/prismLearn/tree/main/testNavigation">github上完整代码参考</a></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">│</span><br><span class="line">├── App.xaml</span><br><span class="line">├── App.xaml.cs</span><br><span class="line">│</span><br><span class="line">├── Views\</span><br><span class="line">│   ├── MainWindow.xaml</span><br><span class="line">│   ├── ViewA.xaml</span><br><span class="line">│   └── ViewB.xaml</span><br><span class="line">│</span><br><span class="line">└── ViewModels\</span><br><span class="line">    ├── MainWindowViewModel.cs</span><br><span class="line">    ├── ViewAViewModel.cs</span><br><span class="line">    └── ViewBViewModel.cs</span><br></pre></td></tr></table></figure>

<p>新建两个视图<code>ViewA.xaml</code>和<code>ViewB.xaml</code>,并在<code>App.xaml.cs</code>中注册两个界面</p>
<h3 id="App-xaml-cs"><a href="#App-xaml-cs" class="headerlink" title="App.xaml.cs"></a>App.xaml.cs</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Ioc;</span><br><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"><span class="keyword">using</span> testNavigation.Views;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">testNavigation</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Interaction logic for App.xaml</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Window <span class="title">CreateShell</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Container.Resolve&lt;MainWindow&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//此处要注册各种资源</span></span><br><span class="line">            <span class="comment">//默认名为ViewA</span></span><br><span class="line">            <span class="comment">//containerRegistry.RegisterForNavigation&lt;ViewA&gt;();</span></span><br><span class="line">            <span class="comment">//起名方式</span></span><br><span class="line">            containerRegistry.RegisterForNavigation&lt;ViewA&gt;(<span class="string">&quot;PageA&quot;</span>);</span><br><span class="line">            containerRegistry.RegisterForNavigation&lt;ViewB&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MainWindowViewModel.cs以及MainWindow.xaml中对视图进行完善并绑定相关command</p>
<h3 id="MainWindowViewModel-cs"><a href="#MainWindowViewModel-cs" class="headerlink" title="MainWindowViewModel.cs"></a>MainWindowViewModel.cs</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Commands;</span><br><span class="line"><span class="keyword">using</span> Prism.Mvvm;</span><br><span class="line"><span class="keyword">using</span> Prism.Regions;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">testNavigation.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainWindowViewModel</span> : <span class="title">BindableBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> _title = <span class="string">&quot;Prism Application&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Title</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _title; &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetProperty(<span class="keyword">ref</span> _title, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IRegionManager regionManager;</span><br><span class="line">        <span class="comment">//用于记录日志情况</span></span><br><span class="line">        IRegionNavigationJournal journal;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DelegateCommand OpenACommand &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DelegateCommand OpenBCommand &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DelegateCommand GoBackCommand &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DelegateCommand GoForwordCommand &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainWindowViewModel</span>(<span class="params">IRegionManager regionManager</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            OpenACommand = <span class="keyword">new</span> DelegateCommand(OpenA);</span><br><span class="line">            OpenBCommand = <span class="keyword">new</span> DelegateCommand(OpenB);</span><br><span class="line">            GoBackCommand = <span class="keyword">new</span> DelegateCommand(GoBack);</span><br><span class="line">            GoForwordCommand = <span class="keyword">new</span> DelegateCommand(GoForword);</span><br><span class="line">            <span class="keyword">this</span>.regionManager = regionManager;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OpenA</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//传递参数给ViewA</span></span><br><span class="line">            NavigationParameters param = <span class="keyword">new</span> NavigationParameters();</span><br><span class="line">            <span class="comment">//参数传递的方式是通过键值对</span></span><br><span class="line">            param.Add(<span class="string">&quot;Value&quot;</span>, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">            <span class="comment">//导航到ViewA(带参数)</span></span><br><span class="line">            <span class="comment">//regionManager.RequestNavigate(&quot;ContentRegion&quot;, nameof(Views.ViewA),param);</span></span><br><span class="line">            <span class="comment">//使用字符串导航(带参数)</span></span><br><span class="line">            <span class="comment">//regionManager.RequestNavigate(&quot;ContentRegion&quot;, &quot;PageA&quot;,param);</span></span><br><span class="line">            <span class="comment">//传递参数的另一种写法(类似html的写法)   顺便加上了获取上下文日志</span></span><br><span class="line">            regionManager.RequestNavigate(<span class="string">&quot;ContentRegion&quot;</span>, <span class="string">$&quot;PageA?Value=Hello1&quot;</span>, arg =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//导航后拿到上下文日志</span></span><br><span class="line">                journal = arg.Context.NavigationService.Journal;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OpenB</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//导航到ViewB(第三个参数设置导航完成的时候触发回调函数)</span></span><br><span class="line">            regionManager.RequestNavigate(<span class="string">&quot;ContentRegion&quot;</span>, <span class="keyword">nameof</span>(Views.ViewB), arg =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//导航后拿到上下文日志</span></span><br><span class="line">                journal = arg.Context.NavigationService.Journal;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoBack</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">          	<span class="comment">//向后导航</span></span><br><span class="line">            journal.GoBack();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoForword</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">          	<span class="comment">//向前导航</span></span><br><span class="line">            journal.GoForward();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MainWindow-xaml"><a href="#MainWindow-xaml" class="headerlink" title="MainWindow.xaml"></a>MainWindow.xaml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window x:Class=&quot;testNavigation.Views.MainWindow&quot;</span><br><span class="line">        xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:prism=&quot;http://prismlibrary.com/&quot;</span><br><span class="line">        prism:ViewModelLocator.AutoWireViewModel=&quot;True&quot;</span><br><span class="line">        Title=&quot;&#123;Binding Title&#125;&quot; Height=&quot;350&quot; Width=&quot;525&quot; &gt;</span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;Grid.RowDefinitions&gt;</span><br><span class="line">            &lt;RowDefinition Height=&quot;Auto&quot; /&gt;</span><br><span class="line">            &lt;RowDefinition Height=&quot;*&quot; /&gt;</span><br><span class="line">        &lt;/Grid.RowDefinitions&gt;</span><br><span class="line">        &lt;StackPanel Grid.Row=&quot;0&quot; Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">            &lt;Button Content=&quot;上一步&quot; Width=&quot;auto&quot; Height=&quot;auto&quot; Margin=&quot;3&quot; Command=&quot;&#123;Binding GoBackCommand&#125;&quot;/&gt;</span><br><span class="line">            &lt;Button Content=&quot;下一步&quot; Width=&quot;auto&quot; Height=&quot;auto&quot; Margin=&quot;3&quot; Command=&quot;&#123;Binding GoForwordCommand&#125;&quot;/&gt;</span><br><span class="line">            &lt;Button Content=&quot;打开A&quot; Width=&quot;auto&quot; Height=&quot;auto&quot; Margin=&quot;3&quot; Command=&quot;&#123;Binding OpenACommand&#125;&quot;/&gt;</span><br><span class="line">            &lt;Button Content=&quot;打开B&quot; Width=&quot;auto&quot; Height=&quot;auto&quot; Margin=&quot;3&quot; Command=&quot;&#123;Binding OpenBCommand&#125;&quot;/&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">        &lt;ContentControl Grid.Row=&quot;1&quot; prism:RegionManager.RegionName=&quot;ContentRegion&quot; /&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这行代码在 XAML 中定义了一个 TabControl 控件，并使用 Prism 框架的 RegionManager 来将该控件与名为 ContentRegion 的区域关联起来。这种关联允许在该区域内动态加载和管理与 TabControl 相关的视图</p>
</blockquote>
<h3 id="ViewAViewModel-cs"><a href="#ViewAViewModel-cs" class="headerlink" title="ViewAViewModel.cs"></a>ViewAViewModel.cs</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Mvvm;</span><br><span class="line"><span class="keyword">using</span> Prism.Regions;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">testNavigation.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//继承BindableBase用于实现通知,继承INavigationAware用于实现view导航,可以使用IConfirmNavigationRequest代替INavigationAware,就可以多一个ConfirmNavigationRequest方法用于判断是否允许导航(IConfirmNavigationRequest是继承INavigationAware)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ViewAViewModel</span> : <span class="title">BindableBase</span>,<span class="title">IConfirmNavigationRequest</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> title;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Title</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> title; &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; title = <span class="keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否允许导航</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfirmNavigationRequest</span>(<span class="params">NavigationContext navigationContext, Action&lt;<span class="built_in">bool</span>&gt; continuationCallback</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">bool</span> result = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(MessageBox.Show(<span class="string">&quot;确认导航&quot;</span>,<span class="string">&quot;温馨提示&quot;</span>,MessageBoxButton.YesNo)==MessageBoxResult.No)</span><br><span class="line">                result = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">//固定格式</span></span><br><span class="line">            continuationCallback(result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 重新创建实例的一个判断,如果已经打开过当前实例的话,如果打开过还返回一个true的话,他会创建一个新的实例覆盖原来的</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;navigationContext&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;NotImplementedException&quot;&gt;</span><span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsNavigationTarget</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 导航离开当前页时触发</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;navigationContext&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;NotImplementedException&quot;&gt;</span><span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedFrom</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 导航完成前,接收用户传递的参数以及是否允许导航等控制</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;navigationContext&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;NotImplementedException&quot;&gt;</span><span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNavigatedTo</span>(<span class="params">NavigationContext navigationContext</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//接收Value键对应的值(string类型)</span></span><br><span class="line">            title = navigationContext.Parameters.GetValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;Value&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ViewA-xaml"><a href="#ViewA-xaml" class="headerlink" title="ViewA.xaml"></a>ViewA.xaml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl x:Class=&quot;testNavigation.Views.ViewA&quot;</span><br><span class="line">             xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot; </span><br><span class="line">             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot; </span><br><span class="line">             xmlns:local=&quot;clr-namespace:testNavigation.Views&quot;</span><br><span class="line">             mc:Ignorable=&quot;d&quot; </span><br><span class="line">             d:DesignHeight=&quot;450&quot; d:DesignWidth=&quot;800&quot;&gt;</span><br><span class="line">    &lt;Grid Background=&quot;Yellow&quot;&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;&#123;Binding Title&#125;&quot;/&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>

<h1 id="对话服务"><a href="#对话服务" class="headerlink" title="对话服务"></a>对话服务</h1><p>Prism提供了一组对话服务, 封装了常用的对话框组件的功能</p>
<ul>
<li>RegisterDialog&#x2F;IDialogService (注册对话及使用对话)</li>
<li>打开对话框传递参数&#x2F;关闭对话框返回参数</li>
<li>回调通知对话结果</li>
</ul>
<h2 id="实现对话框"><a href="#实现对话框" class="headerlink" title="实现对话框"></a>实现对话框</h2><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406191616966.png" alt="img" style="zoom:33%;" />

<p>创建对话框,(注意)通常是一组<strong>用户控件</strong> ,并且实现 IDialogAware</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IDialogAware</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">string</span> Title &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">  <span class="keyword">event</span> Action&lt;IDialogResult&gt; RequestClose;</span><br><span class="line">  <span class="function"><span class="built_in">bool</span> <span class="title">CanCloseDialog</span>()</span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">OnDialogClosed</span>()</span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">OnDialogOpened</span>(<span class="params">IDialogParameters parameters</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例子</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Commands;</span><br><span class="line"><span class="keyword">using</span> Prism.Mvvm;</span><br><span class="line"><span class="keyword">using</span> Prism.Services.Dialogs;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">testDialog.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MsgViewModel</span> : <span class="title">BindableBase</span>,<span class="title">IDialogAware</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Title&#123; <span class="keyword">set</span>; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> Action&lt;IDialogResult&gt; RequestClose;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DelegateCommand OkCommand &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DelegateCommand CancleCommand &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MsgViewModel</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            OkCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//成功时构造返回结果返回出去(也是键值对)</span></span><br><span class="line">                DialogParameters param = <span class="keyword">new</span> DialogParameters();</span><br><span class="line">                param.Add(<span class="string">&quot;Value&quot;</span>, Title);</span><br><span class="line">                RequestClose?.Invoke(<span class="keyword">new</span> DialogResult(ButtonResult.OK, param));</span><br><span class="line">            &#125;);</span><br><span class="line">            CancleCommand = <span class="keyword">new</span> DelegateCommand(() =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                RequestClose?.Invoke(<span class="keyword">new</span> DialogResult(ButtonResult.No));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//是否允许关闭当前窗口</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">CanCloseDialog</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;    </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭时触发</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDialogClosed</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打开前触发(用于接受参数)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDialogOpened</span>(<span class="params">IDialogParameters parameters</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Title = parameters.GetValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;Value&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注册对话框"><a href="#注册对话框" class="headerlink" title="注册对话框"></a>注册对话框</h2><p>注册对话框 RegisterDialog</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//三选一:</span></span><br><span class="line">  <span class="comment">//仅注册视图</span></span><br><span class="line">  containerRegistry.RegisterDialog&lt;MessageDialog&gt;();</span><br><span class="line">  <span class="comment">//注册视图时绑定VM</span></span><br><span class="line">  containerRegistry.RegisterDialog&lt;MessageDialog, MessageDialogViewModel&gt;();</span><br><span class="line">  <span class="comment">//添加别名</span></span><br><span class="line">  containerRegistry.RegisterDialog&lt;MessageDialog&gt;(<span class="string">&quot;DialogName&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用Dialog"><a href="#使用Dialog" class="headerlink" title="使用Dialog"></a>使用Dialog</h2><p>使用IDialogService接口 Show&#x2F;ShowDialog 方法调用对话框</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406191623086.png" alt="img" style="zoom:25%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> IDialogService dialogService;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShowDialog</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  DialogParameters keys = <span class="keyword">new</span> DialogParameters();</span><br><span class="line">  keys.Add(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Hello,Prism!&quot;</span>);</span><br><span class="line"></span><br><span class="line">  dialogService.ShowDialog(<span class="string">&quot;MessageDialog&quot;</span>, keys, arg =&gt;</span><br><span class="line">                           &#123;</span><br><span class="line"></span><br><span class="line">                           &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>调用Show&#x2F;ShowDialog,我们通过注册时候的名称进行打开, 并且可以传递参数, 以及回调方法(主要用于返回对话框的返回结果)</strong></p>
<p><strong>使用对话框实例</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Prism.Commands;</span><br><span class="line"><span class="keyword">using</span> Prism.Mvvm;</span><br><span class="line"><span class="keyword">using</span> Prism.Services.Dialogs;</span><br><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"><span class="keyword">using</span> testDialog.Views;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">testDialog.ViewModels</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainWindowViewModel</span> : <span class="title">BindableBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> DelegateCommand ShowDialogCommand &#123;  <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对话框服务</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IDialogService dialog;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> _title = <span class="string">&quot;Prism Application&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Title</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _title; &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; SetProperty(<span class="keyword">ref</span> _title, <span class="keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//增加IDialogService参数</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainWindowViewModel</span>(<span class="params">IDialogService dialog</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            ShowDialogCommand = <span class="keyword">new</span> DelegateCommand(ShowDialog);</span><br><span class="line">            <span class="keyword">this</span>.dialog = dialog;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ShowDialog</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//添加参数</span></span><br><span class="line">            DialogParameters param = <span class="keyword">new</span> DialogParameters();</span><br><span class="line">            param.Add(<span class="string">&quot;Value&quot;</span>, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">            <span class="comment">//显示对话框(不带参数)</span></span><br><span class="line">            <span class="comment">//dialog.ShowDialog(&quot;dialogView&quot;);</span></span><br><span class="line">            <span class="comment">//显示对话框阳</span></span><br><span class="line">            dialog.ShowDialog(<span class="string">&quot;dialogView&quot;</span>,param, arg =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(arg.Result == ButtonResult.OK)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//获取返回的结果</span></span><br><span class="line">                    MessageBox.Show(arg.Parameters.GetValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;Value&quot;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="封装Dialog-API"><a href="#封装Dialog-API" class="headerlink" title="封装Dialog API"></a>封装Dialog API</h2><p>对于常用的公共对话框, 我们可以封装成扩展方法, 以便于我们在应用程序的任何位置可以使用到它</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowNotification</span>(<span class="params"><span class="keyword">this</span> IDialogService dialogService,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="built_in">string</span> message, Action&lt;IDialogResult&gt; callback</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> DialogParameters();</span><br><span class="line">p.Add(<span class="string">&quot;message&quot;</span>, message);</span><br><span class="line">dialogService.ShowDialog(“NotificationDialog<span class="string">&quot;, p, callback);</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="实例参考"><a href="#实例参考" class="headerlink" title="实例参考"></a>实例参考</h2><p><a target="_blank" rel="noopener" href="https://github.com/che77a38/prismLearn/tree/main/testDialog">测试实例参考</a></p>
<h2 id="弹窗数据传递的核心机制"><a href="#弹窗数据传递的核心机制" class="headerlink" title="弹窗数据传递的核心机制"></a>弹窗数据传递的核心机制</h2><p><a href="#%E4%BC%A0%E5%85%A5%E5%8F%8A%E4%BC%A0%E5%87%BA%E5%8F%82%E6%95%B0">传入数据给对话框</a>  &#x3D;&gt; [[  对话框实现  ]](#弹窗 ViewModel 实现 IDialogAware) &#x3D;&gt; <a href="#%E4%BC%A0%E5%85%A5%E5%8F%8A%E4%BC%A0%E5%87%BA%E5%8F%82%E6%95%B0">传出数据给父级窗口处理程序</a></p>
<p>Prism的对话框服务遵循以下流程:</p>
<ul>
<li><strong>参数传递:</strong> 调用弹窗时通过 <code>DialogParameters</code> 向弹窗传递初始参数</li>
<li><strong>结果回调:</strong> 弹窗关闭时通过 <code>IDialogResult</code> 返回用户输入的数据</li>
<li><strong>接口实现:</strong> 弹窗的 ViewModel 需实现 <code>IDialogAware</code> 接口，处理打开、关闭和数据回传逻辑</li>
</ul>
<h3 id="传入及传出参数"><a href="#传入及传出参数" class="headerlink" title="传入及传出参数"></a>传入及传出参数</h3><p>在父窗口的 ViewModel 中，使用 <code>IDialogService.ShowDialog</code> 方法打开弹窗，并通过 <code>DialogParameters</code> 传递参数</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OpenDialog</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    DialogParameters parameters = <span class="keyword">new</span> DialogParameters();</span><br><span class="line">    parameters.Add(<span class="string">&quot;initialValue&quot;</span>, <span class="string">&quot;默认文本&quot;</span>); <span class="comment">// 传递初始值</span></span><br><span class="line">    dialogService.ShowDialog(<span class="string">&quot;UserInputDialog&quot;</span>, parameters, result =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.Result == ButtonResult.OK)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> userInput = result.Parameters.GetValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;userInput&quot;</span>);</span><br><span class="line">            <span class="comment">// 处理用户输入的数据</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//也可以简写成:</span></span><br><span class="line"> dialogService.ShowDialog(<span class="string">&quot;SelectLinkPointDialogView&quot;</span>, <span class="keyword">new</span> DialogParameters</span><br><span class="line"> &#123;</span><br><span class="line">     &#123; <span class="string">&quot;input&quot;</span>, <span class="string">&quot;测试输入内容111&quot;</span> &#125;,</span><br><span class="line"> &#125;, r =&gt;</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="keyword">if</span> (r.Result == ButtonResult.OK)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">var</span> values = r.Parameters.GetValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;output&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>UserInputDialog</code>：弹窗的注册名称。</li>
<li><code>result</code>：回调参数，包含用户操作结果（确定&#x2F;取消）和返回的数据</li>
</ul>
<h3 id="弹窗-ViewModel-实现-IDialogAware"><a href="#弹窗-ViewModel-实现-IDialogAware" class="headerlink" title="弹窗 ViewModel 实现 IDialogAware"></a>弹窗 ViewModel 实现 IDialogAware</h3><p>弹窗的 ViewModel 需实现 <code>IDialogAware</code> 接口，处理数据接收与返回</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserInputDialogViewModel</span> : <span class="title">BindableBase</span>,<span class="title">IDialogAware</span></span><br><span class="line">&#123;</span><br><span class="line">  </span><br><span class="line">   			<span class="keyword">public</span> <span class="built_in">string</span> Title =&gt; <span class="string">&quot;对话框标题&quot;</span>;</span><br><span class="line">  </span><br><span class="line">        <span class="comment">//是否允许关闭当前窗口</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">CanCloseDialog</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;    </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭时触发</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDialogClosed</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//在关闭前提供了一个时机点来做一些处理</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打开前触发(用于接受参数)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDialogOpened</span>(<span class="params">IDialogParameters parameters</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">           <span class="keyword">if</span> (parameters.ContainsKey(<span class="string">&quot;Value&quot;</span>))</span><br><span class="line">           		Title = parameters.GetValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;Value&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">  			</span><br><span class="line">  			<span class="comment">//请求退出,给外界提供的获取接口</span></span><br><span class="line">  			<span class="keyword">public</span> <span class="keyword">event</span> Action&lt;IDialogResult&gt; RequestClose;</span><br><span class="line">  </span><br><span class="line">  		<span class="comment">//可以在对话框中添加按钮,按钮绑定到命令</span></span><br><span class="line">  		<span class="keyword">private</span> DelegateCommand&lt;<span class="built_in">string</span>&gt; _closeDialogCommand;</span><br><span class="line">			<span class="keyword">public</span> DelegateCommand&lt;<span class="built_in">string</span>&gt; CloseDialogCommand =&gt;</span><br><span class="line">    _closeDialogCommand ?? (_closeDialogCommand = <span class="keyword">new</span> DelegateCommand&lt;<span class="built_in">string</span>&gt;(ExecuteCloseDialogCommand));</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">ExecuteCloseDialogCommand</span>(<span class="params"><span class="built_in">string</span> parameter</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">        	<span class="keyword">var</span> dialogResult = <span class="keyword">new</span> DialogResult(ButtonResult.OK);</span><br><span class="line">        	dialogResult.Parameters.Add(<span class="string">&quot;values&quot;</span>, <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt;(_inputValues));</span><br><span class="line">        	RequestClose?.Invoke(dialogResult); <span class="comment">//确保对话框是通过调用RequestClose事件来关闭的，而不是通过直接关闭窗口的方式。这样可以确保DialogResult被正确传递</span></span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现的对话框需要注册才能使用"><a href="#实现的对话框需要注册才能使用" class="headerlink" title="实现的对话框需要注册才能使用"></a>实现的对话框需要注册才能使用</h3><p>在 Prism 的模块或容器中注册弹窗：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">RegisterTypes</span>(<span class="params">IContainerRegistry containerRegistry</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    containerRegistry.RegisterDialog&lt;UserInputDialog, UserInputDialogViewModel&gt;(<span class="string">&quot;UserInputDialog&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册时需要指定弹窗的 View 和 ViewModel，并为弹窗命名</p>
<h3 id="参数与返回值的封装"><a href="#参数与返回值的封装" class="headerlink" title="参数与返回值的封装"></a>参数与返回值的封装</h3><p>为提高代码可维护性，可封装自定义参数类：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserInputResult</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> InputText &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsConfirmed &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在回调中使用</span></span><br><span class="line"><span class="keyword">var</span> result = result.Parameters.GetValue&lt;UserInputResult&gt;(<span class="string">&quot;result&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>通过强类型对象代替松散键值对，减少硬编码风险</p>
<h2 id="对话框窗口外观设置"><a href="#对话框窗口外观设置" class="headerlink" title="对话框窗口外观设置"></a>对话框窗口外观设置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;prism:Dialog.WindowStyle&gt;</span><br><span class="line">    &lt;Style TargetType=&quot;Window&quot;&gt;</span><br><span class="line">      &lt;!--定义了对话框的启动位置。`CenterScreen` 表示窗口将在屏幕中央启动--&gt;</span><br><span class="line">        &lt;Setter Property=&quot;prism:Dialog.WindowStartupLocation&quot; Value=&quot;CenterScreen&quot; /&gt;</span><br><span class="line">      &lt;!--决定窗口是否在任务栏中显示。`True` 表示该窗口会在任务栏中显示--&gt;</span><br><span class="line">        &lt;Setter Property=&quot;ShowInTaskbar&quot; Value=&quot;True&quot; /&gt;</span><br><span class="line">      &lt;!--定义窗口的大小行为。`WidthAndHeight` 表示窗口的大小将根据其内容自动调整，以适应窗口中显示的内容的宽度和高度--&gt;</span><br><span class="line">        &lt;Setter Property=&quot;SizeToContent&quot; Value=&quot;WidthAndHeight&quot; /&gt;</span><br><span class="line">      &lt;!--指定了窗口的样式。`ToolWindow` 通常用于工具窗口，具有较小的标题栏和不同的外观，适合用于辅助工具或面板--&gt;</span><br><span class="line">        &lt;Setter Property=&quot;WindowStyle&quot; Value=&quot;ToolWindow&quot; /&gt;</span><br><span class="line">      &lt;!--使窗口不可被手动改变大小--&gt;</span><br><span class="line">       &lt;Setter Property=&quot;ResizeMode&quot; Value=&quot;NoResize&quot; /&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">&lt;/prism:Dialog.WindowStyle&gt;</span><br></pre></td></tr></table></figure>









</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"></a><div class="post-copyright__author_name">ZEROKO14</div><div class="post-copyright__author_desc">zeroko14's blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://che77a38.github.io/posts/prism/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://che77a38.github.io/posts/prism/')">Prism</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://che77a38.github.io/posts/prism/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Prism&amp;url=https://che77a38.github.io/posts/prism/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://che77a38.github.io" target="_blank">ZEROKO14的个人博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/WPF/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>WPF<span class="tagsPageCount">3</span></a><a class="post-meta__box__tags" href="/tags/C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>C#<span class="tagsPageCount">3</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E6%91%84%E5%83%8F%E5%A4%B4%E7%9B%91%E6%8E%A7%E5%BC%80%E5%8F%91/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">摄像头监控开发</div></div></a></div><div class="next-post pull-right"><a href="/posts/hello-world/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hello World</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/avalonia/" title="avalonia"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-09-11</div><div class="title">avalonia</div></div></a></div><div><a href="/posts/WPF/" title="WPF"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-11</div><div class="title">WPF</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">欢迎来到ZEROKO14的个人博客</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ZEROKO14</h1><div class="author-info__desc">zeroko14's blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/che77a38" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Prism%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">Prism的初始化过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vs%E6%8F%92%E4%BB%B6%E6%94%AF%E6%8C%81"><span class="toc-number">2.</span> <span class="toc-text">vs插件支持</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ride%E6%94%AF%E6%8C%81"><span class="toc-number">3.</span> <span class="toc-text">ride支持</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AA%97%E4%BD%93%E5%88%87%E6%8D%A2"><span class="toc-number">4.</span> <span class="toc-text">窗体切换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Region"><span class="toc-number">5.</span> <span class="toc-text">Region</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">5.1.</span> <span class="toc-text">基本使用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">5.2.</span> <span class="toc-text">区域适配器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%BA%E5%9F%9F%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">5.2.1.</span> <span class="toc-text">自定义区域适配器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RegionManager"><span class="toc-number">5.3.</span> <span class="toc-text">RegionManager</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Module"><span class="toc-number">6.</span> <span class="toc-text">Module</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9D%97"><span class="toc-number">6.1.</span> <span class="toc-text">创建模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">6.2.</span> <span class="toc-text">加载模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F"><span class="toc-number">6.2.1.</span> <span class="toc-text">代码方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Directory%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97%E7%9B%AE%E5%BD%95"><span class="toc-number">6.2.2.</span> <span class="toc-text">Directory配置模块目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#App-Config%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97%E7%9B%AE%E5%BD%95"><span class="toc-number">6.2.3.</span> <span class="toc-text">App.Config配置模块目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XAML%E9%85%8D%E7%BD%AE%E6%A8%A1%E5%9D%97%E7%9B%AE%E5%BD%95"><span class="toc-number">6.2.4.</span> <span class="toc-text">XAML配置模块目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prism%E6%8E%A7%E5%88%B6%E4%BD%95%E6%97%B6%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">6.2.5.</span> <span class="toc-text">Prism控制何时加载模块</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">视图注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">依赖注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ViewModelLocator"><span class="toc-number">9.</span> <span class="toc-text">ViewModelLocator</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Prism%E4%B8%AD%E7%9A%84MVVM"><span class="toc-number">10.</span> <span class="toc-text">Prism中的MVVM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Prism%E4%B8%8E%E5%B8%B8%E8%A7%81%E7%9A%84MVVM%E6%A1%86%E6%9E%B6%E5%8C%BA%E5%88%AB"><span class="toc-number">10.1.</span> <span class="toc-text">Prism与常见的MVVM框架区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8ViewModel%E5%AE%9E%E7%8E%B0%E5%9F%BA%E7%A1%80%E7%BB%91%E5%AE%9A%E3%80%81Command%E3%80%81%E4%BA%8B%E4%BB%B6%E8%81%9A%E5%90%88%E5%99%A8%E7%AD%89%E6%93%8D%E4%BD%9C"><span class="toc-number">10.2.</span> <span class="toc-text">如何在ViewModel实现基础绑定、Command、事件聚合器等操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%9F%BA%E7%A1%80%E7%BB%91%E5%AE%9A"><span class="toc-number">10.2.1.</span> <span class="toc-text">实现基础绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BindableBase"><span class="toc-number">10.2.2.</span> <span class="toc-text">BindableBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%A4%9A%E5%91%BD%E4%BB%A4"><span class="toc-number">10.2.3.</span> <span class="toc-text">绑定多命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E8%81%9A%E5%90%88%E5%99%A8"><span class="toc-number">10.3.</span> <span class="toc-text">事件聚合器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4"><span class="toc-number">10.3.1.</span> <span class="toc-text">事件过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">10.3.2.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%B6%88%E8%AE%A2%E9%98%85"><span class="toc-number">10.3.3.</span> <span class="toc-text">取消订阅</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E5%AF%BC%E8%88%AA"><span class="toc-number">11.</span> <span class="toc-text">区域导航</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%98%BE%E7%A4%BA%E5%8C%BA%E5%9F%9F"><span class="toc-number">11.1.</span> <span class="toc-text">注册显示区域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AF%BC%E8%88%AA"><span class="toc-number">11.2.</span> <span class="toc-text">使用导航</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%8F%82%E6%95%B0%E5%AF%BC%E8%88%AA"><span class="toc-number">11.2.1.</span> <span class="toc-text">带参数导航</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%AF%BC%E8%88%AA%E8%BF%87%E7%A8%8B"><span class="toc-number">11.3.</span> <span class="toc-text">控制导航过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AF%BC%E8%88%AA%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">11.3.1.</span> <span class="toc-text">获取导航请求参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E5%90%A6%E6%8B%A6%E6%88%AA%E5%AF%BC%E8%88%AA%E8%AF%B7%E6%B1%82"><span class="toc-number">11.3.2.</span> <span class="toc-text">是否拦截导航请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E6%97%A5%E5%BF%97"><span class="toc-number">11.4.</span> <span class="toc-text">导航日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B"><span class="toc-number">11.5.</span> <span class="toc-text">完整案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#App-xaml-cs"><span class="toc-number">11.5.1.</span> <span class="toc-text">App.xaml.cs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MainWindowViewModel-cs"><span class="toc-number">11.5.2.</span> <span class="toc-text">MainWindowViewModel.cs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MainWindow-xaml"><span class="toc-number">11.5.3.</span> <span class="toc-text">MainWindow.xaml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewAViewModel-cs"><span class="toc-number">11.5.4.</span> <span class="toc-text">ViewAViewModel.cs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewA-xaml"><span class="toc-number">11.5.5.</span> <span class="toc-text">ViewA.xaml</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%9C%8D%E5%8A%A1"><span class="toc-number">12.</span> <span class="toc-text">对话服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">12.1.</span> <span class="toc-text">实现对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">12.2.</span> <span class="toc-text">注册对话框</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Dialog"><span class="toc-number">12.3.</span> <span class="toc-text">使用Dialog</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85Dialog-API"><span class="toc-number">12.4.</span> <span class="toc-text">封装Dialog API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%8F%82%E8%80%83"><span class="toc-number">12.5.</span> <span class="toc-text">实例参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%B9%E7%AA%97%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92%E7%9A%84%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6"><span class="toc-number">12.6.</span> <span class="toc-text">弹窗数据传递的核心机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E5%85%A5%E5%8F%8A%E4%BC%A0%E5%87%BA%E5%8F%82%E6%95%B0"><span class="toc-number">12.6.1.</span> <span class="toc-text">传入及传出参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B9%E7%AA%97-ViewModel-%E5%AE%9E%E7%8E%B0-IDialogAware"><span class="toc-number">12.6.2.</span> <span class="toc-text">弹窗 ViewModel 实现 IDialogAware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%AF%B9%E8%AF%9D%E6%A1%86%E9%9C%80%E8%A6%81%E6%B3%A8%E5%86%8C%E6%89%8D%E8%83%BD%E4%BD%BF%E7%94%A8"><span class="toc-number">12.6.3.</span> <span class="toc-text">实现的对话框需要注册才能使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%B8%8E%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-number">12.6.4.</span> <span class="toc-text">参数与返回值的封装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E7%AA%97%E5%8F%A3%E5%A4%96%E8%A7%82%E8%AE%BE%E7%BD%AE"><span class="toc-number">12.7.</span> <span class="toc-text">对话框窗口外观设置</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%B7%A5%E4%B8%9A%E7%9B%B8%E5%85%B3/" title="工业相关">工业相关</a><time datetime="2025-02-14T03:04:40.761Z" title="发表于 2025-02-14 11:04:40">2025-02-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA/" title="操作系统">操作系统</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%AE%A1%E7%BB%84/" title="计算机组成原理">计算机组成原理</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" title="网络架构">网络架构</a><time datetime="2024-11-18T06:17:01.282Z" title="发表于 2024-11-18 14:17:01">2024-11-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/avalonia/" title="avalonia">avalonia</a><time datetime="2024-09-11T14:51:13.000Z" title="发表于 2024-09-11 22:51:13">2024-09-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="ZEROKO14" target="_blank">ZEROKO14</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu"></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 0.88rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 0.88rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 0.88rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 0.88rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 0.88rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 0.88rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 0.88rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 0.88rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 0.88rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 0.88rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 0.88rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 0.88rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 0.88rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 0.88rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 0.88rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 0.88rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 0.88rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 0.88rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 0.88rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">基础<sup>3</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>1</sup></a><a href="/tags/%E7%A1%AC%E7%BC%96%E7%A0%81/" style="font-size: 0.88rem;">硬编码<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>