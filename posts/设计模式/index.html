<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>设计模式 | ZEROKO14的个人博客</title><meta name="keywords" content="设计模式"><meta name="author" content="ZEROKO14"><meta name="copyright" content="ZEROKO14"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="设计模式"><meta name="application-name" content="设计模式"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="设计模式"><meta property="og:url" content="https://che77a38.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html"><meta property="og:site_name" content="ZEROKO14的个人博客"><meta property="og:description" content="详解23种设计模式   在了解设计模式之前首先应该先立靶,即何为优秀的设计 面向对象设计原则下面是面向对象设计中的重要原则，通常统称为“SOLID”原则。它们用于指导软件设计，以提高代码的可维护性、可扩展性和灵活性  单一职责原则（Single Responsibility Principle）：一"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta property="article:author" content="ZEROKO14"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta name="description" content="详解23种设计模式   在了解设计模式之前首先应该先立靶,即何为优秀的设计 面向对象设计原则下面是面向对象设计中的重要原则，通常统称为“SOLID”原则。它们用于指导软件设计，以提高代码的可维护性、可扩展性和灵活性  单一职责原则（Single Responsibility Principle）：一"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://che77a38.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: ZEROKO14","link":"链接: ","source":"来源: ZEROKO14的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZEROKO14的个人博客',
  title: '设计模式',
  postAI: '',
  pageFillDescription: '面向对象设计原则, 组合优于继承原则, 对象组合与类继承的对比, 继承式, 组合式, 继承式优缺点, 组合式优缺点, 组合缺点以及解决方案, 依赖注入, 依赖倒置原则, 概述, 设计模式的重要性, 23种设计模式, 创建型模式（Creational Patterns）, 结构型模式（Structural Patterns）, 行为型模式（Behavioral Patterns）, 设计模式之间的关系, 图例讲解, 创建型模式, 工厂模式, 简单工厂模式, 抽象工厂模式, 实例, 单例模式, 原型模式, 构造器模式, 结构型模式, 适配器模式, 类-适配器, 实例, 对象-适配器, 实例, 桥接模式, 组合模式, 实例, 装饰模式, 案例, 外观模式, 享元模式, 案例, 代理模式, 案例, 行为型模式, 职责链模式, 案例代码, 命令模式, 开关灯案例, 文本编辑器案例, 解释器模式, 案例, 迭代器模式, 案例, 观察者模式, 案例, 与发布-订阅模式的区别, 中介者模式, 案例, 策略模式, 案例, 状态模式, 状态模式实例, 与策略模式的意图差异, 状态机, 有限状态机重要性, 绘制状态机, 优秀的状态模式设计, 备忘录模式, 案例, 模板方法模式, 访问者模式, 案例, UML类图, 类的UML画法, 关系画法总结, 继承关系, 普通继承关系, 抽象继承关系, 关联关系, 单向关联关系, 双向关联关系, 自关联关系, 聚合关系, 组合关系, 依赖关系, 关联、聚合、组合之间的区别详解种设计模式在了解设计模式之前首先应该先立靶即何为优秀的设计面向对象设计原则下面是面向对象设计中的重要原则通常统称为原则它们用于指导软件设计以提高代码的可维护性可扩展性和灵活性单一职责原则一个类应该只有一个引起变化的原因即一个类应该只负责一个功能开放封闭原则软件实体类模块函数等应该对扩展开放对修改关闭可以通过扩展已有的代码来实现新功能而不是修改已有的代码里氏替换原则子类必须能够替换其父类而不影响程序的正确性即子类应该能够完全替代父类依赖倒置原则高层模块不应该依赖于低层模块二者都应该依赖于抽象模块间的依赖关系应该通过接口或抽象类来建立而不是直接依赖于具体的实现类这样可以降低模块间的耦合度提高代码的灵活性和可维护性接口隔离原则客户端不应该强制依赖它不需要的接口应该将大接口拆分成多个小接口迪米特法则一个对象应该对其他对象有最少的了解即一个对象应该尽可能少地与其他对象发生相互作用这些原则可以帮助设计出符合面向对象设计原则的软件系统提高系统的灵活性可维护性和可扩展性架构相关软件开发设计哲学完整可以参考软件开发设计哲学组合优于继承原则组合和继承都在尝试解决同样的问题假如你有一段代码想复用广为流传的组合优于继承的说法是一种不严谨的翻译其来源如下众多设计模式强调的两个个最核心原则面向接口编程而不是具体的实现若某个场景的代码复用既可以通过类继承实现也可以通过对象组合实现尽量选择对象组合的方式对象组合与类继承的对比面向对象设计的过程中两个最常用的技巧就是类继承和对象组合同一个场景下的代码复用这两个技巧基本上都可以完成但是他们有如下的区别通过继承实现的代码复用常常是一种白盒复用这里的白盒指的是可见性对于继承来说父类的内部实现对于子类来说是不透明的实现一个子类时你需要了解父类的实现细节以此决定是否需要重写某个方法对象组合实现的代码复用则是一种黑盒复用对象的内部细节不可见对象仅仅是以黑盒的方式出现可以通过改变对象引用来改变其行为方式继承式这里通过汽车的刹车逻辑进行说明对于汽车来说存在多种不同的型号我们会很自然的希望定义一个类来描述所有汽车通用的刹车行为然后通过某种方式继承组合来为不同的型号的汽车提供不同的刹车行为也可以将该方法设置成抽象方法强迫子类来实现该方法提供一个默认的刹车实现风格的刹车行为风格的刹车实现风格的刹车行为风格的刹车实现值得注意的是每一个型号的车的刹车行为是在编译时就确定好的没有办法在运行时刻将的刹车行为赋予组合式通过引用组合各个组件如果通过对象组合的实现方式则需要为定义一个引用该引用的类型是一个为刹车行为定义的抽象可以是抽象类或接口类定义刹车行为接口中的接口方法不需要关键字风格的刹车行为实现风格的刹车行为风格的刹车实现风格的刹车行为实现风格的刹车行为风格的刹车实现汽车类调用当前的刹车行为设置新的刹车行为注意上面的刹车行为不一定需要通过接口来实现定义一个的父类然后再定义来继承该类实现不同的行为同样是组合方式的应用所以不难发现当我们拿类继承和组合在一起进行对比时并不是以实现方式中是否有用到类继承来区分的我们真正关注的是行为的继承与行为的组合需要变化的行为是通过继承后重写的方式实现还是通过赋予不同的行为实例对象实现继承式优缺点类继承优点类之间的继承关系时在编译时刻静态地定义好的因此使用起来也非常直观毕竟继承是被编程语言本身所支持的功能类继承也使得修改要复用的代码变得相对容易因为可以仅仅重写要更改的父类方法如在集合标准库中大量方法就是通过继承复用的针对这些方法的维护升级都相对简单类继承缺点第一个缺点是伴随第一个优点而生的无法在运行时改变继承了父类的子类行为这一点在之前汽车的例子中已经进行了说明第二个缺点更严重与父类耦合通过继承实现的代码复用本质上把父类的内部实现细节暴露给了子类子类的实现会和父类的实现紧密的绑定在一起结果是父类实现的改动会导致子类也必须得改变以之前的例子进行说明如果是通过继承的方式来实现不同型号汽车的刹车行为变化假设现在我们基于这个父类实现了种不同型号的汽车其中前个型号都没有重写父类的刹车方法直接使用了父类提供的默认方法后个型号均提供了自己独特的实现现假设我们希望对中的方法进行升级改造然而升级改造后的行为只适用于最早的两种型号并不兼容升级后的刹车行为这样我们为了保证依旧能正常工作就不得不把旧的实现挪到中或者分别去升级中的方法比如集合标准库中后期对的支持直接改变了类最早的定义在中加入了默认实现机制组合式优缺点对象组合优点对象的组合是在运行时通过对象之间所获取的引用关系决定的所以对象组合要求不同的对象遵从对方所实现的接口来做引用传递这样反过来会要求开发者更用心地设计接口以此保证客户端在使用一个对象时可以把它和很多其他的对象组合在一起使用而不会出现问题对象的组合由于是通过接口实现的这样在复用的过程中不会打破其封装性任意一个对象都可以在运行时被替换成另外一个实现了相同接口且类型相同的对象更重要的是由于一个对象的实现是针对接口而编写的具体实现之间的依赖会更少对象组合的方式可以帮助你保持每个类的内聚性让每个类专注实现一个任务类的层次会保持的很小不会增长到一种无法管理的恐怖数量这也是只支持单继承的原因总结而言现代开发组合才具备更强的灵活性而当继承面领改变的时候因为子类与父类的耦合会带来更大的重构复杂度根本原因也是因为继承自然地要求捆绑所有公共元素到父类上但一旦发现共性中的例外这就需要很大的修改继承遵守的契约是子类都有父类的结构即父类共享了所有而在组合式中接口就是就是契约他是最轻量最小化级的契约更容易被附加到已经存在的类中说白了组合是一种更加好用的抽象方式现代项目开发中完全可以不使用继承只使用组合会更好组合所使用的引入接口的这种做法又叫依赖注入组合缺点以及解决方案因为需要初始化所有的内部类型很多的实现会含有相同的重复代码当需要从重用的代码中暴露信息时需要创建许多包装方法简单返回一个内部类型的调用总之优势远大于劣势减少未来修改付出的代价依赖注入本质就是有两段代码其中一段代码中想要使用另一段代码但是它不直接用而是把它当成参数传进来使用接口的方式传入就好比依赖了这个接口把要用的东西传进来就是注入把被依赖的代码注入到要用它的代码称之为依赖注入下面视频有利于直观感受依赖注入的好处优势修改简单易于测试一个思想如果发现自己在想怎么测试方法或者需要设置一些内部变量才能进行测试这个信号在提醒你需要把一些东西提出来把他们分离出来并通过注入实现隔离依赖倒置原则依赖倒置原则是设计原则之一它的核心思想是高层模块不应该依赖低层模块两者都应该依赖抽象抽象不应该依赖具体实现具体实现应该依赖抽象通过依赖倒置原则可以有效解决循环依赖问题因为它将直接的依赖关系解耦为通过抽象接口或抽象类进行间接依赖循环依赖是指两个或多个模块类之间直接或间接地相互依赖例如类依赖类类同时依赖类这种情况下代码会变得紧耦合难以维护和测试甚至可能导致编译或运行时错误一般都是通过引入抽象层和依赖注入将循环依赖转换为对抽象的依赖从而打破紧耦合关系步骤如下定义接口让类实现接口并依赖接口在运行时动态注入具体实现概述设计模式的重要性马丁设计模式给了我们瞄准的目标我还会做一些预先设计模式就是用来干这个的模式还给了我们以重构的目标我们得以知道我们改进的方向了解模式还有助于我们找到设计美感因为模式至少都是一些好的设计你可以从它们身上学到很多因此我仍然认为模式起着重要的作用种设计模式创建型模式它关注类产生对象的创建过程中的各种模式工厂模式抽象工厂模式单例模式建造者模式原型模式结构型模式它关注对象与对象之间的各种组合关系的各种模式适配器模式桥接模式组合模式装饰器模式外观模式享元模式代理模式行为型模式它关注对象各种不同的用处和场景的各种模式策略模式观察者模式模板方法模式迭代器模式命令模式备忘录模式状态模式访问者模式中介者模式解释器模式责任链模式设计模式之间的关系上图中红色表示创建型的绿色表示结构型的蓝色表示行为型的相连表示有相似性容易混淆连接线上的文字表示主要不同点图例讲解为什么不使用图讲解因为图带成员不够简洁下面所有设计模式结构图均参考这些图例来讲解直观创建型模式工厂模式将对象的实例化交给工厂去做你只需要告诉工厂你需要什么对象我给你造出来就行了目的让使用者只需要关注自己需要的而不需要关注这个东西是怎么创建的能用就行让实例创建和实例使用解耦简单工厂模式两种实现方式在类里写静态函数用于创建实例解决构造函数参数太多的问题通过定义一个静态函数用于创建实例来简化代码使用一个单独的类来创建实例简单工厂把对象的创建放到一个工厂类中通过参数来创建不同的对象工厂函数创建对象创建对象创建对象创建对象创建对象缺点每添一个对象就需要对简单工厂进行修改尽管不是删代码仅仅是添一个但仍然违背了不改代码的原则尽量做到添加代码而不是修改原有代码优点去除了与具体产品的依赖使用创建工厂类使用工厂函数创建对象返回父类指针编解码抽象工厂模式抽象工厂模式是围绕一个超级工厂创建其他工厂该超级工厂又称为其他工厂的工厂这种类型的设计模式属于创建型模式它提供了一种创建对象的最佳方式好处易于维护易于扩充且不用对原有的代码进行修改工厂方法每种产品由一种工厂来创建不同工厂创建不同的对象创建一个工厂类基类在基类的工厂类中添加工厂函数这是一个虚函数根据要创建的子对象添加子工厂类每个子对象的创建都对应一个子工厂类在子工厂类中实现父类的工厂函数完成创建对象的操作创建的子对象创建工厂类的父类工厂函数创建对象创建对象创建对象创建对象创建子工厂类只创建对象创建子工厂类只创建对象其实就是把的分支拆到了多态中抽象工厂类的使用使用编解码创建工厂对象创建编解码的类对象编解码实例实现最基本的网络编程编码逻辑编码的进一步封装对为了实现对不同结构体的编码而对做的进一步封装的一个用于实现多态的基类和用于具体实现多态的对请求数据进行编码的类型以及对回应数据进行编码的类型生产各种工厂的抽象类其生产工厂的函数返回的类型为多态对多态和具体的生产请求数据的工厂的类和生产回应数据的工厂的类其使用方式为使用编解码创建工厂对象创建编解码的类对象编解码单例模式通过持有自身实例实现类产生的实例是全局唯一的饿汉式单例模式在类创建的时候就创建实例并直接让这个产生出来的实例绑定到自己的某一个静态成员上提供一个静态方法返回这个静态成员实际上就是实例通过这个静态方法就能拿到自身唯一的实例这个过程中构造函数是私有的防止了通过构造函数在外界创造实例缺点在于程序刚开始运行的时候会比较卡大量被执行懒汉式正是解决此问题懒汉式单例模式解决的正是饿汉式的问题让他在真正需要执行的时候再去运行这段代码在静态方法被调用的时候去检查静态属性如果是才创建实例当创建实例的代价很大的时候并且常用该实例用不到的情况可以使用这种懒汉式单例模式原型模式类中实现方法通过在实例中调用克隆函数用于克隆自身适合于克隆自己比通过构造函数创建自身效率高的场景实际使用场景较小构造器模式也叫模式建造者模式也叫生成器模式在软件系统中有时候面临着一个复杂对象的创建工作其通常由各个部分的子对象用一定的算法构成由于需求的变化这个复杂对象的各个部分经常面临着剧烈的变化但是将它们组合在一起的算法却相对稳定如何应对这种变化如何提供一种封装机制来隔离出复杂对象的各个部分的变化从而保持系统中的稳定构建算法不随着需求改变而改变将一个复杂对象的构建与其表示相分离使得同样的构建过程可以创建不同的表示设计模式大部分编程语言都支持可选参数完全能更方便实现这样的功能该模式在构造过程极其复杂的情况下有存在的意义结构型模式适配器模式常用于解决旧系统或新旧接口之间的兼容问题主要有两种类适配器对象适配器类适配器通过继承实现创建一个新类适配器继承新接口同时继承老接口的实现类在新类中新接口中的方法中调用老接口的方法同时做其他逻辑实例以演示旧的打印机接口适配者类新的打印接口通过继承并实现接口来创建适配器类调用适配者类的方法演示使用效果使用的时候这个是关键用新接口引用适配器实例将输出最终就实现了通过新接口来调用新接口的方法通过适配器实际上调用的是老接口的方法类图对象适配器通过组合实现实例以演示旧的打印机接口适配者类新的打印接口通过组合并实现接口来创建适配器类调用适配者类的方法演示使用效果使用的时候这个是关键用新接口引用适配器实例将输出最终就实现了通过新接口来调用新接口的方法通过适配器实际上调用的是老接口的方法类图桥接模式一言以蔽之就是将多个接口及实现的体系可以通过一个类桥接到一起桥接模式是一种结构型设计模式用于将抽象部分与实现部分分离使它们可以独立变化互不影响桥接模式的核心思想是通过将抽象部分和实现部分分离使它们可以独立变化从而提高系统的灵活性和可扩展性简单来说桥接模式就像是一座桥连接了抽象部分和实现部分使它们可以分别变化而不相互影响通过桥接模式我们可以轻松地添加新的抽象部分或实现部分而不需要修改原有的代码结构举个例子假设我们要设计一个绘图软件其中有不同的形状圆形矩形和不同的颜色红色蓝色使用桥接模式我们可以将形状和颜色分别作为抽象部分和实现部分通过桥接将它们连接在一起这样我们可以轻松地组合不同的形状和颜色而不需要修改原有的代码结构看似很复杂实际上就是图中右上方的抽象类通过依赖注入的方式传入武器如果还有底座啥的也同样利用依赖注入传进来相当于桥接了武器和底座可以随意桥接两两实际上就是依赖注入多个组件的思想组合模式组合模式是一种结构型设计模式它允许你将对象组合成树形结构以表示部分整体的层次结构这种模式使得客户端可以统一处理单个对象和对象组合而不必区分它们之间的差异在组合模式中组合对象和叶子对象都实现相同的接口这样客户端可以像处理单个对象一样处理对象组合这种模式可以使得系统更加灵活和可扩展同时简化了客户端的代码适用场景当希望以一致的方式处理单个对象和对象组合时使用实例以代码为例武器接口具体武器类剑使用剑攻击具体武器类枪使用枪射击组合模式中的组件基类继承这样在使用组合模式时无论是叶子节点还是复合节点都可以统一地调用方法组合模式中的复合武器类类图装饰模式装饰模式装饰器装饰者模式动态地给一个对象增加新的功能而不改变对象原本的结构非常有用装饰器模式允许在不影响同一类其他对象行为的情况下静态或动态地向单个对象添加行为装饰器模式对于遵循单一职责原则特别有用因为它允许将功能分离到不同的类中每个类都有自己独特的关注点适用场景当希望在不修改原有代码情况下动态地给对象添加新功能时可以使用装饰器模式装饰器模式可以帮助你以灵活和可拓展的方式组合对象的各种功能给一个类或对象增加新的功能有两种方式参考上图上方的机器人更新功能左下角机器人称之为继承机制新类继承一个现有的类在子类中进行拓展功能上方的机器人更新功能为右下角机器人称之为关联机制将一个类的对象套入到另一个类的对象中相当于把机器人嵌入到箱子里来套一个壳子来拓展功能这个壳子就是装饰器对于第一种方式来说最大的问题在于继承是静态的没办法在运行的过程中动态的改变一个类的行为第二种方法是动态的动态地给一个对象添加一些额外的功能就增加功能来说装饰模式比生成子类更为灵活可以这么理解经过处理就可以给类添加新功能这也是和代理模式的区别代理类里面是写死的在编译的时候就确定了关系而装饰器是在运行时来确定的代理模式是直接编写代理对象装饰模式是编写函数动态生成代理对象装饰器模式关注于在一个对象上动态添加方法而代理模式关注于控制对象的访问大致的操作图如下紫色的圆是左边类的对象通过构造传入右边类成员中在新类的同名中调用成员对象的原来的这里就可以在前后添加代码逻辑使用场景实现监听器功能提供一个接口让使用者自定义监听某个事件发生时的行为在事件发生前后触发相应的操作通过装饰器模式可以动态地附加到想要监听的对象上在执行目标函数的前后可以执行相应的函数装饰器用来做监听器的场景非常多肉鸽游戏场景案例根据这个图给出的代码以演示装饰者模式然后就可以以如图的形式动态地套壳修改类的表现形式基础抽象类饮料类具体组件类奶茶具体组件类水果茶具体组件类酸奶抽象装饰者类注意要继承抽象饮料类包含抽象饮料类的对象成员具体装饰者类珍珠装饰器具体装饰者类布丁装饰器注意这里的渐进式计算价格具体装饰者类草本果冻装饰器测试当需要添加新的配料只需要添加新的具体的配料装饰类同样当需要添加新的饮料也只需要添加新的具体的饮料类类图外观模式外观模式门面模式外观模式为子系统中的一组接口提供一个统一的接口即定义了一个高层接口使得这一子系统更加容易使用通过提供一个统一的接口来隐藏系统中多个子系统的复杂性将多个高度耦合的多类结构封装到一个类中只提供统一接口是一种封装的思想适用场景当需要简化复杂系统的使用接口时可使用外观模式管理资源位置建造塔生成敌人开始游戏循环中央位置游戏开始享元模式享元模式享元的本质就是公用数据的抽象全局变量就可以算是一种享元通过共享技术来有效地支持大量细粒度对象的重用节省不必要的属性空间节省内存将共同类型的属性放到享元类中简单来说享元模式通过共享对象来减少内存消耗使用一个工厂来管理这些共享对象并确保每个对象只被创建一次适用场景当需要创建大量相似对象并希望通过共享对象来减少内存消耗时可以使用享元模式享元模式通过共享相同的状态来减少内存占用和提高性能同时通过动态传递非共享状态来实现个性化定制享元工厂负责管理共享池确保享元对象的唯一性和共享性具体享元类包含了所有共享的状态具体享元类是享元模式中的一种类别它包含了所有可共享的状态或属性这些状态是可以被多个对象共享的从而节省内存和提高性能具体享元类的实例通常是不可变的它们包含了固定不变的共享状态非共享的状态则会在使用时动态传递非共享的状态是指每个具体享元对象特有的状态或属性这些状态不可共享在使用具体享元对象时这些非共享的状态会动态传递给享元对象以便个性化地定制享元对象的行为享元工厂负责维护享元对象的共享池享元工厂是负责创建和管理享元对象的工厂类享元工厂维护一个共享池用于存储和管理已创建的享元对象享元工厂确保相同的享元对象只被创建一次并在需要时从共享池中获取已有的享元对象提供一个方法来获取享元对象享元工厂提供一个方法通常是工厂方法用于获取享元对象当客户端需要使用享元对象时可以通过调用享元工厂的方法来获取相应的享元对象并在其中传递非共享的状态参数案例抽象享元类具体享元类享元工厂类演示类和是相同实例抽象享元类定义了一个方法用于应用样式具体享元类实现了接口包含三个只读属性分别表示字体大小和颜色构造函数用于初始化这些属性方法打印应用的样式和文本享元工厂类使用存储已经创建的享元对象方法根据生成一个键并检查是否已有对应的享元对象如果没有则创建一个新的对象并存储到中最后返回找到的或新创建的享元对象演示类方法演示了享元模式的使用调用获取享元对象并应用样式和应用了相同的样式因此会复用的实例代理模式代理模式通过代理类控制对真实对象的访问并在需要时创建和使用真实对象核心思想代理模式为其他对象提供了一种代理以控制对这个对象的访问代理在其最广泛的形式中是一个用作其他事物接口的类代理是一个包装或代理对象客户端通过它来访问后台的实际服务对象使用代理可以简单地将请求转发到实际对象或者提供额外的逻辑在代理中可以提供额外的功能例如当对实际对象的操作资源消耗较大时进行缓存或在调用实际对象的操作之前进行前置条件检查适用场景当需要在访问对象时增加额外的操作时可以使用代理模式例如延迟加载权限控制日志记录等代理模式可以帮助你在不修改现有代码的情况下实现对对象访问的控制代理类中持有真正的类对象同样的函数名在其中调用真正的类的方法的时候还能执行一些新的动作代理类的名字往往是真正的类应用场景劫持过滤安全检查远程代理用于在不同地址空间中代表对象远程代理可以隐藏对象存在于不同地址空间的实现复杂性使得客户端可以像调用本地对象一样调用远程对象虚拟代理用于延迟加载对象的开销昂贵的资源虚拟代理会在需要时创建真实对象而在不需要时充当占位符保护代理用于控制对对象的访问权限保护代理可以限制对对象的访问确保只有特定权限的用户可以访问对象缓存代理用于缓存对象以提高系统性能缓存代理会在访问对象前检查缓存如果对象已经存在于缓存中则直接返回缓存的对象避免重复创建对象日志记录代理用于记录对象的操作日志日志记录代理可以在调用对象的方法前后记录日志信息用于调试和跟踪操作智能引用代理用于在对象被引用时执行额外的操作智能引用代理可以在对象被引用时执行计数内存管理等操作以确保对象的正确使用延迟初始化用于延迟对象的初始化代理模式可以通过延迟初始化来避免在对象创建时的高开销延迟到真正需要时再进行初始化案例图片接口具体图片类图片代理类图片加载器使用代理加载和显示图片需要显示图片这里才真正加载图片类似单例懒汉模式实现了使用代理模式延迟加载和显示图片行为型模式职责链模式也叫责任链模式让多个处理都有机会处理该请求直到其中某个处理成功为止责任链模式可以把多个处理串成链然后让请求在链上传递直到某一个处理处理成功为止优点将请求和处理分开请求者不需要知道谁去处理处理者也不需要知道请求的全貌将请求的接收者和发送者解耦新增一个处理到整个链条中的代价是非常小的缺点采取类似于递归的方式不易于调试职责链设计模式通过将请求的处理责任分摊到多个对象中避免了请求发送者和接收者之间的耦合在实际开发中职责链模式可以帮助我们创建更灵活的系统结构提高代码的可维护性和扩展性抽象出一个公共的父类然后去定义不同的处理类他们之间通过去连接起来案例代码抽象处理者类设置下一个处理者处理请求的接口将请求传递给下一个处理者具体处理者只处理级别的请求处理请求无法处理请求传递给下一个处理者调用父类方法传递请求具体处理者只处理级别的请求处理请求无法处理请求传递给下一个处理者调用父类方法传递请求具体处理者只处理级别的请求处理请求无法处理请求传递给下一个处理者调用父类方法传递请求创建处理者实例设置职责链测试不同的请求处理请求处理请求处理请求处理请求类图命令模式命令模式它可将请求转换为一个包含与请求相关的所有信息的独立对象该从而可以进行参数化日志记录队列化撤销等操作命令模式中发起者不直接与接收者进行通信而是通过命令对象来执行操作命令模式通过将请求封装成对象可以让系统支持复杂的命令以及请求和操作的管理他提供了一种拓展系统功能的灵活方式同时保持调用者和接收者之间的解耦适用场景命令模式非常适合用于实现命令的调度记录撤销和重做等功能当你需要将操作封装为对象通过操作的排列组合来调控具体行为时命令模式就显得非常有用命令模式典型的代表就是事件驱动很大的优势在于可以轻松实现可撤销功能优点动作封装解耦发送者和接收者可拓展性简化和集中错误处理支持撤销和重做功能易于实现宏命令和组合命令缺点复杂度和性能开销常见应用案例文本编辑器图形编辑器架构问号是表示懒得画了太小了实例架构开关灯案例接收者类灯灯已打开灯已关闭命令接口具体命令类打开灯具体命令类关闭灯调用者类遥控器每次设置新命令时清空栈因为新操作后不再可以重做之前的撤销操作没有命令可以撤销没有命令可以重做用于存储已执行的命令支持撤销用于存储撤销的命令支持重做创建灯对象创建命令对象创建遥控器绑定命令打开灯执行打开灯的命令绑定命令关闭灯执行关闭灯的命令撤销操作撤销灯重新打开再次撤销灯重新关闭重做操作重做灯重新打开重做灯重新关闭输出灯已打开灯已关闭灯已打开灯已关闭灯已打开灯已关闭类图类表示接收者包含和方法是命令接口定义了和方法和实现了接口并依赖于类用来执行开灯和关灯的命令是调用者负责将命令对象关联并执行还管理了撤销和重做功能的栈和文本编辑器案例命令基类如果有必要可以添加文本接收者插入文本当前文本内容删除文本当前文本内容具体命令类插入文本命令记录插入的长度撤销插入操作命令执行者执行后将命令存入历史栈撤销最近的命令没有命令可以撤销存储已执行的命令创建接收者创建命令执行者创建命令执行命令插入插入撤销最近的命令撤销操作撤销再次撤销操作撤销清理内存代码结构如下解释器模式解释器模式用于定义一个语言的语法表示并通过解释器来解释语言中的句子通常解释器模式用于解析和执行简单的语法规则如数学表达式脚本语言或命令语言本质是指导我们去开发一个解释器可以理解成一种语法解释器的开发框架应用场景编译器和解释器配置文件解析器查询语言解析器当需要解释一种特定的语言时例如计算器语法解析当想要将复杂的问题分解为更简单的子问题并对这些子问题进行解释和执行抽象表达式声明一个方法这个方法是所有具体表达式的接口终结符表达式实现与文法中的终结符相关的解释操作非终结符表达式为文法中的非终结符实现解释操作通常它会包含多个表达式上下文包含解释器之外的一些全局信息客户端构建或定义语法树并将其传递给解释器进行解释解释器模式虽然强大但在处理复杂语法时容易导致类爆炸因此仅适用于相对简单的文法解析问题案例表达式接口表达式接口抽象表达式变量表达式终结符表达式加法表达式非终结符表达式减法表达式非终结符表达式上下文环境上下文定义变量及其对应的值表达式总结解释器模式将复杂的表达式解析和解释分解为简单的子问题每个子问题由终结符或非终结符来处理在需要解释某种特定语言的场景下如数学表达式脚本语言解释器模式是一个非常合适的解决方案对于复杂的文法解析解释器模式可能并不是最合适的选择更常见的替代方案是编译器技术中的工具和技术如解析器生成器或者采用更灵活的设计模式在复杂的语法树遍历场景下可以考虑使用访问者模式它能让你在不修改对象结构的情况下增加新的操作访问者模式通过将操作从语法树的节点中分离出来使得对语法树的扩展更加灵活组合模式允许你将对象组合成树状结构以表示部分整体的层次结构通过这种方式可以将复杂表达式的处理通过组合实现而不是每个表达式都定义一个新类迭代器模式迭代器模式用于提供一种方法顺序访问一个聚合对象中的各个元素而又不暴露该对象的内部表示迭代器模式将迭代的逻辑与容器解耦使用迭代器对象来负责遍历操作迭代器模式的主要组成部分迭代器接口定义访问和遍历元素的接口通常包含等方法具体迭代器实现迭代器接口负责遍历聚合对象的具体元素聚合接口定义创建迭代器的接口一般包含一个方法具体聚合实现聚合接口存储元素并定义如何创建该聚合对象的迭代器客户端使用迭代器来遍历聚合对象中的元素客户端只需要与迭代器交互不需要知道聚合对象的内部结构迭代器模式的好处解耦聚合对象和迭代逻辑分离使得聚合对象专注于存储数据迭代器则专注于遍历操作统一接口无论聚合对象的内部结构如何复杂客户端都可以通过统一的迭代器接口访问元素扩展性强可以很方便地增加新的遍历方式不必修改聚合对象的代码适用场景当你需要以一种一致的方法遍历集合中的元素而不想暴露其内部表示时可以使用迭代器模式案例假设有一个简单的类和类是一个集合里面存储了多个对象我们使用迭代器模式来遍历中的书简单的书本类迭代器接口判断是否有下一个元素获取下一个元素聚合接口创建迭代器具体的书本集合类实现创建迭代器具体迭代器类用于遍历书本集合创建书本集合获取迭代器使用迭代器遍历书本集合清理内存输出类图类是书的简单模型包含成员和方法是迭代器接口定义了和方法是聚合接口定义了方法类实现了接口包含一个成员用于存储书本并提供方法来添加书本和获取迭代器类实现了接口用于遍历并跟踪当前的索引迭代器模式通过抽象化遍历逻辑提供了一种简洁的方式来访问聚合对象中的元素它在标准库中被广泛应用例如容器等都有迭代器接口用户可以轻松地遍历容器中的元素观察者模式视频教程充分诠释了观察者模式的意义主要作用定义一对多的依赖关系让多个观察者同时监听一个主题对象观察者模式其中一个对象称为主题它维护一组依赖它的对象称为观察者当主题的状态发生变化时他会主动通知所有观察者适用场景当希望一个对象状态改变时通知其他多个对象而不希望这些对象之间存在紧耦合关系时可使用观察者模式例如当需要实现事件处理系统消息广播系统或任何需要动态通知多个对象的情况应用场景社交媒体平台股票市场工具实时消息系统观察者模式定义对象间的一种一对多的依赖关系当一个对象的状态发生改变时所有依赖于它的对象都得到通知并被自动更新在观察者模式中主体是通知的发布者它发出通知时并不需要知道谁是它的观察者可以有任意数目的观察者订阅并接收通知观察者模式不仅被广泛应用于软件界面元素之间的交互在业务对象之间的交互权限管理等方面也有广泛的应用观察者模式完美的将观察者和被观察的对象分离开观察者模式在模块之间划定了清晰的界限提高了应用程序的可维护性和重用性两个类观察者类被观察者类观察者类中定义一个对某个事件感兴趣的处理函数一般也叫槽函数被观察者类中定义一个数据结构用来保存观察者对哪一个事件感兴趣使用建立对应关系被观察者类中定义两个函数添加观察者与其感兴趣的事件加入到容器之中通知事件函数执行逻辑首先遍历容器找是否有感兴趣的事件若有则代表一系列的观察者对该事件感兴趣那么遍历观察者列表让每一个观察执行相应的槽函数上图中最下面的黄色是被通知者的结构上图的展示效果还是非常模糊案例下面展示的结构为和为观察者观察的变化将再抽象一层提供独立的抽象接口将标准接口抽离出来于是有了下面的图需要先声明一下主题接口类观察者列表添加观察者接口删除观察者接口通知观察者接口观察者类观察谁依赖注入并初始化成员变量继承意味着将观察函数中使用观察者模式的核心是对观察者的抽象以及所观察对象如何通过和以及方法来维护观察者集合与发布订阅模式的区别发布订阅模式是一种常用的架构模式用来规定一系统中的不同部分之间应该如何进行消息传递观察者模式一种软件设计模式主要针对代码层次提供类与类之间的组织关系发布订阅模式一种系统架构模式主要针对组件服务层次指定他们之间的消息传递模式中介者模式中介者模式用于降低对象之间的耦合性通过引入一个中介者对象多个对象之间的交互不再直接相互通信而是通过中介者来协调它们的行为中介者模式的核心思想是通过集中化处理对象之间的交互避免对象之间形成紧耦合关系从而增强系统的可维护性和扩展性如果不使用中介模式将会如上图左边一样调用关系非常混乱但是使用了中介者模式后关系将会特别清晰如上右图中介者模式引入了一个第三方对象称为中介者来控制两个或多个对象称为同事之间的交互从而减少类之间的耦合因为他们不再需要了解彼此的实现细节中介者模式和代理模式的区别中介者模式侧重于简化对象之间的通信通过一个中介者对象来管理和协调多个对象之间的交互用于对象之间的通信协调代理模式通过一个代理对象来控制对另一个对象的访问通常用于添加额外的功能如权限控制延迟加载等用于对象的访问控制适用场景当希望减少对象之间的复杂依赖关系促进对象解耦时可以使用中介者模式中介者模式的主要角色有中介者定义与各个同事对象之间的通信接口具体中介者实现中介者接口负责协调各同事对象之间的通信和行为同事类每个同事对象都通过中介者与其他同事对象通信而不会直接与其他同事对象进行交互优点减少类之间的依赖通过引入中介者同事类不再直接依赖其他同事类从而使代码更加松散耦合增强可维护性集中化管理对象的交互可以更容易地修改或扩展某些行为而不需要在各个同事类中进行变更更好的扩展性通过添加新的中介者或同事类可以很容易地扩展系统缺点中介者复杂性中介者模式虽然降低了同事类的复杂性但中介者自身可能会变得复杂尤其是当系统规模变大时中介者需要处理的逻辑会相应变多适用场景系统中对象之间有复杂的交互关系导致类与类之间的依赖关系复杂且难以维护希望通过一个中间类来封装多个类之间的交互使得这些类之间不再直接耦合上图展开观察者模式在功能上相当于中介者模式的广播模式案例以下是一个简单的中介者模式的实现示例描述了多个同事对象类通过一个中介者来进行通信的情况用户可以关注其他用户广播消息会发送给所有关注自己的用户点对点消息发送则无视关注列表中介者接口添加虚析构函数同事类关注者列表增加接收者参数添加虚析构函数具体同事类发送广播消息发送消息给收到消息具体中介者使用来存储用户以便快速查找关注关系初始化关注者列表广播消息给所有关注用户点对点消息用户不存在消息发送失败使用如下广播消息给所有关注用户点对点消息点对点消息发送给不存在的用户打印如下发送广播消息收到消息发送消息给收到消息发送消息给收到消息发送消息给用户不存在消息发送失败发送消息给收到消息下面以图示的方式展示是一个接口被实现是一个抽象类被继承和之间有一个组合关系表示包含一个的引用和之间有一个聚合关系表示管理多个对象本质上是在各个实例中以组合的方式添加了一个公共使用的中介者实例统一通过这个中介者来调用或注册自身策略模式策略模式定义一组算法将每个算法都封装在独立的类中使得它们之间可以互换使用使我们能够在运行时选择或更改算法策略模式让算法独立于使用它的客户而变化客户不关心策略的实现逻辑也称为政策模式思想主要是将每个策略包装为一个单独的类拥有相同的接口根据不同的情况来选择不同的策略进而达到使用不同算法的目的这种模式特别适用于处理类似支付排序或数据处理等场景算法的变化不会影响系统的其他部分策略模式与状态模式的主要差异状态模式是同样的方法不一样的结果没钱状态下吃霸王餐有钱状态下付钱策略模式是同样的方法不同的策略相同的结果用支付宝和微信都是付钱了即状态模式关注的是对象的状态变化以及状态变化对行为的影响强调的是同样的方法不同的结果策略模式关注的是算法的选择和替换强调的是同样的方法不同的策略最终的结果可能相同可以这么理解飞有很多策略普通飞是个策略不飞也是个策略通过成员将飞的各种策略兼容到一个统一的飞行行为使用组合方式连接策略案例使用如下打印结果如下类图是一个接口抽象类并且有两个具体的实现类和表示不同的飞行行为是一个基类其中包含的成员鸭子可以调用执行飞行行为类有具体的子类和它们分别代表不同种类的鸭子状态模式状态模式是一种行为型设计模式用于解决对象在不同状态下的行为变化和转换的问题在状态模式中对象可以在内部状态发生改变时改变其行为而不需要改变对象本身的类这样可以使对象的行为更加灵活易于扩展和维护以面向对象的方式实现状态机每个状态都会被实现为状态接口的一个派生类状态的转换通过调用接口中的定义的方法来处理状态模式可以看作是策略模式的一种变体其中当前的策略会根据状态转换而改变在状态模式中通常会定义一个状态接口或者抽象类表示不同的状态然后具体的状态类实现这个接口或者继承这个抽象类每个具体的状态类实现自己的行为逻辑另外还会定义一个上下文类用于维护当前的状态对象并根据不同的状态对象调用对应的行为状态模式可以有效地将复杂的状态逻辑进行解耦和封装使代码更加清晰和易于理解它常用于处理对象在不同状态下的行为变化例如状态机工作流等场景当一个对象的行为依赖于他的状态并且需要在运行时根据状态切换行为时可以考虑使用状态模式这种模式特别适用于具有复杂状态转换逻辑的系统状态模式通过将状态与行为分离使对象可以根据状态的变化动态调整其行为这种模式提高了系统的灵活性和可维护性使我们能轻松管理和拓展对象的状态逻辑以一个极光炮塔的状态拆解为例状态模式实例上图中的微波炉有三种状态加热开门关门四种操作开门只能在关门状态下进行关门只能在开门状态下进行启动只能在关门状态下进行停止只能在加热状态下进行如果在操作中判断状态代码中会充斥着各种条件语句这时可以使用状态模式每个状态对应的操作封装在一起状态图完整代码案例前向声明抽象状态类设置上下文微波炉具体状态类加热状态状态转换逻辑例如切换到门关闭状态门打开状态状态转换逻辑例如切换到门关闭状态门关闭状态状态转换逻辑例如切换到门打开状态状态转换逻辑例如切换到加热状态微波炉类使用初始化状态测试微波炉的不同操作类图是抽象类它有多个子类分别代表微波炉的不同状态类与有一个聚合关系表示微波炉包含一个当前状态对象与策略模式的意图差异策略模式侧重在外部代码灵活的改变内部代码的策略的切换状态模式侧重行为根据状态的自动切换状态机状态机可根据状态数量分为两类有限状态机自动机状态数量有限无限状态机状态数量无限如推理机图灵机有限状态机重要性在工业控制领域状态机是一个极其重要的概念它决定了设备能否按照计划流程加工以及及时的停止加工防止物料受损一个好的状态机在异常处理上有着良好的能力需要通过一个状态模型来尽可能涵盖可能发生的情况一个抽象的状态机模型可以拆分为若干个状态节点而每完成一个节点下一个节点的动作才会被触发我们称每一个这样的节点为一步因此状态机可以用有向图来表示在实际实现状态机的数据结构中也常用作图来编写整个流程通常状态机可以分为两种不同的类型状态机不考虑输入的内容而只根据目前状态决策状态机不仅会考量当前状态也同时会考虑当前的输入数据最后综合做出决策由于工艺制程的复杂性半导体领域通常使用的是状态机需要注意的是几乎所有的状态机有自己完整的生命周期钩子通常在被初始化状态转移事件触发动作销毁的时候会触发相应的钩子函数以实现更加强壮的功能我相信很多学习前端的朋友应该都会比较熟悉可以把它简单的理解为一个从创建渲染到销毁的过程绘制状态机不仅可以拆解状态模式的实现思路还可以帮助我们梳理和表达产品需求注意设计时需要全面充分画完图要检查是否有无法进入或无法离开的状态排除会导致状态机可以同时处在不同状态下模棱两可的切换箭头优秀的状态模式设计参考此项目备忘录模式备忘录模式又称之为快照模式或者令牌模式备忘录模式用于保存和恢复对象的状态而不会破坏对象的封装性适用场景当需要在不破坏封装性的前提下捕获和恢复对象状态时可以使用备忘录模式如在实现撤销重做功能时备忘录模式非常有用可以帮你将对象的状态存储起来并在需要时恢复到之前的状态核心思想序列化以及栈以游戏保存为例上图中的堆栈回退栈用于存储序列化后的状态信息案例备忘录类类保存和恢复状态保存当前状态到从恢复状态备忘录管理类负责管理状态的堆栈将压入堆栈从堆栈中弹出最近的测试打印初始状态保存初始状态修改文章打印修改后的状态保存修改后的状态再次修改文章打印再次修改后的状态执行撤销操作恢复到上一次状态再次执行撤销操作恢复到初始状态输出类图模板方法模式模板方法设计模式让你能够定义一个算法的通用结构并将具体的实现延迟到子类中模板方法在基类中定义了一个算法的骨架并允许子类在不改变算法结构的前提下重新定义算法的某些步骤适用场景当你有一个通用的流程需要多个类共享但某些步骤需要根据具体情况进行自定义时可以考虑使用模板方法设计模式例如数据处理流程文档生成流程等模板方法模式与策略模式的区别模版方法模式强调的是在一个通用框架内定义算法的结构然后让子类根据需要重写部分步骤它更关注的是一个固定的流程而不是选择不同的算法模版方法是通过继承来实现算法结构的部分定制策略模式则更强调算法的可替换性允许你在运行时选择不同的算法实现但不会影响算法的结构策略模式是将算法的每个实现封装在独立的类中并通过接口使它们可以互换使用案例就省略了因为无非也就是继承而已访问者模式核心思想不修改现有代码结构的情况下为对象添加新的功能访问者设计模式通过将算法与它操作的对象结构分离允许在不修改这些对象结构的情况下为其添加新操作符合开放封闭原则适用场景当需要在不修改对象结构的情况下为对象添加新功能时可以考虑使用访问者模式这种模式特别适用于那些对象结构稳定但需要经常添加新操作的场景访问者设计模式通过引入访问者对象允许我们在不修改对象结构的前提下为对象添加新功能在实际开发中访问者模式可以帮助我们保持代码的开闭原则提高系统的可扩展性和维护性访问者模式通常用于处理复杂的对象结构比如复合对象或对象集合如树结构使得对这些对象的操作更加灵活访问者模式可以说是中设计模式中最复杂的一个但日常开发中使用频率却不高最关键的两点被访问者提供入口访问者设置访问方法要点总结准确识别出实用的场景如果一个对象结构不稳定决不可使用不然在增删元素时改动将非常巨大对象结构中的元素要可以迭代访问里一般存在与元素个数相同的方法元素通过方法通过将自己传递给了优点使得给结构稳定的对象增加新算法变得容易提搞了代码的可维护性可扩展性缺点太复杂特别是伪动态双分派不仔细理解很难想清楚访问者模式使用频率较低而且复杂可酌情掌握当我们需要统一访问接口的时候有如下办法方案中对应关键词适用场景优点缺点显式接口需要类型安全且子类有部分共同行为编译时检查代码清晰需预先定义接口动态类型快速原型或不确定成员结构灵活失去编译时检查通用容器完全动态的松散结构高度灵活完全无类型安全访问者模式复杂对象结构且处理逻辑多变解耦数据与操作代码复杂度高案例前向声明访问者基类元素基类具体元素类具体元素类具体访问者具体访问者可执行不同的逻辑可执行不同的逻辑创建元素集合使用第一个访问者使用第二个访问者输出核心每个元素通过方法将访问者引入元素内部使访问者调用特定的操作类图是访问者的基类定义了和两个方法和是两个具体的访问者实现了访问元素的方法是元素的基类包含方法和是具体的元素它们实现了方法并有各自的操作方法和类图面向对象设计主要就是使用的类图类图用于描述系统中所包含的类以及它们之间的相互关系帮助人们简化对系统的理解它是系统分析和设计阶段的重要产物也是系统编码和测试的重要模型依据类的画法类封装了数据和行为是面向对象的重要组成部分它是具有相同属性操作关系的对象集合的总称在系统中每个类都具有一定的职责职责指的是类要完成什么样子的功能要承担什么样子的义务一个类可以有多种职责但是设计得好的类一般只有一种职责看到该图分为三层最顶层的为类名中间层的为属性最底层的为方法属性的表示方式为可见性属性名称类型缺省值可选方法的表示方式为可见性方法名称参数列表类型可见性都是一样的表示表示表示关系画法总结继承关系带空心三角形的实线关联关系箭头线聚合关系带空心菱形的箭头线组合关系带实心菱形的箭头线依赖关系带箭头的虚线所有关系详解如下继承关系表示一个类子类继承另一个类父类的属性和方法关联关系表示一个类中包含另一个类的对象作为成员变量聚合关系表示一个类将另一个类的对象作为引用持有但两者之间并不是强耦合关系组合关系表示一个类在构造方法中实例化另一个类的对象两者之间是强耦合关系组合优于继承原则虽然组合关系在某种程度上是强耦合的因为一个对象的存在依赖于另一个对象但它通常被视为比继承低耦合的设计选择因为组合允许在运行时动态地组合不同的对象而继承关系在编译时是固定的依赖关系表示一个类的方法使用另一个类的对象作为参数但两者之间不是拥有关系继承关系继承也叫作泛化用于描述父子类之间的关系父类又称为基类或者超类子类又称作派生类在中泛化关系用带空心三角形的实线来表示普通继承关系抽象继承关系比方说我想实现一个链表插入与删除动作我想让子类去实现链表本身只实现统计链表中元素个数的动作然后有一个子类单向链表去实现父类没有实现的动作类图为在中抽象类无论类名还是抽象方法名都以斜体的方式表示因为这也是一种继承关系所以子类与父类通过带空心三角形的实线来联系关联关系关联关系是类与类之间最常见的一种关系它是一种结构化的关系表示一类对象与另一类对象之间有联系如汽车和轮胎师傅和徒弟班级和学生等在类图中用箭头线连接有关联关系的对象所对应的类在中通常将一个类的对象作为另一个类的成员变量关联关系分单向关联双向关联自关联单向关联关系双向关联关系默认情况下的关联都是双向的比如顾客购买商品反之卖出去的商品总是与某个顾客与之相关联这就是双向关联类图如下自关联关系自关联指的就是对象中的属性为对象本身这在链表中非常常见单向链表中会维护一个它的前驱双向链表中会维护一个它的前驱和一个它的后继就以单向链表为例类图为聚合关系聚合关系表示整体与部分的关系在聚合关系中整体对象持有成员对象的引用成员对象是整体的一部分但是成员对象可以脱离整体对象独立存在在中聚合关系用带空心菱形的箭头线表示如汽车与引擎轮胎车灯类图表示为代码实现聚合关系成员对象通常以构造方法方法的方式注入到整体对象之中依赖注入通过构造方法注入整体对象在实例化时会接收成员对象作为参数并将其保存在内部通过方法注入整体对象可以在运行时动态设置或更改成员对象这种注入方式可以实现对象之间的松耦合提高代码的灵活性和可维护性组合关系组合关系也表示的是一种整体和部分的关系但是在组合关系中整体对象可以控制成员对象的生命周期一旦整体对象不存在成员对象也不存在整体对象和成员对象之间具有同生共死的关系在中组合关系用带实心菱形的箭头线表示比如人的头和嘴巴鼻子嘴巴和鼻子是头的组成部分之一一旦头没了嘴巴也没了因此头和嘴巴鼻子是组合关系类图表示为代码实现组合关系通常在整体类的构造方法中直接实例化成员类因为组合关系的整体和部分是共生关系如果通过外部注入那么即使整体不存在那么部分还是存在的这就相当于变成了一种聚合关系了依赖关系依赖关系是一种使用关系特定事物的改变有可能会影响到使用该事物的其他事物在需要表示一个事物使用另一个事物时使用依赖关系大多数情况下依赖关系体现在某个类的方法使用另一个类的对象作为参数在中依赖关系用带箭头的虚线表示由依赖的一方指向被依赖的一方比如驾驶员开车类的方法将车的对象作为一个参数传递以便在方法中能够调用的方法且驾驶员的方法依赖车的方法因此也可以说依赖类图为依赖关系通常通过三种方式来实现将一个类的对象作为另一个类中方法的参数在一个类的方法中将另一个类的对象作为其对象的局部变量在一个类的方法中调用另一个类的静态方法关联聚合组合之间的区别关联和聚合的区别主要在于语义上关联的两个对象之间一般是平等的聚合则一般是不平等的聚合和组合的区别则在语义和实现上都有差别组合的两个对象之间生命周期有很大的关联被组合的对象在组合对象创建的同时或者创建之后创建在组合对象销毁之前销毁一般来说被组合对象不能脱离组合对象独立存在而且也只能属于一个组合对象可以理解成使用栈空间聚合则不一样被聚合的对象可以属于多个聚合对象实际应用中三种关系其实没有区分得这么清楚不需要把细节扣得这么细合理利用对象之间的关系给出设计方案即可关系画法总结跳转绘制类图的网址跳转',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-05 17:50:32',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://th.bing.com/th/id/OIP.wtmjepfWPBvn26uz7s18dgHaHa?rs=1&amp;pid=ImgDetMain"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ZEROKO14的个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 1.05rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 1.05rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 1.05rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 1.05rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 1.05rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 1.05rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 1.05rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 1.05rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 1.05rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 1.05rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 1.05rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 1.05rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 1.05rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 1.05rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 1.05rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 1.05rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 1.05rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 1.05rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 1.05rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 1.05rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">基础<sup>3</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>1</sup></a><a href="/tags/%E7%A1%AC%E7%BC%96%E7%A0%81/" style="font-size: 1.05rem;">硬编码<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">27</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url">架构</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>设计模式</span></a></span></div></div><h1 class="post-title" itemprop="name headline">设计模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-07-16T04:06:28.980Z" title="发表于 2024-07-16 12:06:28">2024-07-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-03-05T09:50:32.654Z" title="更新于 2025-03-05 17:50:32">2025-03-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="设计模式"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新加坡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新加坡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://che77a38.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><header><a class="post-meta-categories" href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url">架构</a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" tabindex="-1" itemprop="url">设计模式</a><h1 id="CrawlerTitle" itemprop="name headline">设计模式</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ZEROKO14</span><time itemprop="dateCreated datePublished" datetime="2024-07-16T04:06:28.980Z" title="发表于 2024-07-16 12:06:28">2024-07-16</time><time itemprop="dateCreated datePublished" datetime="2025-03-05T09:50:32.654Z" title="更新于 2025-03-05 17:50:32">2025-03-05</time></header><p>详解23种设计模式</p>
<span id="more"></span>

<p>在了解设计模式之前首先应该先<strong>立靶</strong>,即何为优秀的设计</p>
<h1 id="面向对象设计原则"><a href="#面向对象设计原则" class="headerlink" title="面向对象设计原则"></a>面向对象设计原则</h1><p>下面是面向对象设计中的重要原则，通常统称为“SOLID”原则。它们用于指导软件设计，以提高代码的可维护性、可扩展性和灵活性</p>
<ol>
<li><p><strong>单一职责原则（Single Responsibility Principle）</strong>：一个类应该只有一个引起变化的原因，即一个类应该只负责一个功能。 </p>
</li>
<li><p><strong>开放-封闭原则（Open-Closed Principle）</strong>：软件实体（类、模块、函数等）应该对扩展开放，对修改关闭，可以通过扩展已有的代码来实现新功能，而不是修改已有的代码。 </p>
</li>
<li><p><strong>里氏替换原则（Liskov Substitution Principle）</strong>：子类必须能够替换其父类而不影响程序的正确性，即子类应该能够完全替代父类。 </p>
</li>
<li><p><strong>依赖倒置原则（Dependency Inversion Principle）</strong>：高层模块不应该依赖于低层模块，二者都应该依赖于抽象。 </p>
<p>模块间的依赖关系应该通过接口或抽象类来建立，而不是直接依赖于具体的实现类。这样可以降低模块间的耦合度，提高代码的灵活性和可维护性</p>
</li>
<li><p><strong>接口隔离原则（Interface Segregation Principle）</strong>：客户端不应该强制依赖它不需要的接口，应该将大接口拆分成多个小接口。 </p>
</li>
<li><p><strong>迪米特法则（Law of Demeter）</strong>：一个对象应该对其他对象有最少的了解，即一个对象应该尽可能少地与其他对象发生相互作用。 这些原则可以帮助设计出符合面向对象设计原则的软件系统，提高系统的灵活性、可维护性和可扩展性。</p>
</li>
</ol>
<p>[[架构相关#软件开发设计哲学|完整可以参考软件开发设计哲学]]</p>
<h2 id="组合优于继承原则"><a href="#组合优于继承原则" class="headerlink" title="组合优于继承原则"></a>组合优于继承原则</h2><p>组合和继承都在尝试解决同样的问题:假如你有一段代码想复用</p>
<p>广为流传的“组合优于继承” 的说法是一种不严谨的翻译，其来源如下：（众多设计模式强调的两个个最核心原则《Design Patterns: Elements of Reusable Object-Oriented Software》）</p>
<ol>
<li>Program to an interface, not an implementation. (面向接口编程，而不是具体的实现)</li>
<li>Favor object composition over class inheritance.（若某个场景的代码复用既可以通过类继承实现，也可以通过对象组合实现，尽量选择对象组合的方式）</li>
</ol>
<h3 id="对象组合与类继承的对比"><a href="#对象组合与类继承的对比" class="headerlink" title="对象组合与类继承的对比"></a>对象组合与类继承的对比</h3><p>面向对象设计的过程中，两个最常用的技巧就是<strong>类继承</strong>和<strong>对象组合</strong>，同一个场景下的代码复用，这两个技巧基本上都可以完成。 但是他们有如下的区别：</p>
<ul>
<li>通过继承实现的代码复用常常是一种<strong>“白盒复用”</strong>， 这里的白盒指的是可见性： 对于继承来说，<strong>父类的内部实现对于子类来说是不透明的（实现一个子类时， 你需要了解父类的实现细节， 以此决定是否需要重写某个方法）</strong></li>
<li>对象组合实现的代码复用则是一种<strong>“黑盒复用”</strong>: 对象的内部细节不可见，对象仅仅是以<strong>“黑盒”</strong>的方式出现（可以<strong>通过改变对象引用来改变其行为</strong>方式）</li>
</ul>
<h4 id="继承式"><a href="#继承式" class="headerlink" title="继承式"></a>继承式</h4><p>这里通过汽车的刹车逻辑进行说明， 对于汽车来说，存在多种不同的型号，我们会很自然的希望定义一个类Car来描述所有汽车通用的刹车行为brake()，然后通过某种方式（继承&#x2F;组合）来为不同的型号的汽车提供不同的刹车行为。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Car</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 也可以将该方法设置成抽象方法，强迫子类来实现该方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Brake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 提供一个默认的刹车实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CarModelA</span> : <span class="title">Car</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Brake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        AStyleBrake(); <span class="comment">// A 风格的刹车行为</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AStyleBrake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="comment">// A 风格的刹车实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CarModelB</span> : <span class="title">Car</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Brake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        BStyleBrake(); <span class="comment">// B 风格的刹车行为</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BStyleBrake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        <span class="comment">// B 风格的刹车实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>值得注意的是: 每一个型号的车的刹车行为是在编译时就确定好的,没有办法在运行时刻将CarModelB的刹车行为赋予CarModelA</p>
<h4 id="组合式"><a href="#组合式" class="headerlink" title="组合式"></a>组合式</h4><p>通过引用组合各个组件</p>
<p>如果通过对象组合的实现方式，则需要为Car定义一个引用，该引用的类型是一个为刹车行为定义的抽象（<strong>可以是抽象类或接口类</strong>）</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义刹车行为接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IBrakeBehavior</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Brake</span>()</span>; <span class="comment">// C# 中的接口方法不需要 public 关键字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A 风格的刹车行为实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AStyleBrake</span> : <span class="title">IBrakeBehavior</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Brake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        AStyleBrakeMethod(); <span class="comment">// A 风格的刹车行为</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AStyleBrakeMethod</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// A 风格的刹车实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// B 风格的刹车行为实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BStyleBrake</span> : <span class="title">IBrakeBehavior</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Brake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        BStyleBrakeMethod(); <span class="comment">// B 风格的刹车行为</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BStyleBrakeMethod</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// B 风格的刹车实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 汽车类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Car</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> IBrakeBehavior brakeBehavior;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Brake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        brakeBehavior.Brake(); <span class="comment">// 调用当前的刹车行为</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetBrakeBehavior</span>(<span class="params">IBrakeBehavior brakeType</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.brakeBehavior = brakeType; <span class="comment">// 设置新的刹车行为</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：上面的刹车行为不一定需要通过接口来实现，定义一个BrakeBehaviour的父类，然后再定义AStyleBrake，BStyleBrake来继承该类，实现不同的行为， 同样是组合方式的应用。所以不难发现， 当我们拿<strong>类继承</strong>和<strong>组合</strong>在一起进行对比时， 并不是以<strong>实现方式中是否有用到类继承</strong>来区分的。</p>
<blockquote>
<p>我们真正关注的是<strong>行为的继承</strong>与<strong>行为的组合</strong> ：需要变化的行为是通过<strong>继承后重写的方式</strong>实现，还是通过<strong>赋予不同的行为实例对象</strong>实现。</p>
</blockquote>
<h4 id="继承式优缺点"><a href="#继承式优缺点" class="headerlink" title="继承式优缺点"></a>继承式优缺点</h4><p><strong>类继承优点</strong>：</p>
<ul>
<li>类之间的继承关系时在编译时刻静态地定义好的，因此<strong>使用起来也非常直观</strong>，毕竟继承是被编程语言本身所支持的功能。</li>
<li>类继承也使得修改要复用的代码变得相对容易，因为可以仅仅重写要更改的父类方法。(如在Java集合标准库中，大量方法就是通过继承复用的，针对这些方法的维护、升级都相对简单)</li>
</ul>
<p><strong>类继承缺点</strong>:</p>
<ul>
<li>第一个缺点是伴随第一个优点而生的：无法在运行时改变继承了父类的子类行为（这一点在之前汽车的例子中已经进行了说明）。</li>
<li>第二个缺点更严重：<strong>与父类耦合</strong>,通过继承实现的代码复用，<strong>本质上把父类的内部实现细节暴露给了子类，子类的实现会和父类的实现紧密的绑定在一起，结果是父类实现的改动，会导致子类也必须得改变</strong>。</li>
</ul>
<p>以之前的例子进行说明，如果是通过继承的方式来实现不同型号汽车的刹车行为变化，假设现在我们基于Car这个父类实现了10种不同型号的汽车CarModel( A、B、C、D、E、F、G、H、I 、J)，其中前5个型号( A、B、C、D、E) 都没有重写父类的刹车方法，直接使用了父类Car提供的默认方法，后5个型号均提供了自己独特的brake实现 。</p>
<p>现假设，我们希望对Car中的brake方法进行升级改造，<strong>然而升级改造后的brake行为只适用于C，D，最早的两种型号A，B并不兼容升级后的刹车行为</strong>。这样，<strong>我们为了保证A，B依旧能正常工作，就不得不把旧的brake实现挪到A、B中，或者分别去升级C、D、E中的brake方法</strong>。(比如Java集合标准库中，后期对Stream的支持，直接改变了interface类最早的定义，在interface中加入了默认实现机制)</p>
<h4 id="组合式优缺点"><a href="#组合式优缺点" class="headerlink" title="组合式优缺点"></a>组合式优缺点</h4><p><strong>对象组合优点</strong>:</p>
<ul>
<li>对象的组合是在运行时，通过对象之间所获取的引用关系决定的，所以对象组合要求不同的对象遵从对方所实现的<strong>接口</strong>来做引用传递，这样反过来会要求开发者<strong>更用心地设计接口</strong>，以此保证客户端在使用一个对象时，可以把它和很多其他的对象组合在一起使用而不会出现问题。</li>
<li><strong>对象的组合由于是通过接口实现的</strong>，这样在复用的过程中<strong>不会打破其封装性</strong>。任意一个对象都可以在<strong>运行时</strong>被替换成另外一个实现了相同接口且类型相同的对象，更重要的是，由于一个对象的实现是针对接口而编写的，具体实现之间的依赖会更少。</li>
<li>对象组合的方式可以帮助你<strong>保持每个类的内聚性</strong>，让每个类专注实现一个任务。类的层次会保持的很小，不会增长到一种无法管理的恐怖数量。（<strong>这也是Java只支持单继承的原因</strong>）</li>
</ul>
<blockquote>
<p><strong>总结而言:现代开发,组合才具备更强的灵活性而当继承面领改变的时候,因为子类与父类的耦合会带来更大的重构复杂度</strong></p>
<p><strong>根本原因也是因为,继承自然地要求捆绑所有公共元素到父类上,但一旦发现共性中的例外,这就需要很大的修改</strong></p>
<p>继承遵守的契约是子类都有父类的结构,即父类共享了所有,而在组合式中,接口就是就是契约,他是最轻量最小化级的契约,更容易被附加到已经存在的类中.</p>
<p>说白了,组合是一种更加好用的抽象方式</p>
<p>现代项目开发中完全可以不使用继承,只使用组合会更好 </p>
</blockquote>
<p>组合所使用的引入接口的这种做法又叫<a href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">依赖注入</a></p>
<h5 id="组合缺点以及解决方案"><a href="#组合缺点以及解决方案" class="headerlink" title="组合缺点以及解决方案"></a>组合缺点以及解决方案</h5><ul>
<li><p>因为需要初始化所有的内部类型,很多的实现会含有相同的重复代码</p>
</li>
<li><p>当需要从重用的代码中暴露信息时,需要创建许多包装方法(简单返回一个内部类型的调用)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getName</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> user.getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>总之,优势远大于劣势,减少未来修改付出的代价</p>
<h5 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h5><blockquote>
<p><strong>Dependency Injection</strong></p>
<p>本质就是有两段代码,其中一段代码中想要使用另一段代码,但是它不直接用,而是把它当成参数传进来(使用接口的方式传入,就好比依赖了这个接口),把要用的东西传进来就是”<strong>注入</strong>“</p>
<p><strong>把被依赖的代码注入到要用它的代码</strong>  称之为 <strong>依赖注入</strong></p>
<p>下面视频有利于直观感受依赖注入的好处</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.bilibili.com/video/BV1Wh4y1k7vN" alt="教程|720x360"></p>
<p>优势:修改简单,易于测试</p>
<p>一个思想:如果发现自己在想怎么测试private方法,或者需要设置一些内部变量才能进行测试,这个信号在提醒你需要把一些东西提出来,把他们分离出来并通过注入实现隔离</p>
</blockquote>
<h2 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h2><p>依赖倒置原则（Dependency Inversion Principle, DIP）是 SOLID 设计原则之一，它的核心思想是：</p>
<ol>
<li>高层模块不应该依赖低层模块，两者都应该依赖抽象。</li>
<li>抽象不应该依赖具体实现，具体实现应该依赖抽象。</li>
</ol>
<p>通过依赖倒置原则，可以有效解决循环依赖问题，因为它将直接的依赖关系解耦为通过抽象（接口或抽象类）进行间接依赖</p>
<p>循环依赖是指两个或多个模块（类）之间直接或间接地相互依赖。例如：</p>
<ul>
<li>类 A 依赖类 B。</li>
<li>类 B 同时依赖类 A。</li>
</ul>
<p>这种情况下，代码会变得紧耦合，难以维护和测试，甚至可能导致编译或运行时错误。</p>
<p>一般都是<strong>通过引入抽象层和依赖注入,将循环依赖转换为对抽象的依赖</strong>,从而打破紧耦合关系,步骤如下:</p>
<ul>
<li>定义接口。</li>
<li>让类实现接口并依赖接口。</li>
<li>在运行时动态注入具体实现。</li>
</ul>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="设计模式的重要性"><a href="#设计模式的重要性" class="headerlink" title="设计模式的重要性"></a>设计模式的重要性</h2><p><strong>马丁：</strong>设计模式给了我们瞄准的目标。我还会做一些预先设计。模式就是用来干这个的。模式还给了我们以重构的目标。我们得以知道我们改进的方向。了解模式还有助于我们找到设计美感，因为模式至少都是一些好的设计。你可以从它们身上学到很多。因此，我仍然认为模式起着重要的作用。</p>
<h2 id="23种设计模式"><a href="#23种设计模式" class="headerlink" title="23种设计模式"></a>23种设计模式</h2><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406221119508.png" alt="image-20240622111945629" style="zoom: 33%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406221120739.png" alt="image-20240622112032299" style="zoom: 25%;" />

<h3 id="创建型模式（Creational-Patterns）"><a href="#创建型模式（Creational-Patterns）" class="headerlink" title="创建型模式（Creational Patterns）"></a>创建型模式（Creational Patterns）</h3><p>它关注类产生对象的创建过程中的各种模式</p>
<ol>
<li><a href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">工厂模式（Factory Pattern）</a></li>
<li><a href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">抽象工厂模式（Abstract Factory Pattern）</a></li>
<li><a href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">单例模式（Singleton Pattern）</a></li>
<li><a href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F">建造者模式（Builder Pattern）</a></li>
<li><a href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F">原型模式（Prototype Pattern）</a></li>
</ol>
<h3 id="结构型模式（Structural-Patterns）"><a href="#结构型模式（Structural-Patterns）" class="headerlink" title="结构型模式（Structural Patterns）"></a>结构型模式（Structural Patterns）</h3><p>它关注对象与对象之间的各种组合关系的各种模式</p>
<ol>
<li><a href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">适配器模式（Adapter Pattern）</a></li>
<li><a href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F">桥接模式（Bridge Pattern）</a></li>
<li><a href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F">组合模式（Composite Pattern）</a></li>
<li><a href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F">装饰器模式（Decorator Pattern）</a></li>
<li><a href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F">外观模式（Facade Pattern）</a></li>
<li><a href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F">享元模式（Flyweight Pattern）</a></li>
<li><a href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">代理模式（Proxy Pattern）</a></li>
</ol>
<h3 id="行为型模式（Behavioral-Patterns）"><a href="#行为型模式（Behavioral-Patterns）" class="headerlink" title="行为型模式（Behavioral Patterns）"></a>行为型模式（Behavioral Patterns）</h3><p>它关注对象各种不同的用处和场景的各种模式</p>
<ol>
<li><a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">策略模式（Strategy Pattern）</a></li>
<li><a href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">观察者模式（Observer Pattern）</a></li>
<li><a href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F">模板方法模式（Template Method Pattern）</a></li>
<li><a href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F">迭代器模式（Iterator Pattern）</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F">命令模式（Command Pattern）</a></li>
<li><a href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F">备忘录模式（Memento Pattern）</a></li>
<li><a href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F">状态模式（State Pattern）</a></li>
<li><a href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F">访问者模式（Visitor Pattern）</a></li>
<li><a href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F">中介者模式（Mediator Pattern）</a></li>
<li><a href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F">解释器模式（Interpreter Pattern）</a></li>
<li><a href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F">责任链模式（Chain of Responsibility Pattern）</a></li>
</ol>
<h2 id="设计模式之间的关系"><a href="#设计模式之间的关系" class="headerlink" title="设计模式之间的关系"></a>设计模式之间的关系</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406221124175.png" alt="image-20240622112454266"></p>
<p>上图中红色表示创建型的,绿色表示结构型的,蓝色表示行为型的,相连表示有相似性(容易混淆,连接线上的文字表示主要不同点)</p>
<h2 id="图例讲解"><a href="#图例讲解" class="headerlink" title="图例讲解"></a>图例讲解</h2><p>为什么不使用<a href="#UML%E7%B1%BB%E5%9B%BE">UML图</a>讲解?因为UML图带成员,不够简洁</p>
<p>下面所有设计模式结构图均参考这些图例来讲解(直观)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406221117280.png" alt="iShot_2024-06-22_11.11.30"></p>
<h1 id="创建型模式"><a href="#创建型模式" class="headerlink" title="创建型模式"></a>创建型模式</h1><h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><p>将对象的实例化交给工厂去做，你只需要告诉工厂你需要什么对象，我给你造出来就行了</p>
<p>目的：让使用者只需要关注自己需要的，而不需要关注这个东西是怎么创建的，能用就行。让实例创建和实例使用解耦</p>
<h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p>两种实现方式</p>
<ol>
<li><p>在类里写静态函数用于创建实例</p>
<p>解决构造函数参数太多的问题，通过定义一个静态函数用于创建实例,来简化代码</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406221425516.png" alt="image-20240622142528216" style="zoom: 33%;" />
</li>
<li><p>使用一个单独的类来创建实例</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406221426794.png" alt="image-20240622142625462" style="zoom: 67%;" /></li>
</ol>
<p>简单工厂:<strong>把对象的创建放到一个工厂类中,通过参数来创建不同的对象</strong> </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Factory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Factory</span>();</span><br><span class="line">	~<span class="built_in">Factory</span>();</span><br><span class="line">	<span class="comment">// 工厂函数</span></span><br><span class="line">	<span class="comment">// 创建RequestCodec对象</span></span><br><span class="line">	<span class="comment">// 创建RespondCodec对象</span></span><br><span class="line">	<span class="comment">// flag == 0 创建RequestCodec对象</span></span><br><span class="line">	<span class="comment">// flag == 1 创建RespondCodec对象</span></span><br><span class="line">	<span class="function">Codec *<span class="title">createFactory</span><span class="params">(<span class="type">int</span> flag)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (flag)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">			<span class="comment">// 创建RequestCodec对象</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> xxx;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>缺点</strong>：每添一个对象，就需要对简单工厂进行修改（尽管不是删代码，仅仅是添一个switch case，但仍然违背了“不改代码”的原则, 尽量做到添加代码而不是修改原有代码）</li>
<li><strong>优点</strong>：去除了与具体产品的依赖。</li>
</ul>
<p>使用:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建工厂类</span></span><br><span class="line">Factory* factory = <span class="keyword">new</span> <span class="built_in">Factory</span>();</span><br><span class="line"><span class="comment">// 2. 使用工厂函数创建对象, 返回父类指针</span></span><br><span class="line">Codec*codec = factory-&gt;<span class="built_in">createFactory</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 3. 编解码</span></span><br><span class="line">codec-&gt;<span class="built_in">msgEncode</span>();</span><br></pre></td></tr></table></figure>

<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F&spm=1001.2101.3001.7020">抽象工厂模式</a>（Abstract Factory Pattern）是<strong>围绕一个超级工厂创建其他工厂。该超级工厂又称为其他工厂的工厂</strong>。这种类型的设计模式属于<strong>创建型模式</strong>，它提供了一种创建对象的最佳方式。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406230923554.png" alt="image-20240623092325564" style="zoom: 25%;" />

<p>好处:易于维护,易于扩充,且不用对原有的代码进行修改</p>
<ol>
<li>工厂方法：每种产品由一种工厂来创建, 不同工厂创建不同的对象</li>
<li>创建一个工厂类 - 基类</li>
<li>在基类的工厂类中添加工厂函数, 这是一个虚函数</li>
<li>根据要创建的子对象添加子工厂类, 每个子对象的创建都对应一个子工厂类</li>
<li>在子工厂类中实现父类的工厂函数, 完成创建对象的操作</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建的子对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RequestCodec</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RespondCodec</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建工厂类的父类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Factory</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Factory</span>();</span><br><span class="line">	~<span class="built_in">Factory</span>();</span><br><span class="line">	<span class="comment">// 工厂函数</span></span><br><span class="line">	<span class="comment">// 创建RequestCodec对象</span></span><br><span class="line">	<span class="comment">// 创建RespondCodec对象</span></span><br><span class="line">	<span class="comment">// flag == 0 创建RequestCodec对象</span></span><br><span class="line">	<span class="comment">// flag == 1 创建RespondCodec对象</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> Codec *<span class="title">createFactory</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建子工厂类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RequestFactory</span> : <span class="keyword">public</span> Factory</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">RequestFactory</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		flag = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">RequestFactory</span>(RequestMsg *msg)</span><br><span class="line">	&#123;</span><br><span class="line">		m_request = msg;</span><br><span class="line">		flag = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">RequestFactory</span>();</span><br><span class="line">	<span class="comment">// 只创建RequestCodec对象</span></span><br><span class="line">	<span class="function">Codec *<span class="title">createFactory</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (flag)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RequestCodec</span>(&amp;msg);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RequestCodec</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	RequestMsg *m_request;</span><br><span class="line">	<span class="type">bool</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建子工厂类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RespondFactory</span> : <span class="keyword">public</span> Factory</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">RequestFactory</span>();</span><br><span class="line">	~<span class="built_in">RequestFactory</span>();</span><br><span class="line">	<span class="comment">// 只创建RespondCodec对象</span></span><br><span class="line">	<span class="function">Codec *<span class="title">createFactory</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">RespondCodec</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>其实就是把switch的分支拆到了多态中</strong></p>
<p>抽象工厂类的使用:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用编解码RequestCodec</span></span><br><span class="line"><span class="comment">// 1. 创建工厂对象</span></span><br><span class="line">Factory* f = <span class="keyword">new</span> <span class="built_in">RequestFactory</span>();</span><br><span class="line"><span class="comment">// 2. 创建编解码的类对象</span></span><br><span class="line">Codec* codec = f-&gt;<span class="built_in">createFactory</span>();</span><br><span class="line"><span class="comment">// 3. 编解码</span></span><br><span class="line">codec-&gt;<span class="built_in">msgDecode</span>();</span><br></pre></td></tr></table></figure>

<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302201320179.jpeg" alt="ASN.1 编解码- 类图jpg_Page1"  />

<ul>
<li><p>BaseASN1   实现最基本的[[网络编程#ASN.1|ASN1编码]]逻辑</p>
</li>
<li><p>SequenceASN1  ASN1编码的进一步封装</p>
</li>
<li><p>Codec  对为了实现对不同结构体的ASN1编码而对SequenceASN1做的进一步封装的一个用于实现多态的基类</p>
</li>
<li><p>RequestCodec和RespondCodec   用于具体实现Codec多态的[对请求数据进行ASN1编码的类型]以及[对回应数据进行ASN1编码的类型]</p>
</li>
<li><p>FactoryCodec   生产各种工厂的抽象类,其生产工厂的函数返回的类型为Codec(多态对多态)</p>
</li>
<li><p>RequestFactory和RespondFectory 具体的[生产请求数据的工厂的类]和[生产回应数据的工厂的类]</p>
</li>
</ul>
<p>其使用方式为:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用编解码RequestCodec</span></span><br><span class="line"><span class="comment">// 1. 创建工厂对象</span></span><br><span class="line">FactoryCodec* f = <span class="keyword">new</span> <span class="built_in">RequestFactory</span>();</span><br><span class="line"><span class="comment">// 2. 创建编解码的类对象</span></span><br><span class="line">Codec* codec = f-&gt;<span class="built_in">createCodec</span>();   </span><br><span class="line"><span class="comment">// 3. 编解码</span></span><br><span class="line">codec-&gt;<span class="built_in">msgDecode</span>();</span><br></pre></td></tr></table></figure>

<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>通过持有自身实例实现</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231054157.png" alt="image-20240623105445590" style="zoom:25%;" />

<p><strong>类产生的实例是全局唯一的</strong></p>
<ul>
<li><p><strong>饿汉式-单例模式</strong></p>
<p>在类创建的时候,就创建实例,并直接让这个产生出来的实例绑定到自己的某一个静态成员上,提供一个静态方法返回这个静态成员(实际上就是实例),通过这个getxxx静态方法就能拿到自身唯一的实例.这个过程中构造函数是私有的,防止了通过构造函数在外界创造实例</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231055743.png" alt="image-20240623105503211" style="zoom: 25%;" />

<p>缺点在于,程序刚开始运行的时候会比较卡,大量new被执行(懒汉式正是解决此问题)</p>
</li>
<li><p><strong>懒汉式-单例模式</strong></p>
<p>解决的正是饿汉式的问题,让他在真正需要执行的时候再去运行这段代码</p>
<p>在getxxx静态方法被调用的时候去检查静态属性,如果是null才创建实例</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231055296.png" alt="image-20240623105516786" style="zoom: 25%;" /></li>
</ul>
<p>当创建实例的代价很大的时候,并且常用该实例用不到的情况可以使用这种懒汉式单例模式</p>
<h2 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h2><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231058557.png" alt="image-20240623105843918" style="zoom:33%;" />

<p>类中实现Clone方法,通过在实例中调用克隆函数用于克隆自身</p>
<p>适合于克隆自己比通过构造函数创建自身效率高的场景(实际使用场景较小)</p>
<h2 id="构造器模式"><a href="#构造器模式" class="headerlink" title="构造器模式"></a>构造器模式</h2><p>也叫Builder模式(建造者模式),也叫生成器模式</p>
<p>在软件系统中，有时候面临着“一个复杂对象”的创建工作，其通常由各个部分的子对象用一定的算法构成；由于需求的变化，这个复杂对象的各个部分经常面临着剧烈的变化，但是将它们组合在一起的算法却相对稳定。如何应对这种变化？如何提供一种“封装机制”来隔离出“复杂对象的各个部分”的变化，从而保持系统中的“稳定构建算法”不随着需求改变而改变？</p>
<p>将一个复杂对象的构建与其表示相分离，使得同样的构建过程可以创建不同的表示。          ——《设计模式》GoF</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231104005.png" alt="image-20240623110458354" style="zoom: 33%;" />

<p>大部分编程语言都支持可选参数,完全能更方便实现这样的功能,该模式在构造过程极其复杂的情况下有存在的意义</p>
<h1 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h1><h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><p>常用于解决旧系统或新旧接口之间的兼容问题</p>
<p>主要有两种</p>
<ul>
<li>类-适配器</li>
<li>对象-适配器</li>
</ul>
<h3 id="类-适配器"><a href="#类-适配器" class="headerlink" title="类-适配器"></a>类-适配器</h3><p>通过<strong>继承</strong>实现</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231123164.png" alt="image-20240623112342593" style="zoom:33%;" />

<p>创建一个新类(适配器)继承新接口,同时继承老接口的实现类,在新类中新接口中的方法中调用老接口的方法同时做其他逻辑</p>
<h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><p>以java演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 旧的打印机接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">OldPrinter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">printString</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecificPrinter</span> <span class="keyword">implements</span> <span class="title class_">OldPrinter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printString</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Print from SpecificPrinter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新的打印接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">NewPrinter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过继承SpecificPrinter并实现NewPrinter接口来创建适配器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrinterAdapter</span> <span class="keyword">extends</span> <span class="title class_">SpecificPrinter</span> <span class="keyword">implements</span> <span class="title class_">NewPrinter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 调用适配者类SpecificPrinter的方法</span></span><br><span class="line">        printString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//演示使用效果</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassAdapterDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NewPrinter</span> <span class="variable">newPrinter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrinterAdapter</span>();<span class="comment">//使用的时候这个是关键,用新接口引用适配器实例</span></span><br><span class="line">        newPrinter.print(); <span class="comment">// 将输出：Print from SpecificPrinter</span></span><br><span class="line">      	<span class="comment">//最终就实现了通过新接口来调用新接口的方法,通过适配器实际上调用的是老接口的方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class OldPrinter &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +printString()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class SpecificPrinter &#123;</span><br><span class="line">        +printString()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class NewPrinter &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +print()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class PrinterAdapter &#123;</span><br><span class="line">        +print()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    OldPrinter &lt;|.. SpecificPrinter</span><br><span class="line">    SpecificPrinter &lt;|-- PrinterAdapter</span><br><span class="line">    NewPrinter &lt;|.. PrinterAdapter</span><br></pre></td></tr></table></figure>

<h3 id="对象-适配器"><a href="#对象-适配器" class="headerlink" title="对象-适配器"></a>对象-适配器</h3><p>通过<strong>组合</strong>实现</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231632433.png" alt="image-20240623163238312" style="zoom:33%;" />

<h4 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h4><p>以java演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 旧的打印机接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">OldPrinter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">printString</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecificPrinter</span> <span class="keyword">implements</span> <span class="title class_">OldPrinter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printString</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Print from SpecificPrinter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新的打印接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">NewPrinter</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过组合SpecificPrinter并实现NewPrinter接口来创建适配器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrinterAdapter</span> <span class="keyword">implements</span> <span class="title class_">NewPrinter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OldPrinter oldPrinter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PrinterAdapter</span><span class="params">(OldPrinter oldPrinter)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.oldPrinter = oldPrinter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 调用适配者类SpecificPrinter的方法</span></span><br><span class="line">        oldPrinter.printString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示使用效果</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObjectAdapterDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">OldPrinter</span> <span class="variable">oldPrinter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpecificPrinter</span>();</span><br><span class="line">        <span class="type">NewPrinter</span> <span class="variable">newPrinter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrinterAdapter</span>(oldPrinter); <span class="comment">// 使用的时候这个是关键，用新接口引用适配器实例</span></span><br><span class="line">        newPrinter.print(); <span class="comment">// 将输出：Print from SpecificPrinter</span></span><br><span class="line">        <span class="comment">// 最终就实现了通过新接口来调用新接口的方法，通过适配器实际上调用的是老接口的方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class OldPrinter &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +printString()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class SpecificPrinter &#123;</span><br><span class="line">        +printString()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class NewPrinter &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +print()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class PrinterAdapter &#123;</span><br><span class="line">        -oldPrinter : OldPrinter</span><br><span class="line">        +PrinterAdapter(OldPrinter oldPrinter)</span><br><span class="line">        +print()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    OldPrinter &lt;|.. SpecificPrinter</span><br><span class="line">    NewPrinter &lt;|.. PrinterAdapter</span><br><span class="line">    PrinterAdapter --&gt; OldPrinter</span><br></pre></td></tr></table></figure>

<h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><blockquote>
<p>一言以蔽之:就是将多个接口及实现的体系可以通过一个类桥接到一起</p>
</blockquote>
<p><strong>桥接模式</strong>是一种结构型设计模式，用于将抽象部分与实现部分分离，使它们可以独立变化，互不影响。桥接模式的核心思想是通过将抽象部分和实现部分分离，使它们可以独立变化，从而提高系统的灵活性和可扩展性。</p>
<p>简单来说，桥接模式就像是一座桥，连接了抽象部分和实现部分，使它们可以分别变化而不相互影响。通过桥接模式，我们可以轻松地添加新的抽象部分或实现部分，而不需要修改原有的代码结构。</p>
<p>举个例子，假设我们要设计一个绘图软件，其中有不同的形状（圆形、矩形）和不同的颜色（红色、蓝色）。使用桥接模式，我们可以将形状和颜色分别作为抽象部分和实现部分，通过桥接将它们连接在一起。这样，我们可以轻松地组合不同的形状和颜色，而不需要修改原有的代码结构。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231654712.png" alt="image-20240623165451792" style="zoom:33%;" />

<p>看似很复杂,实际上就是图中右上方的抽象类通过<strong>依赖注入</strong>的方式,传入武器,如果还有底座啥的,也同样利用依赖注入传进来,相当于桥接了武器和底座,可以随意桥接两两</p>
<p>实际上就是依赖注入多个组件的思想</p>
<h2 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h2><p><strong>组合模式</strong>是一种结构型设计模式，它<strong>允许你将对象组合成树形结构以表示“部分-整体”的层次结构</strong>。<strong>这种模式使得客户端可以统一处理单个对象和对象组合，而不必区分它们之间的差异。在组合模式中，组合对象和叶子对象都实现相同的接口，这样客户端可以像处理单个对象一样处理对象组合</strong>。这种模式可以使得系统更加灵活和可扩展，同时简化了客户端的代码。 </p>
<p><strong>适用场景</strong>: 当希望以一致的方式处理单个对象和对象组合时使用</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406231905869.png" alt="image-20240623190535699" style="zoom:33%;" />

<h3 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h3><p>以C#代码为例:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 武器接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">IWeapon</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Attack</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体武器类：剑</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Sword</span> : <span class="title">IWeapon</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;使用剑攻击！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体武器类：枪</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Gun</span> : <span class="title">IWeapon</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;使用枪射击！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合模式中的组件基类   </span></span><br><span class="line"><span class="comment">//继承IWeapon,这样在使用组合模式时，无论是叶子节点还是复合节点都可以统一地调用Attack()方法</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">WeaponComponent</span> : <span class="title">IWeapon</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">WeaponComponent component</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params">WeaponComponent component</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合模式中的复合武器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">CompositeWeapon</span> : <span class="title">WeaponComponent</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;WeaponComponent&gt; components = <span class="keyword">new</span> List&lt;WeaponComponent&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">WeaponComponent component</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        components.Add(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params">WeaponComponent component</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        components.Remove(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (WeaponComponent component <span class="keyword">in</span> components)</span><br><span class="line">        &#123;</span><br><span class="line">            component.Attack();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Sword sword1 = <span class="keyword">new</span> Sword();</span><br><span class="line">        Sword sword2 = <span class="keyword">new</span> Sword();</span><br><span class="line">        Gun gun1 = <span class="keyword">new</span> Gun();</span><br><span class="line"></span><br><span class="line">        CompositeWeapon compositeWeapon = <span class="keyword">new</span> CompositeWeapon();</span><br><span class="line">        compositeWeapon.Add(sword1);</span><br><span class="line">        compositeWeapon.Add(sword2);</span><br><span class="line">        compositeWeapon.Add(gun1);</span><br><span class="line"></span><br><span class="line">        compositeWeapon.Attack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    IWeapon &lt;|.. Sword</span><br><span class="line">    IWeapon &lt;|.. Gun</span><br><span class="line">    IWeapon &lt;|.. WeaponComponent</span><br><span class="line">    WeaponComponent &lt;|-- CompositeWeapon</span><br><span class="line">    </span><br><span class="line">    class IWeapon &#123;</span><br><span class="line">        +Attack()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class Sword &#123;</span><br><span class="line">        +Attack()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class Gun &#123;</span><br><span class="line">        +Attack()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class WeaponComponent &#123;</span><br><span class="line">        +Add(WeaponComponent component)</span><br><span class="line">        +Remove(WeaponComponent component)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class CompositeWeapon &#123;</span><br><span class="line">        -List~WeaponComponent~ components</span><br><span class="line">        +Add(WeaponComponent component)</span><br><span class="line">        +Remove(WeaponComponent component)</span><br><span class="line">        +Attack()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class Program &#123;</span><br><span class="line">        +Main()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Program --&gt; CompositeWeapon</span><br><span class="line">    CompositeWeapon --&gt; WeaponComponent</span><br><span class="line">    CompositeWeapon --&gt; IWeapon</span><br><span class="line">    Sword --&gt; IWeapon</span><br><span class="line">    Gun --&gt; IWeapon</span><br></pre></td></tr></table></figure>

<h2 id="装饰模式"><a href="#装饰模式" class="headerlink" title="装饰模式"></a>装饰模式</h2><p><strong>装饰模式&#x2F;装饰器&#x2F;装饰者模式 (Decorator Mode)</strong></p>
<p><strong>动态地给一个对象增加新的功能</strong>,而不改变对象原本的结构 (非常有用!)</p>
<p>装饰器模式允许在不影响同一类其他对象行为的情况下，静态或动态地向单个对象添加行为。装饰器模式对于遵循单一职责原则特别有用，因为它允许将功能分离到不同的类中，每个类都有自己独特的关注点。</p>
<blockquote>
<p>适用场景: 当希望在不修改原有代码情况下,动态地给对象添加新功能时,可以使用装饰器模式,装饰器模式可以帮助你以灵活和可拓展的方式组合对象的各种功能</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261444830.png" alt="image-20240626144448077" style="zoom: 25%;" />

<p>给一个类或对象增加新的功能,有两种方式:(参考上图)</p>
<ul>
<li>上方的机器人,更新功能左下角机器人,称之为<strong>继承机制</strong>:新类继承一个现有的类,在子类中进行拓展功能</li>
<li>上方的机器人,更新功能为右下角机器人,称之为<strong>关联机制</strong>:将一个类的对象套入到另一个类的对象中,相当于把机器人嵌入到箱子里来,套一个壳子来拓展功能,这个壳子就是<strong>装饰器</strong></li>
</ul>
<p>对于第一种方式来说:<strong>最大的问题在于继承是静态的,没办法在运行的过程中动态的改变一个类的行为</strong>.</p>
<p>第二种方法是动态的:<br>$$<br>动态地给一个对象添加一些额外的功能.就增加功能来说,装饰模式比生成子类更为灵活<br>$$<br>可以这么理解,经过处理就可以给类添加新功能</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261654531.png" alt="image-20240626165422116" style="zoom:33%;" />

<p>这也是和<a href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">代理模式</a>的区别:代理类里面是写死的，在编译的时候就确定了关系。而装饰器是在运行时来确定的</p>
<ul>
<li>代理模式是直接编写代理对象</li>
<li>装饰模式是编写函数动态生成代理对象</li>
</ul>
<p>装饰器模式关注于在一个对象上动态添加方法，而代理模式关注于控制对象的访问</p>
<p>大致的操作图如下:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261700308.png" alt="image-20240626170046923" style="zoom:33%;" />

<p>紫色的圆是左边类的对象,通过构造传入右边类成员中,在新类的同名run中调用成员对象的原来的run,这里就可以在前后添加代码逻辑</p>
<blockquote>
<p>使用场景</p>
<p><strong>实现监听器功能</strong>,提供一个接口,让使用者自定义监听某个事件发生时的行为,在事件发生前后触发相应的操作:通过装饰器模式，可以动态地附加到想要监听的对象上,在执行目标函数的前后可以执行相应的函数(装饰器用来做监听器的场景非常多)</p>
<p>肉鸽游戏场景:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261700954.png" alt="image-20240626170006573" style="zoom: 33%;" />
</blockquote>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>根据这个图,给出c#的代码,以演示装饰者模式</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261634731.png" alt="image-20240626163420000" style="zoom: 67%;" />

<p>然后就可以以如图的形式动态地(套壳)修改类的表现形式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261648968.png" alt="image-20240626164802602"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础抽象类 Beverage 饮料类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Beverage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">string</span> Description &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体组件类 奶茶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">MilkTea</span> : <span class="title">Beverage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Description =&gt; <span class="string">&quot;Milk Tea&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2.00</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体组件类 水果茶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">FruitTea</span> : <span class="title">Beverage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Description =&gt; <span class="string">&quot;Fruit Tea&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2.50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体组件类 酸奶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Yogurt</span> : <span class="title">Beverage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Description =&gt; <span class="string">&quot;Yogurt&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.00</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象装饰者类 </span></span><br><span class="line"><span class="comment">// 注意:要继承抽象饮料类,包含抽象饮料类的对象成员</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">ToppingDecorator</span> : <span class="title">Beverage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> Beverage beverage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ToppingDecorator</span>(<span class="params">Beverage beverage</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.beverage = beverage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Description =&gt; beverage.Description;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">override</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰者类 珍珠装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Boba</span> : <span class="title">ToppingDecorator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Boba</span>(<span class="params">Beverage beverage</span>) : <span class="title">base</span>(<span class="params">beverage</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Description =&gt; beverage.Description + <span class="string">&quot;, Boba&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> beverage.Cost() + <span class="number">0.50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰者类 布丁装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Pudding</span> : <span class="title">ToppingDecorator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Pudding</span>(<span class="params">Beverage beverage</span>) : <span class="title">base</span>(<span class="params">beverage</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Description =&gt; beverage.Description + <span class="string">&quot;, Pudding&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">      	<span class="comment">//注意这里的渐进式计算价格</span></span><br><span class="line">        <span class="keyword">return</span> beverage.Cost() + <span class="number">0.60</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰者类 草本果冻装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">HerbalJelly</span> : <span class="title">ToppingDecorator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HerbalJelly</span>(<span class="params">Beverage beverage</span>) : <span class="title">base</span>(<span class="params">beverage</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> Description =&gt; beverage.Description + <span class="string">&quot;, Herbal Jelly&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">double</span> <span class="title">Cost</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> beverage.Cost() + <span class="number">0.70</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Beverage beverage = <span class="keyword">new</span> MilkTea();</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;beverage.Description&#125;</span> $<span class="subst">&#123;beverage.Cost()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        beverage = <span class="keyword">new</span> Boba(beverage);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;beverage.Description&#125;</span> $<span class="subst">&#123;beverage.Cost()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        beverage = <span class="keyword">new</span> Pudding(beverage);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;beverage.Description&#125;</span> $<span class="subst">&#123;beverage.Cost()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        beverage = <span class="keyword">new</span> HerbalJelly(beverage);</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;<span class="subst">&#123;beverage.Description&#125;</span> $<span class="subst">&#123;beverage.Cost()&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Milk Tea $2</span></span><br><span class="line"><span class="comment">Milk Tea, Boba $2.5</span></span><br><span class="line"><span class="comment">Milk Tea, Boba, Pudding $3.1</span></span><br><span class="line"><span class="comment">Milk Tea, Boba, Pudding, Herbal Jelly $3.8</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>当需要添加新的配料,只需要添加新的具体的配料装饰类;同样当需要添加新的饮料也只需要添加新的具体的饮料类</p>
<p>UML类图:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class Beverage &#123;</span><br><span class="line">        &lt;&lt;abstract&gt;&gt;</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class MilkTea &#123;</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class FruitTea &#123;</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Yogurt &#123;</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ToppingDecorator &#123;</span><br><span class="line">        &lt;&lt;abstract&gt;&gt;</span><br><span class="line">        -beverage : Beverage</span><br><span class="line">        +ToppingDecorator(Beverage beverage)</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Boba &#123;</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Pudding &#123;</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class HerbalJelly &#123;</span><br><span class="line">        +Description : string</span><br><span class="line">        +Cost() : double</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Beverage &lt;|-- MilkTea</span><br><span class="line">    Beverage &lt;|-- FruitTea</span><br><span class="line">    Beverage &lt;|-- Yogurt</span><br><span class="line">    Beverage &lt;|-- ToppingDecorator</span><br><span class="line">    ToppingDecorator &lt;|-- Boba</span><br><span class="line">    ToppingDecorator &lt;|-- Pudding</span><br><span class="line">    ToppingDecorator &lt;|-- HerbalJelly</span><br></pre></td></tr></table></figure>

<h2 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h2><p><strong>外观模式&#x2F;门面模式（Facade Pattern）</strong></p>
<p>外观模式为子系统中的一组接口提供一个统一的接口,即定义了一个高层接口,使得这一子系统更加容易使用</p>
<p><strong>通过提供一个统一的接口，来隐藏系统中多个子系统的复杂性</strong></p>
<p>将多个高度耦合的多类结构,封装到一个类中,只提供统一接口,是一种封装的思想</p>
<p><strong>适用场景</strong>: 当需要简化复杂系统的使用接口时,可使用外观模式</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261716578.png" alt="image-20240626171657987" style="zoom: 25%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">ResourceManagement</span>:</span><br><span class="line">    <span class="title">def</span> <span class="title">manage_resources</span>(<span class="title">self</span>):</span><br><span class="line">        <span class="title">print</span>(&quot;管理资源.&quot;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">TowerConstruction</span>:</span><br><span class="line">    <span class="title">def</span> <span class="title">build_tower</span>(<span class="title">self</span>, <span class="title">location</span>):</span><br><span class="line">        <span class="title">print</span>(<span class="title">f</span>&quot;&#123;location&#125;位置建造塔.<span class="string">&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">class EnemySpawning:</span></span><br><span class="line"><span class="string">    def spawn_enemies(self):</span></span><br><span class="line"><span class="string">        print(&quot;</span>生成敌人.<span class="string">&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">class GameLoopControl:</span></span><br><span class="line"><span class="string">    def start_game_loop(self):</span></span><br><span class="line"><span class="string">        print(&quot;</span>开始游戏循环.<span class="string">&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">class GameFacade:</span></span><br><span class="line"><span class="string">    def __init__(self):</span></span><br><span class="line"><span class="string">        self.resource_management = ResourceManagement()</span></span><br><span class="line"><span class="string">        self.tower_construction = TowerConstruction()</span></span><br><span class="line"><span class="string">        self.enemy_spawning = EnemySpawning()</span></span><br><span class="line"><span class="string">        self.game_loop_control = GameLoopControl()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def start_game(self):</span></span><br><span class="line"><span class="string">        self.resource_management.manage_resources()</span></span><br><span class="line"><span class="string">        self.tower_construction.build_tower(&quot;</span>中央位置<span class="string">&quot;)</span></span><br><span class="line"><span class="string">        self.enemy_spawning.spawn_enemies()</span></span><br><span class="line"><span class="string">        self.game_loop_control.start_game_loop()</span></span><br><span class="line"><span class="string">        print(&quot;</span>游戏开始!<span class="string">&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def main():</span></span><br><span class="line"><span class="string">    game_facade = GameFacade()</span></span><br><span class="line"><span class="string">    game_facade.start_game()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &quot;</span>__main__<span class="string">&quot;:</span></span><br><span class="line"><span class="string">    main()</span></span><br></pre></td></tr></table></figure>

<h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><p><strong>享元模式（Flyweight Pattern）</strong></p>
<blockquote>
<p>享元的本质就是公用数据的抽象,全局变量就可以算是一种享元</p>
</blockquote>
<p>通过共享技术来有效地支持大量细粒度对象的重用,节省不必要的属性空间,节省内存</p>
<p>将共同类型的属性放到享元类中</p>
<p>简单来说,享元模式通过共享对象来减少内存消耗,使用一个工厂来管理这些共享对象,并确保每个对象只被创建一次</p>
<p><strong>适用场景</strong>: 当需要创建大量相似对象,并希望通过共享对象来减少内存消耗时,可以使用享元模式</p>
<p>享元模式通过共享相同的状态来减少内存占用和提高性能，同时通过动态传递非共享状态来实现个性化定制。享元工厂负责管理共享池，确保享元对象的唯一性和共享性</p>
<ul>
<li><p><strong>具体享元类包含了所有共享的状态</strong>：</p>
<p>具体享元类是享元模式中的一种类别，它包含了所有可共享的状态或属性。这些状态是可以被多个对象共享的，从而节省内存和提高性能。具体享元类的实例通常是不可变的，它们包含了固定不变的共享状态。</p>
</li>
<li><p><strong>非共享的状态则会在使用时动态传递</strong>：</p>
<p>非共享的状态是指每个具体享元对象特有的状态或属性，这些状态不可共享。在使用具体享元对象时，这些非共享的状态会动态传递给享元对象，以便个性化地定制享元对象的行为。</p>
</li>
<li><p><strong>享元工厂负责维护享元对象的共享池</strong>：</p>
<p>享元工厂是负责创建和管理享元对象的工厂类。享元工厂维护一个共享池（Flyweight Pool），用于存储和管理已创建的享元对象。享元工厂确保相同的享元对象只被创建一次，并在需要时从共享池中获取已有的享元对象。</p>
</li>
<li><p><strong>提供一个方法来获取享元对象</strong>：</p>
<p>享元工厂提供一个方法（通常是工厂方法），用于获取享元对象。当客户端需要使用享元对象时，可以通过调用享元工厂的方法来获取相应的享元对象，并在其中传递非共享的状态参数。</p>
</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261738087.png" alt="image-20240626173800469" style="zoom: 50%;" />

<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象享元类</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title">ITextStyle</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ApplyStyle</span>(<span class="params"><span class="built_in">string</span> text</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体享元类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">ConcreteTextStyle</span> : <span class="title">ITextStyle</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _font;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">int</span> _size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteTextStyle</span>(<span class="params"><span class="built_in">string</span> font, <span class="built_in">int</span> size, <span class="built_in">string</span> color</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _font = font;</span><br><span class="line">        _size = size;</span><br><span class="line">        _color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ApplyStyle</span>(<span class="params"><span class="built_in">string</span> text</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Applying [<span class="subst">&#123;_font&#125;</span>, <span class="subst">&#123;_size&#125;</span>, <span class="subst">&#123;_color&#125;</span>] to \&quot;<span class="subst">&#123;text&#125;</span>\&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元工厂类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">TextStyleFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Dictionary&lt;<span class="built_in">string</span>, ITextStyle&gt; Styles = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, ITextStyle&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ITextStyle <span class="title">GetStyle</span>(<span class="params"><span class="built_in">string</span> font, <span class="built_in">int</span> size, <span class="built_in">string</span> color</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> key = font + size + color;</span><br><span class="line">        <span class="keyword">if</span> (!Styles.TryGetValue(key, <span class="keyword">out</span> ITextStyle style))</span><br><span class="line">        &#123;</span><br><span class="line">            style = <span class="keyword">new</span> ConcreteTextStyle(font, size, color);</span><br><span class="line">            Styles[key] = style;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> style;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 演示类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">FlyweightPatternDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        ITextStyle style1 = TextStyleFactory.GetStyle(<span class="string">&quot;Arial&quot;</span>, <span class="number">12</span>, <span class="string">&quot;Red&quot;</span>);</span><br><span class="line">        style1.ApplyStyle(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ITextStyle style2 = TextStyleFactory.GetStyle(<span class="string">&quot;Arial&quot;</span>, <span class="number">12</span>, <span class="string">&quot;Red&quot;</span>);</span><br><span class="line">        <span class="comment">// style2 和 style1 是相同实例</span></span><br><span class="line">        style2.ApplyStyle(<span class="string">&quot;Flyweight Pattern Demo&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Applying [Arial, 12, Red] to &quot;Hello, World!&quot;</span></span><br><span class="line"><span class="comment">Applying [Arial, 12, Red] to &quot;Flyweight Pattern Demo&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>抽象享元类</strong> <strong>ITextStyle</strong></p>
<ul>
<li>定义了一个方法 <code>ApplyStyle(string text)</code>，用于应用样式。</li>
</ul>
<p><strong>具体享元类</strong> <strong>ConcreteTextStyle</strong></p>
<ul>
<li>实现了 <code>ITextStyle</code> 接口。</li>
<li>包含三个只读属性：<code>_font</code>, <code>_size</code>, <code>_color</code>，分别表示字体、大小和颜色。</li>
<li>构造函数用于初始化这些属性。</li>
<li><code>ApplyStyle</code> 方法打印应用的样式和文本。</li>
</ul>
<p><strong>享元工厂类</strong> <strong>TextStyleFactory</strong></p>
<ul>
<li>使用 <code>Dictionary&lt;string, ITextStyle&gt;</code> 存储已经创建的享元对象。</li>
<li><code>GetStyle</code> 方法根据 <code>font</code>, <code>size</code>, <code>color</code> 生成一个键，并检查是否已有对应的享元对象。</li>
<li>如果没有，则创建一个新的 <code>ConcreteTextStyle</code> 对象并存储到 <code>Styles</code> 中。</li>
<li>最后返回找到的或新创建的享元对象。</li>
</ul>
<p><strong>演示类</strong> <strong>FlyweightPatternDemo</strong></p>
<ul>
<li><code>Main</code> 方法演示了享元模式的使用。</li>
<li>调用 <code>TextStyleFactory.GetStyle</code> 获取享元对象并应用样式。</li>
<li><code>style1</code> 和 <code>style2</code> 应用了相同的样式，因此 <code>style2</code> 会复用 <code>style1</code> 的实例。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class ITextStyle &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +ApplyStyle(string text)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ConcreteTextStyle &#123;</span><br><span class="line">        -_font : string</span><br><span class="line">        -_size : int</span><br><span class="line">        -_color : string</span><br><span class="line">        +ConcreteTextStyle(string font, int size, string color)</span><br><span class="line">        +ApplyStyle(string text)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class TextStyleFactory &#123;</span><br><span class="line">        -Styles : Dictionary~string, ITextStyle~</span><br><span class="line">        +GetStyle(string font, int size, string color) : ITextStyle</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ITextStyle &lt;|.. ConcreteTextStyle</span><br><span class="line">    ConcreteTextStyle --&gt; TextStyleFactory : uses</span><br></pre></td></tr></table></figure>

<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><p>代理模式通过代理类控制对真实对象的访问，并在需要时创建和使用真实对象</p>
<p><strong>核心思想:代理模式为其他对象提供了一种代理以控制对这个对象的访问</strong></p>
<p>代理，在其最广泛的形式中，是一个用作其他事物接口的类。代理是一个包装或代理对象，客户端通过它来访问后台的实际服务对象。使用代理可以简单地将请求转发到实际对象，或者提供额外的逻辑。在代理中可以提供额外的功能，例如，当对实际对象的操作资源消耗较大时进行缓存，或在调用实际对象的操作之前进行前置条件检查。</p>
<p><strong>适用场景</strong>: 当需要在访问对象时增加额外的操作时,可以使用代理模式.例如,延迟加载,权限控制,日志记录等.代理模式可以帮助你在不修改现有代码的情况下,实现对对象访问的控制</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202406261742205.png" alt="image-20240626174214800" style="zoom: 50%;" />



<p>代理类中持有[真正的类]对象,同样的函数名在其中调用[真正的类]的方法的时候还能执行一些新的动作,代理类的名字往往是<code>真正的类+proxy</code></p>
<p>应用场景:劫持,过滤,安全检查</p>
<ol>
<li><strong>远程代理（Remote Proxy）</strong>：用于在不同地址空间中代表对象。远程代理可以隐藏对象存在于不同地址空间的实现复杂性，使得客户端可以像调用本地对象一样调用远程对象。</li>
<li><strong>虚拟代理（Virtual Proxy）</strong>：用于延迟加载对象的开销昂贵的资源。虚拟代理会在需要时创建真实对象，而在不需要时充当占位符。</li>
<li><strong>保护代理（Protection Proxy）</strong>：用于控制对对象的访问权限。保护代理可以限制对对象的访问，确保只有特定权限的用户可以访问对象。</li>
<li><strong>缓存代理（Cache Proxy）</strong>：用于缓存对象，以提高系统性能。缓存代理会在访问对象前检查缓存，如果对象已经存在于缓存中，则直接返回缓存的对象，避免重复创建对象。</li>
<li><strong>日志记录代理（Logging Proxy）</strong>：用于记录对象的操作日志。日志记录代理可以在调用对象的方法前后记录日志信息，用于调试和跟踪操作。</li>
<li><strong>智能引用代理（Smart Reference Proxy）</strong>：用于在对象被引用时执行额外的操作。智能引用代理可以在对象被引用时执行计数、内存管理等操作，以确保对象的正确使用。</li>
<li><strong>延迟初始化（Lazy Initialization）</strong>：用于延迟对象的初始化。代理模式可以通过延迟初始化来避免在对象创建时的高开销，延迟到真正需要时再进行初始化。</li>
</ol>
<h3 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IImage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Display</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图片类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Image</span> : <span class="title">IImage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _fileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Image</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _fileName = fileName;</span><br><span class="line">        LoadImageFromDisk();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadImageFromDisk</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Loading image from disk: &quot;</span> + _fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Displaying image: &quot;</span> + _fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ImageProxy</span> : <span class="title">IImage</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _fileName;</span><br><span class="line">    <span class="keyword">private</span> Image _image;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageProxy</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Display</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_image == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            _image = <span class="keyword">new</span> Image(_fileName);</span><br><span class="line">        &#125;</span><br><span class="line">        _image.Display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片加载器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ImageLoader</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IImage _image;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageLoader</span>(<span class="params">IImage image</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _image = image;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DisplayImage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _image.Display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 使用代理加载和显示图片</span></span><br><span class="line">        IImage imageProxy = <span class="keyword">new</span> ImageProxy(<span class="string">&quot;image.jpg&quot;</span>);</span><br><span class="line">        ImageLoader imageLoader = <span class="keyword">new</span> ImageLoader(imageProxy);</span><br><span class="line">      	Console.WriteLine(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">        imageLoader.DisplayImage();<span class="comment">//需要显示图片这里才真正加载图片</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">Loading image from disk: image.jpg</span></span><br><span class="line"><span class="comment">Displaying image: image.jpg</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>类似单例懒汉模式,实现了使用代理模式延迟加载和显示图片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    direction LR</span><br><span class="line"></span><br><span class="line">    class IImage &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +Display()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Image &#123;</span><br><span class="line">        -string _fileName</span><br><span class="line">        +Image(string fileName)</span><br><span class="line">        -LoadImageFromDisk()</span><br><span class="line">        +Display()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ImageProxy &#123;</span><br><span class="line">        -string _fileName</span><br><span class="line">        -Image _image</span><br><span class="line">        +ImageProxy(string fileName)</span><br><span class="line">        +Display()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ImageLoader &#123;</span><br><span class="line">        -IImage _image</span><br><span class="line">        +ImageLoader(IImage image)</span><br><span class="line">        +DisplayImage()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IImage &lt;|.. Image</span><br><span class="line">    IImage &lt;|.. ImageProxy</span><br><span class="line">    ImageLoader --&gt; IImage</span><br><span class="line">    ImageProxy --&gt; Image</span><br></pre></td></tr></table></figure>

<h1 id="行为型模式"><a href="#行为型模式" class="headerlink" title="行为型模式"></a>行为型模式</h1><h2 id="职责链模式"><a href="#职责链模式" class="headerlink" title="职责链模式"></a>职责链模式</h2><p>也叫责任链模式</p>
<p>让多个处理都有机会处理该请求,直到其中某个处理成功为止.责任链模式可以把多个处理串成链,然后让请求在链上传递,直到某一个处理处理成功为止</p>
<blockquote>
<p>优点</p>
<ul>
<li><p>将请求和处理分开,请求者不需要知道谁去处理,处理者也不需要知道请求的全貌</p>
<p>将请求的接收者和发送者解耦</p>
</li>
<li><p>新增一个处理到整个链条中的代价是非常小的</p>
</li>
</ul>
<p>缺点:</p>
<ul>
<li>采取类似于递归的方式,不易于调试</li>
</ul>
</blockquote>
<p>职责链设计模式通过将请求的处理责任分摊到多个对象中，避免了请求发送者和接收者之间的耦合。在实际开发中，职责链模式可以帮助我们创建更灵活的系统结构，提高代码的可维护性和扩展性。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202407222140143.png" alt="image-20240722214050516" style="zoom: 33%;" />



<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202409211212404.png" alt="image-20240921121239764" style="zoom: 80%;" />

<p>抽象出一个公共的父类,然后去定义不同的处理类,他们之间通过nextHandler去连接起来</p>
<h3 id="案例代码"><a href="#案例代码" class="headerlink" title="案例代码"></a>案例代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象处理者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Handler</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="comment">// 设置下一个处理者</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setNext</span><span class="params">(Handler* nextHandler)</span> </span>&#123;</span><br><span class="line">        next = nextHandler;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理请求的接口</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">const</span> std::string&amp; request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (next) &#123;</span><br><span class="line">            next-&gt;<span class="built_in">handleRequest</span>(request);  <span class="comment">// 将请求传递给下一个处理者</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Handler* next = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者1：只处理&quot;low&quot;级别的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LowLevelHandler</span> : <span class="keyword">public</span> Handler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">const</span> std::string&amp; request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request == <span class="string">&quot;low&quot;</span>) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;LowLevelHandler 处理请求: &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;LowLevelHandler 无法处理请求，传递给下一个处理者&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            Handler::<span class="built_in">handleRequest</span>(request);  <span class="comment">// 调用父类方法传递请求</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者2：只处理&quot;medium&quot;级别的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MediumLevelHandler</span> : <span class="keyword">public</span> Handler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">const</span> std::string&amp; request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request == <span class="string">&quot;medium&quot;</span>) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;MediumLevelHandler 处理请求: &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;MediumLevelHandler 无法处理请求，传递给下一个处理者&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            Handler::<span class="built_in">handleRequest</span>(request);  <span class="comment">// 调用父类方法传递请求</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者3：只处理&quot;high&quot;级别的请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HighLevelHandler</span> : <span class="keyword">public</span> Handler &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handleRequest</span><span class="params">(<span class="type">const</span> std::string&amp; request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request == <span class="string">&quot;high&quot;</span>) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;HighLevelHandler 处理请求: &quot;</span> &lt;&lt; request &lt;&lt; std::endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;HighLevelHandler 无法处理请求，传递给下一个处理者&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            Handler::<span class="built_in">handleRequest</span>(request);  <span class="comment">// 调用父类方法传递请求</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建处理者实例</span></span><br><span class="line">    LowLevelHandler lowHandler;</span><br><span class="line">    MediumLevelHandler mediumHandler;</span><br><span class="line">    HighLevelHandler highHandler;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置职责链</span></span><br><span class="line">    lowHandler.<span class="built_in">setNext</span>(&amp;mediumHandler);</span><br><span class="line">    mediumHandler.<span class="built_in">setNext</span>(&amp;highHandler);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 测试不同的请求</span></span><br><span class="line">    std::string request1 = <span class="string">&quot;low&quot;</span>;</span><br><span class="line">    std::string request2 = <span class="string">&quot;medium&quot;</span>;</span><br><span class="line">    std::string request3 = <span class="string">&quot;high&quot;</span>;</span><br><span class="line">    std::string request4 = <span class="string">&quot;unknown&quot;</span>;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;处理请求: &quot;</span> &lt;&lt; request1 &lt;&lt; std::endl;</span><br><span class="line">    lowHandler.<span class="built_in">handleRequest</span>(request1);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;处理请求: &quot;</span> &lt;&lt; request2 &lt;&lt; std::endl;</span><br><span class="line">    lowHandler.<span class="built_in">handleRequest</span>(request2);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;处理请求: &quot;</span> &lt;&lt; request3 &lt;&lt; std::endl;</span><br><span class="line">    lowHandler.<span class="built_in">handleRequest</span>(request3);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;处理请求: &quot;</span> &lt;&lt; request4 &lt;&lt; std::endl;</span><br><span class="line">    lowHandler.<span class="built_in">handleRequest</span>(request4);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class Handler &#123;</span><br><span class="line">        +setNext(Handler* nextHandler)</span><br><span class="line">        +handleRequest(string request)</span><br><span class="line">        -Handler* next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class LowLevelHandler &#123;</span><br><span class="line">        +handleRequest(string request)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class MediumLevelHandler &#123;</span><br><span class="line">        +handleRequest(string request)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class HighLevelHandler &#123;</span><br><span class="line">        +handleRequest(string request)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Main &#123;</span><br><span class="line">        +main()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Handler &lt;|-- LowLevelHandler</span><br><span class="line">    Handler &lt;|-- MediumLevelHandler</span><br><span class="line">    Handler &lt;|-- HighLevelHandler</span><br><span class="line"></span><br><span class="line">    Main --&gt; LowLevelHandler</span><br><span class="line">    Main --&gt; MediumLevelHandler</span><br><span class="line">    Main --&gt; HighLevelHandler</span><br><span class="line">    </span><br><span class="line">    LowLevelHandler --&gt; Handler : next</span><br><span class="line">    MediumLevelHandler --&gt; Handler : next</span><br><span class="line">    HighLevelHandler --&gt; Handler : next</span><br></pre></td></tr></table></figure>

<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>命令模式它可将<strong>请求转换为一个包含与请求相关的所有信息的独立对象</strong>。该从而可以进行参数化、日志记录、<strong>队列化</strong>、<strong>撤销</strong>等操作。命令模式中，发起者（Invoker）不直接与接收者（Receiver）进行通信，而是通过命令对象来执行操作。</p>
<p>命令模式**通过将请求封装成对象,可以让系统支持复杂的命令以及请求和操作的管理.**他提供了一种拓展系统功能的灵活方式,同时保持调用者和接收者之间的解耦</p>
<p><strong>适用场景</strong>: 命令模式非常适合用于实现命令的调度,记录,撤销和重做等功能,当你需要将操作封装为对象,通过操作的排列组合来调控具体行为时,命令模式就显得非常有用</p>
<p>命令模式典型的代表就是事件驱动</p>
<blockquote>
<p>很大的优势在于可以轻松实现可撤销功能</p>
<p>优点:</p>
<ul>
<li>动作封装</li>
<li>解耦发送者和接收者</li>
<li>可拓展性</li>
<li>简化和集中错误处理</li>
<li>支持撤销和重做功能</li>
<li>易于实现宏命令和组合命令</li>
</ul>
<p>缺点: 复杂度和性能开销</p>
<p>常见应用案例</p>
<ul>
<li>文本编辑器,图形编辑器</li>
</ul>
</blockquote>
<p>架构:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202409211714339.png" alt="image-20240921171413533"></p>
<p>问号是表示懒得画了,太小了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202409211700672.png" alt="image-20240921170046247"></p>
<p>实例架构:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202409211655900.png" alt="image-20240921165559330" style="zoom: 67%;" />

<h3 id="开关灯案例"><a href="#开关灯案例" class="headerlink" title="开关灯案例"></a>开关灯案例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收者类：灯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Light</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">turnOn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;灯已打开&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">turnOff</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;灯已关闭&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ICommand</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ICommand</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">execute</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令类：打开灯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightOnCommand</span> : <span class="keyword">public</span> ICommand &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LightOnCommand</span>(Light* light) : <span class="built_in">light_</span>(light) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        light_-&gt;<span class="built_in">turnOn</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        light_-&gt;<span class="built_in">turnOff</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Light* light_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令类：关闭灯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LightOffCommand</span> : <span class="keyword">public</span> ICommand &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LightOffCommand</span>(Light* light) : <span class="built_in">light_</span>(light) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        light_-&gt;<span class="built_in">turnOff</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        light_-&gt;<span class="built_in">turnOn</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Light* light_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用者类：遥控器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCommand</span><span class="params">(std::shared_ptr&lt;ICommand&gt; command)</span> </span>&#123;</span><br><span class="line">        command_ = command;</span><br><span class="line">        <span class="comment">// 每次设置新命令时，清空 redo 栈，因为新操作后不再可以重做之前的撤销操作</span></span><br><span class="line">        <span class="keyword">while</span> (!redoHistory.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            redoHistory.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pressButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (command_) &#123;</span><br><span class="line">            command_-&gt;<span class="built_in">execute</span>();</span><br><span class="line">            undoHistory.<span class="built_in">push</span>(command_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pressUndo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!undoHistory.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            undoHistory.<span class="built_in">top</span>()-&gt;<span class="built_in">undo</span>();</span><br><span class="line">            redoHistory.<span class="built_in">push</span>(undoHistory.<span class="built_in">top</span>());</span><br><span class="line">            undoHistory.<span class="built_in">pop</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;没有命令可以撤销！&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pressRedo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!redoHistory.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            redoHistory.<span class="built_in">top</span>()-&gt;<span class="built_in">execute</span>();</span><br><span class="line">            undoHistory.<span class="built_in">push</span>(redoHistory.<span class="built_in">top</span>());</span><br><span class="line">            redoHistory.<span class="built_in">pop</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;没有命令可以重做！&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::shared_ptr&lt;ICommand&gt; command_;</span><br><span class="line">    std::stack&lt;std::shared_ptr&lt;ICommand&gt;&gt; undoHistory;  <span class="comment">// 用于存储已执行的命令，支持撤销</span></span><br><span class="line">    std::stack&lt;std::shared_ptr&lt;ICommand&gt;&gt; redoHistory;  <span class="comment">// 用于存储撤销的命令，支持重做</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建灯对象</span></span><br><span class="line">    Light livingRoomLight;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建命令对象</span></span><br><span class="line">    std::shared_ptr&lt;ICommand&gt; lightOnCommand = std::<span class="built_in">make_shared</span>&lt;LightOnCommand&gt;(&amp;livingRoomLight);</span><br><span class="line">    std::shared_ptr&lt;ICommand&gt; lightOffCommand = std::<span class="built_in">make_shared</span>&lt;LightOffCommand&gt;(&amp;livingRoomLight);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建遥控器</span></span><br><span class="line">    RemoteControl remoteControl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定命令：打开灯</span></span><br><span class="line">    remoteControl.<span class="built_in">setCommand</span>(lightOnCommand);</span><br><span class="line">    remoteControl.<span class="built_in">pressButton</span>();  <span class="comment">// 执行打开灯的命令</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定命令：关闭灯</span></span><br><span class="line">    remoteControl.<span class="built_in">setCommand</span>(lightOffCommand);</span><br><span class="line">    remoteControl.<span class="built_in">pressButton</span>();  <span class="comment">// 执行关闭灯的命令</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 撤销操作</span></span><br><span class="line">    remoteControl.<span class="built_in">pressUndo</span>();  <span class="comment">// 撤销：灯重新打开</span></span><br><span class="line">    remoteControl.<span class="built_in">pressUndo</span>();  <span class="comment">// 再次撤销：灯重新关闭</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重做操作</span></span><br><span class="line">    remoteControl.<span class="built_in">pressRedo</span>();  <span class="comment">// 重做：灯重新打开</span></span><br><span class="line">    remoteControl.<span class="built_in">pressRedo</span>();  <span class="comment">// 重做：灯重新关闭</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出:</span></span><br><span class="line">灯已打开</span><br><span class="line">灯已关闭</span><br><span class="line">灯已打开</span><br><span class="line">灯已关闭</span><br><span class="line">灯已打开</span><br><span class="line">灯已关闭</span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class Light &#123;</span><br><span class="line">        +turnOn()</span><br><span class="line">        +turnOff()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ICommand &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +execute() </span><br><span class="line">        +undo() </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class LightOnCommand &#123;</span><br><span class="line">        +execute()</span><br><span class="line">        +undo()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class LightOffCommand &#123;</span><br><span class="line">        +execute()</span><br><span class="line">        +undo()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class RemoteControl &#123;</span><br><span class="line">        +setCommand(ICommand* command)</span><br><span class="line">        +pressButton()</span><br><span class="line">        +pressUndo()</span><br><span class="line">        +pressRedo()</span><br><span class="line">        -undoHistory : stack&lt;ICommand&gt;</span><br><span class="line">        -redoHistory : stack&lt;ICommand&gt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LightOnCommand --&gt; Light</span><br><span class="line">    LightOffCommand --&gt; Light</span><br><span class="line">    LightOnCommand ..|&gt; ICommand</span><br><span class="line">    LightOffCommand ..|&gt; ICommand</span><br><span class="line"></span><br><span class="line">    RemoteControl --&gt; ICommand</span><br></pre></td></tr></table></figure>

<p>​	1.	Light 类表示接收者，包含 turnOn() 和 turnOff() 方法。</p>
<p>​	2.	ICommand 是命令接口，定义了 execute() 和 undo() 方法。</p>
<p>​	3.	LightOnCommand 和 LightOffCommand 实现了 ICommand 接口，并依赖于 Light 类，用来执行开灯和关灯的命令。</p>
<p>​	4.	RemoteControl 是调用者，负责将命令对象关联并执行，还管理了撤销和重做功能的栈：undoHistory 和 redoHistory。</p>
<h3 id="文本编辑器案例"><a href="#文本编辑器案例" class="headerlink" title="文本编辑器案例"></a>文本编辑器案例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">Command</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">execute</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//如果有必要可以添加redo</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文本接收者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> std::string &amp;text)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		content += text;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;插入文本: &quot;</span> &lt;&lt; text &lt;&lt; std::endl;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;当前文本内容: &quot;</span> &lt;&lt; content &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">size_t</span> length)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (length &lt;= content.<span class="built_in">length</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			std::string removedText = content.<span class="built_in">substr</span>(content.<span class="built_in">length</span>() - length, length);</span><br><span class="line">			content.<span class="built_in">erase</span>(content.<span class="built_in">length</span>() - length);</span><br><span class="line">			std::cout &lt;&lt; <span class="string">&quot;删除文本: &quot;</span> &lt;&lt; removedText &lt;&lt; std::endl;</span><br><span class="line">			std::cout &lt;&lt; <span class="string">&quot;当前文本内容: &quot;</span> &lt;&lt; content &lt;&lt; std::endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">const</span> std::string &amp;<span class="title">getContent</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> content;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	std::string content;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令类：插入文本命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InsertCommand</span> : <span class="keyword">public</span> Command</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">InsertCommand</span>(TextEditor *editor, <span class="type">const</span> std::string &amp;text)</span><br><span class="line">		: <span class="built_in">editor</span>(editor), <span class="built_in">text</span>(text) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		editor-&gt;<span class="built_in">insert</span>(text);</span><br><span class="line">		lastInsertLength = text.<span class="built_in">length</span>(); <span class="comment">// 记录插入的长度</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		editor-&gt;<span class="built_in">remove</span>(lastInsertLength); <span class="comment">// 撤销插入操作</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	TextEditor *editor;</span><br><span class="line">	std::string text;</span><br><span class="line">	<span class="type">size_t</span> lastInsertLength = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令执行者（Invoker）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommandInvoker</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">executeCommand</span><span class="params">(Command *command)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		command-&gt;<span class="built_in">execute</span>();</span><br><span class="line">		history.<span class="built_in">push</span>(command); <span class="comment">// 执行后将命令存入历史栈</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">undoCommand</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!history.<span class="built_in">empty</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			Command *lastCommand = history.<span class="built_in">top</span>();</span><br><span class="line">			lastCommand-&gt;<span class="built_in">undo</span>(); <span class="comment">// 撤销最近的命令</span></span><br><span class="line">			history.<span class="built_in">pop</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			std::cout &lt;&lt; <span class="string">&quot;没有命令可以撤销&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	std::stack&lt;Command *&gt; history; <span class="comment">// 存储已执行的命令</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	TextEditor editor;		<span class="comment">// 创建接收者</span></span><br><span class="line">	CommandInvoker invoker; <span class="comment">// 创建命令执行者</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建命令</span></span><br><span class="line">	Command *insertCommand1 = <span class="keyword">new</span> <span class="built_in">InsertCommand</span>(&amp;editor, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">	Command *insertCommand2 = <span class="keyword">new</span> <span class="built_in">InsertCommand</span>(&amp;editor, <span class="string">&quot; World&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 执行命令</span></span><br><span class="line">	invoker.<span class="built_in">executeCommand</span>(insertCommand1); <span class="comment">// 插入 &quot;Hello&quot;</span></span><br><span class="line">	invoker.<span class="built_in">executeCommand</span>(insertCommand2); <span class="comment">// 插入 &quot; World&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 撤销最近的命令</span></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;\n撤销操作:\n&quot;</span>;</span><br><span class="line">	invoker.<span class="built_in">undoCommand</span>(); <span class="comment">// 撤销 &quot; World&quot;</span></span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;\n再次撤销操作:\n&quot;</span>;</span><br><span class="line">	invoker.<span class="built_in">undoCommand</span>(); <span class="comment">// 撤销 &quot;Hello&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 清理内存</span></span><br><span class="line">	<span class="keyword">delete</span> insertCommand1;</span><br><span class="line">	<span class="keyword">delete</span> insertCommand2;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码结构如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class Command &#123;</span><br><span class="line">      &lt;&lt;interface&gt;&gt;</span><br><span class="line">      +execute() void</span><br><span class="line">      +undo() void</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class TextEditor &#123;</span><br><span class="line">      +insert(text: string) void</span><br><span class="line">      +remove(length: size_t) void</span><br><span class="line">      +getContent() string</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class InsertCommand &#123;</span><br><span class="line">      -editor: TextEditor</span><br><span class="line">      -text: string</span><br><span class="line">      -lastInsertLength: size_t</span><br><span class="line">      +execute() void</span><br><span class="line">      +undo() void</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class CommandInvoker &#123;</span><br><span class="line">      -history: stack~Command*~</span><br><span class="line">      +executeCommand(command: Command*) void</span><br><span class="line">      +undoCommand() void</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    InsertCommand --|&gt; Command : implements</span><br><span class="line">    InsertCommand o-- TextEditor : &quot;1&quot;</span><br><span class="line">    CommandInvoker ..&gt; Command : uses</span><br></pre></td></tr></table></figure>

<h2 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h2><p>解释器模式用于定义一个语言的语法表示，并通过解释器来解释语言中的句子。通常，解释器模式用于解析和执行简单的语法规则，如数学表达式、脚本语言或命令语言。</p>
<p>本质是指导我们去开发一个解释器,可以理解成一种语法解释器的开发框架</p>
<p>应用场景：编译器和解释器、配置文件解析器、查询语言解析器</p>
<ul>
<li>当需要解释一种特定的语言时（例如计算器语法、SQL解析）</li>
<li>当想要将复杂的问题分解为更简单的子问题，并对这些子问题进行解释和执行</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410031145141.png" alt="image-20241003114459390" style="zoom:33%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410021337603.png" alt="image-20241002133759038" style="zoom: 67%;" />

<ul>
<li><strong>抽象表达式（AbstractExpression）</strong>: 声明一个interpret()方法，这个方法是所有具体表达式的接口。<ul>
<li><strong>终结符表达式（TerminalExpression）</strong>: 实现与文法中的终结符相关的解释操作。</li>
<li><strong>非终结符表达式（NonterminalExpression）</strong>: 为文法中的非终结符实现解释操作。通常它会包含多个表达式。</li>
</ul>
</li>
<li><strong>上下文（Context）</strong>: 包含解释器之外的一些全局信息。</li>
<li><strong>客户端（Client）</strong>: 构建或定义语法树，并将其传递给解释器进行解释。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410021338377.png" alt="image-20241002133842170"></p>
<p>解释器模式虽然强大，但在处理复杂语法时容易导致类爆炸，因此仅适用于相对简单的文法解析问题。</p>
<h3 id="案例-3"><a href="#案例-3" class="headerlink" title="案例"></a>案例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表达式接口</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 表达式接口（抽象表达式）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> std::map&lt;std::string, <span class="type">int</span>&gt;&amp; context)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Expression</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量表达式：终结符表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VariableExpression</span> : <span class="keyword">public</span> Expression &#123;</span><br><span class="line">    std::string name;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">VariableExpression</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name</span>(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> std::map&lt;std::string, <span class="type">int</span>&gt;&amp; context)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (context.<span class="built_in">find</span>(name) != context.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> context.<span class="built_in">at</span>(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加法表达式：非终结符表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddExpression</span> : <span class="keyword">public</span> Expression &#123;</span><br><span class="line">    Expression* left;</span><br><span class="line">    Expression* right;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AddExpression</span>(Expression* left, Expression* right) : <span class="built_in">left</span>(left), <span class="built_in">right</span>(right) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> std::map&lt;std::string, <span class="type">int</span>&gt;&amp; context)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left-&gt;<span class="built_in">interpret</span>(context) + right-&gt;<span class="built_in">interpret</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">AddExpression</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> left;</span><br><span class="line">        <span class="keyword">delete</span> right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 减法表达式：非终结符表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubtractExpression</span> : <span class="keyword">public</span> Expression &#123;</span><br><span class="line">    Expression* left;</span><br><span class="line">    Expression* right;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SubtractExpression</span>(Expression* left, Expression* right) : <span class="built_in">left</span>(left), <span class="built_in">right</span>(right) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> std::map&lt;std::string, <span class="type">int</span>&gt;&amp; context)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left-&gt;<span class="built_in">interpret</span>(context) - right-&gt;<span class="built_in">interpret</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">SubtractExpression</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> left;</span><br><span class="line">        <span class="keyword">delete</span> right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//上下文环境</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 上下文，定义变量及其对应的值</span></span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; context;</span><br><span class="line">    context[<span class="string">&quot;x&quot;</span>] = <span class="number">5</span>;</span><br><span class="line">    context[<span class="string">&quot;y&quot;</span>] = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表达式：x + y - (x - y)</span></span><br><span class="line">    Expression* expression = <span class="keyword">new</span> <span class="built_in">SubtractExpression</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">AddExpression</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">VariableExpression</span>(<span class="string">&quot;x&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">VariableExpression</span>(<span class="string">&quot;y&quot;</span>)</span><br><span class="line">        ),</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">SubtractExpression</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">VariableExpression</span>(<span class="string">&quot;x&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">VariableExpression</span>(<span class="string">&quot;y&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = expression-&gt;<span class="built_in">interpret</span>(context);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Expression result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> expression;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结:</p>
<ul>
<li>解释器模式将复杂的表达式解析和解释分解为简单的子问题，每个子问题由终结符或非终结符来处理。</li>
<li>在需要解释某种特定语言的场景下（如数学表达式、脚本语言），解释器模式是一个非常合适的解决方案。</li>
</ul>
<blockquote>
<p>对于复杂的文法解析，解释器模式可能并不是最合适的选择。更常见的替代方案是<strong>编译器技术</strong>中的工具和技术，如<strong>解析器生成器</strong>（parser generators）或者采用更灵活的设计模式。</p>
<ul>
<li>在复杂的语法树遍历场景下，可以考虑使用<a href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F">访问者模式（Visitor Pattern）</a>，它能让你在不修改对象结构的情况下，增加新的操作。访问者模式通过将操作从语法树的节点中分离出来，使得对语法树的扩展更加灵活。</li>
<li><a href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F">组合模式</a>允许你将对象组合成树状结构，以表示“部分-整体”的层次结构。通过这种方式，可以将复杂表达式的处理通过组合实现，而不是每个表达式都定义一个新类。</li>
</ul>
</blockquote>
<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><p><strong>迭代器模式</strong>用于提供一种方法，顺序访问一个聚合对象中的各个元素，而又不暴露该对象的内部表示。迭代器模式将迭代的逻辑与容器解耦，使用迭代器对象来负责遍历操作。</p>
<p><strong>迭代器模式的主要组成部分：</strong></p>
<ul>
<li><strong>迭代器接口（Iterator Interface）</strong>: 定义访问和遍历元素的接口，通常包含first()、next()、isDone()、currentItem()等方法</li>
<li><strong>具体迭代器（Concrete Iterator）</strong>: 实现迭代器接口，负责遍历聚合对象的具体元素。</li>
<li><strong>聚合接口（Aggregate Interface）</strong>: 定义创建迭代器的接口，一般包含一个createIterator()方法。</li>
<li><strong>具体聚合（Concrete Aggregate）</strong>: 实现聚合接口，存储元素并定义如何创建该聚合对象的迭代器。</li>
<li><strong>客户端（Client）</strong>: 使用迭代器来遍历聚合对象中的元素，客户端只需要与迭代器交互，不需要知道聚合对象的内部结构。</li>
</ul>
<p><strong>迭代器模式的好处：</strong></p>
<ul>
<li><strong>解耦</strong>：聚合对象和迭代逻辑分离，使得聚合对象专注于存储数据，迭代器则专注于遍历操作。</li>
<li><strong>统一接口</strong>：无论聚合对象的内部结构如何复杂，客户端都可以通过统一的迭代器接口访问元素。</li>
<li><strong>扩展性强</strong>：可以很方便地增加新的遍历方式，不必修改聚合对象的代码。</li>
</ul>
<p><strong>适用场景</strong>: 当你需要以一种一致的方法遍历集合中的元素,而不想暴露其内部表示时,可以使用迭代器模式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410041254205.png" alt="image-20241004125438340"></p>
<h3 id="案例-4"><a href="#案例-4" class="headerlink" title="案例"></a>案例</h3><p>假设有一个简单的Book类和BookCollection类，BookCollection是一个集合，里面存储了多个Book对象。我们使用迭代器模式来遍历BookCollection中的书。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单的书本类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Book</span>(<span class="type">const</span> std::string&amp; name) : <span class="built_in">name</span>(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">hasNext</span><span class="params">()</span> </span>= <span class="number">0</span>;         <span class="comment">// 判断是否有下一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Book* <span class="title">next</span><span class="params">()</span> </span>= <span class="number">0</span>;           <span class="comment">// 获取下一个元素</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Iterator</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 聚合接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Aggregate</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Iterator* <span class="title">createIterator</span><span class="params">()</span> </span>= <span class="number">0</span>;  <span class="comment">// 创建迭代器</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Aggregate</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的书本集合类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookCollection</span> : <span class="keyword">public</span> Aggregate &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;Book*&gt; books;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addBook</span><span class="params">(Book* book)</span> </span>&#123;</span><br><span class="line">        books.<span class="built_in">push_back</span>(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Book* <span class="title">getBookAt</span><span class="params">(<span class="type">int</span> index)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> books[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getSize</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> books.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实现创建迭代器</span></span><br><span class="line">    <span class="function">Iterator* <span class="title">createIterator</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">BookIterator</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体迭代器类，用于遍历书本集合</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookIterator</span> : <span class="keyword">public</span> Iterator &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">const</span> BookCollection* bookCollection;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BookIterator</span>(<span class="type">const</span> BookCollection* collection) : <span class="built_in">bookCollection</span>(collection), <span class="built_in">index</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">hasNext</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index &lt; bookCollection-&gt;<span class="built_in">getSize</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Book* <span class="title">next</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookCollection-&gt;<span class="built_in">getBookAt</span>(index++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建书本集合</span></span><br><span class="line">    BookCollection* collection = <span class="keyword">new</span> <span class="built_in">BookCollection</span>();</span><br><span class="line">    collection-&gt;<span class="built_in">addBook</span>(<span class="keyword">new</span> <span class="built_in">Book</span>(<span class="string">&quot;C++ Programming&quot;</span>));</span><br><span class="line">    collection-&gt;<span class="built_in">addBook</span>(<span class="keyword">new</span> <span class="built_in">Book</span>(<span class="string">&quot;Design Patterns&quot;</span>));</span><br><span class="line">    collection-&gt;<span class="built_in">addBook</span>(<span class="keyword">new</span> <span class="built_in">Book</span>(<span class="string">&quot;Data Structures&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取迭代器</span></span><br><span class="line">    Iterator* iterator = collection-&gt;<span class="built_in">createIterator</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用迭代器遍历书本集合</span></span><br><span class="line">    <span class="keyword">while</span> (iterator-&gt;<span class="built_in">hasNext</span>()) &#123;</span><br><span class="line">        Book* book = iterator-&gt;<span class="built_in">next</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Book: &quot;</span> &lt;&lt; book-&gt;<span class="built_in">getName</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理内存</span></span><br><span class="line">    <span class="keyword">delete</span> iterator;</span><br><span class="line">    <span class="keyword">delete</span> collection;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Book: C++ Programming</span><br><span class="line">Book: Design Patterns</span><br><span class="line">Book: Data Structures</span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class Book &#123;</span><br><span class="line">        -name : string</span><br><span class="line">        +Book(string name)</span><br><span class="line">        +getName() : string</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Iterator &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +hasNext() : bool</span><br><span class="line">        +next() : Book*</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Aggregate &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +createIterator() : Iterator*</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class BookCollection &#123;</span><br><span class="line">        -books : vector&lt;Book*&gt;</span><br><span class="line">        +addBook(Book* book)</span><br><span class="line">        +getBookAt(int index) : Book*</span><br><span class="line">        +getSize() : int</span><br><span class="line">        +createIterator() : Iterator*</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class BookIterator &#123;</span><br><span class="line">        -bookCollection : BookCollection*</span><br><span class="line">        -index : int</span><br><span class="line">        +BookIterator(BookCollection* collection)</span><br><span class="line">        +hasNext() : bool</span><br><span class="line">        +next() : Book*</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Iterator &lt;|.. BookIterator</span><br><span class="line">    Aggregate &lt;|.. BookCollection</span><br><span class="line">    BookCollection --&gt; Book</span><br><span class="line">    BookIterator --&gt; BookCollection</span><br></pre></td></tr></table></figure>

<pre><code>1. Book 类是书的简单模型，包含 name 成员和 getName() 方法。
1. Iterator 是迭代器接口，定义了 hasNext() 和 next() 方法。
1. Aggregate 是聚合接口，定义了 createIterator() 方法。
1. BookCollection 类实现了 Aggregate 接口，包含一个 vector&lt;Book*&gt; 成员，用于存储书本，并提供方法来添加书本和获取迭代器。
1. BookIterator 类实现了 Iterator 接口，用于遍历 BookCollection，并跟踪当前的索引。
</code></pre>
<p>迭代器模式通过抽象化遍历逻辑，提供了一种简洁的方式来访问聚合对象中的元素。它在C++标准库中被广泛应用，例如STL容器（vector, list, map等）都有迭代器接口，用户可以轻松地遍历容器中的元素。</p>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14z421k7hv/">视频教程,充分诠释了观察者模式的意义</a></p>
<p>主要作用：定义<strong>一对多的依赖关系</strong>，让多个观察者同时监听一个主题对象。</p>
<p>观察者模式其中一个对象称为主题(subject),它<strong>维护一组依赖它的对象</strong>,称为观察者(observers).当主题的状态发生变化时,他会主动通知所有观察者</p>
<p><strong>适用场景</strong>: 当希望一个对象状态改变时通知其他多个对象,而不希望这些对象之间存在紧耦合关系时,可使用观察者模式,例如,当需要实现事件处理系统,消息广播系统,或任何需要动态通知多个对象的情况</p>
<p>应用场景：社交媒体平台、股票市场、GUI工具、实时消息系统</p>
<blockquote>
<p>观察者模式定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>
<p>在观察者模式中，主体是通知的发布者，它发出通知时并不需要知道谁是它的观察者，<br>可以有任意数目的观察者订阅并接收通知。观察者模式不仅被广泛应用于软件界面元素之间的交互，在业务对象之间的交互、权限管理等方面也有广泛的应用。</p>
<p>观察者模式（Observer）完美的将观察者和被观察的对象分离开。观察者模式在模块之间划定了清晰的界限，提高了应用程序的可维护性和重用性。</p>
</blockquote>
<p>两个类: 观察者类   被观察者类</p>
<p>观察者类中:定义一个对某个事件感兴趣的处理函数,一般也叫<strong>槽函数</strong></p>
<p>被观察者类中:定义一个数据结构,用来保存观察者对哪一个事件id感兴趣,使用map建立对应关系</p>
<p>被观察者类中,定义两个函数:1. 添加观察者与其感兴趣的事件id加入到容器之中   2. 通知事件函数执行逻辑:首先遍历容器,找是否有感兴趣的事件id,若有则代表一系列的观察者对该事件感兴趣,那么遍历观察者列表,让每一个观察执行相应的槽函数</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410041306354.png" alt="image-20241004130633078" style="zoom: 33%;" />



<p>上图中,最下面的黄色是被通知者的结构,上图的展示效果还是非常模糊</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410061142813.png" alt="img" style="zoom:67%;" />

<h3 id="案例-5"><a href="#案例-5" class="headerlink" title="案例"></a>案例</h3><p>下面展示的结构为Billboard和Monitor为观察者,观察Stock的变化</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410041317600.png" alt="image-20241004131737158" style="zoom:67%;" />

<p>将Stock再抽象一层,提供独立的抽象接口Subject,将标准接口抽离出来,于是有了下面的图:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410041319523.png" alt="image-20241004131958035" style="zoom:67%;" />

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Observer</span>; <span class="comment">// 需要先声明一下Observer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Subject</span></span><br><span class="line">&#123;</span><br><span class="line">	std::list&lt;Observer *&gt; observers;			 <span class="comment">// 观察者列表</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">attach</span><span class="params">(Observer *observer)</span> </span>= <span class="number">0</span>; <span class="comment">// 添加观察者接口</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">detach</span><span class="params">(Observer *observer)</span> </span>= <span class="number">0</span>; <span class="comment">// 删除观察者接口</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">notify</span><span class="params">()</span> </span>= <span class="number">0</span>;					 <span class="comment">// 通知观察者接口</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Observer</span></span><br><span class="line">&#123;</span><br><span class="line">	Subject *sub;					  <span class="comment">// 观察谁</span></span><br><span class="line">	<span class="built_in">Observer</span>(Subject *sub) : <span class="built_in">sub</span>(sub) <span class="comment">// 依赖注入并初始化成员变量</span></span><br><span class="line">	&#123;</span><br><span class="line">		sub-&gt;<span class="built_in">attach</span>(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">Observer</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		sub-&gt;<span class="built_in">detach</span>(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">update</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stock</span> : <span class="keyword">public</span> Subject</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> price = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getPrice</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setPrice</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		price = v;</span><br><span class="line">		<span class="built_in">notify</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">attach</span><span class="params">(Observer *observer)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		observers.<span class="built_in">push_back</span>(observer);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">detach</span><span class="params">(Observer *observer)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		observers.<span class="built_in">remove</span>(observer);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">notify</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> observer : observers)</span><br><span class="line">		&#123;</span><br><span class="line">			observer-&gt;<span class="built_in">update</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//继承Observer意味着将观察Stock</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Monitor</span> : Observer</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">Monitor</span>(Subject *sub) : <span class="built_in">Observer</span>(sub) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> v)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Monitor:&quot;</span> &lt;&lt; v &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">static_cast</span>&lt;Stock *&gt;(sub)-&gt;<span class="built_in">getPrice</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Billboard</span> : Observer</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">Billboard</span>(Subject *sub) : <span class="built_in">Observer</span>(sub) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(<span class="type">int</span> v)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Billboard:&quot;</span> &lt;&lt; v &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">display</span>(<span class="built_in">static_cast</span>&lt;Stock *&gt;(sub)-&gt;<span class="built_in">getPrice</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//main函数中使用:</span></span><br><span class="line">Stock stock;</span><br><span class="line"><span class="function">Monitor <span class="title">Monitor</span><span class="params">(&amp;stock)</span></span>;</span><br><span class="line"><span class="function">Billboard <span class="title">Billboard</span><span class="params">(&amp;stock)</span></span>;</span><br><span class="line">stock.<span class="built_in">setPrice</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>观察者模式的核心是对观察者的抽象,以及所观察对象如何通过attach和detach以及notify方法来维护观察者集合</p>
<h3 id="与发布-订阅模式的区别"><a href="#与发布-订阅模式的区别" class="headerlink" title="与发布-订阅模式的区别"></a>与发布-订阅模式的区别</h3><p>Pub&#x2F;Sub Pattern</p>
<p>发布订阅模式是一种常用的架构模式, 用来规定一系统中的不同部分之间应该如何进行消息传递</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410042321890.png" alt="image-20241004232138161" style="zoom:50%;" />

<ul>
<li><p>观察者模式</p>
<p>一种<strong>软件设计模式</strong>,主要针对代码层次,提供类与类之间的组织关系</p>
</li>
<li><p>发布&#x2F;订阅模式</p>
<p>一种<strong>系统架构模式</strong>,主要针对组件&#x2F;服务层次,指定他们之间的消息传递模式</p>
</li>
</ul>
<h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><p>中介者模式用于降低对象之间的耦合性。通过引入一个中介者对象，多个对象之间的交互不再直接相互通信，而是通过中介者来协调它们的行为。<strong>中介者模式的核心思想是通过集中化处理对象之间的交互，避免对象之间形成紧耦合关系</strong>，从而增强系统的可维护性和扩展性。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410061157923.png" alt="image-20241006115749516" style="zoom: 33%;" />

<p>如果不使用中介模式,将会如上图左边一样调用关系非常混乱,但是使用了中介者模式后,关系将会特别清晰,如上右图</p>
<blockquote>
<p>中介者模式引入了一个第三方对象(称为中介者)来控制两个或多个对象(称为同事)之间的交互,从而减少类之间的耦合,因为他们不再需要了解彼此的实现细节</p>
<p>中介者模式和<a href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">代理模式</a>的<strong>区别</strong></p>
<ul>
<li><p>中介者模式侧重于简化对象之间的通信,通过一个中介者对象来管理和协调多个对象之间的交互</p>
<p>用于对象之间的通信协调</p>
</li>
<li><p>代理模式通过一个代理对象来控制对另一个对象的访问,通常用于添加额外的功能,如权限控制,延迟加载等</p>
<p>用于对象的访问控制</p>
</li>
</ul>
</blockquote>
<p>适用场景:当希望减少对象之间的复杂依赖关系,促进对象解耦时,可以使用中介者模式</p>
<p>中介者模式的主要角色有：</p>
<ul>
<li><strong>中介者（Mediator）</strong>：定义与各个同事对象之间的通信接口。</li>
<li><strong>具体中介者（Concrete Mediator）</strong>：实现中介者接口，负责协调各同事对象之间的通信和行为。</li>
<li><strong>同事类（Colleague）</strong>：每个同事对象都通过中介者与其他同事对象通信，而不会直接与其他同事对象进行交互。</li>
</ul>
<p><strong>优点</strong></p>
<ul>
<li><strong>减少类之间的依赖</strong>：通过引入中介者，同事类不再直接依赖其他同事类，从而使代码更加松散耦合。</li>
<li><strong>增强可维护性</strong>：集中化管理对象的交互，可以更容易地修改或扩展某些行为，而不需要在各个同事类中进行变更。</li>
<li><strong>更好的扩展性</strong>：通过添加新的中介者或同事类，可以很容易地扩展系统。</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li><strong>中介者复杂性</strong>：中介者模式虽然降低了同事类的复杂性，但中介者自身可能会变得复杂，尤其是当系统规模变大时，中介者需要处理的逻辑会相应变多。</li>
</ul>
<p><strong>适用场景</strong></p>
<ul>
<li>系统中对象之间有复杂的交互关系，导致类与类之间的依赖关系复杂且难以维护。</li>
<li>希望通过一个中间类来封装多个类之间的交互，使得这些类之间不再直接耦合。</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410061156351.png" alt="image-20241006115646860" style="zoom: 33%;" />

<p>上图展开:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410061159009.png" alt="image-20241006115910129" style="zoom: 33%;" />



<blockquote>
<p>观察者模式在功能上相当于中介者模式的广播模式</p>
</blockquote>
<h3 id="案例-6"><a href="#案例-6" class="headerlink" title="案例"></a>案例</h3><p>以下是一个简单的中介者模式的C++实现示例，描述了多个同事对象（User 类）通过一个中介者（ChatMediator）来进行通信的情况。</p>
<p>用户可以关注其他用户,广播消息会发送给所有关注自己的用户,点对点消息发送则无视关注列表</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatMediator</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">sendMessage</span><span class="params">(<span class="type">const</span> std::string &amp;message, <span class="keyword">class</span> User *user, <span class="type">const</span> std::string &amp;receiverName = <span class="string">&quot;&quot;</span>)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">addUser</span><span class="params">(User *user)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">followUser</span><span class="params">(<span class="type">const</span> std::string &amp;followerName, <span class="type">const</span> std::string &amp;followeeName)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">ChatMediator</span>() &#123;&#125; <span class="comment">// 添加虚析构函数</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同事类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	ChatMediator *mediator;</span><br><span class="line">	std::string name;</span><br><span class="line">	std::vector&lt;std::string&gt; followers; <span class="comment">// 关注者列表</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">User</span>(ChatMediator *mediator, <span class="type">const</span> std::string &amp;name) : <span class="built_in">mediator</span>(mediator), <span class="built_in">name</span>(name) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">send</span><span class="params">(<span class="type">const</span> std::string &amp;message, <span class="type">const</span> std::string &amp;receiverName = <span class="string">&quot;&quot;</span>)</span> </span>= <span class="number">0</span>; <span class="comment">// 增加接收者参数</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">receive</span><span class="params">(<span class="type">const</span> std::string &amp;message)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function">std::string <span class="title">getName</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line">	<span class="function">std::vector&lt;std::string&gt; <span class="title">getFollowers</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> followers; &#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">follow</span><span class="params">(<span class="type">const</span> std::string &amp;followeeName)</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">User</span>() &#123;&#125; <span class="comment">// 添加虚析构函数</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteUser</span> : <span class="keyword">public</span> User</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">ConcreteUser</span>(ChatMediator *mediator, <span class="type">const</span> std::string &amp;name) : <span class="built_in">User</span>(mediator, name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">send</span><span class="params">(<span class="type">const</span> std::string &amp;message, <span class="type">const</span> std::string &amp;receiverName = <span class="string">&quot;&quot;</span>)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (receiverName.<span class="built_in">empty</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			std::cout &lt;&lt; name &lt;&lt; <span class="string">&quot; 发送广播消息: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			std::cout &lt;&lt; name &lt;&lt; <span class="string">&quot; 发送消息给 &quot;</span> &lt;&lt; receiverName &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">		&#125;</span><br><span class="line">		mediator-&gt;<span class="built_in">sendMessage</span>(message, <span class="keyword">this</span>, receiverName);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">receive</span><span class="params">(<span class="type">const</span> std::string &amp;message)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; name &lt;&lt; <span class="string">&quot; 收到消息: &quot;</span> &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">follow</span><span class="params">(<span class="type">const</span> std::string &amp;followeeName)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		followers.<span class="built_in">push_back</span>(followeeName);</span><br><span class="line">		mediator-&gt;<span class="built_in">followUser</span>(name, followeeName);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteChatMediator</span> : <span class="keyword">public</span> ChatMediator</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	std::unordered_map&lt;std::string, User *&gt; users;						 <span class="comment">// 使用 map 来存储用户以便快速查找</span></span><br><span class="line">	std::unordered_map&lt;std::string, std::vector&lt;std::string&gt;&gt; followMap; <span class="comment">// 关注关系</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">addUser</span><span class="params">(User *user)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		users[user-&gt;<span class="built_in">getName</span>()] = user;</span><br><span class="line">		followMap[user-&gt;<span class="built_in">getName</span>()] = &#123;&#125;; <span class="comment">// 初始化关注者列表</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">followUser</span><span class="params">(<span class="type">const</span> std::string &amp;followerName, <span class="type">const</span> std::string &amp;followeeName)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		followMap[followeeName].<span class="built_in">push_back</span>(followerName);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">sendMessage</span><span class="params">(<span class="type">const</span> std::string &amp;message, User *user, <span class="type">const</span> std::string &amp;receiverName = <span class="string">&quot;&quot;</span>)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (receiverName.<span class="built_in">empty</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 广播消息给所有关注用户</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span> &amp;follower : followMap[user-&gt;<span class="built_in">getName</span>()])</span><br><span class="line">			&#123;</span><br><span class="line">				users[follower]-&gt;<span class="built_in">receive</span>(message);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 点对点消息</span></span><br><span class="line">			<span class="keyword">if</span> (users.<span class="built_in">find</span>(receiverName) != users.<span class="built_in">end</span>())</span><br><span class="line">			&#123;</span><br><span class="line">				users[receiverName]-&gt;<span class="built_in">receive</span>(message);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				std::cout &lt;&lt; <span class="string">&quot;用户 &quot;</span> &lt;&lt; receiverName &lt;&lt; <span class="string">&quot; 不存在，消息发送失败。&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用如下:</span></span><br><span class="line">	ChatMediator *chatMediator = <span class="keyword">new</span> <span class="built_in">ConcreteChatMediator</span>();</span><br><span class="line"></span><br><span class="line">	User *user1 = <span class="keyword">new</span> <span class="built_in">ConcreteUser</span>(chatMediator, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">	User *user2 = <span class="keyword">new</span> <span class="built_in">ConcreteUser</span>(chatMediator, <span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">	User *user3 = <span class="keyword">new</span> <span class="built_in">ConcreteUser</span>(chatMediator, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line">	chatMediator-&gt;<span class="built_in">addUser</span>(user1);</span><br><span class="line">	chatMediator-&gt;<span class="built_in">addUser</span>(user2);</span><br><span class="line">	chatMediator-&gt;<span class="built_in">addUser</span>(user3);</span><br><span class="line"></span><br><span class="line">	user1-&gt;<span class="built_in">follow</span>(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">	user2-&gt;<span class="built_in">follow</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">	user2-&gt;<span class="built_in">follow</span>(<span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line">	user1-&gt;<span class="built_in">send</span>(<span class="string">&quot;Hello, everyone!&quot;</span>);	   <span class="comment">// 广播消息给所有关注用户</span></span><br><span class="line">	user2-&gt;<span class="built_in">send</span>(<span class="string">&quot;Hey, Alice!&quot;</span>, <span class="string">&quot;Alice&quot;</span>);   <span class="comment">// 点对点消息</span></span><br><span class="line">	user3-&gt;<span class="built_in">send</span>(<span class="string">&quot;Hi, Bob!&quot;</span>, <span class="string">&quot;Bob&quot;</span>);		   <span class="comment">// 点对点消息</span></span><br><span class="line">	user1-&gt;<span class="built_in">send</span>(<span class="string">&quot;Hello, David!&quot;</span>, <span class="string">&quot;David&quot;</span>); <span class="comment">// 发送给不存在的用户</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">delete</span> chatMediator;</span><br><span class="line">	<span class="keyword">delete</span> user1;</span><br><span class="line">	<span class="keyword">delete</span> user2;</span><br><span class="line">	<span class="keyword">delete</span> user3;</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印如下:</span></span><br><span class="line">Alice 发送广播消息: Hello, everyone!</span><br><span class="line">Bob 收到消息: Hello, everyone!</span><br><span class="line">Bob 发送消息给 Alice: Hey, Alice!</span><br><span class="line">Alice 收到消息: Hey, Alice!</span><br><span class="line">Charlie 发送消息给 Bob: Hi, Bob!</span><br><span class="line">Bob 收到消息: Hi, Bob!</span><br><span class="line">Alice 发送消息给 David: Hello, David!</span><br><span class="line">用户 David 不存在，消息发送失败。</span><br><span class="line">Charlie 发送消息给 Alice: Hello,Alice</span><br><span class="line">Alice 收到消息: Hello,Alice</span><br></pre></td></tr></table></figure>

<p>下面以图示的方式展示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class ChatMediator &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +sendMessage(message: string, user: User, receiverName: string)</span><br><span class="line">        +addUser(user: User)</span><br><span class="line">        +followUser(followerName: string, followeeName: string)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class User &#123;</span><br><span class="line">        &lt;&lt;abstract&gt;&gt;</span><br><span class="line">        #mediator: ChatMediator</span><br><span class="line">        #name: string</span><br><span class="line">        #followers: vector&lt;string&gt;</span><br><span class="line">        +User(mediator: ChatMediator, name: string)</span><br><span class="line">        +getName() string</span><br><span class="line">        +getFollowers() vector&lt;string&gt;</span><br><span class="line">        +send(message: string, receiverName: string)</span><br><span class="line">        +receive(message: string)</span><br><span class="line">        +follow(followeeName: string)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ConcreteUser &#123;</span><br><span class="line">        +ConcreteUser(mediator: ChatMediator, name: string)</span><br><span class="line">        +send(message: string, receiverName: string)</span><br><span class="line">        +receive(message: string)</span><br><span class="line">        +follow(followeeName: string)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ConcreteChatMediator &#123;</span><br><span class="line">        -users: unordered_map&lt;string, User*&gt;</span><br><span class="line">        -followMap: unordered_map&lt;string, vector&lt;string&gt;&gt;</span><br><span class="line">        +addUser(user: User)</span><br><span class="line">        +followUser(followerName: string, followeeName: string)</span><br><span class="line">        +sendMessage(message: string, user: User, receiverName: string)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ChatMediator &lt;|.. ConcreteChatMediator</span><br><span class="line">    User &lt;|-- ConcreteUser</span><br><span class="line">    ChatMediator --o User</span><br><span class="line">    ConcreteChatMediator --* User</span><br></pre></td></tr></table></figure>

<ol>
<li><code>ChatMediator</code> 是一个接口，被 <code>ConcreteChatMediator</code> 实现。</li>
<li><code>User</code> 是一个抽象类，被 <code>ConcreteUser</code> 继承。</li>
<li><code>User</code> 和 <code>ChatMediator</code> 之间有一个组合关系，表示 <code>User</code> 包含一个 <code>ChatMediator</code> 的引用。</li>
<li><code>ConcreteChatMediator</code> 和 <code>User</code> 之间有一个聚合关系，表示 <code>ConcreteChatMediator</code> 管理多个 <code>User</code> 对象。</li>
</ol>
<p>本质上是在各个实例中,以组合的方式添加了一个公共使用的中介者实例,统一通过这个中介者来调用或注册自身</p>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>策略模式(Strategy pattern)</p>
<p>定义一组算法,将每个算法都封装在独立的类中,使得它们之间可以互换使用,使我们能够在运行时选择或更改算法,<strong>策略模式让算法独立于使用它的客户而变化</strong>(客户不关心策略的实现逻辑),也称为政策模式(Policy)</p>
<p>思想主要是:将每个策略包装为一个单独的类,拥有相同的接口</p>
<p>根据不同的情况来选择不同的策略,进而达到使用不同算法的目的</p>
<p>这种模式特别适用于处理类似支付,排序或数据处理等场景,算法的变化不会影响系统的其他部分</p>
<blockquote>
<p>策略模式与状态模式的主要差异</p>
<ul>
<li><a href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F">状态模式</a>是同样的方法不一样的结果(E.g.没钱状态下吃霸王餐,有钱状态下付钱)</li>
<li>策略模式是同样的方法,不同的策略,相同的结果(E.g.用支付宝和微信都是付钱了)</li>
</ul>
<p>即:</p>
<ul>
<li><strong>状态模式</strong> 关注的是对象的状态变化以及状态变化对行为的影响，强调的是“同样的方法，不同的结果”。</li>
<li><strong>策略模式</strong> 关注的是算法的选择和替换，强调的是“同样的方法，不同的策略，最终的结果可能相同”。</li>
</ul>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202407231405719.png" alt="image-20240723140558183"></p>
<p>可以这么理解,飞有很多策略,普通飞是个策略,不飞也是个策略,通过成员,将飞的各种策略兼容到一个统一的飞行行为(使用组合方式连接策略)</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410151745579.png" alt="image-20241015174528583" style="zoom: 33%;" />

<h3 id="案例-7"><a href="#案例-7" class="headerlink" title="案例"></a>案例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FlyBehavior interface</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyBehavior</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">FlyBehavior</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete behavior: FlyWithWing</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyWithWing</span> : <span class="keyword">public</span> FlyBehavior</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;I&#x27;m flying with wings!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete behavior: FlyNoWay</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyNoWay</span> : <span class="keyword">public</span> FlyBehavior</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;I can&#x27;t fly!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Duck base class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Duck</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	std::unique_ptr&lt;FlyBehavior&gt; flyBehavior;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Duck</span>(std::unique_ptr&lt;FlyBehavior&gt; fb) : <span class="built_in">flyBehavior</span>(std::<span class="built_in">move</span>(fb)) &#123;&#125;</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">Duck</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">performFly</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		flyBehavior-&gt;<span class="built_in">fly</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setFlyBehavior</span><span class="params">(std::unique_ptr&lt;FlyBehavior&gt; fb)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		flyBehavior = std::<span class="built_in">move</span>(fb);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">quack</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Quack!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">swim</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Swimming!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Specific types of ducks</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GreenDuck</span> : <span class="keyword">public</span> Duck</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">GreenDuck</span>() : <span class="built_in">Duck</span>(std::<span class="built_in">make_unique</span>&lt;FlyWithWing&gt;()) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;I&#x27;m a green duck!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedDuck</span> : <span class="keyword">public</span> Duck</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">RedDuck</span>() : <span class="built_in">Duck</span>(std::<span class="built_in">make_unique</span>&lt;FlyNoWay&gt;()) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;I&#x27;m a red duck!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YellowDuck</span> : <span class="keyword">public</span> Duck</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">YellowDuck</span>() : <span class="built_in">Duck</span>(std::<span class="built_in">make_unique</span>&lt;FlyWithWing&gt;()) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;I&#x27;m a yellow duck!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用如下:</span></span><br><span class="line">GreenDuck greenDuck;</span><br><span class="line">	RedDuck redDuck;</span><br><span class="line">	YellowDuck yellowDuck;</span><br><span class="line"></span><br><span class="line">	greenDuck.<span class="built_in">display</span>();</span><br><span class="line">	greenDuck.<span class="built_in">performFly</span>();</span><br><span class="line"></span><br><span class="line">	redDuck.<span class="built_in">display</span>();</span><br><span class="line">	redDuck.<span class="built_in">performFly</span>();</span><br><span class="line"></span><br><span class="line">	yellowDuck.<span class="built_in">display</span>();</span><br><span class="line">	yellowDuck.<span class="built_in">performFly</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Change flying behavior at runtime</span></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;\nChanging RedDuck&#x27;s flying behavior...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	redDuck.<span class="built_in">setFlyBehavior</span>(std::<span class="built_in">make_unique</span>&lt;FlyWithWing&gt;());</span><br><span class="line">	redDuck.<span class="built_in">display</span>();</span><br><span class="line">	redDuck.<span class="built_in">performFly</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印结果如下:</span></span><br><span class="line">I<span class="string">&#x27;m a green duck!</span></span><br><span class="line"><span class="string">I&#x27;</span>m flying with wings!</span><br><span class="line">I<span class="string">&#x27;m a red duck!</span></span><br><span class="line"><span class="string">I can&#x27;</span>t fly!</span><br><span class="line">I<span class="string">&#x27;m a yellow duck!</span></span><br><span class="line"><span class="string">I&#x27;</span>m flying with wings!</span><br><span class="line"></span><br><span class="line">Changing RedDuck<span class="string">&#x27;s flying behavior...</span></span><br><span class="line"><span class="string">I&#x27;</span>m a red duck!</span><br><span class="line">I<span class="string">&#x27;m flying with wings!</span></span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class FlyBehavior &#123;</span><br><span class="line">        &lt;&lt;interface&gt;&gt;</span><br><span class="line">        +fly() const</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class FlyWithWing &#123;</span><br><span class="line">        +fly() const</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class FlyNoWay &#123;</span><br><span class="line">        +fly() const</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Duck &#123;</span><br><span class="line">        +performFly() const</span><br><span class="line">        +display() const</span><br><span class="line">        +setFlyBehavior(FlyBehavior*) void</span><br><span class="line">        +quack() const</span><br><span class="line">        +swim() const</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class GreenDuck &#123;</span><br><span class="line">        +display() const</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class RedDuck &#123;</span><br><span class="line">        +display() const</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class YellowDuck &#123;</span><br><span class="line">        +display() const</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FlyBehavior &lt;|-- FlyWithWing</span><br><span class="line">    FlyBehavior &lt;|-- FlyNoWay</span><br><span class="line"></span><br><span class="line">    Duck o-- FlyBehavior</span><br><span class="line"></span><br><span class="line">    Duck &lt;|-- GreenDuck</span><br><span class="line">    Duck &lt;|-- RedDuck</span><br><span class="line">    Duck &lt;|-- YellowDuck</span><br></pre></td></tr></table></figure>

<ul>
<li>FlyBehavior 是一个接口（抽象类），并且有两个具体的实现类：FlyWithWing 和 FlyNoWay，表示不同的飞行行为。</li>
<li>Duck 是一个基类，其中包含 FlyBehavior 的成员，鸭子可以调用 performFly() 执行飞行行为。Duck 类有具体的子类 GreenDuck、RedDuck 和 YellowDuck，它们分别代表不同种类的鸭子。</li>
</ul>
<h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><p>状态模式是一种行为型设计模式，用于解决对象在不同状态下的行为变化和转换的问题。在状态模式中，对象可以在内部状态发生改变时改变其行为，而不需要改变对象本身的类。这样可以使对象的行为更加灵活，易于扩展和维护。</p>
<p><strong>以面向对象的方式实现状态机,每个状态都会被实现为状态接口的一个派生类,状态的转换通过调用接口中的定义的方法来处理</strong>.状态模式可以看作是策略模式的一种变体,其中当前的策略会根据状态转换而改变</p>
<p>在状态模式中，通常会定义一个状态接口或者抽象类，表示不同的状态，然后具体的状态类实现这个接口或者继承这个抽象类，每个具体的状态类实现自己的行为逻辑。另外，还会定义一个上下文类，用于维护当前的状态对象，并根据不同的状态对象调用对应的行为。</p>
<p>状态模式可以有效地将复杂的状态逻辑进行解耦和封装，使代码更加清晰和易于理解。它常用于处理对象在不同状态下的行为变化，例如状态机、工作流等场景。</p>
<blockquote>
<p>当一个对象的行为依赖于他的状态,并且需要在运行时根据状态切换行为时,可以考虑使用状态模式</p>
<p>这种模式特别<strong>适用于具有复杂状态转换逻辑的系统</strong><br>状态模式通过将状态与行为分离,<strong>使对象可以根据状态的变化动态调整其行为</strong>,这种模式提高了系统的灵活性和可维护性,使我们能轻松管理和拓展对象的状态逻辑</p>
</blockquote>
<p>以一个极光炮塔的状态拆解为例:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410161101355.png" alt="image-20241016110118382" style="zoom: 50%;" />

<h3 id="状态模式实例"><a href="#状态模式实例" class="headerlink" title="状态模式实例"></a>状态模式实例</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202405102049407.png" alt="image-20240510204902800" style="zoom: 50%;" />

<p>上图中的微波炉有三种状态</p>
<ul>
<li>加热 Heating</li>
<li>开门 DoorOpen</li>
<li>关门 DoorClosed</li>
</ul>
<p>四种操作</p>
<ul>
<li>开门 (只能在关门状态下进行)</li>
<li>关门 (只能在开门状态下进行)</li>
<li>启动 (只能在关门状态下进行)</li>
<li>停止 (只能在加热状态下进行)</li>
</ul>
<p>如果在操作中判断状态,代码中会充斥着各种条件语句</p>
<p>这时可以使用<strong>状态模式</strong></p>
<p>每个状态对应的操作封装在一起</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202405102103669.png" alt="image-20240510210328091" style="zoom: 25%;" />

<p>状态图（State Diagram）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">stateDiagram-v2</span><br><span class="line">    [*] --&gt; DoorClosed</span><br><span class="line"></span><br><span class="line">    DoorClosed --&gt; DoorOpen : OpenDoor()</span><br><span class="line">    DoorOpen --&gt; DoorClosed : CloseDoor()</span><br><span class="line">    DoorClosed --&gt; Heating : Start()</span><br><span class="line">    Heating --&gt; DoorClosed : Stop()</span><br><span class="line">    Heating --&gt; DoorOpen : OpenDoor()</span><br><span class="line"></span><br><span class="line">    state DoorClosed &#123;</span><br><span class="line">        [*] --&gt; Idle</span><br><span class="line">        Idle --&gt; Ready : DoorClosed()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state DoorOpen &#123;</span><br><span class="line">        [*] --&gt; Open</span><br><span class="line">        Open --&gt; Waiting : WaitForClose()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state Heating &#123;</span><br><span class="line">        [*] --&gt; HeatingProcess</span><br><span class="line">        HeatingProcess --&gt; Complete : Finish()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>C++完整代码案例</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MicrowaveOven</span>; <span class="comment">// 前向声明</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象状态类 MicrowaveState</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MicrowaveState</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	MicrowaveOven *microwave;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">MicrowaveState</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置上下文(微波炉)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setMicrowave</span><span class="params">(MicrowaveOven *oven)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;microwave = oven;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">OpenDoor</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">CloseDoor</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Start</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Stop</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------具体状态类</span></span><br><span class="line"><span class="comment">// 加热状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeatingState</span> : <span class="keyword">public</span> MicrowaveState</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OpenDoor</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Can&#x27;t open the door while heating.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">CloseDoor</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Door is already closed.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Start</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Already heating.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Stop</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Stopping heating...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		<span class="comment">// 状态转换逻辑，例如切换到门关闭状态</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 门打开状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoorOpenState</span> : <span class="keyword">public</span> MicrowaveState</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OpenDoor</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Door is already open.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">CloseDoor</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Closing the door...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		<span class="comment">// 状态转换逻辑，例如切换到门关闭状态</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Start</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Can&#x27;t start heating with the door open.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Stop</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Already stopped.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 门关闭状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoorClosedState</span> : <span class="keyword">public</span> MicrowaveState</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OpenDoor</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Opening the door...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		<span class="comment">// 状态转换逻辑，例如切换到门打开状态</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">CloseDoor</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Door is already closed.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Start</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Starting heating...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		<span class="comment">// 状态转换逻辑，例如切换到加热状态</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Stop</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Already stopped.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 微波炉类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MicrowaveOven</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	MicrowaveState *state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">MicrowaveOven</span>(MicrowaveState *initState) : <span class="built_in">state</span>(initState)</span><br><span class="line">	&#123;</span><br><span class="line">		state-&gt;<span class="built_in">setMicrowave</span>(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setState</span><span class="params">(MicrowaveState *newState)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;state = newState;</span><br><span class="line">		state-&gt;<span class="built_in">setMicrowave</span>(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">OpenDoor</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		state-&gt;<span class="built_in">OpenDoor</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">CloseDoor</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		state-&gt;<span class="built_in">CloseDoor</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		state-&gt;<span class="built_in">Start</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Stop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		state-&gt;<span class="built_in">Stop</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="comment">// 初始化状态</span></span><br><span class="line"><span class="function">MicrowaveOven <span class="title">microwave</span><span class="params">(<span class="keyword">new</span> DoorClosedState())</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试微波炉的不同操作</span></span><br><span class="line">microwave.<span class="built_in">Start</span>();	  <span class="comment">// Starting heating...</span></span><br><span class="line">microwave.<span class="built_in">OpenDoor</span>(); <span class="comment">// Can&#x27;t open the door while heating.</span></span><br><span class="line">microwave.<span class="built_in">Stop</span>();	  <span class="comment">// Stopping heating...</span></span><br><span class="line">microwave.<span class="built_in">OpenDoor</span>(); <span class="comment">// Opening the door...</span></span><br></pre></td></tr></table></figure>

<p>UML类图:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class MicrowaveState &#123;</span><br><span class="line">        +MicrowaveOven* microwave</span><br><span class="line">        +setMicrowave(MicrowaveOven* oven)</span><br><span class="line">        +OpenDoor() : void</span><br><span class="line">        +CloseDoor() : void</span><br><span class="line">        +Start() : void</span><br><span class="line">        +Stop() : void</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class HeatingState &#123;</span><br><span class="line">        +OpenDoor() : void</span><br><span class="line">        +CloseDoor() : void</span><br><span class="line">        +Start() : void</span><br><span class="line">        +Stop() : void</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class DoorOpenState &#123;</span><br><span class="line">        +OpenDoor() : void</span><br><span class="line">        +CloseDoor() : void</span><br><span class="line">        +Start() : void</span><br><span class="line">        +Stop() : void</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class DoorClosedState &#123;</span><br><span class="line">        +OpenDoor() : void</span><br><span class="line">        +CloseDoor() : void</span><br><span class="line">        +Start() : void</span><br><span class="line">        +Stop() : void</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class MicrowaveOven &#123;</span><br><span class="line">        -MicrowaveState* state</span><br><span class="line">        +MicrowaveOven(MicrowaveState* initState)</span><br><span class="line">        +setState(MicrowaveState* newState) : void</span><br><span class="line">        +OpenDoor() : void</span><br><span class="line">        +CloseDoor() : void</span><br><span class="line">        +Start() : void</span><br><span class="line">        +Stop() : void</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MicrowaveState &lt;|-- HeatingState</span><br><span class="line">    MicrowaveState &lt;|-- DoorOpenState</span><br><span class="line">    MicrowaveState &lt;|-- DoorClosedState</span><br><span class="line">    MicrowaveOven o-- MicrowaveState</span><br></pre></td></tr></table></figure>

<ul>
<li>MicrowaveState 是抽象类，它有多个子类（HeatingState、DoorOpenState、DoorClosedState），分别代表微波炉的不同状态。</li>
<li>MicrowaveOven 类与 MicrowaveState 有一个聚合关系，表示微波炉包含一个当前状态对象。</li>
</ul>
<h3 id="与策略模式的意图差异"><a href="#与策略模式的意图差异" class="headerlink" title="与策略模式的意图差异"></a>与策略模式的意图差异</h3><ul>
<li>策略模式侧重: 在外部代码灵活的改变内部代码的策略的切换</li>
<li>状态模式侧重: 行为根据状态的自动切换</li>
</ul>
<h3 id="状态机"><a href="#状态机" class="headerlink" title="状态机"></a>状态机</h3><p>状态机可根据状态数量分为两类:</p>
<ul>
<li><p>有限状态机（Finite State Machine, FSM）（自动机）</p>
<p>状态数量有限</p>
</li>
<li><p>无限状态机</p>
<p>状态数量无限</p>
<p>如:推理机,图灵机</p>
</li>
</ul>
<h4 id="有限状态机重要性"><a href="#有限状态机重要性" class="headerlink" title="有限状态机重要性"></a>有限状态机重要性</h4><p>在工业控制领域，状态机是一个极其重要的概念，它决定了设备能否按照计划流程加工，以及及时的停止加工，防止物料受损，一个好的状态机在异常处理上有着良好的 Handle 能力，需要通过一个状态模型来尽可能涵盖可能发生的情况。</p>
<p>一个抽象的状态机模型可以拆分为若干个状态节点，而每完成一个节点，下一个节点的动作才会被触发，我们称每一个这样的节点，为一步（Step），因此状态机可以用<a href="#%E7%BB%98%E5%88%B6%E7%8A%B6%E6%80%81%E6%9C%BA">有向图（Directed graph）</a>来表示，在实际实现状态机的数据结构中，也常用作图来编写整个流程。</p>
<p>通常状态机可以分为两种不同的类型，</p>
<ul>
<li><p>Moore 状态机</p>
<p>不考虑输入的内容而只根据目前状态决策</p>
</li>
<li><p>Mealy 状态机</p>
<p>不仅会考量当前状态，也同时会考虑当前的输入数据，最后综合做出决策</p>
</li>
</ul>
<blockquote>
<p>由于工艺制程的复杂性，半导体领域通常使用的是 Mealy 状态机。需要注意的是，几乎所有的状态机有自己完整的生命周期（Life Cycle）钩子，通常在被初始化（Initialization）、状态转移（State Transition）、事件触发（Event Trigger）、动作（Action）、销毁的时候，会触发相应的钩子函数，以实现更加强壮的功能，我相信很多学习前端 Vue 的朋友应该都会比较熟悉，可以把它简单的理解为一个 DOM 从创建、渲染到销毁的过程。</p>
</blockquote>
<h4 id="绘制状态机"><a href="#绘制状态机" class="headerlink" title="绘制状态机"></a>绘制状态机</h4><p>不仅可以拆解状态模式的实现思路</p>
<p>还可以帮助我们梳理和表达产品需求</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410161125098.png" alt="image-20241016112510812"></p>
<p>注意设计时需要<strong>全面充分</strong>,画完图要检查是否有无法进入或无法离开的状态,排除会导致状态机可以同时处在不同状态下模棱两可的切换箭头</p>
<h3 id="优秀的状态模式设计"><a href="#优秀的状态模式设计" class="headerlink" title="优秀的状态模式设计"></a>优秀的状态模式设计</h3><p><a target="_blank" rel="noopener" href="https://github.com/dotnet-state-machine/stateless">参考此项目</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class StateMachine~TState, TTrigger~ &#123;</span><br><span class="line">        +StateMachine()</span><br><span class="line">        +Configure(state: TState)</span><br><span class="line">        +Fire(trigger: TTrigger)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ActivateActionBehaviour &#123;</span><br><span class="line">        +Execute()</span><br><span class="line">        +ExecuteAsync() Task</span><br><span class="line">    &#125;</span><br><span class="line">    StateMachine &lt;|-- ActivateActionBehaviour</span><br><span class="line"></span><br><span class="line">    class DeactivateActionBehaviour &#123;</span><br><span class="line">        +Execute()</span><br><span class="line">        +ExecuteAsync() Task</span><br><span class="line">    &#125;</span><br><span class="line">    StateMachine &lt;|-- DeactivateActionBehaviour</span><br><span class="line"></span><br><span class="line">    class EntryActionBehavior &#123;</span><br><span class="line">        +Execute(transition: Transition, args: object[])</span><br><span class="line">        +ExecuteAsync(transition: Transition, args: object[]) Task</span><br><span class="line">    &#125;</span><br><span class="line">    StateMachine &lt;|-- EntryActionBehavior</span><br><span class="line"></span><br><span class="line">    class TriggerBehaviour &#123;</span><br><span class="line">        +GuardConditionsMet(args: object[]) bool</span><br><span class="line">        +UnmetGuardConditions(args: object[]) ICollection~string~</span><br><span class="line">    &#125;</span><br><span class="line">    StateMachine &lt;|-- TriggerBehaviour</span><br><span class="line"></span><br><span class="line">    class TransitionGuard &#123;</span><br><span class="line">        +GuardConditionsMet(args: object[]) bool</span><br><span class="line">        +UnmetGuardConditions(args: object[]) ICollection~string~</span><br><span class="line">    &#125;</span><br><span class="line">    StateMachine &lt;|-- TransitionGuard</span><br><span class="line"></span><br><span class="line">    class GuardCondition &#123;</span><br><span class="line">        +Guard: Func~object[], bool~</span><br><span class="line">        +Description: string</span><br><span class="line">    &#125;</span><br><span class="line">    TransitionGuard o-- GuardCondition</span><br><span class="line"></span><br><span class="line">    class Transition &#123;</span><br><span class="line">        +Source: TState</span><br><span class="line">        +Destination: TState</span><br><span class="line">        +Trigger: TTrigger</span><br><span class="line">    &#125;</span><br><span class="line">    StateMachine &lt;.. Transition</span><br><span class="line"></span><br><span class="line">    class DynamicTriggerBehaviour &#123;</span><br><span class="line">        +GetDestinationState(source: TState, args: object[], out destination: TState)</span><br><span class="line">    &#125;</span><br><span class="line">    StateMachine &lt;|-- DynamicTriggerBehaviour</span><br><span class="line">    DynamicTriggerBehaviour --|&gt; TriggerBehaviour</span><br></pre></td></tr></table></figure>

<h2 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h2><p>备忘录模式（Memento Pattern）又称之为快照模式(Snapshop Pattern)或者令牌模式(Token Pattern)</p>
<p>备忘录模式: 用于保存和恢复对象的状态,而不会破坏对象的封装性</p>
<p><strong>适用场景</strong>: 当需要在不破坏封装性的前提下捕获和恢复对象状态时,可以使用备忘录模式.如:在实现撤销&#x2F;重做功能时,备忘录模式非常有用,可以帮你将对象的状态存储起来,并在需要时恢复到之前的状态</p>
<p>核心思想: 序列化,以及栈</p>
<p>以游戏保存为例:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410161158757.png" alt="image-20241016115816716" style="zoom:50%;" /></p>
<p>上图中的堆栈(回退栈),用于存储序列化后的状态信息</p>
<h3 id="案例-8"><a href="#案例-8" class="headerlink" title="案例"></a>案例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArticleMemento</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string title;</span><br><span class="line">    std::string content;</span><br><span class="line">    std::<span class="type">time_t</span> createTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ArticleMemento</span>(<span class="type">const</span> std::string&amp; title, <span class="type">const</span> std::string&amp; content, std::<span class="type">time_t</span> createTime)</span><br><span class="line">        : <span class="built_in">title</span>(title), <span class="built_in">content</span>(content), <span class="built_in">createTime</span>(createTime) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">getTitle</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> title; &#125;</span><br><span class="line">    <span class="function">std::string <span class="title">getContent</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> content; &#125;</span><br><span class="line">    <span class="function">std::<span class="type">time_t</span> <span class="title">getCreateTime</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> createTime; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ArticleText 类，保存和恢复状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArticleText</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string title;</span><br><span class="line">    std::string content;</span><br><span class="line">    std::<span class="type">time_t</span> createTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ArticleText</span>(<span class="type">const</span> std::string&amp; title, <span class="type">const</span> std::string&amp; content, std::<span class="type">time_t</span> createTime)</span><br><span class="line">        : <span class="built_in">title</span>(title), <span class="built_in">content</span>(content), <span class="built_in">createTime</span>(createTime) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">getTitle</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> title; &#125;</span><br><span class="line">    <span class="function">std::string <span class="title">getContent</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> content; &#125;</span><br><span class="line">    <span class="function">std::<span class="type">time_t</span> <span class="title">getCreateTime</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> createTime; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTitle</span><span class="params">(<span class="type">const</span> std::string&amp; newTitle)</span> </span>&#123; title = newTitle; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setContent</span><span class="params">(<span class="type">const</span> std::string&amp; newContent)</span> </span>&#123; content = newContent; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCreateTime</span><span class="params">(std::<span class="type">time_t</span> newTime)</span> </span>&#123; createTime = newTime; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存当前状态到 Memento</span></span><br><span class="line">    <span class="function">std::shared_ptr&lt;ArticleMemento&gt; <span class="title">saveToMemento</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;ArticleMemento&gt;(title, content, createTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 Memento 恢复状态</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getArticleFromMemento</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;ArticleMemento&gt;&amp; memento)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (memento) &#123;</span><br><span class="line">            title = memento-&gt;<span class="built_in">getTitle</span>();</span><br><span class="line">            content = memento-&gt;<span class="built_in">getContent</span>();</span><br><span class="line">            createTime = memento-&gt;<span class="built_in">getCreateTime</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录管理类，负责管理状态的堆栈</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArticleCaretaker</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::stack&lt;std::shared_ptr&lt;ArticleMemento&gt;&gt; mementoStack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 将 Memento 压入堆栈</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">saveState</span><span class="params">(<span class="type">const</span> std::shared_ptr&lt;ArticleMemento&gt;&amp; memento)</span> </span>&#123;</span><br><span class="line">        mementoStack.<span class="built_in">push</span>(memento);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从堆栈中弹出最近的 Memento</span></span><br><span class="line">    <span class="function">std::shared_ptr&lt;ArticleMemento&gt; <span class="title">undo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mementoStack.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;No states to undo!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> memento = mementoStack.<span class="built_in">top</span>();</span><br><span class="line">        mementoStack.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> memento;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">hasStates</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !mementoStack.<span class="built_in">empty</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::<span class="type">time_t</span> now = std::<span class="built_in">time</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function">ArticleText <span class="title">article</span><span class="params">(<span class="string">&quot;Design Patterns&quot;</span>, <span class="string">&quot;Learning Memento Pattern&quot;</span>, now)</span></span>;</span><br><span class="line">    ArticleCaretaker caretaker;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印初始状态</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Initial State: &quot;</span> &lt;&lt; article.<span class="built_in">getTitle</span>() &lt;&lt; <span class="string">&quot;, &quot;</span> </span><br><span class="line">              &lt;&lt; article.<span class="built_in">getContent</span>() &lt;&lt; <span class="string">&quot;, Created at: &quot;</span> &lt;&lt; std::<span class="built_in">ctime</span>(&amp;article.<span class="built_in">getCreateTime</span>()) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存初始状态</span></span><br><span class="line">    caretaker.<span class="built_in">saveState</span>(article.<span class="built_in">saveToMemento</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改文章</span></span><br><span class="line">    article.<span class="built_in">setTitle</span>(<span class="string">&quot;Updated Design Patterns&quot;</span>);</span><br><span class="line">    article.<span class="built_in">setContent</span>(<span class="string">&quot;Updated content for Memento pattern.&quot;</span>);</span><br><span class="line">    std::<span class="type">time_t</span> later = std::<span class="built_in">time</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    article.<span class="built_in">setCreateTime</span>(later);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印修改后的状态</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Modified State: &quot;</span> &lt;&lt; article.<span class="built_in">getTitle</span>() &lt;&lt; <span class="string">&quot;, &quot;</span> </span><br><span class="line">              &lt;&lt; article.<span class="built_in">getContent</span>() &lt;&lt; <span class="string">&quot;, Created at: &quot;</span> &lt;&lt; std::<span class="built_in">ctime</span>(&amp;article.<span class="built_in">getCreateTime</span>()) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存修改后的状态</span></span><br><span class="line">    caretaker.<span class="built_in">saveState</span>(article.<span class="built_in">saveToMemento</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再次修改文章</span></span><br><span class="line">    article.<span class="built_in">setTitle</span>(<span class="string">&quot;Final Design Patterns&quot;</span>);</span><br><span class="line">    article.<span class="built_in">setContent</span>(<span class="string">&quot;Final content.&quot;</span>);</span><br><span class="line">    article.<span class="built_in">setCreateTime</span>(std::<span class="built_in">time</span>(<span class="literal">nullptr</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印再次修改后的状态</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final State: &quot;</span> &lt;&lt; article.<span class="built_in">getTitle</span>() &lt;&lt; <span class="string">&quot;, &quot;</span> </span><br><span class="line">              &lt;&lt; article.<span class="built_in">getContent</span>() &lt;&lt; <span class="string">&quot;, Created at: &quot;</span> &lt;&lt; std::<span class="built_in">ctime</span>(&amp;article.<span class="built_in">getCreateTime</span>()) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行撤销操作（恢复到上一次状态）</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\nUndoing to previous state...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">if</span> (caretaker.<span class="built_in">hasStates</span>()) &#123;</span><br><span class="line">        article.<span class="built_in">getArticleFromMemento</span>(caretaker.<span class="built_in">undo</span>());</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Restored State: &quot;</span> &lt;&lt; article.<span class="built_in">getTitle</span>() &lt;&lt; <span class="string">&quot;, &quot;</span> </span><br><span class="line">                  &lt;&lt; article.<span class="built_in">getContent</span>() &lt;&lt; <span class="string">&quot;, Created at: &quot;</span> &lt;&lt; std::<span class="built_in">ctime</span>(&amp;article.<span class="built_in">getCreateTime</span>()) &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再次执行撤销操作（恢复到初始状态）</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\nUndoing to initial state...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">if</span> (caretaker.<span class="built_in">hasStates</span>()) &#123;</span><br><span class="line">        article.<span class="built_in">getArticleFromMemento</span>(caretaker.<span class="built_in">undo</span>());</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Restored Initial State: &quot;</span> &lt;&lt; article.<span class="built_in">getTitle</span>() &lt;&lt; <span class="string">&quot;, &quot;</span> </span><br><span class="line">                  &lt;&lt; article.<span class="built_in">getContent</span>() &lt;&lt; <span class="string">&quot;, Created at: &quot;</span> &lt;&lt; std::<span class="built_in">ctime</span>(&amp;article.<span class="built_in">getCreateTime</span>()) &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line">Initial State: Design Patterns, Learning Memento Pattern, Created at: Thu Oct  <span class="number">3</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">18</span> <span class="number">2024</span></span><br><span class="line">Modified State: Updated Design Patterns, Updated content <span class="keyword">for</span> Memento pattern., Created at: Thu Oct  <span class="number">3</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">20</span> <span class="number">2024</span></span><br><span class="line">Final State: Final Design Patterns, Final content., Created at: Thu Oct  <span class="number">3</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">22</span> <span class="number">2024</span></span><br><span class="line"></span><br><span class="line">Undoing to previous state...</span><br><span class="line">Restored State: Updated Design Patterns, Updated content <span class="keyword">for</span> Memento pattern., Created at: Thu Oct  <span class="number">3</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">20</span> <span class="number">2024</span></span><br><span class="line"></span><br><span class="line">Undoing to initial state...</span><br><span class="line">Restored Initial State: Design Patterns, Learning Memento Pattern, Created at: Thu Oct  <span class="number">3</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">18</span> <span class="number">2024</span></span><br></pre></td></tr></table></figure>

<p>UML类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class ArticleMemento &#123;</span><br><span class="line">        -string title</span><br><span class="line">        -string content</span><br><span class="line">        -time_t createTime</span><br><span class="line">        +getTitle() : string</span><br><span class="line">        +getContent() : string</span><br><span class="line">        +getCreateTime() : time_t</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ArticleText &#123;</span><br><span class="line">        -string title</span><br><span class="line">        -string content</span><br><span class="line">        -time_t createTime</span><br><span class="line">        +saveToMemento() : ArticleMemento</span><br><span class="line">        +getArticleFromMemento(memento : ArticleMemento)</span><br><span class="line">        +getTitle() : string</span><br><span class="line">        +getContent() : string</span><br><span class="line">        +getCreateTime() : time_t</span><br><span class="line">        +setTitle(newTitle : string)</span><br><span class="line">        +setContent(newContent : string)</span><br><span class="line">        +setCreateTime(newTime : time_t)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ArticleCaretaker &#123;</span><br><span class="line">        -stack&lt;ArticleMemento&gt; mementoStack</span><br><span class="line">        +saveState(memento : ArticleMemento)</span><br><span class="line">        +undo() : ArticleMemento</span><br><span class="line">        +hasStates() : bool</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ArticleText --&gt; ArticleMemento : save / restore</span><br><span class="line">    ArticleCaretaker --&gt; ArticleMemento : manage</span><br><span class="line"></span><br><span class="line">    ArticleMemento : -string title</span><br><span class="line">    ArticleMemento : -string content</span><br><span class="line">    ArticleMemento : -time_t createTime</span><br><span class="line">    ArticleCaretaker : -stack mementoStack</span><br></pre></td></tr></table></figure>

<h2 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h2><p><strong>Template Method</strong></p>
<p>模板方法设计模式让你能够定义一个算法的通用结构,并将具体的实现延迟到子类中</p>
<p>模板方法在基类中定义了一个算法的骨架，并允许子类在不改变算法结构的前提下重新定义算法的某些步骤。</p>
<p><strong>适用场景</strong>: 当你有一个通用的流程需要多个类共享,但某些步骤需要根据具体情况进行自定义时,可以考虑使用模板方法设计模式,例如数据处理流程,文档生成流程等</p>
<blockquote>
<p>模板方法模式与<a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">策略模式</a>的区别</p>
<ul>
<li><p>模版方法模式:强调的是在一个通用框架内定义算法的结构,然后让子类根据需要重写部分步骤.它更关注的是一个固定的流程,而不是选择不同的算法</p>
<p>模版方法是通过<strong>继承</strong>来实现算法结构的部分定制</p>
</li>
<li><p>策略模式:则更强调算法的可替换性,允许你在运行时选择不同的算法实现,但不会影响算法的结构</p>
<p>策略模式是将算法的每个实现封装在独立的类中,并通过<strong>接口</strong>使它们可以互换使用</p>
</li>
</ul>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202410161420152.png" alt="image-20241016142012297" style="zoom:50%;" />

<p>案例就省略了,因为无非也就是继承而已</p>
<h2 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h2><p>Visitor </p>
<p>核心思想:不修改现有代码结构的情况下,为对象添加新的功能</p>
<p>访问者设计模式通过<strong>将算法与它操作的对象结构分离</strong>,允许在不修改这些对象结构的情况下为其添加新操作.符合<a href="#%E9%9D%A2%E7%9B%B8%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99">开放封闭原则(Open&#x2F;Closed Principle)</a></p>
<p><strong>适用场景</strong>: 当需要在不修改对象结构的情况下,为对象添加新功能时,可以考虑使用访问者模式.这种模式特别适用于那些对象结构稳定但需要经常添加新操作的场景.</p>
<p>访问者设计模式通过引入访问者对象，允许我们在不修改对象结构的前提下，为对象添加新功能。在实际开发中，访问者模式可以帮助我们保持代码的开闭原则，提高系统的可扩展性和维护性。</p>
<p>访问者模式<strong>通常用于处理复杂的对象结构，比如复合对象（Composite）或对象集合（如树结构），使得对这些对象的操作更加灵活</strong>。</p>
<p>访问者模式可以说是GOF23中设计模式中最复杂的一个，但日常开发中使用频率却不高</p>
<p>最关键的两点:</p>
<ul>
<li>被访问者提供入口</li>
<li>访问者设置访问方法</li>
</ul>
<p>要点总结:</p>
<ul>
<li><p>准确识别出Visitor实用的场景，<strong>如果一个对象结构不稳定决不可使用</strong>，不然在增删元素时改动将非常巨大。</p>
</li>
<li><p>对象结构中的元素要可以迭代访问</p>
</li>
<li><p>Visitor里一般存在与元素个数相同的visit方法。</p>
</li>
<li><p>元素通过<code>accept</code>方法通过<code>this</code>将自己传递给了Visitor。</p>
</li>
<li><p><strong>优点</strong></p>
<p>使得给结构稳定的对象增加新算法变得容易，提搞了代码的可维护性，可扩展性。</p>
</li>
<li><p><strong>缺点</strong></p>
<p>太复杂，特别是伪动态双分派，不仔细理解很难想清楚。</p>
</li>
</ul>
<p>访问者模式<strong>使用频率较低，而且复杂，可酌情掌握</strong></p>
<blockquote>
<p>当我们需要统一访问接口的时候,有如下办法:</p>
<table>
<thead>
<tr>
<th>方案(C#中对应关键词)</th>
<th>适用场景</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>显式接口</strong></td>
<td>需要类型安全且子类有部分共同行为</td>
<td>编译时检查，代码清晰</td>
<td>需预先定义接口</td>
</tr>
<tr>
<td><strong>动态类型</strong>(dynamic)</td>
<td>快速原型或不确定成员结构</td>
<td>灵活</td>
<td>失去编译时检查</td>
</tr>
<tr>
<td><strong>通用容器</strong>(object)</td>
<td>完全动态的松散结构</td>
<td>高度灵活</td>
<td>完全无类型安全</td>
</tr>
<tr>
<td><strong>访问者模式</strong></td>
<td>复杂对象结构且处理逻辑多变</td>
<td>解耦数据与操作</td>
<td>代码复杂度高</td>
</tr>
</tbody></table>
</blockquote>
<h3 id="案例-9"><a href="#案例-9" class="headerlink" title="案例"></a>案例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前向声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElementA</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElementB</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问者基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Visitor</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">visit</span><span class="params">(ElementA* elementA)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">visit</span><span class="params">(ElementB* elementB)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 元素基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Element</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Element</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">accept</span><span class="params">(Visitor* visitor)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体元素A类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElementA</span> : <span class="keyword">public</span> Element &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accept</span><span class="params">(Visitor* visitor)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        visitor-&gt;<span class="built_in">visit</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operationA</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ElementA operation\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体元素B类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElementB</span> : <span class="keyword">public</span> Element &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accept</span><span class="params">(Visitor* visitor)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        visitor-&gt;<span class="built_in">visit</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operationB</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ElementB operation\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体访问者1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor1</span> : <span class="keyword">public</span> Visitor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ElementA* elementA)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteVisitor1 visiting ElementA\n&quot;</span>;</span><br><span class="line">        elementA-&gt;<span class="built_in">operationA</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ElementB* elementB)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteVisitor1 visiting ElementB\n&quot;</span>;</span><br><span class="line">        elementB-&gt;<span class="built_in">operationB</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体访问者2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor2</span> : <span class="keyword">public</span> Visitor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ElementA* elementA)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteVisitor2 visiting ElementA, performing a different operation\n&quot;</span>;</span><br><span class="line">        elementA-&gt;<span class="built_in">operationA</span>(); <span class="comment">// 可执行不同的逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ElementB* elementB)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ConcreteVisitor2 visiting ElementB, performing a different operation\n&quot;</span>;</span><br><span class="line">        elementB-&gt;<span class="built_in">operationB</span>(); <span class="comment">// 可执行不同的逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建元素集合</span></span><br><span class="line">    std::vector&lt;std::unique_ptr&lt;Element&gt;&gt; elements;</span><br><span class="line">    elements.<span class="built_in">push_back</span>(std::<span class="built_in">make_unique</span>&lt;ElementA&gt;());</span><br><span class="line">    elements.<span class="built_in">push_back</span>(std::<span class="built_in">make_unique</span>&lt;ElementB&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用第一个访问者</span></span><br><span class="line">    ConcreteVisitor1 visitor1;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Using ConcreteVisitor1:\n&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; element : elements) &#123;</span><br><span class="line">        element-&gt;<span class="built_in">accept</span>(&amp;visitor1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用第二个访问者</span></span><br><span class="line">    ConcreteVisitor2 visitor2;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\nUsing ConcreteVisitor2:\n&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; element : elements) &#123;</span><br><span class="line">        element-&gt;<span class="built_in">accept</span>(&amp;visitor2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line">Using ConcreteVisitor1:</span><br><span class="line">ConcreteVisitor1 visiting ElementA</span><br><span class="line">ElementA operation</span><br><span class="line">ConcreteVisitor1 visiting ElementB</span><br><span class="line">ElementB operation</span><br><span class="line"></span><br><span class="line">Using ConcreteVisitor2:</span><br><span class="line">ConcreteVisitor2 visiting ElementA, performing a different operation</span><br><span class="line">ElementA operation</span><br><span class="line">ConcreteVisitor2 visiting ElementB, performing a different operation</span><br><span class="line">ElementB operation</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>核心: 每个元素（ElementA, ElementB）通过 accept 方法将访问者（ConcreteVisitor）引入元素内部，使访问者调用特定的操作</strong></p>
</blockquote>
<p>uml类图</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    direction TB</span><br><span class="line"></span><br><span class="line">    class Visitor &#123;</span><br><span class="line">        +visit(ElementA* elementA)</span><br><span class="line">        +visit(ElementB* elementB)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ConcreteVisitor1 &#123;</span><br><span class="line">        +visit(ElementA* elementA)</span><br><span class="line">        +visit(ElementB* elementB)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ConcreteVisitor2 &#123;</span><br><span class="line">        +visit(ElementA* elementA)</span><br><span class="line">        +visit(ElementB* elementB)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class Element &#123;</span><br><span class="line">        +accept(Visitor* visitor)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ElementA &#123;</span><br><span class="line">        +accept(Visitor* visitor)</span><br><span class="line">        +operationA()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ElementB &#123;</span><br><span class="line">        +accept(Visitor* visitor)</span><br><span class="line">        +operationB()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Visitor &lt;|-- ConcreteVisitor1</span><br><span class="line">    Visitor &lt;|-- ConcreteVisitor2</span><br><span class="line"></span><br><span class="line">    Element &lt;|-- ElementA</span><br><span class="line">    Element &lt;|-- ElementB</span><br><span class="line"></span><br><span class="line">    ElementA --&gt; Visitor : accept()</span><br><span class="line">    ElementB --&gt; Visitor : accept()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Visitor</strong> 是访问者的基类，定义了 <code>visit(ElementA*)</code> 和 <code>visit(ElementB*)</code> 两个方法。</li>
<li><strong>ConcreteVisitor1</strong> 和 <strong>ConcreteVisitor2</strong> 是两个具体的访问者，实现了访问元素的方法。</li>
<li><strong>Element</strong> 是元素的基类，包含 <code>accept(Visitor*)</code> 方法。</li>
<li><strong>ElementA</strong> 和 <strong>ElementB</strong> 是具体的元素，它们实现了 accept 方法，并有各自的操作方法 operationA 和 operationB。</li>
</ul>
<h1 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h1><blockquote>
<p>面向对象设计主要就是使用UML的类图，类图用于描述系统中所包含的类以及它们之间的相互关系，帮助人们简化对系统的理解，它是系统分析和设计阶段的重要产物，也是系统编码和测试的重要模型依据。</p>
</blockquote>
<h2 id="类的UML画法"><a href="#类的UML画法" class="headerlink" title="类的UML画法"></a>类的UML画法</h2><p>类（Class）封装了数据和行为，是面向对象的重要组成部分，它是具有相同属性、操作、关系的对象集合的总称。在系统中，每个类都具有一定的职责，职责指的是类要完成什么样子的功能，要承担什么样子的义务。一个类可以有多种职责，但是设计得好的类一般只有一种职责。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302041632811.png" style="zoom:50%;" />

<ul>
<li>看到该图分为三层：<strong>最顶层的为类名，中间层的为属性，最底层的为方法。</strong></li>
<li>属性的表示方式为：<code>【可见性】【属性名称】：【类型】=&#123;缺省值，可选&#125;</code></li>
<li>方法的表示方式为：<code>【可见性】【方法名称】（【参数列表】）：【类型】</code></li>
<li>可见性都是一样的，<code>-</code>表示<code>private</code>、<code>+</code>表示<code>public</code>、<code>#</code>表示<code>protected</code>。</li>
</ul>
<h3 id="关系画法总结"><a href="#关系画法总结" class="headerlink" title="关系画法总结"></a>关系画法总结</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302171643671.png" alt="image-20230217164335569"></p>
<ul>
<li><a href="#%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB">继承关系</a> –&gt; 带空心三角形的实线</li>
<li><a href="#%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB">关联关系</a> –&gt; 箭头线</li>
<li><a href="#%E8%81%9A%E5%90%88%E5%85%B3%E7%B3%BB">聚合关系</a> –&gt; 带空心菱形的箭头线</li>
<li><a href="#%E7%BB%84%E5%90%88%E5%85%B3%E7%B3%BB">组合关系</a> –&gt; 带实心菱形的箭头线</li>
<li><a href="#%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB">依赖关系</a> –&gt; 带箭头的虚线</li>
</ul>
<p>所有关系详解如下</p>
<ul>
<li><p><strong>继承关系（Inheritance）：表示一个类（子类）继承另一个类（父类）的属性和方法。</strong></p>
</li>
<li><p><strong>关联关系（Association）：表示一个类中包含另一个类的对象作为成员变量。</strong></p>
</li>
<li><p><strong>聚合关系（Aggregation）：表示一个类将另一个类的对象作为引用持有，但两者之间并不是强耦合关系。</strong></p>
</li>
<li><p><strong>组合关系（Composition）：表示一个类在构造方法中实例化另一个类的对象，两者之间是强耦合关系。</strong></p>
<p><a href="#%E7%BB%84%E5%90%88%E4%BC%98%E4%BA%8E%E7%BB%A7%E6%89%BF%E5%8E%9F%E5%88%99">组合优于继承原则</a>: 虽然组合关系在某种程度上是强耦合的（因为一个对象的存在依赖于另一个对象），但它通常被视为比继承低耦合的设计选择。因为组合允许在运行时动态地组合不同的对象，而继承关系在编译时是固定的。</p>
</li>
<li><p><strong>依赖关系（Dependency）：表示一个类的方法使用另一个类的对象作为参数，但两者之间不是拥有关系。</strong></p>
</li>
</ul>
<h3 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a>继承关系</h3><blockquote>
<p>继承也叫作泛化（<code>Generalization</code>），用于描述父子类之间的关系，父类又称为基类或者超类，子类又称作派生类。在UML中，泛化关系用<strong>带空心三角形的实线</strong>来表示。</p>
</blockquote>
<h4 id="普通继承关系"><a href="#普通继承关系" class="headerlink" title="普通继承关系"></a>普通继承关系</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061342649.png" style="zoom:50%;" />

<h4 id="抽象继承关系"><a href="#抽象继承关系" class="headerlink" title="抽象继承关系"></a>抽象继承关系</h4><p>比方说我想实现一个链表（<code>Link</code>），插入（<code>insert</code>）与删除（<code>remove</code>）动作我想让子类去实现，链表本身只实现统计链表中元素个数的动作（<code>count</code>），然后有一个子类单向链表（<code>OneWayLink</code>）去实现父类没有实现的动作，UML类图为：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061359977.png" style="zoom:50%;" />

<p>在UML中，抽象类无论类名还是抽象方法名，都以<strong>斜体</strong>的方式表示，因为这也是一种继承关系，所以子类与父类通过带空心三角形的实线来联系。</p>
<h3 id="关联关系"><a href="#关联关系" class="headerlink" title="关联关系"></a>关联关系</h3><blockquote>
<p>关联（Assocition）关系是类与类之间最常见的一种关系，它是一种结构化的关系，表示一类对象与另一类<br>对象之间有联系，如汽车和轮胎、师傅和徒弟、班级和学生等。在UML类图中，用<strong>箭头线</strong>连接有关联关系的对<br>象所对应的类，在C++中通常将一个类的对象作为另一个类的成员变量。关联关系分<strong>单向关联、双向关联、</strong><br><strong>自关联</strong></p>
</blockquote>
<h4 id="单向关联关系"><a href="#单向关联关系" class="headerlink" title="单向关联关系"></a>单向关联关系</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061403919.png" style="zoom:50%;" />

<h4 id="双向关联关系"><a href="#双向关联关系" class="headerlink" title="双向关联关系"></a>双向关联关系</h4><p>默认情况下的关联都是双向的，比如顾客（<code>Customer</code>）购买商品（<code>Product</code>），反之，卖出去的商品总是与某个顾客与之相关联，这就是双向关联。类图如下:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061403640.png" style="zoom:50%;" />

<h4 id="自关联关系"><a href="#自关联关系" class="headerlink" title="自关联关系"></a>自关联关系</h4><p>自关联，指的就是对象中的属性为对象本身，这在链表中非常常见，单向链表Node中会维护一个它的前驱Node，双向链表Node中会维护一个它的前驱Node和一个它的后继Node。就以单向链表为例，UML类图为:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061403687.png" style="zoom:50%;" />

<h3 id="聚合关系"><a href="#聚合关系" class="headerlink" title="聚合关系"></a>聚合关系</h3><blockquote>
<p>聚合（Aggregation）关系表示整体与部分的关系。在聚合关系中，<strong>整体对象持有成员对象的引用</strong>，成员对象是整体的一部分，但是成员对象可以脱离整体对象独立存在。在UML中，聚合关系用带<strong>空心菱形的箭头线</strong>表示</p>
</blockquote>
<p>如汽车（<code>Car</code>）与引擎（<code>Engine</code>）、轮胎（<code>Wheel</code>）、车灯（<code>Light</code>），类图 表示为：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061413313.png" style="zoom:50%;" />

<p>代码实现聚合关系，成员对象通常以构造方法、Setter方法的方式注入到整体对象之中。</p>
<p>依赖注入:</p>
<ul>
<li>通过构造方法注入，整体对象在实例化时会接收成员对象作为参数，并将其保存在内部。</li>
<li>通过Setter方法注入，整体对象可以在运行时动态设置或更改成员对象。这种注入方式可以实现对象之间的松耦合，提高代码的灵活性和可维护性。</li>
</ul>
<h3 id="组合关系"><a href="#组合关系" class="headerlink" title="组合关系"></a>组合关系</h3><blockquote>
<p>组合（Composition）关系也表示的是一种整体和部分的关系，但是在组合关系中整体对象可以控制成员对象的生命周期，一旦整体对象不存在，成员对象也不存在，整体对象和成员对象之间具有同生共死的关系。在UML中组合关系用<strong>带实心菱形的</strong>箭头线表示。</p>
</blockquote>
<p>比如人的头（Head）和嘴巴（Mouth）、鼻子（Nose），嘴巴和鼻子是头的组成部分之一，一旦头没了，嘴巴也没了，因此头和嘴巴、鼻子是组合关系，类图表示为:</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061425886.png" style="zoom:50%;" />

<p>代码实现组合关系，<strong>通常在整体类的构造方法中直接实例化成员类</strong>，因为组合关系的整体和部分是<strong>共生关系</strong>，如果通过外部注入，那么即使整体不存在，那么部分还是存在的，这就相当于变成了一种聚合关系了</p>
<h3 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h3><blockquote>
<p>依赖（Dependency）关系是一种使用关系，特定事物的改变有可能会影响到使用该事物的其他事物，在需要表示一个事物使用另一个事物时使用依赖关系，大多数情况下依赖关系体现在某个类的方法使用另一个类的对象作为参数。在UML中，依赖关系用<strong>带箭头的虚线</strong>表示，由依赖的一方指向被依赖的一方。</p>
</blockquote>
<p>比如，驾驶员（<code>Driver</code>）开车，Driver类的drive()方法将车（<code>Car</code>）的对象作为一个参数传递，以便在drive()方法中能够调用car的move()方法，且驾驶员的drive()方法依赖车的move()方法，因此也可以说Driver依赖Car，类图为：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202302061428737.png" style="zoom:50%;" />

<p>依赖关系通常通过<strong>三种方式</strong>来实现：</p>
<ul>
<li>将一个类的对象作为另一个类中方法的参数</li>
<li>在一个类的方法中将另一个类的对象作为其对象的局部变量</li>
<li>在一个类的方法中调用另一个类的静态方法</li>
</ul>
<h2 id="关联、聚合、组合之间的区别"><a href="#关联、聚合、组合之间的区别" class="headerlink" title="关联、聚合、组合之间的区别"></a>关联、聚合、组合之间的区别</h2><p><strong><code>关联</code><strong>和</strong><code>聚合</code><strong>的区别主要在于语义上：</strong>关联的两个对象之间一般是平等的，聚合则一般是不平等的</strong>。</p>
<p><strong><code>聚合</code><strong>和</strong><code>组合</code><strong>的区别则在语义和实现上都有差别：</strong>组合的两个对象之间生命周期有很大的关联，被组合的对象在组合对象创建的同时或者创建之后创建，在组合对象销毁之前销毁，一般来说被组合对象不能脱离组合对象独立存在，而且也只能属于一个组合对象(可以理解成使用栈空间)；聚合则不一样，被聚合的对象可以属于多个聚合对象</strong></p>
<p>实际应用中，三种关系其实没有区分得这么清楚，不需要把细节扣得这么细，合理利用对象之间的关系给出设计方案即可。</p>
<p><a href="#%E5%85%B3%E7%B3%BB%E7%94%BB%E6%B3%95%E6%80%BB%E7%BB%93">关系画法总结跳转</a></p>
<p><a target="_blank" rel="noopener" href="https://app.diagrams.net/">绘制uml类图的网址跳转</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"></a><div class="post-copyright__author_name">ZEROKO14</div><div class="post-copyright__author_desc">zeroko14's blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://che77a38.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://che77a38.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/')">设计模式</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://che77a38.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=设计模式&amp;url=https://che77a38.github.io/posts/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://che77a38.github.io" target="_blank">ZEROKO14的个人博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>设计模式<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">网络编程</div></div></a></div><div class="next-post pull-right"><a href="/posts/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">并发模式</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">欢迎来到ZEROKO14的个人博客</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ZEROKO14</h1><div class="author-info__desc">zeroko14's blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/che77a38" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.</span> <span class="toc-text">面向对象设计原则</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E4%BC%98%E4%BA%8E%E7%BB%A7%E6%89%BF%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.</span> <span class="toc-text">组合优于继承原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%BB%84%E5%90%88%E4%B8%8E%E7%B1%BB%E7%BB%A7%E6%89%BF%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">1.1.1.</span> <span class="toc-text">对象组合与类继承的对比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%BC%8F"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">继承式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%BC%8F"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">组合式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">继承式优缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">组合式优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E7%BC%BA%E7%82%B9%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.1.4.1.</span> <span class="toc-text">组合缺点以及解决方案</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.1.4.2.</span> <span class="toc-text">依赖注入</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">依赖倒置原则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="toc-number">2.1.</span> <span class="toc-text">设计模式的重要性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">23种设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Creational-Patterns%EF%BC%89"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建型模式（Creational Patterns）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Structural-Patterns%EF%BC%89"><span class="toc-number">2.2.2.</span> <span class="toc-text">结构型模式（Structural Patterns）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F%EF%BC%88Behavioral-Patterns%EF%BC%89"><span class="toc-number">2.2.3.</span> <span class="toc-text">行为型模式（Behavioral Patterns）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">2.3.</span> <span class="toc-text">设计模式之间的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E4%BE%8B%E8%AE%B2%E8%A7%A3"><span class="toc-number">2.4.</span> <span class="toc-text">图例讲解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">创建型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">工厂模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.1.</span> <span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.2.</span> <span class="toc-text">抽象工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.1.3.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text">原型模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.4.</span> <span class="toc-text">构造器模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB-%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">4.1.1.</span> <span class="toc-text">类-适配器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-1"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1-%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">4.1.2.</span> <span class="toc-text">对象-适配器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">实例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">桥接模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">组合模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-3"><span class="toc-number">4.3.1.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.4.</span> <span class="toc-text">装饰模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">4.4.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.5.</span> <span class="toc-text">外观模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.6.</span> <span class="toc-text">享元模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-1"><span class="toc-number">4.6.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.7.</span> <span class="toc-text">代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-2"><span class="toc-number">4.7.1.</span> <span class="toc-text">案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">行为型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.</span> <span class="toc-text">职责链模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">5.1.1.</span> <span class="toc-text">案例代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%85%B3%E7%81%AF%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.1.</span> <span class="toc-text">开关灯案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">5.2.2.</span> <span class="toc-text">文本编辑器案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.3.</span> <span class="toc-text">解释器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-3"><span class="toc-number">5.3.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.4.</span> <span class="toc-text">迭代器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-4"><span class="toc-number">5.4.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.5.</span> <span class="toc-text">观察者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-5"><span class="toc-number">5.5.1.</span> <span class="toc-text">案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.5.2.</span> <span class="toc-text">与发布-订阅模式的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.6.</span> <span class="toc-text">中介者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-6"><span class="toc-number">5.6.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.7.</span> <span class="toc-text">策略模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-7"><span class="toc-number">5.7.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.8.</span> <span class="toc-text">状态模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E5%AE%9E%E4%BE%8B"><span class="toc-number">5.8.1.</span> <span class="toc-text">状态模式实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%84%8F%E5%9B%BE%E5%B7%AE%E5%BC%82"><span class="toc-number">5.8.2.</span> <span class="toc-text">与策略模式的意图差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">5.8.3.</span> <span class="toc-text">状态机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E9%87%8D%E8%A6%81%E6%80%A7"><span class="toc-number">5.8.3.1.</span> <span class="toc-text">有限状态机重要性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">5.8.3.2.</span> <span class="toc-text">绘制状态机</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%A7%80%E7%9A%84%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.8.4.</span> <span class="toc-text">优秀的状态模式设计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.9.</span> <span class="toc-text">备忘录模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-8"><span class="toc-number">5.9.1.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.10.</span> <span class="toc-text">模板方法模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.11.</span> <span class="toc-text">访问者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B-9"><span class="toc-number">5.11.1.</span> <span class="toc-text">案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UML%E7%B1%BB%E5%9B%BE"><span class="toc-number">6.</span> <span class="toc-text">UML类图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84UML%E7%94%BB%E6%B3%95"><span class="toc-number">6.1.</span> <span class="toc-text">类的UML画法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E7%94%BB%E6%B3%95%E6%80%BB%E7%BB%93"><span class="toc-number">6.1.1.</span> <span class="toc-text">关系画法总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.2.</span> <span class="toc-text">继承关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.2.1.</span> <span class="toc-text">普通继承关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.2.2.</span> <span class="toc-text">抽象继承关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.3.</span> <span class="toc-text">关联关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%90%91%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.3.1.</span> <span class="toc-text">单向关联关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%90%91%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.3.2.</span> <span class="toc-text">双向关联关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.3.3.</span> <span class="toc-text">自关联关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.4.</span> <span class="toc-text">聚合关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.5.</span> <span class="toc-text">组合关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="toc-number">6.1.6.</span> <span class="toc-text">依赖关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E3%80%81%E8%81%9A%E5%90%88%E3%80%81%E7%BB%84%E5%90%88%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.2.</span> <span class="toc-text">关联、聚合、组合之间的区别</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%B7%A5%E4%B8%9A%E7%9B%B8%E5%85%B3/" title="工业相关">工业相关</a><time datetime="2025-02-14T03:04:40.761Z" title="发表于 2025-02-14 11:04:40">2025-02-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA/" title="操作系统">操作系统</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%AE%A1%E7%BB%84/" title="计算机组成原理">计算机组成原理</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" title="网络架构">网络架构</a><time datetime="2024-11-18T06:17:01.282Z" title="发表于 2024-11-18 14:17:01">2024-11-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/avalonia/" title="avalonia">avalonia</a><time datetime="2024-09-11T14:51:13.000Z" title="发表于 2024-09-11 22:51:13">2024-09-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="ZEROKO14" target="_blank">ZEROKO14</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu"></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 0.88rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 0.88rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 0.88rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 0.88rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 0.88rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 0.88rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 0.88rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 0.88rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 0.88rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 0.88rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 0.88rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 0.88rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 0.88rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 0.88rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 0.88rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 0.88rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 0.88rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 0.88rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 0.88rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">基础<sup>3</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>1</sup></a><a href="/tags/%E7%A1%AC%E7%BC%96%E7%A0%81/" style="font-size: 0.88rem;">硬编码<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>