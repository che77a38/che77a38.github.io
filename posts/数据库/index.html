<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>数据库 | ZEROKO14的个人博客</title><meta name="keywords" content="数据库"><meta name="author" content="ZEROKO14"><meta name="copyright" content="ZEROKO14"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="数据库"><meta name="application-name" content="数据库"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="数据库"><meta property="og:url" content="https://che77a38.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/index.html"><meta property="og:site_name" content="ZEROKO14的个人博客"><meta property="og:description" content="数据库是为了实现一定的目的按某种规则组织起来的数据的集合, 简单的说,数据库就是存储数据的库.   常见数据库 1 oracle公司的oracle数据库2 IBM公司的DB2数据库3 Informix公司的Informix数据库4 sysbase公司的sysbase数据库5 Microsoft公司的"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta property="article:author" content="ZEROKO14"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta name="description" content="数据库是为了实现一定的目的按某种规则组织起来的数据的集合, 简单的说,数据库就是存储数据的库.   常见数据库 1 oracle公司的oracle数据库2 IBM公司的DB2数据库3 Informix公司的Informix数据库4 sysbase公司的sysbase数据库5 Microsoft公司的"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://che77a38.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: ZEROKO14","link":"链接: ","source":"来源: ZEROKO14的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZEROKO14的个人博客',
  title: '数据库',
  postAI: '',
  pageFillDescription: 'oracle, DBA, 启动数据库服务, Windows, Linux, 容器数据库, 容器数据库基本操作, 登录数据库服务, 本机登陆, 远程登陆, oracle创建案例脚本, sql和sqlplus, sqlplus常用命令, 管理员创建用户, SQL语言的类型, 数据库对象, 表, 创建表, 修改表, 删除表, Oracle的回收站, 两种删除方式, 表的约束, 外键的删除相关, check检查性约束, 视图, 视图相关操作, 索引, 索引的操作, 索引的种类, 序列, 序列的操作, 使用序列需要注意的问题, 同义词, 使用场景, 同义词的操作, sql插入相关, 批处理, sql修改相关, sql删除相关, truncate和delete的区别, sql查询相关, 基本select语句, 去重, 表达式, 别名, 过滤, 比较运算符, 集合运算符, 模糊查找, 逻辑运算, 案例, 排序, 分组, 分组函数过滤, 优化, 单行函数, 字符函数, 数值函数, 转换函数, to_char函数, to_number函数, to_date函数, date的格式, 时间和日期函数, 通用函数, 分组函数, count注意点, 条件表达式与条件函数, case条件表达式, decode函数, 多表查询, 笛卡尔积, 连接条件, 等值连接, 不等值连接, 外连接, 右外连接, 左外连接, 自连接, 子查询, where后子查询案例, select后子查询案例, having后子查询案例, from后子查询案例, 多行子查询, 单行子查询, 子查询中null, 子查询优化, top-N问题, 集合运算, 一些tips, 综合案例, 事务, 事务的特性, 事务的流程, 提交与回滚, 控制事务, 隔离级别, SQL99定义4中隔离级别, oracle开发, OCCI, OCCI介绍, OCCI项目配置, 头文件, 库文件, linux下的环境配置, 常见的几个环境变量, occi使用, 开发流程, 常用API, oracle简易案例, ORA-24550, Mysql, MySQL版本及下载, red hat, 卸载, 安装, 安装客户端, ubuntu, 安装, 卸载, win7 64位, win10 64位, mysql的基本操作, 数据库CURD, 表CURD, mysql的数据类型, 数据的CURD操作, mysql的分组查询注意点, mysql的top-N问题, mysql中的函数, 日期时间函数, 日期格式函数, 数学相关函数, 字符串相关函数, 转换函数, 滤空函数, mysql的多表查询, 交叉连接, 内连接, SQL99写法, oracle写法, mysql外连接, mysql左外连接, mysql右外连接, mysql满外连接, mysql表的约束, mysql中文乱码问题, MYSQL API, 常用函数, mysql_init函数, mysql_real_connect函数, mysql_query函数, mysql_close函数, 编码相关, mysql_character_set_name函数, mysql_set_character_set函数, 结果集相关, mysql_store_result函数, mysql_fetch_row函数, mysql_free_result函数, 查询数据整体案例, 获取列数函数, 获取表头函数, mysql_affected_rows函数, mysql客户端编写案例, MYSQL的事务, 相关sql语句, 代码案例, 预处理类API, 预处理相关函数, mysql_stmt_init函数, mysql_stmt_prepare函数, mysql_stmt_param_count函数, mysql_stmt_bind_param函数, MYSQL_BIND结构体, mysql_stmt_execute函数, mysql_stmt_bind_result函数, mysql_stmt_fetch函数, mysql_stmt_error函数, mysql_stmt_close函数, 预处理案例, oracle和mysql的区别, sqlite, 时序数据库, 非关系数据库, NoSQL数据库, Redis, 安装与使用, redis配置文件, 数据类型, 常用命令, String类型命令, List类型命令, Set类型命令, SortedSet 类型, Hash类型命令, Key 相关的命令, redis插件, Redis数据持久化, 数据持久化的配置项, Redis开发, HIREDIS库, 测试案例, sql server相关, sql server配置, 备份与还原bak文件, 备份流程, 还原流程, 数据库映射技术ORM, 写时复制和事务处理, 写时复制, 核心思想, 步骤, 优点, 应用场景, 事务处理原理, ACID 属性, 事务处理机制, 事务的状态, 事务隔离级别, 数据库相关课程介绍数据库是为了实现一定的目的按某种规则组织起来的数据的集合简单的说数据库就是存储数据的库常见数据库公司的数据库公司的数据库公司的数据库公司的数据库公司的的数据库开始属于公司后来被收购又被收购数据库键值对的非关系数据库是殷墟出土的甲骨文的英文翻译的第一个单词公司成立于年总部位于美国加州数据库是中文名称叫甲骨文公司的核心产品数据库是一个适合于大中型企业的数据库管理系统在所有的数据库管理系统中比如微软的的等的主要用户涉及面非常广包括银行电信移动通信航空保险金融电子商务和跨国公司等数据库的一些版本有到各个版本之间的操作存在一定的差别但是操作数据库都使用的是标准的语句因此对于各个版本的差别不大年月日收购目的是为了得到服务器的框架免费的对应的年月日公司收购了年月日收购了官网安装路径服务器是一个数据管理系统它提供开放的全面的近乎完整的信息管理由个数据库和一个或多个实例可以简单理解成就是进程组成数据库位于硬盘上实例位于内存中非常耗费内存表空间和数据文件逻辑概念表空间是由多个数据文件组成位于实例上在内存中物理概念数据文件在磁盘上目录中的文件一个表空间包含一个或者多个数据文件段存在于表空间中段是区的集合区是数据块的集合数据块会被映射到磁盘块数据库管理员简称是从事管理和维护数据库管理系统的相关工作人员的统称属于运维工程师的一个分支主要负责业务数据库从设计测试到部署交付的全生命周期管理的核心目标是保证数据库管理系统的稳定性安全性完整性和高性能从时间开销上看安装占用创建和配置占用装载和存档数据占软件维护占管理数据库系统占可见管理数据库系统占用了大部分的时间开销启动数据库服务下创建数据库参考此处注意安装过程中主机名不要修改默认的是对的吃过亏了启动数据库服务启动服务找到下列两个服务并启动数据库服务系统监听服务用于远程连接的侦听注意若把数据库默认设置为自启动则开机时间会延长启动数据库服务步骤数据库系统安装到系统上执行或进入到命令行界面执行启动数据库服务执行退出命令行界面执行启动监听服务注意通过远程客户端连接服务端必须要启动监听服务否则客户端连接不上命令行界面下还可以使用停止数据库服务容器数据库容器数据库和可插拔数据库是引入的一种特性它允许在容器数据库中创建并维护多个数据库这个特性的优点之一是可以在一个数据库服务器上创建多个独立的数据库每个在中是相互独立存在的这样可以更有效地利用服务器资源避免浪费此外根容器数据库的主要作用就是容纳所有相关的元数据以及在中对现有进行管理没有容器数据库的概念容器数据库是环境中的根数据库在根数据库中含有主数据字典视图其中包含了与容器有关的元数据和中包含的所有信息在环境中被标识为每个环境中只能有一个容器数据库为的种子其中提供了数据文件在环境中被标识为是创建的模板可以连接但是不能执行任何事务因为是只读的不可修改数据库在环境中每个都是独立存在的与传统数据库无差别每个拥有自己的数据文件和唯一的区别就是可以插入到中以及从中拔出当用户连接到时不会感觉到根容器和其他的存在容器数据库基本操作查看当前数据库下有哪些查看当前连接的是哪个数据库数据库名切换数据库等等点击跳转详解登录数据库服务本机登陆普通用户身份登陆用户名密码如以管理员身份登陆此处不用输入密码在安装的时候已经输入密码自带两个用户用户是数据库的超级用户它拥有最高权限可以执行任何操作用户拥有所有的数据字典表和视图这些对象都存储在模式下通常情况下不建议使用用户进行日常操作因为它拥有非常高的权限可能会对数据库造成不可逆的影响用户也是一个具有高权限的用户它主要用于执行数据库管理任务与用户不同的是用户并不拥有所有的数据字典表和视图它只能访问那些授权给它的对象通常情况下可以使用用户来执行一些日常的数据库管理任务远程登陆远程通过网络登陆数据库需要安装客户端软件并进行配置才能使用可通过使用进行配置配置完成之后可以使用连接字符串进行登陆连接字符串中包含了数据库服务的地址和端口以及实例名注意安装客户端的时候安装路径中不能出现中文和空格安装的时候选择管理员模式普通用户登陆用户名密码连接字符串如管理员用户登陆此外还可以执行地址实例名进行登陆使用用户或者用户登陆完之后可以使用测试一下如果显示用户名就表明已经登陆成功了或者是执行进行一次查询有结果显示就表名已经登陆成功了相关命令解锁用户管理员身份登陆给用户解锁用户默认锁定锁定用户必须用管理员用户登陆修改用户密码新密码管理员身份登陆给用户修改密码修改用户密码也可以直接新密码用户本身修改自身密码的话可以省略查看当前语言环境加锁后对应加锁的用户就不能登录了解锁后该用户才能登录创建案例脚本创建表空间注意表空间的路径根据实际安装环境进行调整创建方案创建用户资源和登录权限创建网点信息表编号名称描述授权码状态可用不可用网银中心北京金融街号月广东分中心广州天河金融月创建网点密钥表客户端网点服务器端网点密钥号密钥产生时间密钥状态创建索引在新的表空间上序列号创建交易信息表交易者交易时间交易事件交易描述什么人在什么时间干了什么事创建索引创建触发器自增字段月创建网银总节点测试数据停止创建新用户方案通过来访问数据库让管理终端系统用和和的区别是语言关键字不能缩写是提供的工具可在里面执行语句它配有自己的命令特点是缩写关键字常用命令显示当前用户查看当前用户下的表数据字典记录数据库和应用程序源数据的目录包含当前用户下的表查看员工表的结构描述设置行宽设置页面或者将上述两行写入如下两个配置文件可永久设置设置员工名列宽表示字符串设置薪水列为位数子一个表示一位数字若想将显示结果保存到文件中或者命令打开文件来编写语句注意语句末尾不要加然后换行加上表示结束修改日期格式日期格式默认为修改日期格式方式为查看当前会话使用的日期格式开关显示的执行时间表示重复刚刚执行过的语句脚本路径或脚本路径可以运行脚本开关回显管理员创建用户用户名密码创建用户刚创建的用户连连接数据库的权限都没有用户名一般都要赋予最基本的连接数据库权限和访问资源的权限赋予对表空间的权限数据库用户名语言的类型数据库中称呼增删改查为语句数据操纵语言就是指代这四个操作语句数据定义语言如截断清空一张表表视图索引序列同义词语句数据控制语言如提交回滚数据库对象数据库对象共有个分别是表视图索引序列同义词存储过程存储函数触发器包包体数据库链路快照常见的数据库对象表基本的数据存储集合由行和列组成视图从表中抽出的逻辑上相关的数据集合序列提供有规律的数值索引提高查询的效率同义词给对象起别名表基本的数据存储集合由行和列组成表名和列名遵循如下命名规则必须以字母开头必须在个字符之间必须只能包含和必须不能和用户定义的其他对象重名必须不能是的保留字默认存储是都存为大写数据库名只能是位可以是位和其他一些特殊字符创建表关键词创建一张表必须具备的权限存储空间的作用是当向表中插入数据的时候没有指定时间的时候使用默认值创建表时列所使用的数据类型中的表示可变长的最大值中的表示数值的总长度表示小数点长度为为行地址伪列看到该列存储的是一系列的地址指针创建索引用注意子句的格式中后面后的表达式要取别名语法要求相关语法参考批处理标题修改表关键词追加一列向表中加入新列类型是修改一列将列的大小由删除一列将刚加入的新列删除重命名一列将列重命名为注意若是修改表的字段的长度若是增加长度没有问题若是减少字段的长度有可能会报错修改表名原表名新表名删除表关键词当表被删除数据和结构都被删除所有正在运行的相关事物被提交所有相关索引被删除语句不能回滚但是可以闪回查看当前用户下有哪些表拷贝保存表名将测试保存点的表删除再次查询跟刚刚保存的表名比对少了但多了另外一张命名复杂的表的回收站查看回收站命令那个复杂的命名即是在回收站中的名字清空回收站将表从回收站闪回注意并不是所有的用户都有回收站对于没有回收站的用户管理员来说删除操作是不可逆的两种删除方式删除的表可以闪回的作用删除不经过回收站删除的表不可以闪回表的约束表的约束有种关键词检查值是否符合预设的规则比如性别只能男或女非空唯一不能重复主键非空唯一外键取值必须在另外一个表中存在注意设置外键的目标必须是父表的主键修改表增加主键约束中设置约束学生主键约束学生姓名非空约束学生邮件唯一约束同时邮件可再设非空没有学生年龄设置约束男女学生性别设置约束学生部门号设置外键上述代码中设置了删除了表中的某个后表中的所有那个值的的全部设置空如果不加则删除表中的值会报错除非删除行的值在表中不存在外键的删除相关级联删除主表记录删除的时候子表引用了该字段的数据跟着删除设置为主表删除的时候子表该字段设为默认方式主表删除的时候如果子表引用了该字段的数据不能删除要先删子表通过定义外键的时候可以用如下参数多数情况下使用这种方法检查性约束格式条件违反检查约束插入报错违反检查约束条件定义约束时没有显式指定名字系统会默认给一个名称建议创建约束的时候自定义一个含义清晰的约束名使用该关键字来给约束起别名查看指定表的约束注意上面位置的表名必须大写视图视图是一种常见数据库对象它是从表中抽出的逻辑上相关的数据集合视图基于表视图是逻辑概念视图本身没有数据使用视图的好处可以简化查询将视图看做是表的复杂的一种封装可以限制用户对某些数据的访问注意建议不要通过视图去修改表的数据即使不是只读视图视图相关操作创建视图视图名查询语句创建视图需要权限创建只读视图视图名查询语句要符合视图创建时的条件才能修改原数据创建或更新视图视图名查询语句不能单独使用查看所有已创建的视图删除视图视图名创建视图需要权限添加权限步骤使用管理员登陆给用户增加权限关键词可以撤销权限视图中使用的规定一当视图定义中包含以下元素之一时不能使用组函数子句关键字伪列二当视图定义中包含以下元素之一时不能使用组函数子句关键字伪列列的定义为表达式三当视图定义中包含以下元素之一时不能使用组函数子句关键字伪列列的定义为表达式表中非空的列在视图定义中未包括总结一句话不通过视图做操作因为视图提供的目的就是为了简化查询索引索引相当于书的目录提高数据检索速度提高效率视图不可以提高效率一种独立于表的模式对象可以存储在与表不同的磁盘或表空间中索引被删除或损坏不会对表产生影响其影响的只是查询的速度索引一旦建立管理系统会对其进行自动维护而且由管理系统决定何时使用索引用户不用在查询语句中指定使用哪个索引在删除一个表时所有基于该表的索引会自动被删除通过指针加速服务器的查询速度通过快速定位数据的方法减少磁盘使用索引注意点使用索引的列值的分布要广泛重复的概率非常低唯一最好索引的原理若一个表有索引则会在内部维护一个索引表查询的时候要使用索引的列优先会到索引表中去查通过索引的列找到对应的行地址找到行地址就可以找到数据索引表中的列的值是有序的使用主键查询数据最快速因为主键本身就是唯一索引所以检索比较快的数据库中索引有树索引默认和位图索引两种推荐创建索引的三种情况列中数据值分布范围很广列经常在子句或连接条件中出现表经常被访问而且数据量很大访问的数据大概占数据总量的到下列情况不要创建索引表很小列不经常作为连接条件或出现在子句中查询的数据大于到表经常更新对索引的理解可以理解为系统自动维护的一张顺序表加快了他查询的速度索引的操作查看所有已创建的索引创建索引索引名表名列名列名创键唯一索引索引名表名列名列名唯一索引要求列值不重复删除索引索引名索引的种类未完待续序列可以理解成数组默认从开始长度在内存中由于序列是被保存在内存中访问内存的速率要高于访问硬盘的速率所以序列可以提高效率序列的用处主要用于插入主键并保证他的非空和唯一性序列的操作创建序列序列名删除序列序列名显示所有已创建序列序列的使用初始状态下指针指向前面的位置欲取出第一个值应该将指针向后移动每取出一个值指针都向后移常常用序列来指定表中的主键创建序列的完整格式步长起始值最大值最小值序列是否循环序列的项个数默认个表示没有缓存一次不产生个而只产生一个序列的两个属性当前值下一个值必须在之前被指定因为初始状态下指向前面的位置无值对于新创建的序列使用得到出错但可以得到序列的第一值此时再执行的值也得到只有取完会向后移动使用不会移动使用时按如下方式插入序列值修改序列必须是序列的拥有者或对序列有权限只有将来的序列值会被改变改变序列的初始值只能通过删除序列之后重建序列的方法实现使用序列需要注意的问题序列是公有对象所以多张表同时使用序列会造成主键不连续回滚也可能造成主键不连续如多次调用操作使用序列创建主键但是当执行了后再次使用借助序列创建主键的时候不会随着回滚操作回退掉电等原因也可能造成不连续由于代表序列的数组保存在内存中断电的时候内存的内容丢失恢复供电时候序列直接从开始插入失败的情况但序列的值已经取了此时的情况也会造成主键不连续同义词同义词就是指表的别名使用场景用户想访问用户下的表默认是不能访问的需要用户为用户授权或已登录界面切换登陆用户为用户开放了表的查询权限授权这时用户就可以使用语句来查询用户下的表的信息了若用户名叫则名字过长为了方便操作用户为它重设别名同义词为创建了同义词创建同义词需要权限管理员添加设置同义词权限操作如下使用同义词进行表查询操作同义词视图等用法在数据保密要求较高的机构使用广泛如银行机构好处是既不影响对数据的操作同时又能保证数据的安全同义词的操作创建同义词同义词名想设置的别名表名删除同义词同义词名查询所有已经创建的同义词插入相关关键字格式如下案例插入全部列插入部分列没有写出的列自动填符号的使用使用会让用户输入值符号可以用于所有语句中供用户输入并不仅仅是插入语句批处理拷贝表结构不拷贝数据通过这个必定错条件不让数据拷贝过去不能省略拷贝表拷贝数据不能省略批量插入修改相关关键词格式表名值对于更新操作来说一般会有一个条件如果没有这限制条件更新的就是整张表危险案例删除相关关键词格式表名注意如不加会将整张表的数据删除危险关键字在中可以省略不写但中不可以但在使用的时候建议还是加上案例也可以清空一张表但留下表结构和的区别逐条删除表内容先摧毁表再重建由于使用频繁对优化后快于不能加条件只能整张表删除是语句是语句语句可以闪回语句不可以闪回闪回做错了一个操作并且了对应的撤销行为了解由于是逐条操作数据所以会产生碎片不会产生碎片同样是由于对进行了优化让不产生碎片两个数据之间的数据被删除删除的数据碎片整理碎片数据连续行移动不会释放空间会释放空间用删除一张的表空间不会释放而会所以当确定表不再使用应可以回滚不可以回滚查询相关基本语句下面所有说法均以此图为案例语句的整体形式中关键字不区分大小写语法格式为字符和日期要包含在单引号中转义单引号本身使用两个单引号来完成转义去重表示去重查看不同部门的不同工种的作用范围是作用于后面出现的所有的列名和表达式有别于升降序是针对单个最近的列名上面的例句中不会出现重复的和的组合表达式后可以接列名或表达式年薪年收入包含值的表达式都返回为空因此所有为空的年收入也为空解决方案如下年薪年收入表示如果为空则当成处理滤空函数参考别名后接的列名或表达式或后接的表名多表查询可以起别名关键词工资奖金年薪注意可以省略如果别名中间有空格需要使用引起来不加双引号英语别名统一显示为大写别名不能在中直接替代表达式和列名使用过滤使用关键词过滤出需要的数据行比较运算符等于不是大于大于等于小于小于等于不等于也可以是介于两值之间闭区间包含两边的值过滤为空的数据不能使用不正确过滤为空的数据过滤不为空的数据和的这两个条件都返回假不管他是什么值集合运算符等于列表中的任意一个和集合返回的任意一个值比较配合子查询使用和集合返回的所有值比较配合子查询使用在集合中不在集合中等同于等同于的注意点参考模糊查找模糊查询匹配任意多个字符匹配一个字符使用表示转义字符下面案例有使用方式转义单引号本身使用两个单引号来完成转义逻辑运算逻辑并优先级依次往下逻辑或逻辑非小括号可以调整优先级优化在解析的时候是从右至左解析的所以时应该将易假的值放在右侧时应该将易真的值放在右侧案例月日期格式要与查询的时候一样日期格式默认是查询员工首字母为的员工信息查询员工编号为开头的员工信息查询员工姓名为个字母长度的员工信息查询员工姓名包含下划线的员工信息后接的字符表示他是转义字符重点后接的字符表示他是转义字符注意表中的列的值是区分大小写的但关键词不区分大小写排序关键词基本格式表达式序号序号表示后面出现的次序从开始子句在语句的最末尾是对查询的最后的结果进行排序使用子句排序升序默认采用升序方式降序员工信息按入职日期先后排序可以省略查询员工信息按奖金逆序查询员工编号员工姓名和工资按照序号工资进行排序注意在排序中表现为无穷大可以使用使的信息放到最后多元素排序对多个元素进行排序时优先排序第一个元素仅在第一个元素相同时对第二个元素进行排序以此类推分组分组数据使用关键字可以配合分组函数使用按照后给定的表达式将后面的进行分组针对每一组使用组函数即先分组再分组统计过滤部分数据可写可不写注意后面存在没有出现在分组函数中的列名一定要出现在子句中不然会报错常数可以不出现在子句中因为分组数据会限制行数如果出现了别的列名那么这一组的别的列名的值会出现多个但只能显示一行显然就冲突了案例统计各个部门的平均工资统计各个部分不同工种的平均工资按照的组合来分组分组函数过滤只有使用关键词才能对分组函数进行过滤不能用注意必须配合使用不能单独存在后面不能使用别名可以可以使用函数不能在中使用组函数可以在中使用组函数分组的情况下和均可以对非分组函数进行过滤下面两句效果一致分组函数过滤案例查询平均薪水大于的部门优化在子句中没有使用组函数的情况下都可以应该怎么选择优化尽量采用如果有分组的话是先过滤再分组而是先分组再过滤当数据量庞大如亿条优势明显单行函数单行函数只对一行进行变换产生一个结果函数可以没有参数但必须要有返回值操作数据对象接受参数返回一个结果只对一行进行变换每行返回一个结果可以转换数据类型可以嵌套参数可以是一列或一个值字符函数小写大写单词的首字母大写连接符函数只能连接两个字符串若想连接三个的话只能嵌套调用可以连接多个字符串建议使用来连接字符串截取字符串从位置开始截取个注意是从开始的若为表示从开始截取到最后若为负数表示从末尾倒数开始截取判断是否在中存在若存在返回第一次出现的位置若不存在则返回和返回长度的字符串如果不够的话在左右填充这个字符去掉字符串首部和尾部的空格中间的空格不去掉也可以去掉中的字符将字符串中的字符串替换成字符串和字符数字节数注意对于函数一个汉字是一个字符对于函数一个汉字占两个这两个函数对于普通字符串没有什么区别数值函数四舍五入对这个数值四舍五入保留小数点后位截取对这个数值截取小数点后位前的内容对取余对向上取整对向下取整转换函数显示转换借助数据格式函数来完成转换注意如果隐式显示都可以使用应该首选显示这样可以省去的解析过程函数功能将或类型转换成字符串类型案例查询员工的薪水使用位小数本地货币代码千位符特别注意之间没有空格参考的格式在屏幕上显示如下字符串今天是星期一今天是说明在固定的格式里加入自定义的格式是可以的必须要加函数功能将字符串转换成类型案例将转化成数字转成数字函数功能将字符串转换成类型已知字符串今天是星期一转化成日期今天是星期一今天是求年月日入职的员工信息月的格式格式不区分大小写格式说明举例年份的后两个数字年的英文全称月份两位数字月的全称月星期几星期一星期一位数字的小时制的小时数位数字的分钟数位数字的秒数时间和日期函数当前的系统时间如日期型加一天日期和日期可以相减表示相隔多少天但是不允许相加两个日期相加没有意义报错不允许日期日期日期只能和数字相加上面方式如果计算月差年差周差等可以分别除以但这样计算显然是不精确的如下日期函数才来精确计算计算的月差日期增加个月日期的这个月的最后一天星期一日期的下一个星期一日期按月份四舍五入过了一半就加没过一半就不加日期按年份截断月份和日数归最小按月截断的话表示日数归最小通用函数这些函数适用于任何数据类型同时也适用于空值滤空函数如果为返回滤空函数如果为返回否则返回当时返回不相等的时候返回值找非空值函数从左向右找参数中第一个不为空的值分组函数分组函数也称之为组函数或者聚合函数提供的常用的有个函数操作的是一组数据返回一个结果可以配合分组数据使用后同时存在分组函数和非分组函数的情况下必须配合分组数据使用列名或计算行数滤空表示只要有值都算列名表示按照该列名算行数显示工作总数去重才能计算到工作总数列名求平均列值滤空注意等同于滤空而非不滤空前者是有奖金的人的奖金平均值后者是全部人平均奖金的值列名求列值最大值滤空列名求列值最小值滤空总和求列值总和滤空总结分组函数自带滤空功能可以通过函数去掉分组函数的滤空功能如下注意点和的区别只要一行中有一个字段不为空就被统计上只有不为空才会被统计上注意不能使用会报错应该写成某个表的具体的列条件表达式与条件函数在中无法实现逻辑当有这种需求的时候可以使用或者条件表达式是一个表达式其语法为上面代码解释根据列名或表达式来判断后面的为判断值如果该值则返回表达式后接没提到的情况的返回值案例老板打算给员工涨工资要求总裁涨经理涨其他人涨请将涨前涨后的薪水列出涨前薪水涨后薪水函数是一个函数其语法为除第一个和最后一个参数之外中间的参数都是成对呈现的参条件值条件值条件值尾参案例题目与效果图等同于条件变量案例涨前薪水涨后薪水多表查询只要后出现多表重复存在的列名则需要标识列名属于谁如否则报错未明确定义列笛卡尔积两个表的笛卡尔积两个表的项之间组合的所有可能的集合笛卡尔积的行数的行数的行数笛卡尔积的列数的列数的列数笛卡尔积中包含不正确的无用数据上图中很显然左表黄和右表绿的匹配会出现不相等的情况即无效数据添加图中连接条件可以去除无效行多表查询就是按照给定条件连接条件从笛卡尔全集中选出正确的结果连接条件等值连接不等值连接外连接自连接等值连接只返回满足连接条件的数据两边都有的才显示子句后面的条件是为等值连接不等值连接子句后面的条件不是为不等值连接外连接按部门统计员工人数显示部门号部门名称人数虽然显示了如上结果但因为缺失了号部门右外连接右边显示全写法与叫法相反左外连接左边显示全写法与叫法相反左外连接和右外连接效果完全一样只是顺序不同重点符号加在哪就看两边的行数想要显示全就在另一边加上该符号自连接核心通过表的别名将同一张表视为多张表查询员工信息的老板是的老板是由于没有老板所以可以使用外连接的方式把也显示出来的老板是没有子查询子查询语法很简单就是语句的嵌套使用即嵌套语法格式主查询的后都可以放置子查询如下查询工资比高的员工信息查出的工资结果为查询比高的员工通过两步可以将问题结果得到子查询可以将两步合成一步写一个较复杂的子查询的时候要合理的添加换行缩进主查询的后都可以放置子查询强调在后面放置的子查询后面放置是一个集合表查询结果一般不在子查询中使用但在分析问题中必须使用子查询可以放在后但要求该子查询必须是单行子查询该子查询本身只返回一条记录叫多行子查询单行子查询只能使用单行操作符多行子查询只能使用多行操作符后子查询案例参考第一个例子后子查询案例查询号部分员工号员工姓名部门编号部门名称此处的子查询后必须是单行子查询后子查询案例查询部门平均工资高于号部门平均工资的部门和平均工资后子查询案例查询员工的姓名薪水和年薪要求格式为姓名薪水年薪多行子查询子查询返回条记录以上就叫多行多行操作符有等于列表中的任意一个和子查询返回的任意一个值比较和子查询返回的所有值比较案例查询薪水比号部门任意一个员工高的员工信息单行子查询方式实现多行子查询方式实现查询薪水比号部门所有员工高的员工信息单行子查询方式实现多行子查询方式实现单行子查询单行子查询就是该条子查询执行结束时只返回一条记录一行数据使用单行操作符或者子查询中判断一个值等于不等于空不能使用和号而应该使用和特别注意如果集合中有值不能使用如但是可以使用用等于号与不等于号和做比较都返回假值返回假值返回假因为操作符等价于最后一个表达式为假整体假而等价于只要有一个为真即为真操作符等价于子查询优化一般情况下子查询使用或是不使用对主查询来说没有什么意义子查询的结果给主查询当成集合来使用所以没有必要将子查询但在分析问题中必须使用优化理论上既可以使用子查询也可以使用多表查询尽量使用多表查询子查询有次与数据库服务的交互多问题指排名前相关的问题解决问题使用了一个关键词行号的生成是在集合第一次产生的时候就生成了可以将查询的结果看成一个表来用通过子查询排序的方式得到一个临时表在外部查询中按照来区分排名参考如下案例查询表中工资在的员工信息排名讲解二级子查询中子集合中的不是列名的话不能在上级查询中被作为筛选条件解决方式是给提供一个别名再多加一层子查询使最外部查询中的别名成为一个列名以此参与筛选结果集合运算集合运算的操作符和的区别会去掉重复的而会全部显示集合运算注意点参与运算的各个集合必须列数相同且对应每个列的类型一致不然会报错类型不一致或列数不同采用第一个集合的表头作为最终使用的表头可以使用括号先执行后面的语句案例按照部门统计各部门不同工种的工资情况要求按如下格式输出照集合的要求必须列数相同类型一致所以写法如下使用强行占位优化集合运算的性能一般较差一些尽量使用列名用列名代替之前不同之后一样可以作为列名在后使用表示当前日期如果后面不来源于任何表可以使用伪表综合案例查询部门工资大于本部门平均工资的员工信息先查询号部门使用子查询推广到所有部门其实就是换成上述是一种解决方案也可以使用多表查询从表中查询结果显示如下的格式如下函数跳转事务数据库事务是由有限的数据库操作序列组成的逻辑执行单元这一系列操作要么全部执行要么全部放弃执行数据库事务由以下的部分组成一个或多个语句一个数据定义语言语句一个数据控制语言语句事务的特点要么都成功要么都失败事务的特性原子性一致性隔离性持久性原子性事务中的全部操作在数据库中是不可分割的要么全部完成要么均不执行一致性几个并行执行的事务其执行结果必须与按某一顺序串行执行的结果相一致隔离性事务的执行不受其他事务的干扰当数据库被多个客户端并发访问时隔离它们的操作防止出现脏读幻读不可重复读持久性对于任意已提交事务系统必须保证该事务对数据库的改变不被丢失即使数据库出现故障事务的流程事务的起始标志中自动开启事务以语句为开启标志执行增删改查语句只要没有提交和回滚操作都在一个事务中事务的结束标志提交回滚都是事务的结束标志提交与回滚提交显示提交隐式提交任何语句如除了创建表之外还会隐式提交之前所有没有提交的语句正常退出回滚显示回滚隐式回滚掉电宕机非正常退出控制事务保存点可以防止错误操作影响整个事务方便进行事务控制设置保存点回滚到保存点主要用于在事务上下文中声明一个中间标记将一个长事务分隔为多个较小的部分和我们编写文档时习惯性保存一下一样都是为了防止出错和丢失如果保存点设置名称重复则会删除之前的那个保存点一旦之后所有的将失效回滚的操作会将回滚过程中的设置保存点行为也回滚掉隔离级别对于同时运行的多个事务当这些事务访问数据库中相同的数据时如果没有采取必要的隔离机制就会导致各种并发问题脏读对于两个事物读取了已经被更新但还没有被提交的字段之后若回滚读取的内容就是临时且无效的不可重复读对于两个事物读取了一个字段然后更新了该字段之后再次读取同一个字段值就不同了幻读对于两个事物从一个表中读取了一个字段然后在该表中插入了一些新的行之后如果再次读取同一个表就会多出几行数据库事务的隔离性数据库系统必须具有隔离并发运行各个事务的能力使它们不会相互影响避免各种并发问题一个事务与其他事务隔离的程度称为隔离级别数据库规定了多种事务隔离级别不同隔离级别对应不同的干扰程度隔离级别越高数据一致性就越好但并发性越弱定义中隔离级别读未提交数据读已提交数据默认可重复读默认序列化串行化查询也要等前一个事务结束支持的隔离级别默认和以及自定义的三种由于大多数情况下在事务操作的过程中不希望别人也来操作但是如果将别人的隔离级别设置为串行但是单线程会导致数据库的性能太差是应该允许别人来进行操作的开发开发需要使用库下开发需要先下载开发包具体操作参考此链接下下载安装包有自带通过查找调用接口即是的允许你使用面向对象的特性本地类语言的方法来访问数据库介绍优势基于标准和面向对象的设计效率较高适合开发模式的程序软件中间层特性完整支持为不断增长的用户和请求提供弹性选项为使用用户自定义类型如中的类提供了无缝接口支持所有的数据类型以及大对象可以访问数据库元数据项目配置头文件程序中只需要包含这一个头文件库文件或或前者为模式时使用名字末尾带的后者为模式时使用库文件路径头文件路径下的环境配置用户下进行配置将文件上传到操作系统的目录下执行解压至当前目录下进入到刚刚解压的目录打开看我看我将文件中的导出的环境变量拷贝到用户的文件中注意若解压的目录不是环境变量中的路径需要修改执行或者或者退出再次登录使配置的环境变量生效可以执行进行查看若看到内容则设置成功可以设置远程服务器切换到目录下打开文件修改其中的部分将修改成实际的服务的地址测试代码上传到用户下然后执行编译通过表明设置的没有问题若执行报错查看一下代码中的的用户名和密码是否正确常见的几个环境变量命令或者可执行程序搜索的路径编译器查找头文件的路径编译器查找头文件的路径查找动态链接库的路径查找静态库的路径用户安装了服务系统本身就有编程需要的库文件和头文件程序编译时搜索的库目录程序编译时搜索的头文件目录上面的环境变量中和与在中的配置不同其余相同使用开发流程初始化类通过创建一个的对象完成初始化工作可以通过创建数据库连接从而进行其它的操作要创建应该调用类的静态方法初始化环境返回表示失败关闭环境连接数据库类第一个参数用户名第二个参数密码第三个参数数据库连接串地址端口号数据库服务名连接数据库通过类的对象实例实现调用类的方法可以创建一个对象使用断开连接函数调用用户名密码数据库连接串断开连接执行类用于执行语句并获取返回结果类用于处理查询的结果对于所有类型的数据的绑定或者获取都提供了统一的方法方法用于方法用于会自动处理类型之间的转换使用方法使用创建对象指定命令作为参数常用操作函数如果上面函数未传参则可调用该函数也可不调用该参数直接调用下面的各种函数传参它会返回一个布尔值指示是否可以检索对象如果返回值为则可以使用方法获取查询结果注意该函数不能执行查询返回值表示受影响的行数结果集该函数才能执行查询针对上一个函数通哟的函数遍历每个查询到的行等函数通过传参获取每行的每一项使用方法传递要绑定用于输入的值使用合适的方法执行对于查询使用对象处理返回结果执行插入的案例插入操作关闭查询释放资源使用绑定参数的数据操作语句示例简易案例初始化连接环境创建连接是的默认端口是建立连接之后得到的对象捕获到异常连接失败数据库连接成功创建一个用户操作对象可以给这个函数指定语句也可以不指定如果没有指定执行的可以通过方法指定执行语句取出所有的记录每循环一次读一条记录读出这条记录的三个字段释放资源编译命令为执行返回结果为数据库连接成功在使用多线程访问服务器的时候会出现错误错误信息如下该错误会导致进程终止修改方案如下使用命令所有服务器端的文件在文件中添加下配置项如果该问题还未解决在调用接口的客户端对应目录中例如我的客户端对用的目录为在该目录下的中添加文件内容如下瑞典公司开发由收购而后被甲骨文并购目前属于公司是一种关联数据库管理系统由于其体积小速度快总体拥有成本低软件采用了双授权政策分为社区版和企业版部分系统用不了但没有这个问题版本及下载数据库版本相对比较繁杂常见的有社区版企业版版是开源免费的这也是我们通常用的的版本可以满足绝大多数用户需求版官方指出提供天免费试用期可进一步划分为标准版企业版集群版官方提供付费服务其中可以直接从的官网下载但只能从上下载而有时会屏蔽中国下载时注意区分版本细节及所应用的系统平台是指软件的通用版本一般指正式发布的版本精简版如果只需要服务就选择此版本完整版包含安装程序和配置向导有文档是非安装的压缩包没有自动安装程序和配置向导无安装向导是用于的源码压缩包默认情况下都会有卸载演示如何卸载在终端提示符输入命令查询是否安装卸载旧的版本操作软件包名不理会依赖关系删除所有上一步查出来的相同的将老版本的几个残留文件手动删除安装演示如何安装解压安装包得到如下软件包下面三个必装下面可选可以参考安装服务器第一次安装会自动生成一个文件文件内含的用户的密码因此必须在第一次连接的时候修改此处的密码配置安全选项默认配置设置文件在可以编辑这个文件改变服务器设置安装客户端说明不安装是不能使用工具登陆到数据库修改密码将密码设置为安装下安装无初始密码设置的初始密码这个命令设置安全配置向导是否建立密码验证插件用以验证密码强度首次运行则会要求输入并确认密码设置过第步的初始密码则会提示是否修改密码如果遇到以下报错请先执行上面第步的设置初始密码是否删除匿名用户是否禁止远程登陆是否删除数据库刷新权限给账号开放所有权限检查服务状态服务的启动停止重启启动服务停止服务重启服务如果要安装客户端和开发组件要分别执行下面语句卸载位下面以为例安装流程及配置初始用户及授权远程连接流程如下在目录下新建目录将下载到的解压到目录进入目录里并新建一个文件文件内容如下注意不能有头高危坑点的记事本只要打开编码格式的文件就会自动添加头而头不识别设置为自己的安装目录设置为的数据目录开启查询缓存某些系统版本需要开启这项确定需要第一次启动打开这行一定放在末尾可以免密登陆方便登录设置密码管理员身份运行命令在路径下以管理员执行进入目录执行安装命令执行初始化命令启动服务这里如果报错无法启动此程序因为计算机中丢失尝试重新安装该程序以解决问题解决方案装运行由于之前我们设置登入无密码当系统提示需要输入密码时直接按回车键此时会显示直接回车此时会进入输入下面的三条命令来设置密码设置用户的密码为表示只有在本地连接时才使用此密码如果是远程连接则需要另外设置密码修改用户的密码过期时间为永不过期刷新权限使设置生效将目录下的文件里面的最后一行通过使用注释掉退出重启服务客户端用户可能无法访问服务器因此需要开启远程连接权限这里显示输入上面设置的密码将用户表中用户名为主机为的用户的主机改为表示允许该用户从任何主机连接查看效果这句可以不输然后重启服务进入刷新权限设置各种问题盘点记事本不能使用可以使用修改打开后右下角是不是就没问题或者使用保存文件时选择选项如果因为任何的原因导致启动失败报错但是当你想或的时候会一直提示服务正在启动或停止中请稍候片刻后再试一次解决方案为任务管理器强杀进程然后就可以正常或了如果报错无法启动此程序因为计算机中丢失尝试重新安装该程序以解决问题解决方案装位找选项安装参考链接的基本操作用户名密码进入本地命令行若想进入远程数据库需要使用参数指定远程主机地址退出登录在中您可以使用语句创建新用户创建新用户的基本语法如下其中是您要创建的用户的名称是用户可以连接的主机可以是特定的地址或通配符例如表示任何主机而是新用户的密码创建用户后您需要为他们授予适当的权限以便他们能够访问和操作服务器上的数据库和表这可以使用语句完成例如要将所有权限授予数据库中的用户您可以使用以下命令需要注意的是创建用户后您必须刷新权限以反映所做的更改方法是运行数据库对数据库进行增删改查操作注意中数据库名和表名都区分大小写组织结构是先有库库下是用户用户下再有表是先有用户用户下是库库下是表操作盘点显示已有的所有数据库显示建数据库的语句数据库名新建数据库数据库名创建字符集为的数据库数据库名创建字符集为并会对存入的数据进行检查是否格式的数据库数据库名如果不存在才新建数据库数据库名删除数据库数据库名修改数据库字符集不能修改数据库名数据库名进入数据库数据库名查看当前使用的是哪个库或脚本文件路径用该命令执行上面的脚本文件点击参考显示索引是表名默认情况下反引号括起来的字符串区分大小写表的表操作和是几乎一样的只有数据类型不一致跳转方便对比的表的数据类型附加说明位可以指定位数如字节可以指定最大位数如最大为位的整数个字节可以指定最大的位数和最大的小数位数如最大为一个位的数小数位最多位个字节可以指定最大的位数和最大的小数位数如最大为一个位的数小数位最多位必须指定字符数如为不可变字符即使存储的内容为也是用个字符的空间存储这个数据必须指定字符数如为可变字符如果存储的内容为占用个字符的空间如果为则占用个字符的空间大文本大字符串二进制大数据如图片音频文件视频文件日期如日期时间如时间戳自动赋值为当前日期时间在中显示多行数据应该在查询语句结尾处添加或来替换结束标记创建表查看当前选择的数据库中的表查看表结构查看创建表的语法更改表名增加一个字段关键字在中添加则语法错误修改一个字段删除一个字段修改表的字符集删除表注意删除表不能使用数据的操作和是一样的查询名字月薪年薪修改也是一个中牛王五删除王五插入张三一个大牛的分组查询注意点在数据库中后面不可以使用别名可以使用别名别名若是中文不要加正确的总分总分正确的总分总分错误的总分总分显示尽量使用英文别名的问题中的问题比较复杂而中很简单关键词在查询中经常要返回前几条或者中间某几行数据时用到参数说明指定第一个返回记录行的偏移量即从哪一行开始返回注意初始行的偏移量为返回具体行数如果后面是一个参数就是检索前多少行如果后面是个参数就是从行开始检索行记录案例将成绩从小到大排序求成绩在名的学生的信息中的函数日期时间函数里面时间分为三类时间日期时间戳含有时分秒的在中使用必须加小括号等同于同理等同于同理等同于等同于函数用法参考函数用法参考是关键词不能缺少上述语句中的函数名不区分大小写也可以用大写函数用法参考日期格式函数日期转字符串根据字符串安排值的格式以下说明符可用在字符串中案例数学相关函数将从进制转换成进制为将保留小数点后两位为求余为函数一般用还有三角函数指数等等的一大堆数学函数字符串相关函数连接字符串在不可以使用但的函数可以连接多个字符串会替换所有符合的字串相等返回小于返回大于返回的可以为负数表示倒数第几个位置开始转换函数日期转字符串函数字符串转日期函数滤空函数不支持函数取而代之是函数用法与函数一致注意中有一个通用函数与中的函数名字相近如当时返回不相等的时候返回值中函数也存在的多表查询准备数据新建文件用该命令执行上面的脚本文件得到原始数据交叉连接相当于的笛卡尔积关键词内连接对应中的等值连接只返回满足连接条件的数据两边都有的才显示写法关键词可以省略写法区别盘点外连接左外连接左边有值才显示与的左外连接仅仅是写法不同含义一致关键词可省略右外连接右边有值才显示与的右外连接仅仅是写法不同含义一致关键词可省略即可知中外链接取值与关系表达式号左右位置无关取值跟后表的书写顺序有关案例统计各个部门员工总人数要求显示部门名称自连接案例查询员工老板信息显示的老板是的老板是自己满外连接任一边有值就会显示在中没有对应关键词可省略表的约束定义主键约束不允许为空不允许重复定义主键自动增长从开始即使插入不填或者手动填也会从开始自动增长给数定义唯一约束定义非空约束定义外键约束注意约束在中语法保留但没有效果案例中文乱码问题查看所有应用的字符集关于和其主要区别在于和即最多使用个字节来表示个字符所以当使用时可以表示更多字符例如生僻汉字冷门符号表情符号等指定字符集登录数据库默认是上面语句如果不是和插入时登录数据库使用的同一个字符集就会中文乱码如果使用菜单中的中可以设置设置工具的字符集如果未设置为也会显示乱码操作系统的语言集下查看字符集下查看字符集返回显示表示环境变量操作系统的菜单按照显示文件存储按照操作系统本身不是也会乱码总结使用哪种字符集插入的数据就要用哪种字符集去查看操作系统本身必须支持中文的显示客户端工具若不支持中文显示也会显示乱码访问服务器这需要使用库的大多数客户端除和都是通过这个库来和服务器通讯的而这个库正是使用语言编写的可使用命令查看当前系统内所使用的数据库版本信息客户端使用库内部的函数访问服务器因此我们在编程过程中如若使用到库内的函数必须链接函数库对应的要找到头文件所在目录位置函数库路径以便我们在使用编译工具时可以填充参数从手册中可获知函数库名为因此我们使用命令或下需要下载支持查找该库的路径得到命令可查看库内包含的函数链接使用该库用到头文件可使用查看其目录位置编译引用库的应用程序如果链接出错原因是某些位环境下动态库配置不完整需手动指定编译所用的动态库根据错误提示分析需要加入如下函数库使用相关的环境完成用一个程序加载其他动态库的作用线程库是中对的支持库使用命令可以查看该可执行文件运行所依赖的库文件常用函数程序员需要访问数据库时可以有个选择一个是纯的的另外一个是这个库前者是的开发小组所维护的其实现代码是源代码的一部分后者现在已经转为社区维护了总体印象使用库函数的一般步骤初始化错误处理建立连接执行语句获取结果释放内存关闭连接编码相关结果集相关函数分配或初始化与相适应的对象如果是指针该函数将分配初始化并返回新对象否则将初始化对象并返回对象的地址如果分配了新的对象当调用来关闭连接时将释放该对象返回值初始化的句柄如果无足够内存以分配新的对象返回函数尝试与运行在主机上的数据库引擎建立连接在你能够执行需要有效连接句柄结构的任何其他函数之前必须成功完成结构体指针地址或视为本机用户名或空字符串视为当前用户密码数据库名会将默认数据库设为该值端口号跨网络的话应该填如果非空描述了应使用的套接字或命名管道标志通常为可以设置下面组合以允许特定功能返回值如果失败返回成功返回结构体指针标志名称标志描述使用压缩协议返回发现的行数匹配的而不是受影响的行数允许在函数名后使用空格使所有的函数名成为保留字关闭连接之前允许取代了秒的不活动时间客户端的会话变量被设为会话变量的值允许处理功能通知服务器客户端可能在单个字符串内发送多条语句由隔开如果未设置该标志将禁止多语句执行通知服务器客户端能够处理来自多语句执行或存储程序的多个结果集如果设置了将自动设置它禁止语法它用于如果使用了该语法它会使分析程序生成错误在捕获某些程序中的缺陷时它很有用客户端是客户端它将变得更为友好使用加密协议该选项不应由应用程序设置它是在客户端库内部设置的调用之前不要尝试加密密码密码加密将由客户端自动处理使用函数功能执行由终结的字符串查询指向的查询正常情况下字符串必须包含条语句而且不应为语句添加终结分号或如果允许多语句执行字符串可包含多条由分号隔开的语句函数不单单能完成查询的功能还能完成非语句在程序中的执行是一个十分万能的程序中执行语句的函数并且该函数本身直接支持静态如果语句中包含二进制数据则需要调用来执行查询语句如果查询成功返回如果出现错误返回非值参数为返回值为执行语句的字符串若执行的是或语句则可通过获知受影响的记录数若执行的是语句查询结束后查询结果被保存在句柄中需要使用获取结果集的函数将结果集获取出来有两种方式可以获取结果集注意执行的语句不应为语句添加终结分号或函数关闭前面打开的连接如果句柄是由或自动分配的还将解除分配由指向的连接句柄编码相关函数为当前连接返回默认的字符集函数该函数用于为当前连接设置默认的字符集返回值表示成功非值表示出现错误设置编码集例子下面也可以结果集相关一种方式是通过将整个结果集全部取回来另一种方式则是调用初始化获取操作但暂时不取回任何记录视结果集的条目数选择获取结果集的函数两种方法均通过来访问每一条记录函数获取结果集函数解析结果集函数释放结果集获取列数函数获取表头函数函数返回影响行数函数获取结果集成功返回结果集指针失败返回可以通过判断返回来判断是否执行成功是一个结构体类型可以从头文件中找到该结构体的定义行数有多少行使用案例该函数调用成功则查询的结果被保存在中函数解析结果集成功返回下一行的结构如果没有更多要检索的行或出现了错误返回为返回的值使用案例的本质是数据信息存储的形式如下图函数释放结果集成功释放参数传递的结果集没有失败情况查询数据整体案例执行失败执行成功获取列数函数从句柄中获取连接的表有多少列表为连接数据库的时候指定了的某张表从返回的结果集中获取有多少列获取表头函数全部获取获取单个返回值为结构体指针列名原名有别名的情况下表名原表名表的库名函数返回上次更改的行数上次删除的行数或上次语句插入的行数对于或语句可在后立刻调用对于语句的工作方式与类似返回值大于的整数表明受影响或检索的行数表示语句未更新记录在查询中没有与匹配的行或未执行查询表示查询返回错误或者对于查询在调用之前调用了由于返回无符号值通过比较返回值和或等效的检查是否为如果在连接至时指定了标志对于语句将返回语句匹配的行数客户端编写案例初始化连接数据库循环打印提示符读取用户输入的语句判断是否为退出不是退出的话执行语句取出结果集或影响行数打印出来如果要释放结果集关闭连接代码错误成功链接成功去首尾空格判断是否只有回车字符去末尾分号最终传递的指令为执行命令执行失败执行失败的事务事务相关知识点参考事务章节的事务的默认自动提交的每执行一个语句都自动的事务是自动打开的以你执行的一条语句为标志但每次执行需要手动在程序中设置修改事务的属性每次连接会重新恢复默认要重新设置禁止自动提交开启自动提交中引擎才支持事务默认自动提交机制引擎不支持相关语句开启事务设置手动提交设置自动提交提交回滚代码案例手动自动设置事务为手动提交开启事务设置事务为手动提交设置事务为自动提交开启事务设置事务为自动提交执行手动提交事务执行回滚事务开启事务并修改事务属性为手动向表中插入第一行数据向表中插入第二行数据手动提交事务再次修改事务属性为自动再次修改事务属性为手动向表中插入第三行数据向表中插入第四行数据直接操作操作是否能回退掉的值取决于事务属性预处理类客户端服务器协议提供了预处理语句该功能采用了由初始化函数返回的语句处理程序数据结构对于多次执行的语句预处理执行是一种有效的方式首先对语句进行解析为执行作好准备接下来在以后使用初始化函数返回的语句句柄执行一次或多次对于多次执行的语句预处理执行比直接执行快主要原因在于仅对查询执行一次解析操作在直接执行的情况下每次执行语句时均将进行查询此外由于每次执行预处理语句时仅需发送参数的数据从而减少了网络通信量预处理语句的另一个优点是它采用了二进制协议从而使得客户端和服务器之间的数据传输更有效率性能调优是数据库编程永恒不变的主题如果能把语句框架预先处理好当真正要执行语句时只需要发送对应的参数到对应的框架中就能提高客户端访问服务器的速度且数据量小可以减少网络通信量提高数据传输效率高预处理语句的优势在于归纳为一次编译多次运行省去了解析优化等过程此外预处理语句能防止注入预处理相关函数初始化预处理环境句柄返回一个结构体指针向上面句柄中添加语句带有占位符求绑定变量的个数辅助函数有多少个就返回多少将对应的实参设置到预处理环境句柄中执行预处理的语句获取错误消息关闭预处理语句函数创建句柄对于该句柄应使用释放成功时返回指向结构的指针如果内存溢出返回函数准备语句框架字符串必须包含条语句通过将问号字符嵌入到字符串的恰当位置不应为语句添加终结用分号或为语句字符串为字符串长度如果成功处理了语句返回如果出现错误返回非值可通过调用获取错误消息函数返回预处理语句中参数标记符的数目表示语句中参数数目的无符号长整数函数用于为语句中的参数标记符绑定数据以传递给它使用结构来提供数据应该为数组首地址如果绑定成功返回如果出现错误返回非值结构体详解参考官方文档参考下方讲解问号缓冲区中的值是否可以为空指向问号缓冲区的地址缓冲区长度字符串要提供作为输入参数时表示的字节数作为输出结果时表示可以存储在中的最大字节数问号缓冲区的类别值得注意的是上面结构体中的成员和成员你的区别对于入参数据绑定设置表示中存储的参数值的实际长度这是由使用的当为时可以作为长度来用但改变之后必须重新调用才会对查询起作用而只要改变其所指向的就会在下一次查询起作用不用重新调用对于输出值绑定在您调用时设置返回值决定了如何解释长度如果返回值为则表示参数值的实际长度如果返回值为则表示参数值的非截断长度在这种情况下和中的最小值表示值的实际长度成员指定的允许值函数执行与语句句柄相关的预处理查询在该调用期间将当前绑定的参数标记符的值发送到服务器服务器用新提供的数据替换标记符如果执行成功返回如果出现错误返回非值函数返回值如果绑定成功返回如果出现错误返回非值一种函数用于将结果集中的列与数据缓冲和长度缓冲关联绑定起来当调用以获取数据时客户端服务器协议会将绑定列的数据置于指定的缓冲区内函数是函数名返回结果集中的下一行返回值描述成功数据被提取到应用程序数据缓冲区出现错误调用可获取错误消息不存在行数据出现数据截短函数对于由指定的语句返回由终结的字符串该字符串包含最近调用的语句函数的错误消息该函数或成功或失败如果未出现错误返回空字符串函数关闭预处理句柄如果成功释放了语句返回如果出现错误返回非值预处理案例初始化问号参数集初始化问号数作为参数个初始化结果集获取结果和的区别要求和一定要组合使用可以没有是一种轻量级的关系数据库管理系统广泛用于嵌入式系统和移动应用程序中它的特点是轻量级的库文件非常小通常只有几百适合资源有限的环境自包含不需要安装和配置所有的数据库文件都是普通的文件可以直接使用零配置它不需要服务器进程数据库文件可以直接在应用程序中打开和操作跨平台可以在多种操作系统上运行包括和在各大操作系统中基本都有预装可以使用查看安装的版本时序数据库参考视频教程讲解得比较底层一个开源的时序数据库专为高性能数据写入和查询而设计适合监控和分析工业数据基于的扩展支持时序数据的存储和查询具备强大的功能虽然主要用于监控但也可以作为时序数据库适合收集和查询时间序列数据一个分布式可扩展的时序数据库通常与和结合使用用于存储和绘制时序数据特别适合监控和性能指标高性能的时序数据库广泛应用于金融和其他需要快速数据处理的工业领域非关系数据库数据库有两种关系型数据库操作数据必须要使用语句数据存储在磁盘存储的数据量大非关系型数据库操作不使用语句命令方式数据默认存储在内存速度快效率高存储数据量小不需要数据库表以键值对的方式存储的所有的数据默认存储在关系型数据库中客户端访问服务器有一些数据服务器需要频繁的查询数据服务器首先将数据从关系型数据库中读出第一次将数据写入到中客户端第二次包含以后访问服务器服务器从中直接读数据数据库如果你的应用场景允许考虑使用数据库如这些数据库通常使用文档存储数据操作方式更接近编程语言本身避免了的复杂性下面是几个比较轻量的数据库盘点如下是一个开源的键值存储数据库通常用于缓存和快速数据存取它在内存中运行速度非常快且可以通过简单的安装和配置来使用虽然的主要数据存储在内存中但它也可以持久化到磁盘是一个轻量级的文档数据库专为应用程序设计它是一个单文件数据库简单易用适合嵌入式应用是一个数据库允许在浏览器中使用数据库它可以与同步适合需要在客户端存储数据的应用是一个开源的键值存储库由开发它是一个轻量级的数据库适合需要快速存取和高效存储的场景安装与使用官网跳转安装命令两个角色服务器服务器启动不填路径默认找根目录下的配置文件路径客户端客户端端口号地址默认连接本地端口的服务器通过客户端关闭服务器客户端的测试命令测试消息官方命令在线文档安装完成后服务将自动启动您可以使用以下命令检查服务的状态如果服务正在运行您将看到的状态如果服务未运行您可以使用以下命令手动启动它您还可以使用以下命令停止服务如果您希望服务在系统启动时自动启动可以使用以下命令启用它配置文件给服务器使用的根目录下的配置文件常用配置项允许谁访问服务器如果注释掉它表示任何主机都可以访问到服务器保护模式保护模式必须要关闭才能允许远程主机访问服务器服务器启动的时候绑定的端口默认为客户端空闲的超时时长超时后服务器主动断开连接表示禁用该超时断开功能服务器启动后是否以守护进程存在如果上一项设置了服务器是守护进程就会生成一个文件路径设置为如下一般改为表示的启动目录下生成文件服务器是守护进程才会写日志文件日志文件路径如下空表示把日志丢到了空设备中意思不想保留下来一般修改成设置数据库的个数通过来切换数据库到的值之间的一个值另有数据持久化相关的配置项点击跳转数据类型中数据的组织形式必须是字符串双引号括住的部分会将空格也视为字符串的一部分可选的类型字符串类型存储多个字符串的类型集合元素不重复数据是无序的类型排序集合元素不重复默认升序类型与数据组织方式一样是红黑树实现的是数组实现的常用命令类型命令设置一个键值对通过得到同时设置一个或多个对同时查看过个如果已经存在并且是一个字符串命令将追加到原来的值的末尾返回所储存的字符串值的长度为值加的值加为值减的值减前提必须是数字字符串类型命令将一个或多个值插入到列表的表头将一个或多个值插入到列表的表尾最右边中删除元素删除最左侧元素删除最右侧元素遍历起始位置结束位置倒数第二个为倒数第三为依此类推通过下标得到对应位置的字符串中字符串的个数类型命令类型添加元素将一个或多个元素加入到集合当中已经存在于集合的元素将被忽略遍历差集交集并集类型添加元素如果添加的已存在可以更新的值遍历参数能让成员和它的值一并返回升序集合降序集合指定分数区间内元素的个数显示的薪水排名由尾至前的排名由前至尾的排名移除有序集中的一个或多个成员系那是成员的值类型命令添加数据是字段添加一个的键值对取某字段数据批量插入键值对批量取数据删除键值对判断字段是否存在存在不存在遍历哈希表中所有的字段和值返回哈希表中的所有字段返回哈希表中的字段数来你肝返回哈希表中的所有字段的值相关的命令删除键值对查看值查找所有符合给定模式的匹配数据库中所有匹配和等匹配和等匹配和但不匹配给设置生存时长可以输入算式如查看当前还剩下的生存时长无限生存时间返回的是取消生存时长返回对应的的数据类型判断值是否存在存在返回否则返回插件布隆过滤器插件数据结构布隆过滤器了解布隆过滤器数据持久化持久化数据从内存到磁盘的过程持久化的两种方式方式这是一种默认的持久化方式默认打开磁盘的持久化文件将内存数据以二进制的方式直接写入磁盘文件文件比较小恢复时间短效率高以用户设定的频率同步数据方式默认是关闭的磁盘的持久化文件直接将生成数据的命令写入磁盘文件文件比较大恢复时间长效率低每隔同步一次不可设置由于频率很快数据完整性高二者关联和同步方式可以同时打开和同步方式可以同时关闭两种模式同时开启的情况下数据恢复时效率上考虑用模式数据完整性上考虑用模式数据持久化的配置项设置的同步频率设置为表示关闭同步方式内至少一个发生变化就同步数据到磁盘上内至少十个发生变化就同步数据内至少一万个发生变化就同步数据同步到磁盘上的文件名字和文件同步到磁盘上的文件的路径文件同步功能是否要打开文件名字的同步方式可以设置为或为每秒同步一次折中方案推荐为每写一次就同步一次效率最低为操作系统想的时候才会同步效率最高一般不用开发开发库有很多有官方的有第三方的支持各种语言在官网有罗列点击跳转此处以语言的库作为选择库库链接接口的使用连接数据库连接数据库结构体不等于表示有错误执行命令函数执行命令第一个参数即为的返回值如返回值指向的结构函数实际的返回值类型命令执行结果的返回类型存储执行结果返回为整数变量的字符串值长度存储命令执行结果返回是字符串或者错误信息返回结果是数组代表数据的大小存储执行结果返回是数组的类型盘点状态表示含义返回值是字符串字符串储存在当中字符串长度为返回值是数组数组大小存在里面数组值存储在里面数组里面存储的是指向的指针数组里面的返回值可以通过来访问数组的结果里全是的对象指针返回整数从字段获取值返回值为空表示执行结果为空返回命令执行的状态比如返回的状态为存储在当中命令执行错误错误信息存放在当中释放资源释放放回结果释放连接测试案例连接成功显示为为数组相关配置此处记录下配置的操作流程参考官方指导安装好镜像后参数说明将变量设置为任意值以确认接受最终用户许可协议是映像的必需设置指定至少包含个字符且符合密码策略的强密码是映像的必需设置指定自定义排序规则可不使用默认值将主机环境中的端口映射到容器中的端口在此例中侦听容器中的此容器端口会对主机上的端口公开为容器指定自定义名称若运行多个容器不能重复使用相同名称用于显式设置容器主机名未指定则默认为随机生成的系统在后台运行容器守护程序容器映像默认情况下密码必须设置为至少八个字符且包含以下四种字符中的三种大写字母小写字母十进制数字符号登录进查看容器的地址使用这句命令容器名容器新建好的数据库默认只能使用身份验证模式启动需要使用通过身份验证模式连接上数据库在右键属性安全性中有服务器身份验证选择和身份验证模式启用账户在树形图中的安全性登录名中找到账户右键属性中可以启用用户名的密码可以在树形图中的安全性登录名中具体登录名右键属性中修改连接上数据库后用此命令修改也可以启动远程连接需要打开配置管理器找到的协议右键选择启用事后要重启服务在上安装自学笔记在中创建用户角色及授权使用语句更新创建用户并授权博客快速入门使用备份和还原数据库备份与还原文件备份流程打开客户端选中数据库鼠标右键选择任务备份操作备份在备份页面指定文件路径存放路径默认是数据库路径可以自行指定其他默认是完整备份单击确定还原流程打开客户端选中数据库鼠标右键单击任务还原操作还原单击数据库在此页面选择源设备单击右侧按钮在指定备份单击添加选择保存的文件单击确定勾选覆盖现有数据库单击确定数据库映射技术对象关系映射是指将应用程序中的对象模型通常是面向对象的模型与数据库中的关系模型进行映射的过程简单来说是通过使用描述对象和数据库之间映射的元数据将程序中的对象自动持久化到关系数据库中常见的数据库映射技术包括对象关系映射框架如入门在平台上在平台上年代久远当下比较流行半需要写一大堆的里面要写语句开发最流行这些框架提供了便捷的方式来映射数据库表和对象之间的关系简化了数据访问层的开发工作使用方式实例可以参考入门能解决下面的问题语法学习开发效率低字段重命名需要挨个地方修改数据库更换如更换为数据库语句不同有兼容性问题的底层会通过反射帮我们生成数据库能够执行的语句缺点降低了系统的执行效率遇到复杂的查询时显得有些吃力基本框架也支持直接执行语句写时复制和事务处理大部分数据库都支持的操作写时复制核心思想当需要对数据进行修改时不直接修改原始数据而是先复制一份数据的副本在副本上进行修改只有在真正需要修改时才进行数据的复制这样可以延迟复制操作提高性能步骤读取阶段多个事务可以并发地读取同一个数据页或记录不需要进行复制操作写入阶段当事务尝试修改数据时先将需要修改的数据页或记录复制到一个新位置副本提交阶段事务成功后新副本替代原始数据未被提交的修改则会被丢弃优点多版本并发控制允许读写事务并发执行读操作不会阻塞写操作减少锁争用读事务不需要加锁因为读取的是快照数据提高可靠性原始数据在未确认修改前保持不变减少数据损坏的风险应用场景的实现每次写操作会创建一个数据的版本未提交的事务可以访问旧版本文件系统如和写时复制用于实现快照和可靠的数据存储事务处理原理数据库中的事务是逻辑上的一组操作它们要么全部成功提交要么全部失败回滚事务处理的核心是保证属性属性原子性事务中的所有操作要么全部完成要么全部不执行一致性事务执行前后数据库必须处于一致状态隔离性事务的执行不被其他事务干扰即使是并发事务也要表现为独立运行持久性事务提交后其对数据库的修改永久生效即使发生系统崩溃事务处理机制事务日志在事务修改数据之前先将修改记录写入日志如果事务失败系统可以通过日志回滚未完成的操作记录数据被修改前的旧值回滚时用旧值还原数据回滚机制在事务失败或中止时根据将数据库状态恢复到事务开始前的状态锁机制共享锁锁用于读操作多个事务可以同时持有排他锁锁用于写操作确保只有一个事务能够修改数据多粒度锁锁的粒度可以是行页表或整个数据库以平衡并发性能和隔离性两阶段锁协议在事务中分为加锁阶段和解锁阶段事务在执行时先加锁直到事务提交或回滚后才释放所有锁多版本并发控制通过保存不同版本的数据实现读写并发分离数据库为每个事务维护数据的多个版本读操作访问旧版本数据写操作创建新版本互不冲突检查点定期将日志的部分内容刷入磁盘减少恢复时间事务的状态活动状态事务开始执行但未完成部分提交事务所有操作执行完成但尚未写入磁盘失败状态事务因某种原因失败需要回滚中止状态事务已经回滚数据恢复到事务开始时的状态已提交事务成功结束所有修改永久生效事务隔离级别数据库使用隔离级别来控制并发事务的相互影响共有以下四种隔离级别从低到高读未提交事务可以读取未提交的数据存在脏读问题读已提交只能读取已提交的数据避免脏读可重复读同一事务中多次读取结果一致避免不可重复读可串行化最高隔离级别事务按串行顺序执行避免幻读数据库相关课程介绍',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-17 15:11:13',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://th.bing.com/th/id/OIP.wtmjepfWPBvn26uz7s18dgHaHa?rs=1&amp;pid=ImgDetMain"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ZEROKO14的个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 1.05rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 1.05rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 1.05rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 1.05rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 1.05rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 1.05rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 1.05rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 1.05rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 1.05rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 1.05rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 1.05rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 1.05rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 1.05rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 1.05rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 1.05rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 1.05rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 1.05rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 1.05rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 1.05rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 1.05rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 1.05rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">基础<sup>3</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>1</sup></a><a href="/tags/%E7%A1%AC%E7%BC%96%E7%A0%81/" style="font-size: 1.05rem;">硬编码<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">27</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>数据库</span></a></span></div></div><h1 class="post-title" itemprop="name headline">数据库</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-07-16T04:06:28.969Z" title="发表于 2024-07-16 12:06:28">2024-07-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-12-17T07:11:13.708Z" title="更新于 2024-12-17 15:11:13">2024-12-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="数据库"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新加坡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新加坡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://che77a38.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" tabindex="-1" itemprop="url">数据库</a><h1 id="CrawlerTitle" itemprop="name headline">数据库</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ZEROKO14</span><time itemprop="dateCreated datePublished" datetime="2024-07-16T04:06:28.969Z" title="发表于 2024-07-16 12:06:28">2024-07-16</time><time itemprop="dateCreated datePublished" datetime="2024-12-17T07:11:13.708Z" title="更新于 2024-12-17 15:11:13">2024-12-17</time></header><p>数据库是为了实现一定的目的按某种规则组织起来的数据的集合, 简单的说,数据库就是存储数据的库.</p>
<span id="more"></span>

<p><strong>常见数据库</strong></p>
<p>1 oracle公司的oracle数据库<br>2 IBM公司的DB2数据库<br>3 Informix公司的Informix数据库<br>4 sysbase公司的sysbase数据库<br>5 Microsoft公司的SQL Server<br>6 oracle的MySQL数据库（开始属于mysql公司，后来mysql被sun收购，sun又被oracle收购）<br>7 MongoDB数据库(json键值对的非关系数据库)</p>
<h1 id="oracle"><a href="#oracle" class="headerlink" title="oracle"></a>oracle</h1><p>Oracle是殷墟（yīn Xu）出土的甲骨文（oracle bone inscriptions）的英文翻译的第一个单词。</p>
<p>Oracle公司成立于1977年，总部位于美国加州；</p>
<p>Oracle数据库是Oracle（中文名称叫甲骨文）公司的核心产品，Oracle数据库是一个适合于大中型企业的数据库管理系统。在所有的数据库管理系统中（比如：微软的SQL Server，IBM的DB2等），Oracle的主要用户涉及面非常广, 包括: 银行、电信、移动通信、航空、保险、金融、电子商务和跨国公司等。</p>
<p>Oracle数据库的一些版本有：Oracle7、Oracle8i、Oracle9i，Oracle10g到Oracle11g，Oracle12c， 各个版本之间的操作存在一定的差别，但是<strong>操作oracle数据库都使用的是标准的SQL语句，因此对于各个版本的差别不大</strong>。</p>
<p>2008年1月16日 收购bea，目的是为了得到weblogic（web服务器的框架，免费的对应的tomcat）。<br>2008年1月16日 sun公司收购了mysql 。<br>2009年4月20日 oracle收购了sun 。</p>
<p><a target="_blank" rel="noopener" href="https://www.oracle.com/database/technologies/oracle-database-software-downloads.html">官网安装路径</a></p>
<p><strong>Oracle服务器</strong>：是一个<strong>数据管理系统(RDBMS)<strong>，它提供开放的, 全面的, 近乎完整的信息管理。由</strong>1个数据库和一个（或多个）实例(可以简单理解成就是进程)组成</strong>。数据库位于硬盘上，实例位于内存中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210121542288.png" alt="image-20221012154245368"></p>
<p>oracle非常耗费内存</p>
<p><strong>表空间和数据文件</strong></p>
<p>逻辑概念：表空间是由多个数据文件组成，位于实例上，在内存中。<br>物理概念：数据文件，在磁盘上（&#x2F;home&#x2F;oracle_11&#x2F;app&#x2F;oradata&#x2F;orcl目录中的.DBF文件）；<br>          一个表空间包含一个或者多个数据文件。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210151419807.png" alt="image-20221015141839715"></p>
<p>段存在于表空间中，段是区的集合，区是数据块的集合，数据块会被映射到磁盘块。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210151421976.png" alt="image-20221015142120134"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210151421152.png" alt="image-20221015142151286"></p>
<h2 id="DBA"><a href="#DBA" class="headerlink" title="DBA"></a>DBA</h2><p>数据库管理员（Database Administrator，简称DBA），是从事管理和维护数据库管理系统(DBMS)的相关工作人员的统称，属于运维工程师的一个分支，主要负责业务数据库从设计、测试到部署交付的全生命周期管理。DBA的核心目标是保证数据库管理系统的稳定性、安全性、完整性和高性能。从时间开销上看：安装占用6%，创建和配置占用12%，装载和存档数据占6%, 软件维护占6%，管理数据库系统占55%，可见，管理数据库系统占用了大部分的时间开销。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210151428318.png" alt="image-20221015142827073"></p>
<h2 id="启动数据库服务"><a href="#启动数据库服务" class="headerlink" title="启动数据库服务"></a>启动数据库服务</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>windows下创建数据库参考<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_11682417/5792643">此处</a>(注意,安装过程中主机名不要修改,默认的是对的,吃过亏了)</p>
<p>Windows启动oracle数据库服务：<br>启动服务：services.msc，找到下列两个服务，并启动。</p>
<ul>
<li><code>OracleServiceORCL</code>： oracle数据库服务系统</li>
<li><code>home1TNSListene</code>： 监听服务，用于远程连接的侦听</li>
</ul>
<p>注意：若把数据库默认设置为自启动，则开机时间会延长。</p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>Linux启动oracle数据库服务步骤(oracle数据库系统安装到linux系统上)</p>
<ol>
<li>执行<code>sqlplus / as sysdba</code>或<code>sqlplus sys/sys as sysdba</code>进入到命令行界面</li>
<li>执行<code>startup</code>启动数据库服务</li>
<li>执行<code>exit</code>退出<code>sqlplus命令行界面</code></li>
<li>执行<code>lsnrctl start</code><strong>启动监听服务</strong></li>
</ol>
<p>注意：通过远程客户端连接oracle服务端必须要启动监听服务，否则客户端连接不上。</p>
<p>sqlplus命令行界面下还可以使用 <code>shutdown immeidate</code>停止数据库服务</p>
<h2 id="容器数据库"><a href="#容器数据库" class="headerlink" title="容器数据库"></a>容器数据库</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42774383/article/details/82116377">容器数据库（CDB）和可插拔数据库（PDB）</a>是Oracle 12C引入的一种特性，它允许在CDB容器数据库中创建并维护多个数据库。这个特性的优点之一是可以在一个数据库服务器上创建多个独立的数据库，每个PDB在CDB中是相互独立存在的。这样可以更有效地利用服务器资源，避免浪费。此外，CDB根容器数据库的主要作用就是容纳所有相关的PDB元数据，以及在CDB中对现有PDB进行管理</p>
<p>MYSQL没有容器数据库的概念</p>
<ul>
<li><code>ROOT</code>：ROOT容器数据库，是CDB环境中的根数据库，在根数据库中含有主数据字典视图，其中包含了与ROOT容器有关的元数据和CDB中包含的所有PDB信息，在CDB环境中被标识为**<code>CDB$ROOT</code>**，每个CDB环境中只能有一个ROOT容器数据库。</li>
<li><code>PDB SEED</code>:PDB SEED为PDB的种子，其中提供了数据文件，在PDB环境中被标识为<code>PDB$SEED</code>，是创建PDB的模板，可以连接PDB$SEED但是不能执行任何事务，因为PDB$SEED是只读的，不可修改。</li>
<li><code>PDBS</code>：PDBS数据库，在CDB环境中每个PDB都是独立存在的，与传统ORACLE数据库无差别，每个PDB拥有自己的数据文件和OBJECTS，唯一的区别就是PDB可以插入到CDB中，以及从CDB中拔出。当用户连接到PDB时不会感觉到根容器和其他PDB的存在。</li>
</ul>
<h3 id="容器数据库基本操作"><a href="#容器数据库基本操作" class="headerlink" title="容器数据库基本操作"></a>容器数据库基本操作</h3><ul>
<li><code>show pdbs;</code>   查看当前数据库下有哪些PDB</li>
<li><code>show con_name;</code>  查看当前连接的是哪个数据库</li>
<li><code>alter session set container=数据库名;</code>   切换数据库</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42774383/article/details/82116377">等等点击跳转详解</a></li>
</ul>
<h2 id="登录数据库服务"><a href="#登录数据库服务" class="headerlink" title="登录数据库服务"></a>登录数据库服务</h2><h3 id="本机登陆"><a href="#本机登陆" class="headerlink" title="本机登陆"></a>本机登陆</h3><ul>
<li><p>普通用户身份登陆</p>
<p><code>sqlplus 用户名/密码</code>，如sqlplus scott&#x2F;tiger</p>
</li>
<li><p>以管理员身份登陆</p>
<p><code>sqlplus  /  as  sysdba</code>（此处不用输入密码，在安装的时候已经输入密码）</p>
<p><code>sqlplus sys/sys as sysdba</code></p>
</li>
</ul>
<p><strong>oracle自带两个用户</strong></p>
<ul>
<li>**<code>SYS</code>**用户是Oracle数据库的超级用户，它拥有最高权限，可以执行任何操作。<code>SYS</code>用户拥有所有的数据字典表和视图，这些对象都存储在<code>SYS</code>模式下。通常情况下，不建议使用<code>SYS</code>用户进行日常操作，因为它拥有非常高的权限，可能会对数据库造成不可逆的影响。</li>
<li>**<code>SYSTEM</code>**用户也是一个具有高权限的用户，它主要用于执行数据库管理任务。与<code>SYS</code>用户不同的是，<code>SYSTEM</code>用户并不拥有所有的数据字典表和视图，它只能访问那些授权给它的对象。通常情况下，可以使用<code>SYSTEM</code>用户来执行一些日常的数据库管理任务。</li>
</ul>
<h3 id="远程登陆"><a href="#远程登陆" class="headerlink" title="远程登陆"></a>远程登陆</h3><p> 远程通过网络登陆数据库需要安装oracle客户端软件，并进行配置才能使用，可通过使用net manager进行配置，配置完成之后可以使用连接字符串进行登陆，连接字符串中包含了数据库服务的IP地址和端口，以及实例名。</p>
<p>注意：安装oracle客户端的时候，安装路径中不能出现中文和空格，安装的时候选择管理员模式。</p>
<ul>
<li><p>普通用户登陆</p>
<p><code>sqlplus 用户名/密码@连接字符串</code>，如<code>sqlplus scott/tiger@oracle_orcl</code></p>
</li>
<li><p>管理员用户登陆</p>
<p><code>sqlplus sys/sys@oracle_orcl as sysdba</code></p>
</li>
</ul>
<p> 此外：还可以执行： <code>sqlplus scott/tiger@//IP地址/实例名</code>        进行登陆。<br>    使用scott用户或者sys用户登陆完之后，可以使用<code>show user</code>测试一下，如果显示用户名就表明已经登陆成功了，或者是执行<code>select * from tab；</code>进行一次查询, 有结果显示就表名已经登陆成功了.</p>
<p>相关命令</p>
<ul>
<li><p>解锁用户：<code>alter user scott account unlock</code> (管理员身份登陆，给scott用户解锁。用户默认锁定)</p>
</li>
<li><p>锁定用户：<code>alter user scott account lock</code>，（必须用管理员用户登陆）</p>
</li>
<li><p>修改用户密码：<code>alter user scott identified by 新密码</code>    (管理员身份登陆，给scott用户修改密码)</p>
<p>修改用户密码也可以直接 <code>password scott 新密码</code>(scott用户本身修改自身密码的话可以省略scott)</p>
</li>
<li><p>查看当前语言环境：<code>select userenv(&#39;language&#39;) from dual;</code></p>
</li>
</ul>
<p>加锁后,对应加锁的用户就不能登录了,解锁后该用户才能登录</p>
<h3 id="oracle创建案例脚本"><a href="#oracle创建案例脚本" class="headerlink" title="oracle创建案例脚本"></a>oracle创建案例脚本</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 01 创建表空间</span></span><br><span class="line"><span class="comment">-- 注意表空间的路径 根据实际安装环境进行调整</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>SPACE ts_seckey_admin </span><br><span class="line">    LOGGING  </span><br><span class="line">    DATAFILE <span class="string">&#x27;/u01/app/oracle/oradata/orcl/ts_seckeymng_admin.dbf&#x27;</span> SIZE <span class="number">50</span>M </span><br><span class="line">    EXTENT MANAGEMENT <span class="keyword">LOCAL</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>SPACE ts_seckey_op</span><br><span class="line">    LOGGING </span><br><span class="line">    DATAFILE <span class="string">&#x27;/u01/app/oracle/oradata/orcl/ts_seckeymng_op.dbf&#x27;</span> SIZE <span class="number">200</span>M</span><br><span class="line">    EXTENT MANAGEMENT <span class="keyword">LOCAL</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">ALTER</span> DATABASE DATAFILE <span class="string">&#x27;/u01/app/oracle/oradata/orcl/ts_seckeymng_admin.dbf&#x27;</span> AUTOEXTEND <span class="keyword">ON</span> NEXT   <span class="number">50</span>M MAXSIZE UNLIMITED;</span><br><span class="line"><span class="keyword">ALTER</span> DATABASE DATAFILE <span class="string">&#x27;/u01/app/oracle/oradata/orcl/ts_seckeymng_op.dbf&#x27;</span> AUTOEXTEND <span class="keyword">ON</span> NEXT  <span class="number">200</span>M MAXSIZE UNLIMITED; </span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 02 创建方案 (创建用户)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> SECMNG  PROFILE <span class="keyword">DEFAULT</span> </span><br><span class="line">    IDENTIFIED <span class="keyword">BY</span> SECMNG <span class="keyword">DEFAULT</span> TABLESPACE USERS</span><br><span class="line">    ACCOUNT UNLOCK;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 资源和登录权限</span></span><br><span class="line"><span class="keyword">GRANT</span> resource <span class="keyword">TO</span> SECMNG;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">create</span> session <span class="keyword">TO</span> SECMNG;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建 网点信息表 --编号 名称 描述 授权码 状态(0可用  1不可用)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SECMNG.SECNODE(</span><br><span class="line">	id     				<span class="type">char</span>(<span class="number">4</span>) <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">	name     			VARCHAR2(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> 	nodedesc      		VARCHAR2(<span class="number">512</span>),</span><br><span class="line"> 	createtime			<span class="type">date</span>,</span><br><span class="line"> 	authcode			NUMBER(<span class="number">12</span>),</span><br><span class="line"> 	state     			NUMBER(<span class="number">4</span>)</span><br><span class="line">)TABLESPACE ts_seckey_admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SECMNG.secnode <span class="keyword">VALUES</span>(<span class="string">&#x27;0001&#x27;</span>, <span class="string">&#x27;网银中心&#x27;</span>, <span class="string">&#x27;北京金融街23号&#x27;</span>, <span class="string">&#x27;15-7月-15&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SECMNG.secnode <span class="keyword">VALUES</span>(<span class="string">&#x27;1111&#x27;</span>, <span class="string">&#x27;广东分中心1111&#x27;</span>, <span class="string">&#x27;广州天河金融&#x27;</span>, <span class="string">&#x27;15-7月-15&#x27;</span>, <span class="number">1111</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建 网点密钥表, 客户端网点 服务器端网点 密钥号 密钥产生时间 密钥状态 </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SECMNG.SECKEYINFO(</span><br><span class="line">	clientid          	<span class="type">char</span>(<span class="number">4</span>) <span class="keyword">constraint</span> secmng_seckeynode_clientid_fk <span class="keyword">references</span> SECMNG.SECNODE(id),</span><br><span class="line">	serverid          	<span class="type">char</span>(<span class="number">4</span>) <span class="keyword">constraint</span> secmng_seckeynode_serverid_fk <span class="keyword">references</span> SECMNG.SECNODE(id),</span><br><span class="line">	keyid            	NUMBER(<span class="number">9</span>) <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">	createtime			<span class="type">date</span>,</span><br><span class="line">	state				NUMBER(<span class="number">4</span>),</span><br><span class="line">	seckey				VARCHAR2(<span class="number">512</span>)</span><br><span class="line">)TABLESPACE ts_seckey_admin;</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建索引 在新的表空间上</span></span><br><span class="line"><span class="keyword">CREATE</span>  INDEX SECMNG.IX_SECKEYINFO_clientid <span class="keyword">ON</span> SECMNG.SECKEYINFO(clientid) TABLESPACE ts_seckey_admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- keysn序列号</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SECMNG.KEYSN(</span><br><span class="line">	ikeysn 		number(<span class="number">12</span>)  <span class="keyword">PRIMARY</span> KEY</span><br><span class="line">) TABLESPACE ts_seckey_admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SECMNG.KEYSN(ikeysn) <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SECMNG.SRVCFG(</span><br><span class="line">	key				VARCHAR2(<span class="number">64</span>),</span><br><span class="line">	valude			VARCHAR2(<span class="number">128</span>)</span><br><span class="line">)TABLESPACE ts_seckey_admin;</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- 创建 交易信息表 交易者 交易时间 交易事件 交易描述 （什么人 在什么时间 干了什么事）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SECMNG.TRAN(</span><br><span class="line">	iID					Number(<span class="number">12</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line"> 	tran_operator     	NUMBER,</span><br><span class="line"> 	trantime			<span class="type">date</span>,</span><br><span class="line"> 	tranid          	NUMBER(<span class="number">4</span>),</span><br><span class="line"> 	trandesc      		VARCHAR2(<span class="number">512</span>)	</span><br><span class="line">)TABLESPACE ts_seckey_op;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX SECMNG.IX_TRAN_tran_operator <span class="keyword">ON</span> SECMNG.TRAN(tran_operator) TABLESPACE ts_seckey_op;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建触发器 自增字段</span></span><br><span class="line"><span class="keyword">CREATE</span> SEQUENCE SECMNG.SEQiID INCREMENT <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">1</span> </span><br><span class="line">    MAXVALUE <span class="number">1.0E28</span> MINVALUE <span class="number">1</span> NOCYCLE </span><br><span class="line">    CACHE <span class="number">20</span> NOORDER;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">TRIGGER</span> SECMNG.SEQiID</span><br><span class="line">  BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> SECMNG.TRAN</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> SECMNG.SEQiID.nextval <span class="keyword">into</span> :new.iID <span class="keyword">from</span> dual;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SECMNG.TRAN(tran_operator, trantime, tranid, trandesc) <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;15-7月-15&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;创建网银总节点-测试数据&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">------停止-----</span></span><br><span class="line"><span class="comment">-- 04创建新用户方案 	通过 SECMNGUSER1 来访问数据库, 让管理终端系统用   </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;SECMNGADMIN&quot;  PROFILE &quot;DEFAULT&quot; IDENTIFIED <span class="keyword">BY</span> &quot;123456&quot; <span class="keyword">DEFAULT</span> TABLESPACE &quot;USERS&quot; ACCOUNT UNLOCK;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> &quot;CONNECT&quot; <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> resource <span class="keyword">TO</span> SECMNGADMIN;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">create</span> session <span class="keyword">TO</span> SECMNGADMIN;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> SECMNG.SRVCFG <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> SECMNG.SRVCFG <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> SECMNG.SRVCFG <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> SECMNG.SECNODE <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> SECMNG.SECNODE <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> SECMNG.SECNODE <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> SECMNG.SECKEYINFO <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> SECMNG.SECKEYINFO <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> SECMNG.SECKEYINFO <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">DELETE</span> <span class="keyword">ON</span> SECMNG.TRAN <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> SECMNG.TRAN <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> SECMNG.TRAN <span class="keyword">TO</span> &quot;SECMNGADMIN&quot;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="comment">-- Insert Into SECMNG.SECKEYINFO(clientid, serverid, keyid, createtime, state, seckey)</span></span><br><span class="line"><span class="comment">-- values (&#x27;1111&#x27;, &#x27;0001&#x27;, 1, to_date(&#x27;2015-07-14 21:09:09&#x27;, &#x27;yyyy-mm-dd hh24:mi:ss&#x27;), 0, &#x27;zzz&#x27;)  ;</span></span><br></pre></td></tr></table></figure>

<h1 id="sql和sqlplus"><a href="#sql和sqlplus" class="headerlink" title="sql和sqlplus"></a>sql和sqlplus</h1><p>sql和sqlplus的区别:</p>
<ul>
<li>SQL是语言，关键字不能缩写。</li>
<li>sqlplus是oracle提供的工具，可在里面执行SQL语句，它配有自己的命令(ed、c、set、col、spool) 特点是缩写关键字。</li>
</ul>
<h2 id="sqlplus常用命令"><a href="#sqlplus常用命令" class="headerlink" title="sqlplus常用命令"></a>sqlplus常用命令</h2><ul>
<li><p>显示当前用户： 	<code>SQL&gt; show user;</code></p>
</li>
<li><p>查看当前用户下的表：	<code>SQL&gt; select * from tab;</code>		</p>
<p>​	tab:	数据字典（记录数据库和应用程序源数据的目录），包含当前用户下的表。</p>
</li>
<li><p>查看员工表的结构：	<code>SQL&gt; desc emp;</code>		(desc  →  description 描述)</p>
</li>
<li><p>设置行宽：<code>set linesize 120;</code></p>
</li>
<li><p>设置页面：<code>set pagesize 100;</code></p>
<p>或者将上述两行写入如下两个配置文件，可永久设置：</p>
<ul>
<li><code>C:\app\Administrator\product\11.2.0\client_1\sqlplus\admin\glogin.sql</code> </li>
<li><code>C:\app\Administrator\product\11.2.0\dbhome_1\sqlplus\admin\glogin.sql</code></li>
</ul>
</li>
<li><p>设置员工名列宽：<code>col ename for a20</code>			(a表示字符串)</p>
</li>
<li><p>设置薪水列为4位数子：<code>col sal for 9999</code>		(一个9表示一位数字)</p>
</li>
<li><p>若想将显示结果保存到文件中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spool d:\result.txt;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line">spool off;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ed(或者edit)命令打开文件来编写sql语句,注意, sql语句末尾不要加<code>;</code>  , 然后换行加上<code>/</code>表示结束</p>
</li>
<li><p>修改日期格式,日期格式默认为<code>DD-MON-RR</code>,修改日期格式方式为: <code>alter session set NLS_DATE_FORMAT = &#39;yyyy-mm-dd hh24:mi:ss&#39;;</code>  查看当前会话使用的日期格式 : <code>select * from v$nls_parameters;</code></p>
</li>
<li><p>开关显示SQL的执行时间： <code>set timing on/off</code></p>
</li>
<li><p><code>/</code>表示重复刚刚执行过的sql语句.</p>
</li>
<li><p><code>start sql脚本路径</code>或 <code>@ sql脚本路径</code> 可以运行sql脚本</p>
</li>
<li><p><code>set feedback on/off</code>开关回显</p>
</li>
</ul>
<h3 id="管理员创建用户"><a href="#管理员创建用户" class="headerlink" title="管理员创建用户"></a>管理员创建用户</h3><p><code>create user 用户名 identified by 密码;</code>  创建用户(刚创建的用户连连接数据库的权限都没有)</p>
<p><code>grant connect ,resource to 用户名;</code>  一般都要赋予最基本的连接数据库权限<code>connect</code>和访问资源的权限 <code>resource</code></p>
<p>赋予对USERS表空间的权限<code>ALTER USER 数据库用户名 QUOTA UNLIMITED ON USERS ;</code></p>
<h2 id="SQL语言的类型"><a href="#SQL语言的类型" class="headerlink" title="SQL语言的类型"></a>SQL语言的类型</h2><ol>
<li>数据库中，称呼 <strong><a href="#sql%E6%8F%92%E5%85%A5%E7%9B%B8%E5%85%B3">增</a> <a href="#sql%E5%88%A0%E9%99%A4%E7%9B%B8%E5%85%B3">删</a> <a href="#sql%E4%BF%AE%E6%94%B9%E7%9B%B8%E5%85%B3">改</a> <a href="#sql%E6%9F%A5%E8%AF%A2%E7%9B%B8%E5%85%B3">查</a><strong>，为</strong>DML语句</strong>。(<strong>Data Manipulation Language 数据操纵</strong><br><strong>语言</strong>)，就是指代：<code>insert</code>、<code>update</code>、<code>delete</code>、<code>select</code>这四个操作。</li>
<li>**<a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1">DDL语句</a>**。(<strong>Data Definition Language 数据定义语言</strong>)。	<br>如：<code>truncate table(截断/清空一张表)</code><br><code>create table(表)</code>、<code>create view(视图)</code>、<code>create index(索引)</code>、<code>create sequence(序列)</code>、<br><code>create synonym(同义词)</code>、<code>alter table</code>、<code>drop table</code>。</li>
<li><strong>DCL语句</strong>。DCL（<strong>Data Control Language数据控制语言</strong>）如：<br><code>commit(提交)</code>、<code>rollback(回滚)</code></li>
</ol>
<h1 id="数据库对象"><a href="#数据库对象" class="headerlink" title="数据库对象"></a>数据库对象</h1><p>数据库对象共有12个,分别是:  表,视图,索引,序列,同义词,存储过程,存储函数,触发器,包,包体,数据库链路(datalink),快照</p>
<p><strong>常见的数据库对象</strong></p>
<ul>
<li><a href="#%E8%A1%A8">表</a>		    基本的数据存储集合，由行和列组成。</li>
<li>视图	    从表中抽出的逻辑上相关的数据集合。</li>
<li>序列	    提供有规律的数值。</li>
<li>索引        提高查询的效率</li>
<li>同义词	给对象起别名</li>
</ul>
<h2 id="表"><a href="#表" class="headerlink" title="表"></a>表</h2><p>基本的数据存储集合，由行和列组成。表名和列名遵循如下<strong>命名规则</strong>：</p>
<ul>
<li>必须以字母开头</li>
<li>必须在 1–30 个字符之间</li>
<li>必须只能包含 A–Z, a–z, 0–9, _, $, 和#</li>
<li>必须不能和用户定义的其他对象重名</li>
<li>必须不能是Oracle 的保留字</li>
<li>Oracle默认存储是都存为大写</li>
<li>数据库名只能是1~8位, datalink可以是128位, 和其他一些特殊字符</li>
</ul>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p>关键词   <strong><code>Create Table</code></strong></p>
<p>创建一张表必须具备：1. Create Table的权限 2. 存储空间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test1 (tid number, tname varchar2(<span class="number">20</span>), hiredate <span class="type">date</span> <span class="keyword">default</span> sysdate);</span><br></pre></td></tr></table></figure>

<p><code>default</code>的作用是, 当向表中插入数据的时候, 没有指定时间的时候, 使用默认值<code>sysdate</code>。</p>
<p>创建表时，列所使用的数据类型：	</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210261717113.png" alt="image-20221026171754801"></p>
<ul>
<li><p><code>varchar2(size)</code>中的<code>size</code>表示可变长的最大值</p>
</li>
<li><p><code>number(p,s)</code>中的p表示数值的总长度,s表示小数点长度(6200.00,p为6,s为2)</p>
</li>
<li><p><code>rowid</code>：行地址 ——伪列<br><code>select rowid, empno, deptno from emp;</code><br>看到该列存储的是一系列的地址(指针), 创建索引用.</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210261732808.png" alt="image-20221026173208069" style="zoom:67%;" /></li>
</ul>
<p><strong>[ [注意] ]</strong> <code>create table as select子句</code>的格式中,后面select后的<strong>表达式要取别名(语法要求)</strong></p>
<p><a href="#%E6%89%B9%E5%A4%84%E7%90%86">相关语法参考批处理标题</a></p>
<h3 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h3><p>关键词	<strong><code>ALTER TABLE</code></strong>	</p>
<ul>
<li><p><strong>追加一列</strong>: <strong><code>add</code></strong>  向test1表中加入新列 image 类型是blob</p>
<p><code>alter table test1 add image blob;</code>			</p>
</li>
<li><p><strong>修改一列</strong>: <strong><code>modify</code></strong>  将tname列的大小由20→40.</p>
<p><code>alter table test1 modify tname varchar2(40);</code></p>
</li>
<li><p><strong>删除一列</strong>: <strong><code>dropcolumn</code></strong>  将刚加入的新列image删除.</p>
<p><code>alter table test1 dropcolumn image;</code></p>
</li>
<li><p><strong>重命名一列</strong>: <strong><code>renamecolumn</code></strong>  将列tname重命名为username.</p>
<p><code>alter table test1 renamecolumn tname to username;</code></p>
</li>
</ul>
<p><strong>注意</strong>: 若是修改表的字段的长度, 若是增加长度没有问题, 若是减少字段的长度, 有可能会报错.</p>
<p>修改表名:   <code>rename 原表名 to  新表名</code></p>
<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><p>关键词   <strong><code>drop table</code></strong></p>
<p>当表被删除：</p>
<ul>
<li>数据和结构都被删除</li>
<li>所有正在运行的相关事物被提交</li>
<li>所有相关索引被删除</li>
<li><code>DROP TABLE</code>语句不能回滚，但是可以闪回</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tab;		查看当前用户下有哪些表, 拷贝保存表名。</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> testsp;		将测试保存点的表删除。	</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tab;		再次查询跟刚刚保存的表名比对，少了testsp，但多了另外一张命名复杂的表。</span><br></pre></td></tr></table></figure>

<h4 id="Oracle的回收站"><a href="#Oracle的回收站" class="headerlink" title="Oracle的回收站"></a>Oracle的回收站</h4><ul>
<li>查看回收站：<code>show recyclebin</code>(sqlplus 命令)那个复杂的命名即是testsp在回收站中的名字。</li>
<li>清空回收站：<code>purge recyclebin</code></li>
<li>将表从回收站<strong>闪回</strong><code>flashback table t2 to before drop;</code></li>
</ul>
<p><strong>注意：并不是所有的用户都有“回收站”，对于没有回收站的用户（管理员）来说，删除操作是不可逆的.</strong></p>
<h4 id="两种删除方式"><a href="#两种删除方式" class="headerlink" title="两种删除方式"></a>两种删除方式</h4><ul>
<li><code>drop table tbl;</code>      删除的表可以闪回</li>
<li><code>drop table tbl purge;</code>       purge的作用:删除不经过回收站,删除的表不可以闪回</li>
</ul>
<h3 id="表的约束"><a href="#表的约束" class="headerlink" title="表的约束"></a>表的约束</h3><p>表的约束有5种:   (<strong><code>关键词</code></strong>)</p>
<ul>
<li><strong>检查</strong>   值是否符合预设的规则(比如性别只能男或女)  (<strong><code>check</code></strong>)</li>
<li><strong>非空 **    (</strong><code>not null</code>**)</li>
<li><strong>唯一</strong>   不能重复   (<strong><code>unique</code></strong>)</li>
<li><strong>主键</strong>    非空+唯一   (<strong><code>primary key</code></strong>)</li>
<li><strong>外键</strong>(foreign key)    取值必须在另外一个表中存在  (<strong><code>references</code></strong>)</li>
</ul>
<p><strong>[注意]   设置外键的目标必须是父表的主键.</strong></p>
<p>修改表增加主键约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> dept_bak <span class="keyword">add</span> <span class="keyword">constraint</span> pk_dept_bak <span class="keyword">primary</span> key (deptno);</span><br></pre></td></tr></table></figure>

<p>create table中设置约束:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student </span><br><span class="line">(</span><br><span class="line">		sid number <span class="keyword">constraint</span> student_PK <span class="keyword">primary</span> key,  			     </span><br><span class="line">  	#学生Id主键约束</span><br><span class="line">		sname varchar2(<span class="number">20</span>) <span class="keyword">constraint</span> student_name_notnull <span class="keyword">not</span> <span class="keyword">null</span>, 	</span><br><span class="line">  	#学生姓名非空约束</span><br><span class="line">		email varchar2(<span class="number">20</span>) <span class="keyword">constraint</span> student_email_unique <span class="keyword">unique</span>		</span><br><span class="line">  	#学生邮件唯一约束</span><br><span class="line">		<span class="keyword">constraint</span> student_email_notnull <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  	#同时邮件可再设非空，没有,</span><br><span class="line">		age number <span class="keyword">constraint</span> student_age_min <span class="keyword">check</span>(age <span class="operator">&gt;</span> <span class="number">10</span>),	      </span><br><span class="line">  	#学生年龄设置<span class="keyword">check</span>约束</span><br><span class="line">		gender varchar2(<span class="number">6</span>) <span class="keyword">constraint</span> gender_female_or_male <span class="keyword">check</span>(gender <span class="keyword">in</span> (<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>)),</span><br><span class="line">  	#学生性别设置<span class="keyword">check</span>约束</span><br><span class="line">		deptno number <span class="keyword">constraint</span> student_FK <span class="keyword">references</span> dept(deptno) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span> </span><br><span class="line">  	#学生部门号设置外键</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上述代码中,<code>deptno number constraint student_FK references dept</code> 设置了删除了dept表中的某个deptno后,student表中的所有那个值的deptno的全部设置空.如果不加 <code>ON DELETE SET NULL</code>则删除dept表中的值会报错,除非删除行的deptno值在student表中不存在.</p>
<h4 id="外键的删除相关"><a href="#外键的删除相关" class="headerlink" title="外键的删除相关"></a>外键的删除相关</h4><ul>
<li><p><strong>cascade</strong>  级联删除,主表记录删除的时候,子表引用了该字段的数据跟着删除</p>
<p><code>drop table dept_bak cascade constraints;</code></p>
</li>
<li><p><strong>set null</strong>  设置为null,主表删除的时候,子表该字段设为null</p>
</li>
<li><p><strong>默认方式</strong>  主表删除的时候,如果子表引用了该字段的数据,不能删除,要先删子表</p>
</li>
</ul>
<p>通过<code>references</code>定义外键的时候可以用如下参数</p>
<ul>
<li><code>on delete cascade</code> </li>
<li><code>on delete set null</code>(多数情况下使用这种方法)</li>
</ul>
<h4 id="check检查性约束"><a href="#check检查性约束" class="headerlink" title="check检查性约束"></a>check检查性约束</h4><p>格式  <strong><code>check(条件)</code></strong></p>
<p>违反检查约束插入报错: ORA-02290：违反检查约束条件</p>
<p>定义约束时没有显式指定名字，系统会默认给一个名称.<strong>建议创建约束的时候自定义一个含义清晰的约束名</strong></p>
<p><strong><code>constraint</code></strong>: 使用该关键字，来给约束起别名。</p>
<hr>
<p><strong>查看指定表的约束:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> constraint_name, constraint_Type, search_condition <span class="keyword">from</span> user_constraints <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;STUDENT&#x27;</span>;	</span><br></pre></td></tr></table></figure>

<p><strong>注意:上面STUDENT位置的表名必须大写</strong></p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是一种常见数据库对象, 它是<strong>从表中抽出的逻辑上相关的数据集合</strong>。</p>
<ul>
<li>视图基于表</li>
<li>视图是<strong>逻辑概念</strong></li>
<li>视图本身没有数据</li>
</ul>
<p>使用视图的好处:</p>
<ul>
<li>可以简化查询,将视图看做是表的复杂的SQL一种封装</li>
<li>可以<strong>限制用户对某些数据的访问</strong></li>
</ul>
<p>[注意] 建议不要通过视图去修改表的数据,即使不是只读视图</p>
<h3 id="视图相关操作"><a href="#视图相关操作" class="headerlink" title="视图相关操作"></a>视图相关操作</h3><ul>
<li><p><strong>创建视图</strong>    <code>create view 视图名 as  sql查询语句;</code></p>
<p>创建视图需要 <code>create view</code> 权限</p>
<p>创建<strong>只读视图</strong>  <code>create view 视图名 as sql查询语句 with read only;</code></p>
<p><code>with check option</code>  要符合视图创建时的条件才能修改原数据</p>
</li>
<li><p><strong>创建或更新视图</strong>  <code>create or replace view 视图名 as 查询语句;</code>   (<code>replace</code>不能单独使用)</p>
</li>
<li><p><strong>查看所有已创建的视图</strong>    <code>select view_name from user_views;</code></p>
</li>
<li><p><strong>删除视图</strong>    <code>drop view 视图名;</code></p>
</li>
</ul>
<p>创建视图需要 <code>create view</code> 权限,添加权限步骤:</p>
<ol>
<li>使用管理员登陆：<code>sqlplus / as sysdba</code></li>
<li>给scott用户增加权限 <code>grant create view to scott;</code> (<code>revoke</code>关键词可以撤销权限)</li>
</ol>
<p>视图中使用DML的规定：														<br>一：<br>当视图定义中包含以下元素之一时不能使用delete:<br>	组函数<br>	GROUP BY 子句<br>	DISTINCT 关键字<br>	ROWNUM 伪列<br>二：<br>    当视图定义中包含以下元素之一时不能使用update :<br>	组函数<br>	GROUP BY子句<br>	DISTINCT 关键字<br>	ROWNUM 伪列<br>	列的定义为表达式<br>三：<br>    当视图定义中包含以下元素之一时不能使用insert :<br>	组函数<br>	GROUP BY 子句<br>	DISTINCT 关键字<br>	ROWNUM 伪列<br>	列的定义为表达式<br>	表中非空的列在视图定义中未包括<br>总结一句话：<strong>不通过视图做<code>insert</code>、<code>update</code>、<code>delete</code>操作。因为视图提供的目的就是为了简化查询。</strong></p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引，相当于书的目录，提高数据检索速度。提高效率（视图不可以提高效率）</p>
<ul>
<li>一种独立于表的模式对象, 可以存储在与表不同的磁盘或表空间中</li>
<li>索引被删除或损坏, 不会对表产生影响, 其影响的只是查询的速度</li>
<li>索引一旦建立, Oracle 管理系统会对其进行自动维护, 而且由 Oracle 管理系统决定何时使用索引. 用户不用在查询语句中指定使用哪个索引</li>
<li>在删除一个表时, 所有基于该表的索引会自动被删除</li>
<li>通过指针加速 Oracle 服务器的查询速度</li>
<li>通过快速定位数据的方法，减少磁盘 I&#x2F;O</li>
</ul>
<p><strong>使用索引注意点</strong>: 使用索引的列值的<strong>分布要广泛</strong>,重复的概率非常低,<strong>唯一最好</strong>.</p>
<p>索引的原理:若一个表有索引,则oracle会在内部维护一个索引表,查询的时候要使用索引的列,优先会到索引表中去查,通过索引的列找到对应的行地址,找到行地址就可以找到数据.</p>
<p><strong>索引表中的列的值是有序的.</strong></p>
<p>使用主键查询数据最快速，因为主键本身就是“唯一索引”，所以检索比较快</p>
<p>Oracle的数据库中，索引有 B树索引（默认）和位图索引两种。</p>
<p>推荐创建索引的三种情况:</p>
<ul>
<li>列中数据值分布范围很广</li>
<li>列经常在 WHERE 子句或连接条件中出现</li>
<li>表经常被访问而且数据量很大, 访问的数据大概占数据总量的2%到4%</li>
</ul>
<p>下列情况不要创建索引</p>
<ul>
<li>表很小</li>
<li>列不经常作为连接条件或出现在WHERE子句中</li>
<li>查询的数据大于2%到4%</li>
<li>表经常更新</li>
</ul>
<p>对索引的理解可以理解为: 系统自动维护的一张顺序表加快了他查询的速度.</p>
<h3 id="索引的操作"><a href="#索引的操作" class="headerlink" title="索引的操作"></a>索引的操作</h3><ul>
<li><p><strong>查看所有已创建的索引</strong>  <code>select index_name from user_indexes;</code></p>
</li>
<li><p><strong>创建索引</strong>  <code>create index 索引名  on  表名(列名1，列名2…);</code> </p>
<p><strong>创键唯一索引</strong>  <code>create unique index 索引名  on  表名(列名1，列名2…);</code>    (唯一索引要求列值不重复)</p>
</li>
<li><p>删除索引   <code>drop index 索引名;</code></p>
</li>
</ul>
<h3 id="索引的种类"><a href="#索引的种类" class="headerlink" title="索引的种类"></a>索引的种类</h3><p>未完待续</p>
<h2 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h2><p>可以理解成数组：默认，从[1]开始，长度[20]		[1, 2, 3, 4, 5, 6, …, 20]		在内存中。</p>
<p>由于序列是被保存在内存中，访问内存的速率要高于访问硬盘的速率。所以序列可以提高效率。</p>
<p><strong>序列的用处</strong>:主要用于插入主键,并保证他的非空和唯一性</p>
<h3 id="序列的操作"><a href="#序列的操作" class="headerlink" title="序列的操作"></a>序列的操作</h3><ul>
<li><strong>创建序列</strong>  <code>create sequence 序列名;</code></li>
<li><strong>删除序列</strong>  <code>drop sequence 序列名;</code></li>
<li><strong>显示所有已创建序列</strong>   <code>select sequence_name from user_sequences;</code></li>
</ul>
<p><strong>序列的使用</strong></p>
<ol>
<li>初始状态下：指针*指向1前面的位置。欲取出第一个值，应该将指针向后移动。每取出一个值指针都向后移。</li>
<li>常常用序列来指定表中的主键。</li>
</ol>
<p>	</p>
<p>创建序列的完整格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SEQUENCE sequence</span><br><span class="line">       [INCREMENT <span class="keyword">BY</span> n]    #步长</span><br><span class="line">       [<span class="keyword">START</span> <span class="keyword">WITH</span> n]      #起始值 </span><br><span class="line">       [&#123;MAXVALUE n <span class="operator">|</span> NOMAXVALUE&#125;]    #最大值</span><br><span class="line">       [&#123;MINVALUE n <span class="operator">|</span> NOMINVALUE&#125;]    #最小值</span><br><span class="line">       [&#123;<span class="keyword">CYCLE</span> <span class="operator">|</span> NOCYCLE&#125;]    #序列是否循环</span><br><span class="line">       [&#123;CACHE n <span class="operator">|</span> NOCACHE&#125;]; #序列的项个数,默认<span class="number">20</span>个(NOCACHE表示没有缓存，一次不产生<span class="number">20</span>个，而只产生一个。)</span><br></pre></td></tr></table></figure>

<p>序列的两个属性  </p>
<ul>
<li><code>currval</code>    当前值</li>
<li><code>nextval</code>    下一个值</li>
</ul>
<p><strong><code>NextVal</code> 必须在<code>CurrVal</code>之前被指定</strong>。因为初始状态下，CurrVal指向1前面的位置，无值</p>
<p>对于新创建的序列使用select myseq.currval from dual;		得到出错。<br>但select myseq.nextval from dual;		可以得到序列的第一值1.<br>此时再执行select myseq.currval from dual;	currval的值也得到1</p>
<p>只有nextval取完会向后移动，使用currval不会移动。</p>
<p>使用时按如下方式插入序列值</p>
<p><code>insert into tableA values(myseq.nextval, &amp;name)</code> </p>
<p><strong>修改序列：</strong>															<br>	必须是序列的拥有者或对序列有 ALTER 权限<br>	只有将来的序列值会被改变<br>	改变序列的初始值只能通过删除序列之后重建序列的方法实现</p>
<h3 id="使用序列需要注意的问题"><a href="#使用序列需要注意的问题" class="headerlink" title="使用序列需要注意的问题"></a>使用序列需要注意的问题</h3><ul>
<li><p>序列是公有对象，所以多张表同时使用序列，会造成主键不连续。</p>
</li>
<li><p>回滚也可能造成主键不连续。	</p>
<p>如：多次调用insert操作使用序列创建主键。但是当执行了rollback后再次使用insert借助序列创建主键的时候，nextval不会随着回滚操作回退。</p>
</li>
<li><p>掉电等原因，也可能造成不连续。由于代表序列的数组保存在内存中，断电的时候内存的内容丢失。恢复供电时候，序列直接从21开始。</p>
</li>
<li><p>插入失败的情况,但序列的值已经取了,此时的情况也会造成主键不连续</p>
</li>
</ul>
<h2 id="同义词"><a href="#同义词" class="headerlink" title="同义词"></a>同义词</h2><p><strong>同义词</strong>就是指表的别名。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol>
<li><p>scott用户想访问hr用户下的表employees。默认是不能访问的。需要hr用户为scott用户授权.</p>
<p><code>sqplus hr/11</code>		或		<code>conn hr/11</code>（已登录界面，切换登陆）</p>
</li>
<li><p>hr用户为scott用户开放了employees表的查询权限。</p>
</li>
</ol>
<p>   授权  <code>grant select on employees to scott;</code>	</p>
<ol start="3">
<li><p>这时scott用户就可以使用select语句，来查询hr用户下的employees表的信息了。</p>
<p><code>select count(*) from hr.employees;</code>   (若用户名叫zhangsanfeng则zhangsanfeng.employees)</p>
</li>
<li><p>hr.employees名字过长，为了方便操作，scott用户为它重设别名(<strong>同义词</strong>):<br><code>create synonym hremp for hr.employees;</code>  为hr.employees创建了同义词。</p>
</li>
</ol>
<p>创建同义词需要权限:管理员添加设置同义词权限操作如下:</p>
<ol>
<li><code>conn / as sysdba</code></li>
<li><code>grant create synonym to scott;</code></li>
<li><code>select count(*) from hremp;</code>	使用同义词进行表查询操作。</li>
</ol>
<p>同义词、视图等用法在数据<strong>保密要求较高</strong>的机构使用广泛，如银行机构。好处是既不影响对数据的操作，同时又能保证数据的安全。</p>
<h3 id="同义词的操作"><a href="#同义词的操作" class="headerlink" title="同义词的操作"></a>同义词的操作</h3><ul>
<li>创建同义词  <code>create synonym 同义词名(想设置的别名) fot 表名</code></li>
<li>删除同义词 <code>drop synonym 同义词名;</code></li>
<li>查询所有已经创建的同义词  <code>select synonym_name from user_synonyms;</code></li>
</ul>
<h1 id="sql插入相关"><a href="#sql插入相关" class="headerlink" title="sql插入相关"></a>sql插入相关</h1><p>关键字: <strong><code>insert into</code></strong></p>
<p>格式如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>	<span class="keyword">table</span> [(<span class="keyword">column</span> [, column...])]</span><br><span class="line"><span class="keyword">VALUES</span>			(<span class="keyword">value</span> [, value...]);</span><br></pre></td></tr></table></figure>

<p><strong>案例</strong></p>
<ul>
<li><p>插入<strong>全部列</strong></p>
<p><code>insert into dept values(51,&#39;51name&#39;,&#39;51loc&#39;);</code></p>
</li>
<li><p>插入<strong>部分列</strong>(没有写出的列自动填NULL)</p>
<p><code>insert into dept(deptno,dname) values(55,&#39;55name&#39;);</code></p>
</li>
<li><p><strong>&amp;符号的使用</strong> (使用&amp;会让用户输入值)</p>
<p><code>insert into dept(deptno,dname,loc) values(&amp;t1,&amp;t2,&amp;t3);</code></p>
</li>
</ul>
<p>&amp;符号可以用于所有DML语句中供用户输入,并不仅仅是插入语句.</p>
<h2 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h2><ul>
<li><p>拷贝表结构(不拷贝数据)     通过<code>where 1=2</code>这个必定错条件不让数据拷贝过去</p>
<p><code>create table tname_YYYY_MM_DD as select * from tname_xxxxx where 1=2;</code>      (as不能省略)</p>
</li>
<li><p>拷贝表(拷贝数据)    </p>
<p><code>create table tname_YYYY_MM_DD as select * from tname_xxxxx; </code>        (as不能省略)</p>
</li>
<li><p>批量插入</p>
<p><code>insert into tname_bak select * from tname where .....;</code></p>
</li>
</ul>
<h1 id="sql修改相关"><a href="#sql修改相关" class="headerlink" title="sql修改相关"></a>sql修改相关</h1><p>关键词 :  <strong><code>update</code></strong></p>
<p>格式: <code>update 表名 set col=值 where condtion</code></p>
<p>对于更新操作来说，一般会有一个“where”条件，如果没有这限制条件，更新的就是整张表[危险]。</p>
<p>案例  :  <code>update emp10 set sal=4000, comm=300 where ename = &#39;CLARK&#39;;</code></p>
<h1 id="sql删除相关"><a href="#sql删除相关" class="headerlink" title="sql删除相关"></a>sql删除相关</h1><p>关键词  :  <strong><code>delete</code></strong></p>
<p>格式: <code>delete from 表名 where condtion</code></p>
<p>注意: 如不加“where”会将整张表的数据删除。[危险]</p>
<p><code>from</code>关键字在<strong>Oracle</strong>中可以省略不写，但<strong>MySQL</strong>中不可以;<br>但在使用的时候建议还是加上<code>from</code>. </p>
<p>案例: <code>delete from emp10 where empno=7782;</code></p>
<p><code>truncate table dept_0915</code> 也可以清空一张表,但留下表结构</p>
<h2 id="truncate和delete的区别"><a href="#truncate和delete的区别" class="headerlink" title="truncate和delete的区别"></a>truncate和delete的区别</h2><ol>
<li>delete 逐条删除表“内容”，truncate 先摧毁表再重建。<br>(由于delete使用频繁，Oracle对delete优化后delete快于truncate)      <strong>truncate不能加where条件,只能整张表删除</strong></li>
<li><code>delete</code> 是<strong>DML语句</strong>，<code>truncate</code> 是<strong>DDL语句</strong>。<br>**DML语句可以<a href="#Oracle%E7%9A%84%E5%9B%9E%E6%94%B6%E7%AB%99">闪回(flashback)</a>**，DDL语句不可以闪回。<br>（闪回：做错了一个操作并且commit了，对应的撤销行为。了解）</li>
<li>由于delete是逐条操作数据，所以delete会产生碎片，truncate不会产生碎片。<br>（同样是由于Oracle对delete进行了优化，让delete不产生碎片）。<br>两个数据之间的数据被删除，删除的数据——碎片，整理碎片，数据连续，行移动</li>
<li><strong>delete不会释放空间，truncate 会释放空间</strong><br>用delete删除一张10M的表，空间不会释放。而truncate会。所以当确定表不再使用，应truncate</li>
<li><strong>delete可以回滚rollback, truncate不可以回滚rollback。</strong></li>
</ol>
<h1 id="sql查询相关"><a href="#sql查询相关" class="headerlink" title="sql查询相关"></a>sql查询相关</h1><h2 id="基本select语句"><a href="#基本select语句" class="headerlink" title="基本select语句"></a>基本select语句</h2><p>下面所有说法均以此图为案例</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210151722300.png" alt="image-20221015172212283"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span>语句的整体形式：</span><br><span class="line"><span class="keyword">select</span> col1, col2…  </span><br><span class="line"><span class="keyword">from</span> table_name</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">condition</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> col…</span><br><span class="line"><span class="keyword">having</span> condtion</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> col…</span><br></pre></td></tr></table></figure>

<p>p.s.  oracle中sql关键字不区分大小写</p>
<p>语法格式为：<code>SELECT  *|&#123;[DISTINCT] column|expression [alias],...&#125;FROM table;</code></p>
<p><strong>字符和日期要包含在单引号中</strong>  转义单引号本身使用两个单引号来完成转义</p>
<h3 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h3><p><code>DISTINCT</code>表示去重</p>
<p>查看不同部门的不同工种</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> detpno,job <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p><strong><code>distinct</code>的作用范围是作用于后面出现的所有的列名和表达式.</strong>   (有别于升降序是针对单个最近的列名)</p>
<p>上面的例句中,不会出现重复的[detpno和job的组合].</p>
<h3 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h3><p>select后可以接列名或表达式</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select empno,ename,sal,comm,sal*<span class="number">12</span> 年薪,sal*<span class="number">12</span>+nvl 年收入 from emp;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210151735254.png" alt="image-20221015173450512"></p>
<p><strong>包含NULL值的表达式都返回为空</strong>,因此所有COMM为空的,年收入也为空</p>
<p>解决方案如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal,comm,sal<span class="operator">*</span><span class="number">12</span> 年薪,sal<span class="operator">*</span><span class="number">12</span><span class="operator">+</span>nvl(comm,<span class="number">0</span>) 年收入 <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p><code>nvl(comm,0)</code>表示<code>nvl</code>如果<code>comm</code>为空,则当成0处理   <a href="#%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0">滤空函数参考</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210151738265.png" alt="image-20221015173808216"></p>
<h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><p>select后接的列名或表达式或from后接的表名(<a href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2">多表查询</a>)可以起别名   关键词: <code>as</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">as</span> 工资,comm 奖金,sal<span class="operator">*</span><span class="number">12</span> &quot;年 薪&quot; <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p>注意:  </p>
<ul>
<li>as可以省略</li>
<li>如果别名中间有空格,需要使用<code>&quot;&quot;</code>引起来(不加双引号,英语别名统一显示为大写)</li>
</ul>
<p><strong>别名不能在where中直接替代表达式和列名使用.</strong></p>
<h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><p>使用关键词  <strong><code>where</code></strong>  过滤出需要的数据行</p>
<h4 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">=  等于(不是==)		&gt;	大于</span><br><span class="line">&gt;= 大于等于		    &lt;	小于</span><br><span class="line">&lt;= 小于等于			  &lt;&gt;	不等于(也可以是!=)</span><br><span class="line">between…and:介于两值之间,闭区间,包含两边的值.</span><br><span class="line"><span class="comment">//过滤col1为空的数据,不能使用 where col1 = null(不正确);</span></span><br><span class="line">过滤col1为空的数据: where coll is null;</span><br><span class="line">过滤col1不为空的数据: where coll is not null;</span><br><span class="line"><span class="comment">//col1 = null  和  col1 != null 的这两个条件都返回假,不管他col1是什么值</span></span><br></pre></td></tr></table></figure>

<h4 id="集合运算符"><a href="#集合运算符" class="headerlink" title="集合运算符"></a>集合运算符</h4><ul>
<li><code>IN</code>	等于列表中的任意一个</li>
<li><code>ANY</code>	和集合返回的任意一个值比较   <a href="#%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2">配合子查询使用</a></li>
<li><code>ALL</code>	和集合返回的所有值比较     <a href="#%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2">配合子查询使用</a></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">in</span>：在集合中       <span class="keyword">not</span> <span class="keyword">in</span> 不在集合中</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>col <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>)等同于 col<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> col<span class="operator">=</span><span class="number">2</span></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>col <span class="keyword">not</span> <span class="keyword">in</span>(<span class="number">1</span>,<span class="number">2</span>)等同于col<span class="operator">!=</span><span class="number">1</span> <span class="keyword">and</span> col<span class="operator">!=</span><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><a href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%B8%ADnull"> <code>not in</code> 的<code>null</code>注意点参考</a></p>
<h4 id="模糊查找"><a href="#模糊查找" class="headerlink" title="模糊查找"></a>模糊查找</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">like</span>：模糊查询  <span class="operator">/</span><span class="operator">/</span><span class="operator">%</span>匹配任意多个字符,  _匹配一个字符, 使用<span class="keyword">escape</span>表示转义字符(下面案例有使用方式),转义单引号本身使用两个单引号来完成转义</span><br></pre></td></tr></table></figure>

<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AND		逻辑并  (优先级依次往下)</span><br><span class="line">OR 		逻辑或</span><br><span class="line">NOT		逻辑非</span><br><span class="line"><span class="comment">//小括号可以调整优先级</span></span><br></pre></td></tr></table></figure>

<p>SQL优化：SQL在解析where的时候，是<strong>从右至左解析</strong>的。</p>
<p>所以： </p>
<ul>
<li><code>and</code>时应该将易假的值放在右侧;</li>
<li><code>or</code>时应该将易真的值放在右侧.</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;KING&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> hiredate<span class="operator">=</span> <span class="string">&#x27;17-11月-81&#x27;</span></span><br><span class="line">日期格式要与查询的时候一样,日期格式默认是DD<span class="operator">-</span>MON<span class="operator">-</span>RR</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal<span class="operator">&gt;=</span><span class="number">1000</span> <span class="keyword">and</span> sal<span class="operator">&lt;=</span><span class="number">2000</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="keyword">between</span> <span class="number">1000</span> <span class="keyword">and</span> <span class="number">2000</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">where</span> deptno <span class="keyword">in</span>(<span class="number">10</span>,<span class="number">20</span>);</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询员工首字母为S的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;S%&#x27;</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询员工编号为<span class="number">79</span>开头的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> empno <span class="keyword">like</span> <span class="string">&#x27;79%&#x27;</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询员工姓名为<span class="number">4</span>个字母长度的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;____&#x27;</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询员工姓名包含下划线_的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%\_%&#x27;</span> <span class="keyword">escape</span> <span class="string">&#x27;\&#x27;</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="keyword">escape</span>后接的字符表示他是转义字符</span><br></pre></td></tr></table></figure>

<p><strong>[重点]</strong> <strong>escape后接的字符表示他是转义字符</strong></p>
<p>注意:表中的列的值是区分大小写的,但关键词不区分大小写</p>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p>关键词: <code>order by</code></p>
<p>基本格式: <code>select ... from ... where condition order by colname|alias|expr(表达式)|number(序号)</code>   (序号表示select后面出现的次序,从1开始)</p>
<p>ORDER BY子句在<strong>SELECT语句的最末尾</strong>, 是对select查询的最后的结果进行排序.</p>
<p>使用 ORDER BY 子句排序<br>•	<code>ASC（ascend）</code>: 升序。默认采用升序方式。<br>•	<code>DESC（descend）</code>: 降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>员工信息按入职日期先后排序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> hiredate <span class="keyword">asc</span>;(<span class="keyword">asc</span>可以省略)</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询员工信息按奖金逆序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> comm <span class="keyword">desc</span> nulls <span class="keyword">last</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查询员工编号,员工姓名和工资,按照序号(工资)进行排序</span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p><strong>[注意]  NULL在排序中表现为无穷大</strong>    可以使用<code>nulls last</code>使null的信息放到最后.</p>
<p><strong>多元素排序</strong>  : 对多个元素进行排序时,优先排序第一个元素,仅在第一个元素相同时对第二个元素进行排序,以此类推.</p>
<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><p>分组数据使用**<code>group by</code>**关键字.	可以配合<a href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0">分组函数</a>使用<br>$$<br>select\ \ …,count()\ \ from\ \ emp \ \ where\ \ …\ \ group\ \ by\ \ …<br>$$<br>按照group by 后给定的表达式，将from后面的table进行分组。针对每一组，使用<a href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0">组函数</a>, 即先分组, 再分组统计.(<a href="#%E8%BF%87%E6%BB%A4">where过滤部分数据</a>可写可不写)</p>
<p><strong>[ [注意] ]</strong>    <strong>select后面存在没有出现在分组函数中的列名,一定要出现在group by子句中</strong>  ,不然会报错.(常数可以不出现在group by子句中)</p>
<p>因为分组数据会限制行数,如果select出现了别的列名,那么这一组的别的列名的值会出现多个,但只能显示一行,显然就冲突了.</p>
<p>案例: 统计各个部门的平均工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191639980.png" alt="image-20221019163924637"></p>
<hr>
<p>统计各个部分不同工种的平均工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno, job, <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno, job; </span><br></pre></td></tr></table></figure>

<p>按照<strong>deptno, job的组合</strong>来分组.</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191720152.png" alt="image-20221019172030679" style="zoom: 67%;" />

<h3 id="分组函数过滤"><a href="#分组函数过滤" class="headerlink" title="分组函数过滤"></a>分组函数过滤</h3><p>只有使用关键词 **<code>having</code>**才能对<a href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0"><strong>分组函数</strong></a>进行过滤.(不能用where)</p>
<p><strong>[注意]</strong> </p>
<ul>
<li><strong>having必须配合group by使用</strong>   不能单独存在</li>
<li><strong>having后面不能使用别名</strong>(where可以),可以使用函数</li>
<li>不能在where中使用组函数,<strong>可以在having中使用组函数</strong></li>
</ul>
<p>p.s.分组的情况下,having和where均可以对<strong>非分组函数</strong>进行过滤,下面两句效果一致:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">!=</span><span class="number">10</span> <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno <span class="keyword">having</span> deptno<span class="operator">!=</span><span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong>分组函数过滤案例</strong></p>
<p>查询平均薪水大于2000的部门 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno <span class="keyword">having</span> <span class="built_in">avg</span>(sal)<span class="operator">&gt;</span><span class="number">2000</span>;</span><br></pre></td></tr></table></figure>

<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>在子句中没有使用组函数的情况下，where、having都可以，应该怎么选择？	</p>
<p>SQL优化： <strong>尽量采用where</strong>。<br>如果有分组的话，where是先过滤再分组，而having是先分组再过滤。当数据量庞大如1亿条，where优势明显。</p>
<h2 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h2><p>单行函数:只对一行进行变换，产生一个结果。函数可以没有参数，但必须要有返回值。</p>
<ul>
<li>操作数据对象</li>
<li>接受参数返回一个结果</li>
<li>只对一行进行变换</li>
<li>每行返回一个结果</li>
<li>可以转换数据类型</li>
<li>可以嵌套</li>
<li>参数可以是一列或一个值</li>
</ul>
<h3 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h3><ul>
<li><p><code>lower</code> 小写, <code>upper</code> 大写, <code>initcap</code>单词的首字母大写</p>
</li>
<li><p><code>concat</code>(连接符<code>||</code>)</p>
<p>concat函数只能连接两个字符串, 若想连接三个的话只能嵌套调用;<code>||</code> 可以连接多个字符串, 建议使用||来连接字符串.</p>
</li>
<li><p><code>substr(str,pos,len)</code>截取字符串str,从pos位置开始截取len个</p>
<p>注意:pos是从1开始的, 若len为0表示从pos开始, 截取到最后, 若pos为负数, 表示从末尾倒数开始截取</p>
</li>
<li><p><code>instr(str, substr)</code>:判断substr是否在str中存在, 若存在返回第一次出现的位置, 若不存在则返回0</p>
</li>
<li><p>lpad和rpad–<code>l(r)pad(str, len, ch)</code>:返回len长度的字符串, 如果str不够len的话, 在左(右)填充ch这个字符</p>
</li>
<li><p><code>trim(str)</code>:去掉字符串str首部和尾部的空格,中间的空格不去掉</p>
<p>也可以<code>trim(c from str)</code>:去掉str中的c字符</p>
</li>
<li><p><code>replace(str, old, new)</code>:将str字符串中的old字符串替换成new字符串</p>
</li>
<li><p>length和lengthb</p>
<p><code>select length(&#39;hello world&#39;) 字符数, lengthb(&#39;hello world&#39;) 字节数 from dual;</code><br>注意:<strong>对于length函数一个汉字是一个字符</strong>, <strong>对于lengthb函数,一个汉字占两个</strong>,这两个函数对于普通字符串没有什么区别.</p>
</li>
</ul>
<h3 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h3><ul>
<li><code>round(n,m)</code>: 四舍五入,对n这个数值四舍五入保留小数点后m位</li>
<li><code>trunc(n,m)</code>: 截取,对n这个数值截取小数点后m位前的内容</li>
<li><code>mod(n,m)</code>:n对m取余</li>
<li><code>ceil(n)</code>:对n向上取整;<code>floor(n)</code>:对n向下取整</li>
</ul>
<h3 id="转换函数"><a href="#转换函数" class="headerlink" title="转换函数"></a>转换函数</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210161727853.png" alt="image-20221016172705248"></p>
<p><strong>显示转换</strong>：借助to_char(数据，格式)、to_number、to_date函数来完成转换。</p>
<p><strong>[注意]</strong> 如果隐式、显示都可以使用，应该首选显示，这样可以省去oracle的解析过程。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210161727812.png" alt="image-20221016172746213"></p>
<h4 id="to-char函数"><a href="#to-char函数" class="headerlink" title="to_char函数"></a>to_char函数</h4><p><strong>功能</strong>:将date或number类型转换成字符串类型</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191135012.png" alt="image-20221019113415897"></p>
<p>案例:</p>
<p>查询员工的薪水: 使用2位小数, 本地货币代码, 千位符 	</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_char(sal, <span class="string">&#x27;L9,999.99&#x27;</span>) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p>特别注意:’L9,999.99’之间没有空格</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191138144.png" alt="image-20221019113747079" style="zoom: 50%;" />

<hr>
<p><a href="#date%E7%9A%84%E6%A0%BC%E5%BC%8F">参考date的格式</a></p>
<p>在屏幕上显示如下字符串：<br>2015-05-11 16:17:06 今天是 星期一       </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_char(sysdate, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss &quot;今天是&quot; day&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<p><strong>说明</strong>: 在<strong>固定的格式里加入自定义的格式是可以</strong>的，必须要加<code>””</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191146163.png" alt="image-20221019114539105"></p>
<h4 id="to-number函数"><a href="#to-number函数" class="headerlink" title="to_number函数"></a>to_number函数</h4><p><strong>功能</strong>:将字符串转换成number类型</p>
<p>案例:</p>
<p>将￥2,975.00转化成数字2975：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_number(<span class="string">&#x27;￥2,975.00&#x27;</span>, <span class="string">&#x27;L9,999.99&#x27;</span>) 转成数字 <span class="keyword">from</span> dual;  </span><br></pre></td></tr></table></figure>

<h4 id="to-date函数"><a href="#to-date函数" class="headerlink" title="to_date函数"></a>to_date函数</h4><p><strong>功能</strong>:将字符串转换成date类型</p>
<p>已知字符串’2015-05-11 15:17:06 今天是 星期一’转化成日期.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_date(<span class="string">&#x27;2015-05-11 15:17:06 今天是 星期一&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss &quot;今天是&quot; day&#x27;</span>) 	<span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191149773.png" alt="image-20221019114858405"></p>
<hr>
<p>求1980年12月17日入职的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> hiredate <span class="operator">=</span> to_date(<span class="string">&#x27;17-12月-80&#x27;</span>,<span class="string">&#x27;DD-MON-RR&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="date的格式"><a href="#date的格式" class="headerlink" title="date的格式"></a>date的格式</h4><p>(格式不区分大小写)</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>YYYY</td>
<td>Full year in numbers</td>
<td>2011</td>
</tr>
<tr>
<td>RR</td>
<td>年份的后两个数字</td>
<td>11</td>
</tr>
<tr>
<td>YEAR</td>
<td>Year spelled out(年的英文全称)</td>
<td>twenty eleven</td>
</tr>
<tr>
<td>MM</td>
<td>Two-digit value of month 月份（两位数字）</td>
<td>04</td>
</tr>
<tr>
<td>MONTH&#x2F;mon</td>
<td>Full name of the month（月的全称）</td>
<td>4月</td>
</tr>
<tr>
<td>DY</td>
<td>Three-letter abbreviation of the day of the week(星期几)</td>
<td>星期一</td>
</tr>
<tr>
<td>DAY</td>
<td>Full name of the day of the week</td>
<td>星期一</td>
</tr>
<tr>
<td>DD</td>
<td>Numeric day of the month</td>
<td>02</td>
</tr>
<tr>
<td>HH24</td>
<td>2位数字的24小时制的小时数</td>
<td>11</td>
</tr>
<tr>
<td>MI</td>
<td>2位数字的分钟数</td>
<td>52</td>
</tr>
<tr>
<td>ss</td>
<td>2位数字的秒数</td>
<td>44</td>
</tr>
</tbody></table>
<h4 id="时间和日期函数"><a href="#时间和日期函数" class="headerlink" title="时间和日期函数"></a>时间和日期函数</h4><p><code>sysdate</code> 当前的系统时间    如:  <code>select sysdate from dual;</code></p>
<p>oracle日期型+1 &#x3D; 加一天</p>
<p>日期和日期可以<strong>相减表示相隔多少天</strong>, 但是<strong>不允许相加</strong>, 两个日期相加没有意义(报错: <code>ORA-00975</code>: 不允许日期 + 日期), <strong>日期只能和数字相加</strong></p>
<p>上面方式如果计算月差,年差,周差,等可以分别除以30,365,7.但这样计算显然是不精确的</p>
<p>如下日期函数才来精确计算</p>
<ul>
<li><code>months_between(date1,date2)</code>   计算date1-date2的月差</li>
<li><code>add_months(date,n)</code>   date日期增加n个月</li>
<li><code>last_day(date)</code>  date日期的这个月的最后一天</li>
<li><code>next_day(date,&#39;星期一&#39;)</code>   date日期的下一个星期一</li>
<li><code>round(date,&#39;month&#39;)</code>  date日期按月份四舍五入(过了一半就加1,没过一半就不加)</li>
<li><code>trunc(date,&#39;year&#39;)</code> date日期按年份截断(月份和日数归最小),按月截断的话表示日数归最小</li>
</ul>
<h3 id="通用函数"><a href="#通用函数" class="headerlink" title="通用函数"></a>通用函数</h3><p>这些函数适用于任何数据类型，同时也适用于空值：</p>
<ul>
<li><p><strong><code>NVL (expr1, expr2)</code></strong>     滤空函数： 如果expr1为NULL，返回expr2</p>
</li>
<li><p><strong><code>NVL2 (expr1, expr2, expr3)</code></strong>    滤空函数： 如果expr1为NULL，返回expr3,否则返回expr2</p>
</li>
<li><p><strong><code>NULLIF (expr1, expr2)</code></strong>   当 expr1 &#x3D; expr2 时返回null, 不相等的时候返回expr1值。</p>
</li>
<li><p><strong><code>COALESCE (expr1, expr2, ..., exprn)</code></strong>   找非空值函数  从左向右找参数中第一个不为空的值。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191431201.png" alt="image-20221019143055678" style="zoom:67%;" /></li>
</ul>
<h2 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h2><p>分组函数:也称之为组函数或者聚合函数,oracle提供的常用的有5个函数: avg、count、max、min、sum操作的是一组数据，返回一个结果。     可以配合<a href="#%E5%88%86%E7%BB%84">分组数据</a>使用(select后同时存在分组函数和非分组函数的情况下,必须配合<a href="#%E5%88%86%E7%BB%84">分组数据</a>使用)</p>
<ul>
<li><p><strong><code>count(列名或1)</code></strong>  计算行数(滤空)  1表示只要有值,都算+1;列名表示按照该列名算行数</p>
<p><code>select count(distinct job) from emp</code>显示工作总数(去重才能计算到工作总数) </p>
</li>
<li><p><strong><code>avg(列名)</code></strong>  求平均列值(滤空)      注意: <code>avg(comm)</code>   等同于   <code>sum(comm)/count(comm)</code> (滤空) 而非<code>sum(comm)/count(empno)</code> (不滤空),前者是有奖金的人的奖金平均值,后者是全部人平均奖金的值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191613017.png" alt="image-20221019161354607"></p>
</li>
<li><p><strong><code>max(列名)</code></strong>  求列值最大值(滤空)</p>
</li>
<li><p><strong><code>min(列名)</code></strong>  求列值最小值(滤空)</p>
</li>
<li><p><strong><code>sum(总和)</code></strong>   求列值总和(滤空)</p>
</li>
</ul>
<p><strong>总结 : 分组函数自带滤空功能</strong></p>
<p>可以通过 <a href="#%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0">nvl函数</a> 去掉分组函数的滤空功能,如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(nvl(comm,<span class="number">0</span>)) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h4 id="count注意点"><a href="#count注意点" class="headerlink" title="count注意点"></a>count注意点</h4><p><code>count(*)</code>和<code>count(e.empno)</code>的区别:</p>
<ul>
<li><code>count(*)</code> 只要一行中有一个字段不为空就被统计上</li>
<li><code>count(e.empno)</code> 只有<code>e.empno</code>不为空才会被统计上</li>
<li><strong>[注意]</strong> 不能使用<code>count(e.*)</code>, 会报错.应该写成某个表的具体的列.</li>
</ul>
<h2 id="条件表达式与条件函数"><a href="#条件表达式与条件函数" class="headerlink" title="条件表达式与条件函数"></a>条件表达式与条件函数</h2><p>在SQL中无法实现if else 逻辑。当有这种需求的时候，可以使用case 或者 decode</p>
<h3 id="case条件表达式"><a href="#case条件表达式" class="headerlink" title="case条件表达式"></a>case条件表达式</h3><p>case:是一个<strong>表达式</strong>，其语法为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> expr  <span class="keyword">WHEN</span> comparison_expr1 <span class="keyword">THEN</span> return_expr1</span><br><span class="line">[<span class="keyword">WHEN</span> comparison_expr2 <span class="keyword">THEN</span> return_expr2</span><br><span class="line"> <span class="keyword">WHEN</span> comparison_exprn <span class="keyword">THEN</span> return_exprn</span><br><span class="line"> <span class="keyword">ELSE</span> else_expr]</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>上面代码解释,根据expr列名或表达式来判断,when后面的为判断值,如果expr &#x3D; 该值,则返回return_expr1表达式.else后接when没提到的情况的返回值else_expr.</p>
<p><strong>案例</strong></p>
<p>老板打算给员工涨工资, 要求：<br>总裁(PRESIDENT)涨1000, 经理(MANAGER)涨800, 其他人涨400. 请将涨前, 涨后的薪水列出。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, job, sal 涨前薪水, 	</span><br><span class="line"><span class="keyword">case</span> job </span><br><span class="line"><span class="keyword">when</span> <span class="string">&#x27;PRESIDENT&#x27;</span> <span class="keyword">then</span> sal<span class="operator">+</span><span class="number">1000</span> </span><br><span class="line"><span class="keyword">when</span> <span class="string">&#x27;MANAGER&#x27;</span>   <span class="keyword">then</span> sal<span class="operator">+</span><span class="number">800</span> </span><br><span class="line"><span class="keyword">else</span>  sal <span class="operator">+</span> <span class="number">400</span></span><br><span class="line"><span class="keyword">end</span> 涨后薪水 </span><br><span class="line"><span class="keyword">from</span> emp;  </span><br></pre></td></tr></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210191532530.png" alt="image-20221019153254072" style="zoom:67%;" />

<h3 id="decode函数"><a href="#decode函数" class="headerlink" title="decode函数"></a>decode函数</h3><p>decode：是一个<strong>函数</strong>，其语法为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DECODE(col<span class="operator">|</span>expression, search1, result1 </span><br><span class="line">			[, search2, result2,...,]</span><br><span class="line">			[, <span class="keyword">default</span>])</span><br></pre></td></tr></table></figure>

<p>除第一个和最后一个参数之外，中间的参数都是成对呈现的 <code>(参1, 条件, 值, 条件, 值, …, 条件, 值, 尾参)</code></p>
<p><strong>案例</strong></p>
<p>题目与效果图等同于case条件变量案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename, job, sal 涨前薪水, decode(job, <span class="string">&#x27;PRESIDENT&#x27;</span>, sal <span class="operator">+</span> <span class="number">1000</span>,  </span><br><span class="line"><span class="string">&#x27;MANAGER&#x27;</span>, sal <span class="operator">+</span> <span class="number">800</span>,  </span><br><span class="line">sal <span class="operator">+</span> <span class="number">400</span>) <span class="keyword">as</span> 涨后薪水 </span><br><span class="line"><span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>只要select后出现多表重复存在的列名,则需要标识列名属于谁,如:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno <span class="keyword">from</span> emp e,dept d;</span><br></pre></td></tr></table></figure>

<p>否则报错:  <code>ORA-00918: 未明确定义列</code></p>
<h3 id="笛卡尔积"><a href="#笛卡尔积" class="headerlink" title="笛卡尔积"></a>笛卡尔积</h3><p>两个表的笛卡尔积 &#x3D; 两个表的项之间组合的所有可能的集合</p>
<p>笛卡尔积的行数 &#x3D; table1的行数 x table2的行数<br>笛卡尔积的列数 &#x3D; table1的列数 + table2的列数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210201658550.png" alt="image-20221020165843162"></p>
<p>笛卡尔积中包含不正确的无用数据.上图中很显然左表(黄)和右表(绿)的deptno匹配会出现不相等的情况,即无效数据.(添加图中连接条件可以去除无效行)</p>
<p>多表查询就是按照给定条件(连接条件)，从笛卡尔全集中选出正确的结果。</p>
<h3 id="连接条件"><a href="#连接条件" class="headerlink" title="连接条件"></a>连接条件</h3><ul>
<li><code>Equijoin</code>：等值连接</li>
<li><code>Non-equijoin</code>：不等值连接</li>
<li><code>Outerjoin</code>：外连接</li>
<li><code>Selfjoin</code>：自连接</li>
</ul>
<h4 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h4><p>只返回满足连接条件的数据（两边都有的才显示）。</p>
<p>where子句后面的条件，是“&#x3D;”为等值连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.<span class="operator">*</span> <span class="keyword">from</span> emp e, dept d <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure>

<h4 id="不等值连接"><a href="#不等值连接" class="headerlink" title="不等值连接"></a>不等值连接</h4><p>where子句后面的条件，不是“&#x3D;”为不等值连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.empno,e.ename,e.sal,s.grade <span class="keyword">from</span> emp e,salgrade s <span class="keyword">where</span> e.sal<span class="operator">&lt;=</span>s.hisal <span class="keyword">and</span> e.sal<span class="operator">&gt;=</span> s.losal;</span><br></pre></td></tr></table></figure>

<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><p>按部门统计员工人数，显示： 部门号 部门名称 人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.deptno,dname,<span class="built_in">count</span>(e.empno) <span class="keyword">from</span> dept d,emp e <span class="keyword">where</span> d.deptno <span class="operator">=</span> e.deptno <span class="keyword">group</span> <span class="keyword">by</span> dname,d.deptno;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210201801063.png" alt="image-20221020180059609"></p>
<p>虽然显示了如上结果,但因为<code>where d.deptno = e.deptno</code>,缺失了40号部门</p>
<h5 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h5><p>右边deptno显示全</p>
<p>写法：与叫法相反：<code>where e.deptno(+)=d.deptno</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.deptno,dname,<span class="built_in">count</span>(e.empno) <span class="keyword">from</span> dept d,emp e <span class="keyword">where</span> e.deptno(<span class="operator">+</span>)<span class="operator">=</span>d.deptno <span class="keyword">group</span> <span class="keyword">by</span> dname,d.deptno;</span><br></pre></td></tr></table></figure>

<h5 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h5><p>左边deptno显示全</p>
<p>写法：与叫法相反：<code>where d.deptno=e.deptno(+)</code> </p>
<p>左外连接和右外连接效果完全一样,只是顺序不同.</p>
<p><strong>[重点]</strong>  <strong><code>(+)</code>符号加在哪就看两边的行数想要显示全,就在另一边加上该符号</strong></p>
<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><p>核心，通过表的别名，将同一张表视为多张表。</p>
<p>查询员工信息：xxx的老板是 yyy </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename <span class="operator">||</span> <span class="string">&#x27;  的老板是 &#x27;</span> <span class="operator">||</span> b.ename <span class="keyword">from</span> emp e, emp b <span class="keyword">where</span> e.mgr<span class="operator">=</span>b.empno;</span><br></pre></td></tr></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210211432867.png" alt="image-20221021143252478" style="zoom:50%;" />

<p>由于KING没有老板,所以可以使用外连接的方式把king也显示出来:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.ename <span class="operator">||</span> <span class="string">&#x27;  的老板是 &#x27;</span> <span class="operator">||</span> nvl(b.ename,<span class="string">&#x27;没有&#x27;</span>) <span class="keyword">from</span> emp e, emp b <span class="keyword">where</span> e.mgr<span class="operator">=</span>b.empno(<span class="operator">+</span>);</span><br></pre></td></tr></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210211602703.png" alt="image-20221021160247799" style="zoom:67%;" />

<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>子查询语法很简单，就是select 语句的嵌套使用,即<strong>sql嵌套sql</strong>。</p>
<p>语法格式: 主查询的where、select、having、from后都可以放置子查询,如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	select_list</span><br><span class="line"><span class="keyword">FROM</span>	<span class="keyword">table</span></span><br><span class="line"><span class="keyword">WHERE</span>	expr operator</span><br><span class="line">			(<span class="keyword">SELECT</span>	select_list</span><br><span class="line">		   <span class="keyword">FROM</span>		<span class="keyword">table</span>);</span><br></pre></td></tr></table></figure>

<p>查询工资比SCOTT高的员工信息.</p>
<ol>
<li><p>查出SCOTT的工资</p>
<p><code>select ename, sal from emp where ename=&#39;SCOTT&#39;; 结果为3000</code></p>
</li>
<li><p>查询比3000高的员工</p>
<p><code>select * from emp where sal&gt;3000;  </code></p>
</li>
</ol>
<p>通过两步可以将问题结果得到。子查询，可以将两步合成一步。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> emp  </span><br><span class="line"><span class="keyword">where</span> sal  <span class="operator">&gt;</span>  (<span class="keyword">select</span> sal  </span><br><span class="line">					     <span class="keyword">from</span> emp  </span><br><span class="line">					      <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SCOTT&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>写一个较复杂的子查询的时候,要合理的添加换行,缩进</li>
<li>主查询的where、<a href="#select%E5%90%8E%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B">select</a>、<a href="#having%E5%90%8E%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B">having</a>、<a href="#from%E5%90%8E%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B">from</a>后都可以放置子查询</li>
<li>强调：在from后面放置的子查询(…), from后面放置是一个集合(表、查询结果)</li>
<li>一般不在子查询中使用order by, 但在<a href="#top-N%E9%97%AE%E9%A2%98">Top-N分析问题</a>中，必须使用<code>order by</code>  </li>
<li><strong>子查询可以放在select后，但，要求该子查询必须是单行子查询：(该子查询本身只返回一条记录，2+叫多行子查询)</strong></li>
<li><strong>单行子查询只能使用单行操作符；多行子查询只能使用多行操作符</strong></li>
</ul>
<h3 id="where后子查询案例"><a href="#where后子查询案例" class="headerlink" title="where后子查询案例"></a>where后子查询案例</h3><p>参考第一个例子.</p>
<h3 id="select后子查询案例"><a href="#select后子查询案例" class="headerlink" title="select后子查询案例"></a>select后子查询案例</h3><p>查询10号部分员工号,员工姓名,部门编号,部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.empno,e.ename,e.deptno,(<span class="keyword">select</span> dname <span class="keyword">from</span> dept <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">10</span>) <span class="keyword">from</span> emp e <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>此处的子查询(select后)必须是<strong>单行子查询</strong>.</p>
<h3 id="having后子查询案例"><a href="#having后子查询案例" class="headerlink" title="having后子查询案例"></a>having后子查询案例</h3><p>查询部门平均工资高于20号部门平均工资的部门和平均工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,<span class="built_in">avg</span>(sal) </span><br><span class="line"><span class="keyword">from</span> emp </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> deptno </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(sal)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="built_in">avg</span>(sal) </span><br><span class="line">                 <span class="keyword">from</span> emp </span><br><span class="line">                 <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<h3 id="from后子查询案例"><a href="#from后子查询案例" class="headerlink" title="from后子查询案例"></a>from后子查询案例</h3><p>查询员工的姓名、薪水和年薪：要求格式为:<code>select * from ___________________</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> ename 姓名,sal 薪水,sal<span class="operator">*</span><span class="number">12</span><span class="operator">+</span>nvl(comm,<span class="number">0</span>) 年薪 <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure>

<h3 id="多行子查询"><a href="#多行子查询" class="headerlink" title="多行子查询"></a>多行子查询</h3><p>子查询返回2条记录以上就叫多行。</p>
<p>多行操作符有：	</p>
<ul>
<li><code>IN</code>		等于列表中的任意一个</li>
<li><code>ANY</code>	  和子查询返回的任意一个值比较</li>
<li><code>ALL</code>		和子查询返回的所有值比较</li>
</ul>
<p><strong>案例</strong></p>
<p>查询薪水比30号部门任意一个员工高的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">单行子查询方式min实现:</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">min</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">30</span>);  </span><br><span class="line">多行子查询方式<span class="keyword">ANY</span>实现</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="keyword">any</span>(<span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<hr>
<p>查询薪水比30号部门所有员工高的员工信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">单行子查询方式max实现:</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">max</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">30</span>);</span><br><span class="line">多行子查询方式<span class="keyword">ALL</span>实现</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="keyword">all</span> (<span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> deptno<span class="operator">=</span><span class="number">30</span>); </span><br></pre></td></tr></table></figure>

<h3 id="单行子查询"><a href="#单行子查询" class="headerlink" title="单行子查询"></a>单行子查询</h3><p>单行子查询就是该条子查询执行结束时, 只返回一条记录(一行数据)。</p>
<p>使用单行操作符:<br>&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;或者!&#x3D;	</p>
<h3 id="子查询中null"><a href="#子查询中null" class="headerlink" title="子查询中null"></a>子查询中null</h3><p>判断一个值等于、不等于空，不能使用&#x3D;和!&#x3D;号，而应该使用is 和 not。</p>
<p><strong>[ [特别注意] ]</strong>  如果<strong>集合中有NULL值，不能使用not in</strong>。如： not in (10， 20， NULL)，但是可以使用in。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用等于号与不等于号和null做比较都返回假</span></span><br><span class="line">值 =  null   <span class="comment">//返回假</span></span><br><span class="line">值 != null   <span class="comment">//返回假</span></span><br></pre></td></tr></table></figure>

<p>因为, not in操作符等价于 !&#x3D;All，最后一个表达式为假，整体假;<br>而a in (10, 20, NULL)等价于(a &#x3D; 10) or (a &#x3D; 20) or (a &#x3D; null)只要有一个为真即为真。<br>        in 操作符等价于 &#x3D; Any </p>
<h3 id="子查询优化"><a href="#子查询优化" class="headerlink" title="子查询优化"></a>子查询优化</h3><blockquote>
<p>一般情况下，子查询使用order by或是不使用order by对主查询来说没有什么意义。子查询的结果给主查询当成集合来使用，所以没有必要将子查询order by。<br>但，在Top-N分析问题中，必须使用order by</p>
</blockquote>
<p><strong>SQL优化</strong>: 理论上，既可以使用子查询，也可以使用多表查询，尽量使用“多表查询”。子查询有2次from, 与数据库服务的交互多.</p>
<h3 id="top-N问题"><a href="#top-N问题" class="headerlink" title="top-N问题"></a>top-N问题</h3><p>Top-N指排名前N相关的问题</p>
<p>解决top-N问题使用了一个关键词   <strong><code>rownum</code>   (行号)</strong></p>
<p><strong><code>rownum</code>的生成是在集合第一次产生的时候就生成了.</strong>  可以将查询的结果看成一个表来用</p>
<p>通过子查询排序的方式得到一个临时表,在外部查询中按照rownum来区分排名.   参考如下案例:</p>
<p>查询emp表中工资在5-8的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> rn 排名,d.<span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> rownum rn,e.<span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal) e) d <span class="keyword">where</span> rn<span class="operator">&lt;=</span><span class="number">8</span> <span class="keyword">and</span> rn<span class="operator">&gt;=</span><span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p><strong>[讲解]</strong> 二级子查询中,子集合中的rownum不是列名的话,不能在上级查询中被作为筛选条件,解决方式是给rownum提供一个别名,再多加一层子查询,使最外部查询中<code>rownum的别名</code>成为一个列名,以此参与筛选.</p>
<p>结果:<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210281618481.png" alt="image-20221028161825421"></p>
<h2 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h2><p>集合运算的操作符。<code>A ∩ B</code>、<code>A ∪ B</code>、<code>A - B</code>  			</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210231341844.png" alt="image-20221023134056913"></p>
<p><strong><code>union</code>和<code>union all</code>的区别</strong>: <code>union</code>会去掉重复的, 而<code>union all</code>会全部显示</p>
<p><strong>集合运算注意点</strong></p>
<ul>
<li>参与运算的各个集合必须<strong>列数相同</strong>，且对应<strong>每个列的类型一致</strong>。(不然会报错类型不一致:<code>ORA-01790</code> 或 列数不同:<code>ORA-01789</code>)</li>
<li>采用第一个集合的表头作为最终使用的表头.</li>
<li>可以使用括号()先执行后面的语句。</li>
</ul>
<p><strong>案例</strong></p>
<p>按照部门统计各部门不同工种的工资情况，要求按如下格式输出：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210231519944.png" alt="image-20221023151906466"></p>
<p>照集合的要求,必须列数相同,类型一致,所以写法如下,使用null强行占位!</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> deptno,job,<span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno,job</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> deptno,to_char(<span class="keyword">null</span>),<span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> to_number(<span class="keyword">null</span>),to_char(<span class="keyword">null</span>),<span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp;	</span><br></pre></td></tr></table></figure>

<p><strong>sql优化</strong>  :  集合运算的性能一般较差</p>
<h2 id="一些tips"><a href="#一些tips" class="headerlink" title="一些tips"></a>一些tips</h2><p>尽量使用列名，用列名代替* (oracle 9i之前不同， 之后一样)</p>
<p><code>sysdate</code>可以作为列名在select后使用,表示当前日期,如果from后面不来源于任何表,可以使用伪表<code>dual</code></p>
<h2 id="综合案例"><a href="#综合案例" class="headerlink" title="综合案例"></a>综合案例</h2><p><strong>查询部门工资大于本部门平均工资的员工信息</strong></p>
<p>先查询10号部门:<br>      使用子查询:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno,</span><br><span class="line">		       e.empno,</span><br><span class="line">		       e.ename,</span><br><span class="line">		       e.sal,</span><br><span class="line">		       (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">10</span>) </span><br><span class="line">		  <span class="keyword">from</span> emp e</span><br><span class="line">		 <span class="keyword">where</span> e.deptno <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">		   <span class="keyword">and</span> e.sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>推广到所有部门   (其实就是<code>10</code>换成<code>e.deptno</code>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno,</span><br><span class="line">		       e.empno,</span><br><span class="line">		       e.ename,</span><br><span class="line">		       e.sal,</span><br><span class="line">		       (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="operator">=</span> e.deptno)</span><br><span class="line">		  <span class="keyword">from</span> emp e</span><br><span class="line">		 <span class="keyword">where</span> e.sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp <span class="keyword">where</span> deptno <span class="operator">=</span> e.deptno)</span><br><span class="line">		 <span class="keyword">order</span> <span class="keyword">by</span> e.deptno;</span><br></pre></td></tr></table></figure>

<p>上述是一种解决方案,也可以:使用多表查询:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno, e.empno, e.ename, e.sal, d.avgsal</span><br><span class="line">		  <span class="keyword">from</span> emp e,</span><br><span class="line">		       (<span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal) avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> deptno) d</span><br><span class="line">		 <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line">		   <span class="keyword">and</span> e.sal <span class="operator">&gt;</span> d.avgsal;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>从emp表中查询, 结果显示如下的格式:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Total  1980   1981  1982  1987</span><br><span class="line">-----  -----  ----- ----- -----</span><br><span class="line"> 14     1     10     1      2</span><br></pre></td></tr></table></figure>

<p>sql如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(empno) &quot;Total&quot;,</span><br><span class="line">          <span class="built_in">sum</span>(decode(to_char(hiredate, <span class="string">&#x27;YYYY&#x27;</span>), <span class="string">&#x27;1980&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;1980&quot;,</span><br><span class="line">          <span class="built_in">sum</span>(decode(to_char(hiredate, <span class="string">&#x27;YYYY&#x27;</span>), <span class="string">&#x27;1981&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;1981&quot;,</span><br><span class="line">          <span class="built_in">sum</span>(decode(to_char(hiredate, <span class="string">&#x27;YYYY&#x27;</span>), <span class="string">&#x27;1982&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;1982&quot;,</span><br><span class="line">          <span class="built_in">sum</span>(decode(to_char(hiredate, <span class="string">&#x27;YYYY&#x27;</span>), <span class="string">&#x27;1987&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) &quot;1987&quot;</span><br><span class="line"><span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>

<p><a href="#decode%E5%87%BD%E6%95%B0">decode函数跳转</a></p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p><strong>数据库事务</strong>，是由有限的数据库操作序列组成的逻辑执行单元，这一系列操作要么全部执行，要么全部放弃执行。</p>
<p>数据库事务由以下的部分组成:</p>
<ul>
<li>一个或多个DML 语句</li>
<li>一个 DDL(Data Definition Language – 数据定义语言) 语句</li>
<li>一个 DCL(Data Control Language – 数据控制语言) 语句</li>
</ul>
<p>事务的<strong>特点</strong>：<strong>要么都成功，要么都失败</strong>。</p>
<h2 id="事务的特性"><a href="#事务的特性" class="headerlink" title="事务的特性"></a><strong>事务的特性</strong></h2><p>ACID: 原子性,一致性,隔离性,持久性</p>
<ul>
<li>**原子性(Atomicity)**：事务中的全部操作在数据库中是不可分割的，要么全部完成，要么均不执行。</li>
<li>**一致性 (Consistency)**：几个并行执行的事务, 其执行结果必须与按某一顺序串行执行的结果相一致。</li>
<li>**隔离性(Isolation)**：事务的执行不受其他事务的干扰，当数据库被多个客户端并发访问时，隔离它们的操作，防止出现：脏读、幻读、不可重复读。</li>
<li>**持久性 (Durability)**：对于任意已提交事务，系统必须保证该事务对数据库的改变不被丢失，即使数据库出现故障。</li>
</ul>
<h2 id="事务的流程"><a href="#事务的流程" class="headerlink" title="事务的流程"></a>事务的流程</h2><p>事务的<strong>起始标志</strong>：oracle中自动开启事务，以DML语句为开启标志。</p>
<blockquote>
<p>执行增删改查语句, 只要没有提交commit和回滚rollback, 操作都在一个事务中.</p>
</blockquote>
<p>事务的结束标志: 提交、回滚都是事务的结束标志。</p>
<h3 id="提交与回滚"><a href="#提交与回滚" class="headerlink" title="提交与回滚"></a>提交与回滚</h3><ul>
<li><p>提交</p>
<p>1.显示提交: <code>commit</code><br>2.隐式提交</p>
<ol>
<li><strong>任何DDL语句</strong>，如：<code>create table</code>除了创建表之外还会隐式提交Create之前所有没有提交的DML语句。</li>
<li><strong>正常退出</strong>(exit &#x2F; quit)</li>
</ol>
</li>
<li><p>回滚</p>
<p>1.<strong>显示回滚</strong>: <code>rollback</code><br>2.<strong>隐式回滚</strong>: 掉电、宕机、非正常退出。</p>
</li>
</ul>
<h2 id="控制事务"><a href="#控制事务" class="headerlink" title="控制事务"></a>控制事务</h2><p><strong>保存点（savepoint）</strong>可以防止错误操作影响整个事务，方便进行事务控制。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210241436648.png" alt="image-20221024143654530"></p>
<ul>
<li><strong>设置保存点</strong>aaa   <code>savepoint aaa;</code></li>
<li><strong>回滚到保存点</strong>aaa   <code>rollback to savepoint aaa;</code></li>
</ul>
<p><code>savepoint</code>主要用于在事务上下文中声明一个中间标记, 将一个长事务分隔为多个较小的部分,和我们编写文档时, 习惯性保存一下一样, 都是为了防止出错和丢失。如果<strong>保存点设置名称重复，则会删除之前的那个保存点</strong>。一旦<strong>commit之后，所有的savepoint将失效</strong>。</p>
<p>回滚的操作,会将<strong>回滚过程中的”设置保存点行为”也回滚掉.</strong></p>
<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><p>对于同时运行的多个事务, 当这些事务访问数据库中相同的数据时, 如果没有采取必要的隔离机制, 就会导致各种并发问题:</p>
<ul>
<li><strong>脏读</strong>: 对于两个事物T1, T2; T1读取了已经被T2更新但还没有被提交的字段. 之后, 若 T2 回滚, T1读取的内容就是临时且无效的</li>
<li><strong>不可重复读</strong>: 对于两个事物 T1, T2; T1 读取了一个字段, 然后 T2 更新了该字段. 之后, T1再次读取同一个字段, 值就不同了.</li>
<li><strong>幻读</strong>: 对于两个事物 T1, T2, T1 从一个表中读取了一个字段, 然后 T2 在该表中插入了一些新的行. 之后, 如果 T1 再次读取同一个表, 就会多出几行.</li>
</ul>
<p><strong>数据库事务的隔离性</strong>: 数据库系统必须具有<strong>隔离并发运行各个事务的能力, 使它们不会相互影响, 避免各种并发问题.</strong> </p>
<p>一个事务与其他事务隔离的程度称为<strong>隔离级别</strong>. 数据库规定了多种事务隔离级别, 不同隔离级别对应不同的干扰程度, <strong>隔离级别越高, 数据一致性就越好, 但并发性越弱</strong>.</p>
<h3 id="SQL99定义4中隔离级别"><a href="#SQL99定义4中隔离级别" class="headerlink" title="SQL99定义4中隔离级别"></a>SQL99定义4中隔离级别</h3><ol>
<li><code>Read Uncommitted</code>	读未提交数据。</li>
<li><code>Read Commited</code>	读已提交数据。	（Oracle默认）</li>
<li><code>Repeatable Read</code>	可重复读。		（MySQL默认）</li>
<li><code>Serializable</code>		序列化、串行化。（查询也要等前一个事务结束）</li>
</ol>
<p>Oracle支持的隔离级别： <code>Read Commited</code>（默认）和 <code>Serializable</code>，以及Oracle自定义的<code>Read Only</code>三种。</p>
<p><code>Read Only</code>：由于大多数情况下，在事务操作的过程中，不希望别人也来操作，但是如果将别人的隔离级别设置为Serializable（串行），但是单线程会导致数据库的性能太差。是应该允许别人来进行read操作的。</p>
<h1 id="oracle开发"><a href="#oracle开发" class="headerlink" title="oracle开发"></a>oracle开发</h1><p>oracle开发需要使用<strong>occi库</strong></p>
<ul>
<li>Windows下开发需要先下载开发包,具体操作参考<a target="_blank" rel="noopener" href="https://www.freesion.com/article/4985586791/">此链接</a></li>
<li>Linux下下载oracle安装包有自带,通过<code>locate libocci.so</code>查找</li>
</ul>
<h2 id="OCCI"><a href="#OCCI" class="headerlink" title="OCCI"></a>OCCI</h2><blockquote>
<p>Oracle C++调用接口 – <code>OCCI</code> 即 <code>Oracle C++ Call Interface</code><br>OCCI 是Oracle 的C++ API, 允许你使用面向对象的特性、本地类、C++语言的方法来访问Oracle数据库</p>
</blockquote>
<h3 id="OCCI介绍"><a href="#OCCI介绍" class="headerlink" title="OCCI介绍"></a>OCCI介绍</h3><ul>
<li><p>优势</p>
<ul>
<li><p>基于标准C++和面向对象的设计</p>
</li>
<li><p>效率较高</p>
</li>
<li><p>适合开发C&#x2F;S模式的程序,软件中间层</p>
</li>
</ul>
</li>
<li><p>特性</p>
<ul>
<li>完整支持SQL&#x2F;PLSQL</li>
<li>为不断增长的用户和请求提供弹性选项</li>
<li>为使用用户自定义类型,如C中的类,提供了无缝接口</li>
<li>支持所有的Oracle数据类型以及LOB types(大对象)</li>
<li>可以访问数据库元数据</li>
</ul>
</li>
</ul>
<h3 id="OCCI项目配置"><a href="#OCCI项目配置" class="headerlink" title="OCCI项目配置"></a>OCCI项目配置</h3><h4 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;occi.h&gt;</span> -- 程序中只需要包含这一个头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;occiCommon.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;occiControl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;occiData.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;occiObjects.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="库文件"><a href="#库文件" class="headerlink" title="库文件"></a>库文件</h4><ul>
<li><p>Windows</p>
<ul>
<li><p><code>oraocci11.lib</code> 或 <code>oraocci11d.lib</code></p>
</li>
<li><p><code>oraocci11.dll</code> 或 <code>oraocci11d.dll</code></p>
<p>(前者为release模式时使用，名字末尾带d的后者为debug模式时使用。)</p>
</li>
<li><p>库文件路径:<code>oci/lib/msvc/vc14</code></p>
</li>
<li><p>头文件路径:<code>oci/include</code></p>
</li>
</ul>
</li>
<li><p>Linux</p>
<ul>
<li><code>libnnz11.so</code></li>
<li><code>libocci.so</code></li>
<li><code>libclntsh.so</code></li>
</ul>
</li>
</ul>
<h4 id="linux下的环境配置"><a href="#linux下的环境配置" class="headerlink" title="linux下的环境配置"></a>linux下的环境配置</h4><p>—–root用户下进行配置——</p>
<ol>
<li><p>将oracle_client_11gR2.tar.gz文件上传到linux操作系统的<code>/opt</code>目录下</p>
</li>
<li><p>执行<code>tar -zxvf oracle_client_11gR2.tar.gz</code>解压至当前目录下</p>
</li>
<li><p>进入到刚刚解压的目录, 打开<code>&lt;&lt;Hi-看我,看我.sh&gt;&gt;</code></p>
</li>
<li><p>将文件中的export导出的环境变量拷贝到root用户的<code>.bashrc</code>文件中</p>
<p>注意: 若解压的目录不是<code>/opt</code>, 环境变量中的路径需要修改</p>
</li>
<li><p>执行<code>..bashrc</code>或者<code>source .bashrc</code> 或者退出再次登录使配置的环境变量生效</p>
<p>可以执行<code>echo $OCCI_HOME</code>进行查看, 若看到内容则设置成功</p>
</li>
<li><p>可以设置远程oracle服务器</p>
<p>切换到<code>/opt/instantclient_11_2/network/admin</code>目录下</p>
<p>打开<code>tnsnames.ora</code>文件, 修改其中的HOST部分, 将IP修改成实际的oracle服务的IP地址</p>
</li>
<li><p>occi.cpp测试代码上传到root用户下</p>
<p>然后执行: <code>g++ -o a.out occi.cpp -locci -lclntsh</code>, 编译通过表明设置的没有问题.</p>
<p>若执行报错, 查看一下代码中的oracle的用户名和密码是否正确.</p>
</li>
</ol>
<h4 id="常见的几个环境变量"><a href="#常见的几个环境变量" class="headerlink" title="常见的几个环境变量"></a>常见的几个环境变量</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PATH:命令或者可执行程序搜索的路径</span><br><span class="line">C_INCLUDE_PATH:gcc编译器查找头文件的路径</span><br><span class="line">CPLUS_INCLUDE_PATH: g++编译器查找头文件的路径</span><br><span class="line">LD_LIBRARY_PATH:查找动态链接库的路径</span><br><span class="line">LIBRARY_PATH: 查找静态库的路径</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">oracle用户安装了oracle服务系统, 本身就有oracle编程需要的库文件和头文件:</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">export</span> OCCI_HOME=/u01/app/oracle/product/11.2.0/db_1</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">export</span> OCCI_INCLUDE_DIR=<span class="variable">$OCCI_HOME</span>/rdbms/public</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">export</span> OCCI_LIBRARY_PATH=<span class="variable">$OCCI_HOME</span>/lib</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">export</span> LD_LIBRARY_PATH=$<span class="variable">$LD_LIBRARY_PATH</span>:<span class="variable">$OCCI_LIBRARY_PATH</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; 程序编译时搜索的库目录</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; <span class="built_in">export</span> LIBRARY_PATH=$<span class="variable">$LIBRARY_PATH</span>:<span class="variable">$OCCI_LIBRARY_PATH</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; 程序编译时搜索的头文件目录</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; <span class="built_in">export</span> CPLUS_INCLUDE_PATH=$<span class="variable">$CPLUS_INCLUDE_PATH</span>:<span class="variable">$OCCI_INCLUDE_DIR</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; 上面的环境变量中OCCI_HOME和OCCI_INCLUDE_DIR与在root中的配置不同, 其余相同</span></span><br></pre></td></tr></table></figure>

<h3 id="occi使用"><a href="#occi使用" class="headerlink" title="occi使用"></a>occi使用</h3><h4 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h4><p><strong>初始化</strong> - Environment类</p>
<ul>
<li>OCCI通过创建一个Environment的对象完成初始化工作。</li>
<li>可以通过Environment创建数据库连接，从而进行其它的操作</li>
<li>要创建Environment，应该调用Environment类的静态方法<code>createEnvironment()</code></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化环境   (返回NULL表示失败)</span></span><br><span class="line">Environment *env = Environment::<span class="built_in">createEnvironment</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭环境</span></span><br><span class="line">Environment::<span class="built_in">terminateEnvironment</span>(env);</span><br></pre></td></tr></table></figure>

<p><strong>连接数据库</strong> - Connection 类</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Connection *<span class="title">Environment::createConnection</span><span class="params">(<span class="type">const</span> string &amp;userName,<span class="type">const</span> string &amp;password,<span class="type">const</span> string &amp;connectString)</span></span>;</span><br><span class="line"><span class="comment">//第一个参数:用户名</span></span><br><span class="line"><span class="comment">//第二个参数:密码</span></span><br><span class="line"><span class="comment">//第三个参数:数据库连接串,&quot;IP地址:端口号/数据库服务名&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>连接数据库通过Connection类的对象实例实现</li>
<li>调用Environment类的<code>createConnection()</code>方法可以创建一个Connection对象；</li>
<li>使用Environment::terminateConnection()断开连接</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数调用</span></span><br><span class="line"><span class="type">const</span> string userName = <span class="string">&quot;scott&quot;</span>; <span class="comment">// 用户名</span></span><br><span class="line"><span class="type">const</span> string passwd = <span class="string">&quot;tiger&quot;</span>; <span class="comment">// 密码</span></span><br><span class="line"><span class="type">const</span> string connstr = <span class="string">&quot;localhost:1521/orcl&quot;</span>; <span class="comment">// 数据库连接串</span></span><br><span class="line">Connection* conn = env-&gt;<span class="built_in">createConnection</span>(userName, passwd, connstr);</span><br><span class="line"><span class="comment">// 断开连接</span></span><br><span class="line">env-&gt;<span class="built_in">terminateConnection</span>(conn);</span><br></pre></td></tr></table></figure>

<p><strong>执行SQL</strong></p>
<p>**<code>Statement类</code>**用于执行SQL语句,并获取返回结果。<br>**<code>ResultSet类</code>**用于处理SELECT 查询的结果。<br>对于所有类型的数据的绑定或者获取，OCCI都提供了统一的方法</p>
<ul>
<li>setXXX 方法用于Statement</li>
<li>getXXX 方法用于Statement &amp; ResultSet</li>
</ul>
<p>OCCI会自动处理类型之间的转换。<br>使用方法：<br>使用<code>Connection::createStatement()</code>创建Statement对象, 指定 SQL 命令(DDL&#x2F;DML&#x2F;query)作为参数</p>
<h4 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 操作函数</span></span><br><span class="line">Connection::<span class="built_in">createStatement</span>(string &amp;sql);</span><br><span class="line">Statement::<span class="built_in">setSQL</span>(string &amp;sql);<span class="comment">//如果上面函数未传参,则可调用该函数,也可不调用该参数,直接调用下面的各种execute函数传参</span></span><br><span class="line">Statement::<span class="built_in">execute</span>(string &amp;sql); <span class="comment">// can be used for any SQL, returns status它会返回一个布尔值，指示是否可以检索ResultSet对象。如果返回值为true，则可以使用getResultSet()方法获取查询结果。</span></span><br><span class="line">Statement::<span class="built_in">executeUpdate</span>(string &amp;sql); <span class="comment">// returns Insert/Update/Delete count,注意该函数不能执行select查询,返回值表示受影响的行数</span></span><br><span class="line">Statement::<span class="built_in">executeQuery</span>(string &amp;sql); <span class="comment">// returns ResultSet（结果集）该函数才能执行select查询(针对上一个函数).通哟ResultSet的next()函数遍历每个查询到的行,getString,getInt等函数通过传参1,2,3...获取每行的每一项</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 setXXX 方法传递要绑定用于输入的值<br>使用合适的execute方法执行SQL<br>对于SELECT 查询, 使用ResultSet 对象处理返回结果</p>
</blockquote>
<p>执行插入的案例:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入操作</span></span><br><span class="line">Statement *stmt = conn-&gt;<span class="built_in">createStatement</span>(“ insert into <span class="built_in">Dept</span>(Deptno,Dname, Loc) <span class="built_in">values</span> (<span class="number">1</span>,</span><br><span class="line">‘ACCOUNTS’, ‘ZONE1’ ”);</span><br><span class="line">stmt-&gt;<span class="built_in">executeUpdate</span>();</span><br><span class="line">conn-&gt;<span class="built_in">terminateStatement</span>(stmt); <span class="comment">// 关闭查询, 释放资源</span></span><br></pre></td></tr></table></figure>

<p>使用绑定参数的DML（数据操作语句）示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Statement *stmt = conn-&gt;<span class="built_in">createStatement</span>(“ insert into <span class="built_in">Emp</span>(EmpNo,Ename) <span class="built_in">values</span>(:<span class="number">1</span>, :<span class="number">2</span>) ”);</span><br><span class="line"><span class="comment">//1 and 2 are bind placeholders</span></span><br><span class="line"><span class="type">int</span> empno = <span class="number">2</span>;</span><br><span class="line">string empname = “JOHN W”;</span><br><span class="line"><span class="comment">//first parameter is bind position, second is value</span></span><br><span class="line">stmt-&gt;<span class="built_in">setInt</span>(<span class="number">1</span>, empno);</span><br><span class="line">stmt-&gt;<span class="built_in">setString</span>(<span class="number">2</span>, empname);</span><br><span class="line">stmt-&gt;<span class="built_in">executeUpdate</span>();</span><br></pre></td></tr></table></figure>

<h4 id="oracle简易案例"><a href="#oracle简易案例" class="headerlink" title="oracle简易案例"></a>oracle简易案例</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;occi.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> oracle::occi;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// 初始化连接环境</span></span><br><span class="line">  Environment *env = Environment::<span class="built_in">createEnvironment</span>();</span><br><span class="line">  <span class="comment">// 创建连接</span></span><br><span class="line">  string userName = <span class="string">&quot;scott&quot;</span>;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;userName:&quot;</span> &lt;&lt; userName &lt;&lt; endl;</span><br><span class="line">  string passwd = <span class="string">&quot;tiger&quot;</span>;</span><br><span class="line">  string connstr = <span class="string">&quot;localhost:1521/orcl&quot;</span>; <span class="comment">// 1521是oracle的默认端口</span></span><br><span class="line">  <span class="comment">// conn是建立连接之后得到的对象</span></span><br><span class="line">  Connection* conn = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">      conn = env-&gt;<span class="built_in">createConnection</span>(userName, passwd, connstr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e)</span><br><span class="line">  &#123;</span><br><span class="line">      cout &lt;&lt; <span class="string">&quot;捕获到异常&quot;</span>&lt;&lt;endl;</span><br><span class="line">      cout &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; endl;</span><br><span class="line">      cout&lt;&lt;conn&lt;&lt;endl;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (conn == <span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;连接失败...&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;数据库连接成功...&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="comment">// 创建一个用户操作sql对象</span></span><br><span class="line">  <span class="comment">// 可以给这个函数指定sql语句,也可以不指定</span></span><br><span class="line">  Statement *stat = conn-&gt;<span class="built_in">createStatement</span>();</span><br><span class="line">  <span class="comment">// 如果没有指定执行的sql可以通过set方法指定</span></span><br><span class="line">  string sql = <span class="string">&quot;select * from dept&quot;</span>;</span><br><span class="line">  stat-&gt;<span class="built_in">setSQL</span>(sql);</span><br><span class="line">  <span class="comment">// 执行sql语句</span></span><br><span class="line">  ResultSet *resSet = stat-&gt;<span class="built_in">executeQuery</span>(sql);</span><br><span class="line">  <span class="comment">// 取出所有的记录</span></span><br><span class="line">  <span class="keyword">while</span> (resSet-&gt;<span class="built_in">next</span>())</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 每循环一次读一条记录</span></span><br><span class="line">    <span class="comment">// 读出这条记录的三个字段</span></span><br><span class="line">    <span class="type">int</span> no = resSet-&gt;<span class="built_in">getInt</span>(<span class="number">1</span>);</span><br><span class="line">    string str1 = resSet-&gt;<span class="built_in">getString</span>(<span class="number">2</span>);</span><br><span class="line">    string str2 = resSet-&gt;<span class="built_in">getString</span>(<span class="number">3</span>);</span><br><span class="line">    cout &lt;&lt; no &lt;&lt; <span class="string">&quot;&quot;</span> &lt;&lt; str1 &lt;&lt; <span class="string">&quot;&quot;</span> &lt;&lt; str2 &lt;&lt; endl;</span><br><span class="line">  &#125;</span><br><span class="line">  conn-&gt;<span class="built_in">terminateStatement</span>(stat);</span><br><span class="line">  env-&gt;<span class="built_in">terminateConnection</span>(conn);</span><br><span class="line">  <span class="comment">// 释放资源</span></span><br><span class="line">  Environment::<span class="built_in">terminateEnvironment</span>(env);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;end&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译命令为:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -o a.out occi.cpp -I$ORACLE_HOME/rdbms/public -L$ORACLE_HOME/lib -locci -lclntsh</span><br></pre></td></tr></table></figure>

<p>执行返回结果为:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">userName:scott</span><br><span class="line">数据库连接成功...</span><br><span class="line">10ACCOUNTINGNEW YORK</span><br><span class="line">20RESEARCHDALLAS</span><br><span class="line">30SALESCHICAGO</span><br><span class="line">40OPERATIONSBOSTON</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h2 id="ORA-24550"><a href="#ORA-24550" class="headerlink" title="ORA-24550"></a>ORA-24550</h2><p>在使用occi多线程访问oracle服务器的时候,会出现ORA-24550错误,错误信息如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ORA-24550 : signal received : [si_signo=11] [si_errno=0] [si_code=50] [si_adr =</span><br><span class="line">2020202020202020] killed</span><br></pre></td></tr></table></figure>

<p>该错误会导致进程终止, 修改方案如下:</p>
<ol>
<li><p>使用fifind命令所有oracle服务器端的 <code>sqlnet.ora</code> 文件, 在文件中添加下配置项:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DIAG_ADR_ENABLED=OFF</span><br><span class="line">DIAG_SIGHANDLER_ENABLED=FALSE</span><br><span class="line">DIAG_DDE_ENABLED=FALSE</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果该问题还未解决, 在调用 OCCI 接口的客户端对应oracle目录中, 例如, 我的客户端对用的oralce目录为<br><code>/opt/instantclient_11_2</code> , 在该目录下的 <code>network/admin</code> 中添加文件 <code>sqlnet.ora</code> , 内容如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQLNET.AUTHENTICATION_SERVICES= (NTS)</span><br><span class="line">NAMES.DIRECTORY_PATH= (TNSNAMES,HOSTNAME)</span><br><span class="line">DIAG_ADR_ENABLED=OFF</span><br><span class="line">DIAG_SIGHANDLER_ENABLED=FALSE</span><br><span class="line">DIAG_DDE_ENABLED=FALSE</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h1><p>瑞典MySQL AB公司开发，由SUN收购，而后SUN被甲骨文并购，目前属于Oracle公司。</p>
<p>MySQL是一种关联数据库管理系统 由于其<strong>体积小、速度快、总体拥有成本低</strong>、MySQL软件采用了双授权政策，分为社区版和企业版。</p>
<p>oracle部分linux系统用不了,但mysql没有这个问题</p>
<h2 id="MySQL版本及下载"><a href="#MySQL版本及下载" class="headerlink" title="MySQL版本及下载"></a>MySQL版本及下载</h2><p>MySQL数据库版本相对比较繁杂。常见的有：<code>Community</code>社区版、<code>Enterprise</code>企业版。</p>
<ul>
<li><code>Community</code>版是开源免费的，这也是我们通常用的MySQL的版本。可以满足绝大多数用户需求。</li>
<li><code>Enterprise</code>版，官方指出提供30天免费试用期。可进一步划分为MySQL标准版、MySQL企业版、MySQL集群版。官方提供付费服务。</li>
</ul>
<p>其中<code>Community Server</code> 可以直接从mysql 的官网下载。但<code>Enterprice Edition</code>只能从<code>Oracle edelivery</code>上下载，而<code>Edelivery</code>有时会屏蔽中国IP。</p>
<p>下载mysql时注意区分版本细节及所应用的系统平台：linux(32&#x2F;64) 、win(32&#x2F;64)</p>
<p>GA 是指软件的通用版本，一般指正式发布的版本 <code>(Generally Available (GA) Release)</code></p>
<ul>
<li><code>mysql-essential-5.1.60-win32.msi</code>精简版，如果只需要mysql服务，就选择此版本。</li>
<li><code>mysql-5.1.60-win32.msi</code> 完整版，包含安装程序和配置向导，有MySQL文档。  </li>
<li><code>mysql-noinstall-5.1.60-win32.zip</code> 是非安装的zip压缩包，没有自动安装程序和配置向导，无安装向导</li>
<li><code>mysql-5.1.60.zip</code> 是用于windows的Mysql源码压缩包</li>
</ul>
<p>默认情况下,linux都会有mysql</p>
<h3 id="red-hat"><a href="#red-hat" class="headerlink" title="red hat"></a>red hat</h3><h4 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h4><p><strong>red hat linux演示如何卸载mysql</strong></p>
<p>在终端提示符输入：<code>rpm -aq | grep -i mysql</code>命令。查询mysql是否安装</p>
<p><strong>卸载旧的版本操作</strong></p>
<ol>
<li><p><code>rpm -e 软件包名 --nodeps --allmatches</code> (不理会依赖关系，删除所有上一步查出来的相同的mysql)</p>
<p><code>rpm -e mysql-connector-odbc-3.51.26r1127-1.el5 --nodeps --allmatches</code></p>
<p><code>rpm -e libdbi-dbd-mysql-0.8.1a-1.2.2 --nodeps --allmatches</code></p>
<p><code>rpm -e mysql-server-5.0.77-3.el5 --nodeps --allmatches</code></p>
</li>
<li><p>将老版本的几个残留文件手动删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm -f /etc/my.cnf</span><br><span class="line">rm -rf /var/lib/mysql</span><br><span class="line">rm -rf /var/share/mysql</span><br><span class="line">rm -rf /usr/bin/mysql*</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p><strong>red hat linux演示如何安装mysql</strong></p>
<p>解压.zip安装包<br><code>unzip V46610-01-MySQL Database 5.6.20 RPM for Oracle Linux RHEL 6 x86 (64bit).zip</code></p>
<p>得到如下软件包</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面三个必装</span></span><br><span class="line">MySQL-client-advanced<span class="number">-5.6</span><span class="number">.20</span><span class="number">-1.</span>el6.x86_64.rpm</span><br><span class="line">MySQL-devel-advanced<span class="number">-5.6</span><span class="number">.20</span><span class="number">-1.</span>el6.x86_64.rpm</span><br><span class="line">MySQL-server-advanced<span class="number">-5.6</span><span class="number">.20</span><span class="number">-1.</span>el6.x86_64.rpm</span><br><span class="line"><span class="comment">//下面可选</span></span><br><span class="line">MySQL-embedded-advanced<span class="number">-5.6</span><span class="number">.20</span><span class="number">-1.</span>el6.x86_64.rpm</span><br><span class="line">MySQL-shared-advanced<span class="number">-5.6</span><span class="number">.20</span><span class="number">-1.</span>el6.x86_64.rpm</span><br><span class="line">MySQL-shared-compat-advanced<span class="number">-5.6</span><span class="number">.20</span><span class="number">-1.</span>el6.x86_64.rpm</span><br><span class="line">MySQL-test-advanced<span class="number">-5.6</span><span class="number">.20</span><span class="number">-1.</span>el6.x86_64.rpm</span><br><span class="line"><span class="comment">//可以参考README.txt</span></span><br><span class="line">README.txt</span><br></pre></td></tr></table></figure>

<p>安装服务器  <code>rpm -ivh MySQL-server-advanced-5.6.****-1.el6.x86_64.rpm</code></p>
<p>第一次安装,会自动生成一个文件<code>/root/.mysql_secret</code>,文件内含mysql的root用户的密码.因此必须在第一次连接的时候修改此处的密码</p>
<p><code>mysql_secure_installation</code> 配置安全选项</p>
<p>默认配置设置文件在 <code>/usr/my.cnf</code> ,可以编辑这个 文件改变mysql服务器设置</p>
<h5 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h5><p><code>rpm -ivh MySQL-client-advanced-5.6.****-1.el6.x86_64.rpm</code></p>
<p>说明:不安装<code>mysql-client</code>是不能使用mysql工具登陆到mysql数据库</p>
<p>修改密码  <code>mysql&gt; set password=password(&#39;123456&#39;);</code> 	将密码设置为：123456&#96;</p>
<h3 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p>ubuntu下安装:  <code>apt-get install mysql-server</code>     (root无初始密码)</p>
<p>设置MySQL的root初始密码:  <code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;your_password&#39;;</code></p>
<p><code>mysql_secure_installation</code>这个命令设置mysql安全配置向导</p>
<ol>
<li><p>是否建立密码验证插件（用以验证密码强度）：n</p>
</li>
<li><p>首次运行则会要求输入并确认root密码，设置过第2步的root初始密码则会提示是否修改密码。</p>
<p>如果遇到以下报错，请先执行上面第2步的设置root初始密码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed! Error: SET PASSWORD has no significance for user ‘root’@’localhost’ as the authentication method used doesn’t store authentication data in the MySQL server. Please consider using ALTER USER instead if you want to change authentication parameters.</span><br></pre></td></tr></table></figure>
</li>
<li><p>是否删除匿名用户：y</p>
</li>
<li><p>是否禁止root远程登陆：n</p>
</li>
<li><p>是否删除test数据库：y</p>
</li>
<li><p>刷新权限：y</p>
</li>
</ol>
<p>给root账号开放所有权限:  <code>GRANT ALL PRIVILEGES ON *.* TO root@&#39;localhost&#39;;</code></p>
<p>检查mysql服务状态  <code>sudo systemctl status mysql</code></p>
<p>mysql服务的启动&#x2F;停止&#x2F;重启</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动MySQL服务</span></span><br><span class="line">service mysql start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止MySQL服务</span></span><br><span class="line">service mysql stop</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启MySQL服务</span></span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<p>如果要安装客户端和开发组件要分别执行下面语句</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libmysqlclient-dev	</span><br><span class="line">sudo apt-get install mysql-client</span><br></pre></td></tr></table></figure>

<h4 id="卸载-1"><a href="#卸载-1" class="headerlink" title="卸载"></a>卸载</h4><p><code>apt autoremove mysql-server</code></p>
<h3 id="win7-64位"><a href="#win7-64位" class="headerlink" title="win7 64位"></a>win7 64位</h3><p>下面以mysql-5.7.24-winx64为例</p>
<p>安装流程及配置初始root用户,及授权远程连接流程如下:</p>
<ol>
<li><p>在C:\Program Files目录下新建目录MySQL</p>
</li>
<li><p>将下载到的mysql-5.7.24-winx64.zip解压到目录<code>C:\Program Files\MySQL</code></p>
</li>
<li><p>进入目录<code>C:\Program Files\MySQL\mysql-5.7.24-winx64</code>里，并新建一个文件my.ini</p>
<p>文件内容如下:(注意:不能有bom头)<strong>高危坑点</strong>!!!!(win7的记事本只要打开utf8编码格式的文件就会自动添加bom头,而bom头mysql不识别!!!)</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span> </span><br><span class="line"><span class="comment"># 设置为自己MYSQL的安装目录 </span></span><br><span class="line"><span class="comment">#basedir=C:\Program Files\MySQL\mysql-5.7.24-winx64</span></span><br><span class="line"><span class="comment"># 设置为MYSQL的数据目录 </span></span><br><span class="line"><span class="comment">#datadir=C:\Program Files\MySQL\mysql-5.7.24-winx64\data</span></span><br><span class="line"><span class="comment">#port=3306</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">1024</span> </span><br><span class="line"><span class="attr">character_set_server</span>=utf8</span><br><span class="line"><span class="attr">max_allowed_packet</span>=<span class="number">32</span>M</span><br><span class="line"><span class="attr">read_buffer_size</span>=<span class="number">4</span>M    </span><br><span class="line"><span class="comment">#sql_mode=NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USER</span></span><br><span class="line"><span class="comment"># 开启查询缓存</span></span><br><span class="line"><span class="comment">#某些系统版本需要开启这项(win7确定需要)</span></span><br><span class="line"><span class="attr">explicit_defaults_for_timestamp</span>=<span class="literal">true</span>   </span><br><span class="line"><span class="comment"># 第一次启动MYSQL打开这行（一定放在末尾），可以免密登陆，方便登录设置root密码</span></span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>
</li>
<li><p>管理员身份运行命令 在C:\Windows\System32路径下以管理员执行cmd </p>
<p>进入目录C:\Program Files\MySQL\mysql-5.7.24-winx64\bin</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行安装命令</span></span><br><span class="line">mysqld.exe install</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行初始化命令</span></span><br><span class="line">mysqld.exe --initialize</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动 mysql 服务</span></span><br><span class="line">net start mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里如果报错:无法启动此程序,因为计算机中丢失MSVCR120.dll.尝试重新安装该程序以解决问题</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解决方案:装2013 Redistributable</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行mysql，由于之前我们设置登入无密码，当系统提示需要输入密码时，直接按回车键</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时会显示password:   直接回车!</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时会进入mysql&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入下面的三条命令来设置root密码</span></span><br><span class="line">flush privileges;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置<span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>用户的密码为<span class="string">&#x27;xxxxxx&#x27;</span></span></span><br><span class="line">set password for &#x27;root&#x27;@&#x27;localhost&#x27;=password(&#x27;xxxxxx&#x27;);#&#x27;@&#x27;localhost&#x27;表示只有在本地连接时才使用此密码。如果是远程连接，则需要另外设置密码</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改<span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>用户的密码过期时间为永不过期。</span></span><br><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; password expire never;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">刷新权限，使设置生效。</span></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将目录C:\Program Files\MySQL\mysql-5.7.24-winx64\下的文件my.ini里面的最后一行通过使用#注释掉</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">quit;#退出&gt;mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启mysql服务</span></span><br><span class="line">net stop mysql</span><br><span class="line">net start mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">客户端用户可能无法访问服务器mysql,因此需要开启远程连接权限</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里显示password:输入上面设置的密码xxxxxx</span></span><br><span class="line">use mysql;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将用户表中用户名为<span class="string">&#x27;root&#x27;</span>，主机为<span class="string">&#x27;localhost&#x27;</span>的用户的主机(host)改为<span class="string">&#x27;%&#x27;</span>，表示允许该用户从任何主机连接。</span></span><br><span class="line">update user set host = &#x27;%&#x27; where user = &#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看效果(这句可以不输)</span></span><br><span class="line">select host, user from user;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后重启mysql服务</span></span><br><span class="line">net stop mysql</span><br><span class="line">net start mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入mysql刷新权限设置</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>各种问题盘点</strong></p>
<ul>
<li>记事本不能使用,可以使用vscode修改,打开后右下角是utf8不是utf8 with BOM就没问题;或者使用Notepad++,保存文件时选择“UTF-8 without BOM”选项</li>
<li>如果因为任何的原因导致mysql启动失败报错,但是当你想net stop mysql或net start mysql的时候会一直提示:服务正在启动或停止中,请稍候片刻后再试一次.解决方案为:任务管理器强杀mysqld进程,然后就可以正常net start mysql或net stop mysql了</li>
<li>net start mysql如果报错:无法启动此程序,因为计算机中丢失MSVCR120.dll.尝试重新安装该程序以解决问题.解决方案:装c++ 2013 Redistributable</li>
</ul>
<h3 id="win10-64位"><a href="#win10-64位" class="headerlink" title="win10 64位"></a>win10 64位</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/">MySQL Community Downloads</a>   找<code>MySQL Installer for Windows</code>选项</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_59636442/article/details/123058454">安装参考链接</a></p>
<h2 id="mysql的基本操作"><a href="#mysql的基本操作" class="headerlink" title="mysql的基本操作"></a>mysql的基本操作</h2><p><code>mysql -u用户名 -p密码</code>进入本地mysql命令行    e.g.<code>mysql -uroot -p12345</code></p>
<p>若想进入远程数据库,需要使用参数<code>-h192.168.0.3</code>指定远程主机ip地址</p>
<p>退出登录 <code>quit/exit</code></p>
<p>在MySQL中，您可以使用<code>CREATE USER</code>语句创建新用户。创建新用户的基本语法如下：<code>CREATE USER &#39;username&#39;@&#39;host&#39; IDENTIFIED BY &#39;password&#39;;</code>，其中<code>username</code>是您要创建的用户的名称，<code>host</code>是用户可以连接的主机（可以是特定的IP地址或通配符，例如<code>%</code>表示任何主机），而<code>password</code>是新用户的密码 。</p>
<p>创建用户后，您需要为他们授予适当的权限，以便他们能够访问和操作MySQL服务器上的数据库和表。这可以使用<code>GRANT</code>语句完成 。例如，要将所有权限授予<code>test</code>数据库中的<code>johndoe</code>用户，您可以使用以下命令：<code>GRANT ALL PRIVILEGES ON test.* TO &#39;johndoe&#39;@&#39;%&#39;;</code>。需要注意的是，创建用户后，您必须刷新权限以反映所做的更改，方法是运行 <code>FLUSH PRIVILEGES;</code> 。</p>
<h3 id="数据库CURD"><a href="#数据库CURD" class="headerlink" title="数据库CURD"></a>数据库CURD</h3><p>对数据库进行增(create)、删(delete)、改(update)、查(Retrieve)操作</p>
<p><strong>[注意] mysql中数据库名和表名都区分大小写</strong></p>
<p><strong>组织结构</strong></p>
<ul>
<li>oracle是先有库,库下是用户,用户下再有表</li>
<li>mysql是先有用户,用户下是库,库下是表</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301136512.png" alt="image-20221030113604065"></p>
<p>操作盘点</p>
<ul>
<li><p><strong>显示已有的所有数据库</strong> <code>show databases</code></p>
</li>
<li><p><strong>显示建数据库的语句</strong> <code>show create database 数据库名</code></p>
</li>
<li><p><strong>新建数据库</strong>  <code>create database 数据库名</code></p>
<p>创建字符集为utf-8的数据库:<code>create database 数据库名 character set utf8;</code> </p>
<p>创建字符集为utf-8并会对存入的数据进行检查是否utf8格式的数据库 <code>create database 数据库名 character set utf8 collate utf8_general_ci;</code></p>
<p>如果不存在才新建数据库  <code>create database if not exists 数据库名</code></p>
</li>
<li><p><strong>删除数据库</strong>  <code>drop database 数据库名</code></p>
</li>
<li><p>修改数据库字符集(不能修改数据库名) <code>alter database 数据库名 character set utf8;</code></p>
</li>
<li><p>进入数据库  <code>use 数据库名</code></p>
</li>
<li><p>查看当前使用的是哪个库 <code>status;</code> 或 <code>select database() from dual;</code></p>
</li>
<li><p><code>source sql脚本文件路径</code> 用该命令执行上面的sql脚本文件.<a href="#mysql%E7%9A%84%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2">点击参考</a></p>
</li>
<li><p>显示索引是<code>show index from 表名</code></p>
</li>
</ul>
<p>p.s.  默认情况下,反引号 &#96;&#96; &#96; 括起来的字符串,区分大小写.</p>
<h3 id="表CURD"><a href="#表CURD" class="headerlink" title="表CURD"></a>表CURD</h3><p>mysql的表curd操作和oracle是几乎一样的,只有<a href="#mysql%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">数据类型</a>不一致.</p>
<p><a href="#%E8%A1%A8">跳转方便对比oracle的表curd</a></p>
<h4 id="mysql的数据类型"><a href="#mysql的数据类型" class="headerlink" title="mysql的数据类型"></a>mysql的数据类型</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301356829.png" alt="image-20221030135621392"></p>
<p>p.s.  (附加说明)</p>
<ul>
<li><code>bit</code>     1位　	可以指定位数，如：bit(3)</li>
<li><code>int</code>     2字节 	可以指定最大位数，如：int&lt;4&gt;　最大为4位的整数</li>
<li><code>float</code>   2个字节　可以指定最大的位数和最大的小数位数，如：float&lt;5,2&gt; 最大为一个5位的数，小数位最多2位 </li>
<li><code>double</code>　4个字节　可以指定最大的位数和最大的小数位数，如：float&lt;6,4&gt; 最大为一个6位的数，小数位最多4位</li>
<li><code>char</code>　  必须指定字符数,如char(5) 为不可变字符　即使存储的内容为’ab’,也是用5个字符的空间存储这个数据</li>
<li><code>varchar</code>　必须指定字符数,如varchar(5) 为可变字符　如果存储的内容为’ab’,占用2个字符的空间；如果为’abc’,则占用3个字符的空间</li>
<li><code>text</code>: 大文本(大字符串)</li>
<li><code>blob</code>：二进制大数据　如图片，音频文件，视频文件</li>
<li><code>date</code>: 日期　如：’1921-01-02’</li>
<li><code>datetime</code>: 日期+时间　如：’1921-01-02 12:23:43’</li>
<li><code>timeStamp</code>: 时间戳，自动赋值为当前日期时间</li>
</ul>
<p>在Mysql中显示多行数据应该在查询语句结尾处添加 <code>\G</code>或<code>\g</code>来替换结束标记<code>;</code></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301443749.png" alt="image-20221030144335864" style="zoom: 50%;" />

<ul>
<li><strong>创建表</strong>   <code>create table t1 (id int, name varchar(20))</code></li>
<li><strong>查看当前选择的数据库中的表</strong>   <code>show tables;</code></li>
<li><strong>查看表结构</strong>  <code>desc tablename;</code></li>
<li><strong>查看创建表的语法</strong>    <code>show create table t1;</code></li>
<li><strong>更改表名</strong>    <code>rename table employee to worker;</code></li>
<li><strong>增加一个字段</strong>   <code>alter table employee add column height double;</code>   （column关键字在Oracle中，添加则语法错误）</li>
<li><strong>修改一个字段</strong>   <code>alter table employee modify column height float;</code></li>
<li><strong>删除一个字段</strong>   <code>alter table employee drop column height;</code></li>
<li><strong>修改表的字符集</strong>   <code>alter table employee character set gbk;</code></li>
<li><strong>删除employee表</strong>  <code>drop table employee;</code></li>
</ul>
<p>注意:mysql删除表不能使用purge</p>
<h3 id="数据的CURD操作"><a href="#数据的CURD操作" class="headerlink" title="数据的CURD操作"></a>数据的CURD操作</h3><p><strong>和oracle是一样的.</strong></p>
<ul>
<li><p>查询  <code>select id, name as &quot;名字&quot;, salary &quot;月薪&quot;, salary*12 年薪  from employee where id &gt;=2;</code></p>
</li>
<li><p>修改  <code>update employee set salary=10000, resume=&#39;也是一个中牛&#39; where name=&#39;王五&#39;;</code></p>
</li>
<li><p>删除  <code>delete from employee where name=&#39;王五&#39;;</code></p>
<p><code>truncate employee;</code></p>
</li>
<li><p>插入 <code>insert into employee values(1,&#39;张三&#39;,1,&#39;1983-04-27&#39;,15000,&#39;2012-06-24&#39;,&#39;一个大牛&#39;);</code></p>
</li>
</ul>
<h3 id="mysql的分组查询注意点"><a href="#mysql的分组查询注意点" class="headerlink" title="mysql的分组查询注意点"></a>mysql的分组查询注意点</h3><p>在oracle数据库中,<strong>having后面不可以使用别名,mysql可以使用别名</strong>(别名若是中文不要加<code>&quot;&quot;</code>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#正确的</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(english<span class="operator">+</span>chinese<span class="operator">+</span>math) &quot;总分&quot;,class_id <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> class_id <span class="keyword">having</span> 总分<span class="operator">&gt;</span><span class="number">1300</span>;</span><br><span class="line">#正确的</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(english<span class="operator">+</span>chinese<span class="operator">+</span>math) 总分,class_id <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> class_id <span class="keyword">having</span> 总分<span class="operator">&gt;</span><span class="number">1300</span>;</span><br><span class="line">#错误的</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(english<span class="operator">+</span>chinese<span class="operator">+</span>math) &quot;总分&quot;,class_id <span class="keyword">from</span> student <span class="keyword">group</span> <span class="keyword">by</span> class_id <span class="keyword">having</span> &quot;总分&quot;<span class="operator">&gt;</span><span class="number">1300</span>;</span><br><span class="line">#显示<span class="keyword">Empty</span> <span class="keyword">set</span>, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>尽量使用英文别名</strong></p>
<h3 id="mysql的top-N问题"><a href="#mysql的top-N问题" class="headerlink" title="mysql的top-N问题"></a>mysql的top-N问题</h3><p><a href="#top-N%E9%97%AE%E9%A2%98">oracle中的top-N问题</a>比较复杂,而mysql中很简单</p>
<p>关键词  <strong><code>limit</code></strong></p>
<p>在查询中，经常要返回前几条或者中间某几行数据时，用到<code>limit</code><br>$$<br>limit\ \ offset,rows<br>$$<br>参数说明：<br>**<code>offset</code>**：指定第一个返回记录行的偏移量（即从哪一行开始返回），注意：初始行的偏移量为0。<br>**<code>rows</code>**：返回具体行数。</p>
<p><strong>如果limit后面是一个参数，就是检索前多少行。如果limit后面是2个参数，就是从offset+1行开始，检索rows行记录。</strong></p>
<p><strong>案例</strong></p>
<p>将math成绩从小到大排序,求math成绩在5-8名的学生的信息</p>
<p><code>select * from student order by math limit 4,4;</code></p>
<h3 id="mysql中的函数"><a href="#mysql中的函数" class="headerlink" title="mysql中的函数"></a>mysql中的函数</h3><h4 id="日期时间函数"><a href="#日期时间函数" class="headerlink" title="日期时间函数"></a>日期时间函数</h4><p>MySQL里面时间分为三类：时间、日期、时间戳(含有时分秒的<code>sysdate</code>)。    (在mysql中使用sysdate必须加小括号)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301726678.png" alt="image-20221030172638699"></p>
<ul>
<li><code>DATA_ADD</code> 等同于 <code>ADDDATE</code> ,<code>DATA_SUB</code>同理</li>
<li><code>CURDATE</code> 等同于 <code>CURRENT_DATE</code>,<code>current_time</code>同理</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301732417.png" alt="image-20221030173143508"></p>
<p><code>now()</code>   等同于   <code>sysdate()</code>   等同于   <code>current_timestamp()</code></p>
<p>addtime函数用法参考</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301742376.png" alt="image-20221030174159636"></p>
<p>DATE_ADD函数用法参考  (<code>interval</code>是关键词,不能缺少)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301750340.png" alt="image-20221030175035800"></p>
<p> 上述语句中的函数名, INTERVAL不区分大小写, day, month, year也可以用大写.</p>
<p>DATEDIFF函数用法参考</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301802641.png" alt="image-20221030180213902"></p>
<h5 id="日期格式函数"><a href="#日期格式函数" class="headerlink" title="日期格式函数"></a>日期格式函数</h5><p>日期转字符串<br>$$<br>DATE_FORMAT(date,format)<br>$$</p>
<p>根据format 字符串安排date 值的格式。 </p>
<p>以下说明符可用在 format 字符串中：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301808026.png" alt="image-20221030180826827"></p>
<p>案例:   <code>select date_format(now(),&#39;%Y-%m-%d %H:%i:%s&#39;);</code></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210301811721.png" alt="image-20221030181106873" style="zoom:67%;" />

<h4 id="数学相关函数"><a href="#数学相关函数" class="headerlink" title="数学相关函数"></a>数学相关函数</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210311123690.png" alt="image-20221031112333528"></p>
<ul>
<li><code>conv(12,10,2)</code> 将12从10进制转换成2进制为1100</li>
<li><code>format(12.015,2)</code> 将12.015保留小数点后两位为12.02</li>
<li><code>mod(3700,300)</code>  求余为100</li>
<li><code>rand</code>函数一般用<code>rand(now())</code></li>
</ul>
<p>还有三角函数,指数等等的一大堆数学函数</p>
<h4 id="字符串相关函数"><a href="#字符串相关函数" class="headerlink" title="字符串相关函数"></a>字符串相关函数</h4><p><strong><code>||</code> 连接字符串 在 MySQL不可以使用。</strong>但mysql的<code>concat</code>函数可以连接多个字符串</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210311420970.png" alt="image-20221031142000017"></p>
<ul>
<li><code>replace</code>  会替换所有符合的字串</li>
<li><code>strcmp</code>  相等返回0,小于返回-1,大于返回1</li>
<li><code>substring</code> 的<code>position</code>可以为负数表示倒数第几个位置开始</li>
</ul>
<h4 id="转换函数-1"><a href="#转换函数-1" class="headerlink" title="转换函数"></a>转换函数</h4><ul>
<li>日期转字符串 :    <code>date_format(date,format)</code>函数</li>
<li>字符串转日期:     <code>str_to_date(string,format)</code>函数</li>
</ul>
<h4 id="滤空函数"><a href="#滤空函数" class="headerlink" title="滤空函数"></a>滤空函数</h4><p>mysql不支持<a href="#%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0">nvl函数</a>,取而代之是**<code>ifnull</code>**函数,用法与nvl函数一致.</p>
<blockquote>
<p>注意：<br>Oracle中有一个通用函数，与MYSQL中的<code>ifnull</code>函数名字相近：<code>nullif</code>：如<code>nullif(a, b)</code> 当 a &#x3D; b 时返回null, 不相等的时候返回a值。<code>nullif(&#39;L9,999.99&#39;, &#39;L9,999.99&#39;)</code></p>
</blockquote>
<p>mysql中<code>nullif()</code>函数也存在。</p>
<h3 id="mysql的多表查询"><a href="#mysql的多表查询" class="headerlink" title="mysql的多表查询"></a>mysql的多表查询</h3><p>准备数据</p>
<p>新建scott.sql文件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> scott <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line"></span><br><span class="line">use scott;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> bonus</span><br><span class="line">(</span><br><span class="line">        ename <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">        job   <span class="type">VARCHAR</span>(<span class="number">9</span>),</span><br><span class="line">        sal   <span class="type">int</span>,</span><br><span class="line">        comm  <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept</span><br><span class="line">(</span><br><span class="line">        deptno  <span class="type">int</span>  <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">        dname  <span class="type">varchar</span>(<span class="number">14</span>),</span><br><span class="line">        loc    <span class="type">varchar</span>(<span class="number">13</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> dept <span class="keyword">add</span> <span class="keyword">constraint</span> PK_DEPT <span class="keyword">primary</span> key(deptno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp</span><br><span class="line">(</span><br><span class="line">        empno  <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">        ename  <span class="type">varchar</span>(<span class="number">10</span>),</span><br><span class="line">        job    <span class="type">varchar</span>(<span class="number">9</span>),</span><br><span class="line">        mgr    <span class="type">int</span>,</span><br><span class="line">        hiredate  <span class="type">date</span>,</span><br><span class="line">        sal   <span class="type">int</span>,</span><br><span class="line">        comm    <span class="type">int</span>,</span><br><span class="line">        deptno   <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">add</span> <span class="keyword">constraint</span> PK_EMP <span class="keyword">primary</span> key (empno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">add</span> <span class="keyword">constraint</span> FK_DEPTNO <span class="keyword">foreign</span> key (DEPTNO) <span class="keyword">references</span> dept(deptno);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> salgrade</span><br><span class="line">(</span><br><span class="line">        grade <span class="type">int</span>,</span><br><span class="line">        losal <span class="type">int</span>,</span><br><span class="line">        hisal <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept <span class="keyword">VALUES</span> (<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;ACCOUNTING&#x27;</span>, <span class="string">&#x27;NEW YORK&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept <span class="keyword">VALUES</span> (<span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;RESEARCH&#x27;</span>, <span class="string">&#x27;DALLAS&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept <span class="keyword">VALUES</span> (<span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;SALES&#x27;</span>, <span class="string">&#x27;CHICAGO&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept <span class="keyword">VALUES</span> (<span class="string">&#x27;40&#x27;</span>, <span class="string">&#x27;OPERATIONS&#x27;</span>, <span class="string">&#x27;BOSTON&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7369</span>, <span class="string">&#x27;SMITH&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7902</span>,<span class="string">&#x27;1980-12-17&#x27;</span>, <span class="number">800</span>, <span class="keyword">NULL</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7499</span>, <span class="string">&#x27;ALLEN&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,<span class="string">&#x27;1981-2-20&#x27;</span>, <span class="number">1600</span>, <span class="number">300</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7521</span>, <span class="string">&#x27;WARD&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,<span class="string">&#x27;1981-2-22&#x27;</span>, <span class="number">1250</span>, <span class="number">500</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7566</span>, <span class="string">&#x27;JONES&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,<span class="string">&#x27;1981-4-2&#x27;</span>, <span class="number">2975</span>, <span class="keyword">NULL</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7654</span>, <span class="string">&#x27;MARTIN&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,<span class="string">&#x27;1981-9-28&#x27;</span>, <span class="number">1250</span>, <span class="number">1400</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7698</span>, <span class="string">&#x27;BLAKE&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,<span class="string">&#x27;1981-5-1&#x27;</span>, <span class="number">2850</span>, <span class="keyword">NULL</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7782</span>, <span class="string">&#x27;CLARK&#x27;</span>, <span class="string">&#x27;MANAGER&#x27;</span>, <span class="number">7839</span>,<span class="string">&#x27;1981-1-9&#x27;</span>, <span class="number">2450</span>, <span class="keyword">NULL</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7788</span>, <span class="string">&#x27;SCOTT&#x27;</span>, <span class="string">&#x27;ANALYST&#x27;</span>, <span class="number">7566</span>,<span class="string">&#x27;1982-12-9&#x27;</span>, <span class="number">3000</span>, <span class="keyword">NULL</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7839</span>, <span class="string">&#x27;KING&#x27;</span>, <span class="string">&#x27;PRESIDENT&#x27;</span>, <span class="keyword">NULL</span>,<span class="string">&#x27;1981-11-17&#x27;</span>, <span class="number">5000</span>, <span class="keyword">NULL</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7844</span>, <span class="string">&#x27;TURNER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>, <span class="number">7698</span>,<span class="string">&#x27;1981-9-8&#x27;</span>, <span class="number">1500</span>, <span class="number">0</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7876</span>, <span class="string">&#x27;ADAMS&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7788</span>,<span class="string">&#x27;1983-1-12&#x27;</span>, <span class="number">1100</span>, <span class="keyword">NULL</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7900</span>, <span class="string">&#x27;JAMES&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7698</span>,<span class="string">&#x27;1981-12-3&#x27;</span>, <span class="number">950</span>, <span class="keyword">NULL</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7902</span>, <span class="string">&#x27;FORD&#x27;</span>, <span class="string">&#x27;ANALYST&#x27;</span>, <span class="number">7566</span>,<span class="string">&#x27;1981-12-3&#x27;</span>, <span class="number">3000</span>, <span class="keyword">NULL</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp <span class="keyword">VALUES</span> (<span class="number">7934</span>, <span class="string">&#x27;MILLER&#x27;</span>, <span class="string">&#x27;CLERK&#x27;</span>, <span class="number">7782</span>,<span class="string">&#x27;1982-12-3&#x27;</span>, <span class="number">1300</span>, <span class="keyword">NULL</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> salgrade <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">700</span>,<span class="number">1200</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> salgrade <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">1201</span>,<span class="number">1400</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> salgrade <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">1401</span>,<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> salgrade <span class="keyword">values</span>(<span class="number">4</span>,<span class="number">2001</span>,<span class="number">3000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> salgrade <span class="keyword">values</span>(<span class="number">5</span>,<span class="number">3001</span>,<span class="number">9999</span>);</span><br></pre></td></tr></table></figure>

<p><code>source /root/scott.sql</code> 用该命令执行上面的sql脚本文件.</p>
<p>得到原始数据</p>
<h4 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h4><p>相当于oracle的<a href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF">笛卡尔积</a></p>
<p>关键词  <strong><code>cross join</code></strong></p>
<p><code>select e.*, d.* from emp e cross join dept d;</code></p>
<h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><p>对应oracle中的<a href="#%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5">等值连接</a></p>
<p>只返回满足连接条件的数据（两边都有的才显示）。</p>
<h5 id="SQL99写法"><a href="#SQL99写法" class="headerlink" title="SQL99写法"></a>SQL99写法</h5><p>关键词  <strong><code>[inner] join ... on ...</code></strong>     (inner可以省略)</p>
<p><code>select e.ename,e.job,d.deptno,d.dname from emp e inner join dept d on e.deptno = d.deptno;</code></p>
<h5 id="oracle写法"><a href="#oracle写法" class="headerlink" title="oracle写法"></a>oracle写法</h5><p><code>select e.ename,e.job,d.deptno,d.dname from emp e, dept d where e.deptno = d.deptno;</code></p>
<p>区别盘点:    [,]  —&gt;  [inner join]      [where]  —&gt;  [on]</p>
<h4 id="mysql外连接"><a href="#mysql外连接" class="headerlink" title="mysql外连接"></a>mysql外连接</h4><h5 id="mysql左外连接"><a href="#mysql左外连接" class="headerlink" title="mysql左外连接"></a>mysql左外连接</h5><p>左边有值才显示。     与<a href="#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5">oracle的左外连接</a>仅仅是写法不同,含义一致</p>
<p>关键词   <strong><code>left [outer] join ...   on  ...</code></strong>     (outer可省略)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.<span class="operator">*</span></span><br><span class="line">		<span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept d</span><br><span class="line">		<span class="keyword">on</span> e.deptno<span class="operator">=</span>d.deptno</span><br></pre></td></tr></table></figure>

<h5 id="mysql右外连接"><a href="#mysql右外连接" class="headerlink" title="mysql右外连接"></a>mysql右外连接</h5><p>右边有值才显示。   与<a href="#%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5">oracle的右外连接</a>仅仅是写法不同,含义一致</p>
<p>关键词   <strong><code>right [outer] join ...   on  ... </code></strong>    (outer可省略)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.<span class="operator">*</span></span><br><span class="line">		<span class="keyword">from</span> emp e <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept d</span><br><span class="line">		<span class="keyword">on</span> e.deptno<span class="operator">=</span>d.deptno</span><br></pre></td></tr></table></figure>

<p>即可知: SQL99中，外链接取值与关系表达式&#x3D;号左右位置无关。取值跟from后表的书写顺序有关。 </p>
<p><strong>[案例]</strong>   统计各个部门员工总人数-要求显示部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(e.empno),d.dname <span class="keyword">from</span> emp e <span class="keyword">right</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.deptno <span class="operator">=</span> d.deptno <span class="keyword">group</span> <span class="keyword">by</span> dname;</span><br></pre></td></tr></table></figure>

<p><strong>[自连接案例]</strong>   查询员工、老板信息，显示: xxx的老板是xxx</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(e.ename,<span class="string">&#x27;的老板是&#x27;</span>,ifnull(b.ename,<span class="string">&#x27;自己&#x27;</span>)) <span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> emp b <span class="keyword">on</span> e.mgr <span class="operator">=</span> b.empno;</span><br></pre></td></tr></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210311558213.png" alt="image-20221031155836798" style="zoom:67%;" />

<h5 id="mysql满外连接"><a href="#mysql满外连接" class="headerlink" title="mysql满外连接"></a>mysql满外连接</h5><p>任一边有值就会显示。     在oracle中没有对应</p>
<p>关键词    <strong><code>full [outer] join ... on ...</code></strong>      (outer可省略)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.<span class="operator">*</span></span><br><span class="line">		<span class="keyword">from</span> emp e <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept d		</span><br><span class="line">		<span class="keyword">on</span> e.deptno<span class="operator">=</span>d.deptno</span><br></pre></td></tr></table></figure>

<h3 id="mysql表的约束"><a href="#mysql表的约束" class="headerlink" title="mysql表的约束"></a>mysql表的约束</h3><ul>
<li><strong>定义主键约束</strong>　<code>primary key</code>	不允许为空，不允许重复</li>
<li><strong>定义主键自动增长</strong>　<code>auto_increment</code>  (从1开始,即使插入不填或者手动填null,也会从1开始自动增长给数)</li>
<li><strong>定义唯一约束</strong>　<code>unique</code></li>
<li><strong>定义非空约束</strong>　<code>not null</code></li>
<li><strong>定义外键约束</strong>　<code>constraint ordersid_FK foreign key(ordersid) references orders(id)</code></li>
</ul>
<p><strong>[注意]</strong>  <strong>check约束</strong>在MySQL中语法保留，但<strong>没有效果</strong></p>
<p><strong>案例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> myclass (</span><br><span class="line">  id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">unique</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (</span><br><span class="line">  id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">unique</span>,</span><br><span class="line">  passwd <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">  classid <span class="type">INT</span>(<span class="number">11</span>),</span><br><span class="line">  <span class="keyword">constraint</span> stu_classid_FK <span class="keyword">foreign</span> key(classid) <span class="keyword">references</span> myclass(id));</span><br></pre></td></tr></table></figure>

<h2 id="mysql中文乱码问题"><a href="#mysql中文乱码问题" class="headerlink" title="mysql中文乱码问题"></a>mysql中文乱码问题</h2><p>查看所有应用的字符集     <code>show variables like &#39;character%&#39;;</code></p>
<blockquote>
<p>关于<code>utf8mb3</code>和<code>utf8mb4</code>，其主要区别在于：<code>most bytes 3</code>和<code>most bytes 4</code>，即最多使用3 &#x2F; 4个字节来表示1个字符！所以，当使用<code>utf8mb4</code>时，可以表示更多字符，例如生僻汉字、冷门符号、emoji表情符号等。</p>
</blockquote>
<p>指定字符集登录数据库(默认是utf8mb4)   <code>mysql -uroot -p123456 --default_character_set=gbk</code></p>
<p>上面语句如果不是和插入时登录数据库使用的同一个字符集,就会中文乱码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202210311738498.png" alt="image-20221031173810379"></p>
<p>如果使用<code>secureCRT</code>,<code>secureCRT</code>菜单中的Options-Session Options-Category-Terminal-Appearance中可以设置Character encoding设置工具的字符集(如果未设置为utf-8也会显示乱码)</p>
<p>操作系统的语言集</p>
<p>Ubuntu下查看字符集 <code>cat /etc/default/locale</code></p>
<p>red hat下查看字符集 <code>cat /etc/sysconfig/i18n</code></p>
<p>返回显示<code>LANG=&quot;en_US.UTF-8&quot;</code>   表示环境变量LANG &#x3D; 操作系统的菜单按照zh_CN显示,文件存储按照utf8</p>
<p>操作系统本身不是utf-8也会乱码</p>
<p>总结:</p>
<ul>
<li>使用哪种字符集插入的数据,就要用哪种字符集去select查看</li>
<li>操作系统本身必须支持中文的显示</li>
<li>linux客户端工具若不支持中文显示也会显示乱码</li>
</ul>
<h2 id="MYSQL-API"><a href="#MYSQL-API" class="headerlink" title="MYSQL API"></a>MYSQL API</h2><p>访问MySQL服务器，这需要使用mysqlclient库，MySQL的大多数客户端API（除Java和.NET）都是通过这个库来和MySQL服务器通讯的，而这个库正是使用C语言编写的。</p>
<p>可使用<code>mysql -V</code> 命令查看当前系统内所使用的mysql数据库版本信息。MySQL客户端使用 libmysqlclient 库内部的函数访问MySQL服务器。因此我们在编程过程中，如若使用到库内的函数，必须链接函数库，对应的要找到头文件所在目录位置、函数库路径。以便我们在使用gcc编译工具时可以填充参数<code>-I、-L、-l</code>。</p>
<p>从手册中可获知，函数库名为mysqlclient。<br>    因此我们使用命令<code>find / -name libmysqlclient*</code> 或<code>locate *libmysql*</code>(ubuntu下需要下载支持)查找该库的路径。得到<code>/usr/lib/x86_64-linux-gnu/libmysqlclient.a</code>。<br><code>nm /usr/lib/x86_64-linux-gnu/libmysqlclient.a</code>命令可查看库内包含的函数。</p>
<p><strong>链接使用该库。</strong>			<br>    用到头文件<code>&lt;mysql.h&gt;</code>可使用<code>locate mysql.h</code>查看其目录位置<code>/usr/include/mysql/mysql.h</code>。</p>
<p>编译引用库的应用程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc hello.c -o hello -I/usr/include/mysql/ -L/usr/lib/x86_64-linux-gnu/ -lmysqlclient </span><br></pre></td></tr></table></figure>

<p>如果链接出错,原因是<strong>某些64位Linux环境</strong>下，动态库配置不完整。需手动指定编译所用的动态库。根据错误提示分析需要加入如下函数库：</p>
<ul>
<li><code>__gxx_personality_v0</code>   		–&gt;	-lstdc++		使用g++相关的环境</li>
<li><code>dlclose/dlopen/dlsym</code>				–&gt;	-ldl			完成用一个程序加载其他动态库的作用。</li>
<li><code>pthread_*</code>						–&gt;-lpthread		线程库</li>
<li>&#96;&#96;my_getsystime’&#x2F;clock_gettime’&#96;	–&gt;-lrt			librt.so是glibc中对real-time的支持库</li>
</ul>
<p>使用<code>ldd</code>命令可以查看该可执行文件运行所依赖的库文件。</p>
<h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h3><blockquote>
<p>c&#x2F;c++程序员需要访问mysql数据库时，可以有2个选择，一个是纯的mysql的c API, 另外一个是<code>mysqlplus</code>这个库。前者是mysql的开发小组所维护的，其实现代码是mysql源代码的一部分。后者现在已经转为社区维护了。</p>
</blockquote>
<p><strong>总体印象</strong></p>
<p>使用MySQL库API函数的一般步骤：</p>
<ol>
<li><p><strong>初始化</strong>. 	<code>MYSQL *mysql_init(MYSQL *mysql)</code></p>
</li>
<li><p><strong>错误处理</strong>	<code>unsigned int mysql_errno(MYSQL *mysql)</code> </p>
<p><code>char *mysql_error(MYSQL *mysql);</code></p>
</li>
<li><p><strong>建立连接</strong>.	<code>MYSQL *mysql_real_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd,const char *db, unsigned int port, const char *unix_socket, unsigned long client_flag);</code></p>
</li>
<li><p><strong>执行SQL语句</strong>	<code>int mysql_query(MYSQL *mysql, const char *stmt_str)</code></p>
</li>
<li><p><strong>获取结果</strong>	<code>MYSQL_RES *mysql_store_result(MYSQL *mysql)</code></p>
<p><code>MYSQL_ROW mysql_fetch_row(MYSQL_RES *result)</code></p>
</li>
<li><p><strong>释放内存</strong>	<code>void mysql_free_result(MYSQL_RES *result)</code></p>
</li>
<li><p><strong>关闭连接</strong>	<code>void mysql_close(MYSQL *mysql)</code> </p>
</li>
<li><p><a href="#%E7%BC%96%E7%A0%81%E7%9B%B8%E5%85%B3">编码相关</a></p>
</li>
<li><p><a href="#%E7%BB%93%E6%9E%9C%E9%9B%86%E7%9B%B8%E5%85%B3">结果集相关</a></p>
</li>
</ol>
<h4 id="mysql-init函数"><a href="#mysql-init函数" class="headerlink" title="mysql_init函数"></a>mysql_init函数</h4><p>分配或初始化与<code>mysql_real_connect()</code>相适应的MYSQL对象。如果mysql是NULL指针，该函数将分配、初始化、并返回新对象。否则，将初始化对象，并返回对象的地址。如果<code>mysql_init()</code>分配了新的对象，当调用<code>mysql_close()</code>来关闭连接时。将释放该对象。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSQL *<span class="title function_">mysql_init</span><span class="params">(MYSQL *mysql)</span> </span><br></pre></td></tr></table></figure>

<p>返回值:   初始化的MYSQL*句柄。如果无足够内存以分配新的对象，返回NULL。</p>
<h4 id="mysql-real-connect函数"><a href="#mysql-real-connect函数" class="headerlink" title="mysql_real_connect函数"></a>mysql_real_connect函数</h4><p>mysql_real_connect()尝试与运行在主机上的MySQL数据库引擎建立连接。在你能够执行需要有效MySQL连接句柄结构的任何其他API函数之前，mysql_real_connect()必须成功完成。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MYSQL *<span class="title function_">mysql_real_connect</span><span class="params">(</span></span><br><span class="line"><span class="params">  MYSQL *mysql, <span class="comment">//mysql结构体指针</span></span></span><br><span class="line"><span class="params">  <span class="type">const</span> <span class="type">char</span> *host, <span class="comment">//ip地址,NULL或localhost视为本机</span></span></span><br><span class="line"><span class="params">  <span class="type">const</span> <span class="type">char</span> *user, <span class="comment">//用户名,NULL或空字符串视为当前用户</span></span></span><br><span class="line"><span class="params">  <span class="type">const</span> <span class="type">char</span> *passwd, <span class="comment">//密码</span></span></span><br><span class="line"><span class="params">  <span class="type">const</span> <span class="type">char</span> *db, <span class="comment">//数据库名,NULL会将默认数据库设为该值</span></span></span><br><span class="line"><span class="params">  <span class="type">unsigned</span> <span class="type">int</span> port,<span class="comment">//端口号 </span></span></span><br><span class="line"><span class="params">  <span class="type">const</span> <span class="type">char</span> *unix_socket, <span class="comment">//跨网络的话应该填NULL.如果非空,描述了应使用的套接字或命名管道.</span></span></span><br><span class="line"><span class="params">  <span class="type">unsigned</span> <span class="type">long</span> client_flag)</span> <span class="comment">//标志,通常为0,可以设置下面组合,以允许特定功能</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//返回值,如果失败返回NULL,成功返回mysql(MYSQL结构体指针)</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>标志名称</th>
<th>标志描述</th>
</tr>
</thead>
<tbody><tr>
<td>CLIENT_COMPRESS</td>
<td>使用压缩协议。</td>
</tr>
<tr>
<td>CLIENT_FOUND_ROWS</td>
<td>返回发现的行数（匹配的），而不是受影响的行数。</td>
</tr>
<tr>
<td>CLIENT_IGNORE_SPACE</td>
<td>允许在函数名后使用空格。使所有的函数名成为保留字。</td>
</tr>
<tr>
<td>CLIENT_INTERACTIVE</td>
<td>关闭连接之前，允许interactive_timeout（取代了wait_timeout）秒的不活动时间。客户端的会话wait_timeout变量被设为会话interactive_timeout变量的值。</td>
</tr>
<tr>
<td>CLIENT_LOCAL_FILES</td>
<td>允许LOAD DATA LOCAL处理功能。</td>
</tr>
<tr>
<td>CLIENT_MULTI_STATEMENTS</td>
<td>通知服务器，客户端可能在单个字符串内发送多条语句（由‘;’隔开）。如果未设置该标志，将禁止多语句执行。</td>
</tr>
<tr>
<td>CLIENT_MULTI_RESULTS</td>
<td>通知服务器，客户端能够处理来自多语句执行或存储程序的多个结果集。如果设置了CLIENT_MULTI_STATEMENTS，将自动设置它。</td>
</tr>
<tr>
<td>CLIENT_NO_SCHEMA</td>
<td>禁止<code>db_name.tbl_name.col_name</code>语法。它用于ODBC。如果使用了该语法，它会使分析程序生成错误，在捕获某些ODBC程序中的缺陷时，它很有用。</td>
</tr>
<tr>
<td>CLIENT_ODBC</td>
<td>客户端是ODBC客户端。它将mysqld变得更为ODBC友好。</td>
</tr>
<tr>
<td>CLIENT_SSL</td>
<td>使用SSL（加密协议）。该选项不应由应用程序设置，它是在客户端库内部设置的。</td>
</tr>
</tbody></table>
<p>调用mysql_real_connect之前不要尝试加密密码,密码加密将由客户端API自动处理</p>
<p>使用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MYSQL *conn = mysql_real_connect(mysql,<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;password&quot;</span>,<span class="string">&quot;myTest&quot;</span>,<span class="number">0</span>,<span class="literal">NULL</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(conn == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[error]%s&quot;</span>,mysql_error(mysql));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="mysql-query函数"><a href="#mysql-query函数" class="headerlink" title="mysql_query函数"></a>mysql_query函数</h4><p>**[功能]**执行由“Null终结的字符串”查询指向的SQL查询。正常情况下，字符串必须包含1条SQL语句，而且不应为语句添加终结分号<code>;</code>或<code>\g</code>。如果允许多语句执行，字符串可包含多条由分号隔开的语句。</p>
<p>mysql_query函数不单单能完成查询sql的功能，还能完成非select语句在c程序中的执行。是一个十分万能的c程序中执行SQL语句的函数。并且该函数本身直接支持静态SQL。如果语句中包含二进制数据，则需要调用<code>mysql_real_query</code>来执行查询语句。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mysql_query</span><span class="params">(MYSQL *mysql, <span class="type">const</span> <span class="type">char</span> *query)</span>;</span><br><span class="line"><span class="comment">//如果查询成功，返回0。如果出现错误，返回非0值</span></span><br><span class="line"><span class="comment">//mysql参数为mysql_real_connect返回值</span></span><br><span class="line"><span class="comment">//query为sql执行语句的字符串</span></span><br></pre></td></tr></table></figure>

<ul>
<li>若执行的是**<code>UPDATE, DELETE或INSERT语句</code>**，则可通过<code>mysql_affected_rows()</code>获知受影响的记录数。</li>
<li>若执行的是**<code>SELECT语句</code>**，查询结束后，查询结果被保存在mysql句柄中。需要使用获取结果集的API函数将结果集获取出来。有两种方式可以获取结果集。</li>
</ul>
<p><strong>注意</strong>: <code>mysql_query</code>执行的SQL语句不应为语句添加终结分号（‘;’）或“\g”。</p>
<h4 id="mysql-close函数"><a href="#mysql-close函数" class="headerlink" title="mysql_close函数"></a>mysql_close函数</h4><p>关闭前面打开的连接。如果句柄是由mysql_init()或mysql_connect()自动分配的，mysql_close()还将解除分配由mysql指向的连接句柄。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">mysql_close</span><span class="params">(MYSQL *mysql)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="编码相关"><a href="#编码相关" class="headerlink" title="编码相关"></a>编码相关</h4><h5 id="mysql-character-set-name函数"><a href="#mysql-character-set-name函数" class="headerlink" title="mysql_character_set_name函数"></a>mysql_character_set_name函数</h5><p>为当前连接返回默认的字符集。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">char</span> *<span class="title function_">mysql_character_set_name</span><span class="params">(MYSQL *mysql)</span> </span><br></pre></td></tr></table></figure>

<h5 id="mysql-set-character-set函数"><a href="#mysql-set-character-set函数" class="headerlink" title="mysql_set_character_set函数"></a>mysql_set_character_set函数</h5><p>该函数用于为当前连接设置默认的字符集</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mysql_set_character_set</span><span class="params">(MYSQL *mysql, <span class="type">char</span> *csname)</span> </span><br></pre></td></tr></table></figure>

<p>返回值:    0表示成功，非0值表示出现错误。 </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置utf8编码集例子</span></span><br><span class="line">mysql_set_charset_name(&amp;mysql, <span class="string">&quot;utf8&quot;</span>)</span><br><span class="line"><span class="comment">//下面也可以</span></span><br><span class="line">mysql_query(mysql, <span class="string">&quot;set names utf8&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="结果集相关"><a href="#结果集相关" class="headerlink" title="结果集相关"></a>结果集相关</h4><p>一种方式是通过<code>mysql_store_result()</code>将整个结果集全部取回来。另一种方式则是调用<code>mysql_use_result()</code>初始化获取操作，但暂时不取回任何记录。视结果集的条目数选择获取结果集的函数。两种方法均通过<code>mysql_fetch_row()</code>来访问每一条记录。</p>
<ul>
<li><a href="#mysql_store_result%E5%87%BD%E6%95%B0"><code>mysql_store_result函数</code></a>    获取结果集</li>
<li><a href="#mysql_fetch_row%E5%87%BD%E6%95%B0"><code>mysql_fetch_row函数</code> </a>   解析结果集</li>
<li><a href="#mysql_free_result%E5%87%BD%E6%95%B0"><code>mysql_free_result函数</code> </a>   释放结果集</li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%88%97%E6%95%B0%E5%87%BD%E6%95%B0">获取列数函数</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%A4%B4%E5%87%BD%E6%95%B0">获取表头函数</a></li>
<li><a href="#mysql_affected_rows%E5%87%BD%E6%95%B0"><code>mysql_affected_rows函数</code></a>      返回影响行数</li>
</ul>
<h5 id="mysql-store-result函数"><a href="#mysql-store-result函数" class="headerlink" title="mysql_store_result函数"></a>mysql_store_result函数</h5><p><strong>获取结果集</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_RES *<span class="title function_">mysql_store_result</span><span class="params">(MYSQL *mysql)</span> </span><br><span class="line"><span class="comment">//成功返回MYSQL_RES结果集指针，失败返回NULL。(可以通过判断返回NULL来判断mysql_query是否执行成功)</span></span><br></pre></td></tr></table></figure>

<p><code>MYSQL_RES</code>是一个结构体类型，可以从<code>mysql.h</code>头文件中找到该结构体的定义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">MYSQL_RES</span> &#123;</span></span><br><span class="line">  <span class="type">uint64_t</span> row_count;<span class="comment">//行数,有多少行</span></span><br><span class="line">  MYSQL_FIELD *fields;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">MYSQL_DATA</span> *<span class="title">data</span>;</span></span><br><span class="line">  MYSQL_ROWS *data_cursor;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> *lengths; <span class="comment">/* column lengths of current row */</span></span><br><span class="line">  MYSQL *handle;          <span class="comment">/* for unbuffered reads */</span></span><br><span class="line">  <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">MYSQL_METHODS</span> *<span class="title">methods</span>;</span></span><br><span class="line">  MYSQL_ROW row;         <span class="comment">/* If unbuffered read */</span></span><br><span class="line">  MYSQL_ROW current_row; <span class="comment">/* buffer to current row */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">MEM_ROOT</span> *<span class="title">field_alloc</span>;</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> field_count, current_field;</span><br><span class="line">  <span class="type">bool</span> eof; <span class="comment">/* Used by mysql_fetch_row */</span></span><br><span class="line">  <span class="comment">/* mysql_stmt_close() had to cancel this result */</span></span><br><span class="line">  <span class="type">bool</span> unbuffered_fetch_cancelled;</span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">enum_resultset_metadata</span> <span class="title">metadata</span>;</span></span><br><span class="line">  <span class="type">void</span> *extension;</span><br><span class="line">&#125; MYSQL_RES;</span><br></pre></td></tr></table></figure>

<p><strong>使用案例</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_RES *result = mysql_store_result(mysql);</span><br><span class="line">	<span class="keyword">if</span> (result == <span class="literal">NULL</span>) &#123;</span><br><span class="line">	ret = mysql_errno(mysql);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;mysql_store_result error: %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">	<span class="keyword">return</span> ret;	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>该函数调用成功，则SQL查询的结果被保存在result中</p>
<h5 id="mysql-fetch-row函数"><a href="#mysql-fetch-row函数" class="headerlink" title="mysql_fetch_row函数"></a>mysql_fetch_row函数</h5><p><strong>解析结果集</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_ROW <span class="title function_">mysql_fetch_row</span><span class="params">(MYSQL_RES *result)</span></span><br><span class="line"><span class="comment">//成功返回下一行的MYSQL_ROW结构。如果没有更多要检索的行或出现了错误，返回NULL</span></span><br><span class="line"><span class="comment">//result为mysql_store_result返回的值</span></span><br></pre></td></tr></table></figure>

<p><strong>使用案例</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_ROW row = <span class="literal">NULL</span>;				<span class="comment">//typedef char **MYSQL_ROW;	</span></span><br><span class="line">     <span class="keyword">while</span> ((row = mysql_fetch_row(result))) &#123;</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">&quot;%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n&quot;</span>, row[<span class="number">0</span>],row[<span class="number">1</span>],row[<span class="number">2</span>],row[<span class="number">3</span>],row[<span class="number">4</span>],row[<span class="number">5</span>],row[<span class="number">6</span>],row[<span class="number">7</span>]);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>MYSQL_ROW的本质是<code>tupedef char** MYSQL_ROW;</code>,数据信息存储的形式如下图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202211141522005.png" alt="image-20221114152116545"></p>
<h5 id="mysql-free-result函数"><a href="#mysql-free-result函数" class="headerlink" title="mysql_free_result函数"></a>mysql_free_result函数</h5><p><strong>释放结果集</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">mysql_free_result</span><span class="params">(MYSQL_RES *result)</span>; </span><br><span class="line"><span class="comment">//成功释放参数传递的结果集。没有失败情况。</span></span><br></pre></td></tr></table></figure>

<h5 id="查询数据整体案例"><a href="#查询数据整体案例" class="headerlink" title="查询数据整体案例"></a>查询数据整体案例</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> sSql[<span class="number">255</span>] = <span class="string">&quot;select * from testTable&quot;</span>;</span><br><span class="line">    <span class="type">int</span> ret = mysql_query(conn,sSql);</span><br><span class="line">    <span class="keyword">if</span>(ret!=<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;执行失败\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;执行成功\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    MYSQL_RES* res = mysql_store_result(mysql);</span><br><span class="line">    <span class="keyword">if</span>(res == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,mysql_error(mysql));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        MYSQL_ROW row = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span>((row = mysql_fetch_row(res))!=<span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;id:%s  name:%s\n&quot;</span>,row[<span class="number">0</span>],row[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        mysql_free_result(res);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="获取列数函数"><a href="#获取列数函数" class="headerlink" title="获取列数函数"></a>获取列数函数</h5><ul>
<li><code>unsigned int mysql_field_count(MYSQL *mysql)</code> 			从<strong>mysql句柄</strong>中获取连接的表有多少列。(表为连接数据库的时候指定了的某张表)</li>
<li><code>unsigned int mysql_num_fields(MYSQL_RES *result)</code> 	从<strong>返回的结果集</strong>中获取有多少列。</li>
</ul>
<h5 id="获取表头函数"><a href="#获取表头函数" class="headerlink" title="获取表头函数"></a>获取表头函数</h5><ul>
<li><code>MYSQL_FIELD *mysql_fetch_fields(MYSQL_RES *result)</code> 全部获取</li>
<li><code>MYSQL_FIELD *mysql_fetch_field(MYSQL_RES *result)</code> 获取单个</li>
</ul>
<p>返回值为**<code>MYSQL_FIELD</code>**结构体指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">MYSQL_FIELD</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name;               <span class="comment">/* 列名Name of column */</span></span><br><span class="line">  <span class="type">char</span> *org_name;           <span class="comment">/* 原名(有别名的情况下)Original column name, if an alias */</span></span><br><span class="line">  <span class="type">char</span> *table;              <span class="comment">/* 表名Table of column if column was a field */</span></span><br><span class="line">  <span class="type">char</span> *org_table;          <span class="comment">/* 原表名Org table name, if table was an alias */</span></span><br><span class="line">  <span class="type">char</span> *db;                 <span class="comment">/*表的库名 Database for table */</span></span><br><span class="line">  <span class="type">char</span> *catalog;            <span class="comment">/* Catalog for table */</span></span><br><span class="line">  <span class="type">char</span> *def;                <span class="comment">/* Default value (set by mysql_list_fields) */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> length;     <span class="comment">/* Width of column (create length) */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> max_length; <span class="comment">/* Max width for selected set */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> name_length;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> org_name_length;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> table_length;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> org_table_length;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> db_length;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> catalog_length;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> def_length;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> flags;         <span class="comment">/* Div flags */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> decimals;      <span class="comment">/* Number of decimals in field */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> charsetnr;     <span class="comment">/* Character set */</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">enum_field_types</span> <span class="title">type</span>;</span> <span class="comment">/* Type of field. See mysql_com.h for types */</span></span><br><span class="line">  <span class="type">void</span> *extension;</span><br><span class="line">&#125; MYSQL_FIELD;</span><br></pre></td></tr></table></figure>

<h5 id="mysql-affected-rows函数"><a href="#mysql-affected-rows函数" class="headerlink" title="mysql_affected_rows函数"></a>mysql_affected_rows函数</h5><p>返回上次UPDATE更改的行数，上次DELETE删除的行数，或上次INSERT语句插入的行数。对于UPDATE、DELETE或INSERT语句，可在mysql_query()后立刻调用。对于SELECT语句，mysql_affected_rows()的工作方式与mysql_num_rows()类似。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_ulonglong <span class="title function_">mysql_affected_rows</span><span class="params">(MYSQL *mysql)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>[返回值]</strong> 大于0的整数表明受影响或检索的行数。“0”表示UPDATE语句未更新记录，在查询中没有与WHERE匹配的行，或未执行查询。“-1”表示查询返回错误，或者，对于SELECT查询，在调用mysql_store_result()之前调用了mysql_affected_rows()。由于mysql_affected_rows()返回无符号值，通过比较返回值和“(my_ulonglong)-1”或等效的“(my_ulonglong)~0”，检查是否为“-1”。</p>
<p>如果在连接至mysqld时指定了标志CLIENT_FOUND_ROWS，对于UPDATE语句，mysql_affected_rows()将返回WHERE语句匹配的行数。</p>
<h3 id="mysql客户端编写案例"><a href="#mysql客户端编写案例" class="headerlink" title="mysql客户端编写案例"></a>mysql客户端编写案例</h3><ol>
<li>mysql初始化 – <a href="#mysql_init%E5%87%BD%E6%95%B0">mysql_init()</a></li>
<li>连接mysql数据库 – <a href="#mysql_real_connect%E5%87%BD%E6%95%B0">mysql_real_connect()</a></li>
<li>循环<ol>
<li>打印提示符</li>
<li>读取用户输入的sql语句,判断是否为退出</li>
<li>不是退出的话执行sql语句取出结果集或影响行数打印出来 – <a href="#mysql_store_result%E5%87%BD%E6%95%B0">mysql_store_result()</a>,<a href="#mysql_fetch_row%E5%87%BD%E6%95%B0">mysql_fetch_row()</a>,<a href="#mysql_affected_rows%E5%87%BD%E6%95%B0">mysql_affected_rows()</a></li>
<li>如果要释放结果集 – <a href="#mysql_free_result%E5%87%BD%E6%95%B0">mysql_free_result()</a></li>
</ol>
</li>
<li>关闭连接 – mysql_close()</li>
</ol>
<p><strong>代码</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mysql.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    MYSQL *mysql = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (mysql == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;错误\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;mysql Init 成功\n&quot;</span>);</span><br><span class="line">    MYSQL *conn = mysql_real_connect(mysql, <span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;password123&quot;</span>, <span class="string">&quot;myTest&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[error]%s&quot;</span>, mysql_error(mysql));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;链接成功\n&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> buf[<span class="number">999</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;MYSQL&gt;&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        read(STDIN_FILENO, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">        <span class="comment">//去首尾空格</span></span><br><span class="line">        <span class="type">int</span> spaceIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (spaceIndex = <span class="number">0</span>; spaceIndex &lt; <span class="built_in">strlen</span>(buf); spaceIndex++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (buf[spaceIndex] != <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> commandRealLength = <span class="built_in">strlen</span>(buf) - spaceIndex;</span><br><span class="line">        memmove(buf, buf + spaceIndex, <span class="built_in">strlen</span>(buf) - spaceIndex);</span><br><span class="line">        <span class="comment">// printf(&quot;old:%s\n&quot;,buf);</span></span><br><span class="line">        <span class="built_in">memset</span>(buf + commandRealLength, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf) - commandRealLength);</span><br><span class="line">        <span class="comment">// printf(&quot;new:%s\n&quot;,buf);</span></span><br><span class="line">        <span class="comment">//判断是否只有回车字符</span></span><br><span class="line">        <span class="keyword">if</span> (buf[<span class="number">0</span>] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">//去末尾分号</span></span><br><span class="line">        <span class="type">char</span> *p = <span class="built_in">strrchr</span>(buf, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">NULL</span>)</span><br><span class="line">            *p = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">// printf(&quot;最终传递的sql指令为：%s\n&quot;, buf);</span></span><br><span class="line">        <span class="keyword">if</span> (strncasecmp(buf, <span class="string">&quot;quit&quot;</span>, <span class="number">4</span>) == <span class="number">0</span> || strncasecmp(buf, <span class="string">&quot;exit&quot;</span>, <span class="number">4</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mysql_close(mysql);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;执行命令\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (strncasecmp(buf, <span class="string">&quot;select&quot;</span>, <span class="number">6</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> ret = mysql_query(conn, buf);</span><br><span class="line">            <span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;执行失败\n&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            MYSQL_RES *res = mysql_store_result(mysql);</span><br><span class="line">            <span class="keyword">if</span> (res == <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                MYSQL_ROW row = <span class="literal">NULL</span>;</span><br><span class="line">                <span class="type">int</span> colSum = mysql_num_fields(res);</span><br><span class="line">                MYSQL_FIELD *field = mysql_fetch_fields(res);</span><br><span class="line">                <span class="keyword">if</span> (field != <span class="literal">NULL</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">while</span> ((row = mysql_fetch_row(res)) != <span class="literal">NULL</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; colSum; i++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">/* code */</span></span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot;%s:%s\t&quot;</span>, field[i].name, row[i]);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                mysql_free_result(res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> ret = mysql_query(conn, buf);</span><br><span class="line">            <span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;执行失败\n&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;query ok,%d row affected\n&quot;</span>, mysql_affected_rows(mysql));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mysql_close(mysql);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MYSQL的事务"><a href="#MYSQL的事务" class="headerlink" title="MYSQL的事务"></a>MYSQL的事务</h3><p>事务相关知识点参考<a href="#%E4%BA%8B%E5%8A%A1">事务章节</a></p>
<ul>
<li>MySQL的事务的默认自动提交的，每执行一个sql语句都自动commit</li>
<li>Oracle的事务是自动打开的(以你执行的一条DML语句为标志)，但每次执行需要手动commit</li>
</ul>
<p>在程序中设置**<code>autocommit</code>**修改MySQL事务的属性。(<strong>每次连接会重新恢复默认,要重新设置</strong>)</p>
<ul>
<li><code>set autocommit = 0</code> 禁止自动提交</li>
<li><code>set autocommit = 1</code> 开启自动提交MySQL中InnoDB引擎才支持事务默认自动提交机制。MYISAM引擎不支持。</li>
</ul>
<h4 id="相关sql语句"><a href="#相关sql语句" class="headerlink" title="相关sql语句"></a>相关sql语句</h4><ul>
<li>开启事务   <code>start transaction</code></li>
<li>设置手动提交   <code>set autocommit = 0</code> </li>
<li>设置自动提交   <code>set autocommit = 1</code> </li>
<li>提交   <code>commit</code></li>
<li>回滚   <code>rollback</code></li>
</ul>
<h4 id="代码案例"><a href="#代码案例" class="headerlink" title="代码案例"></a>代码案例</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mysql.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SET_TRAN	<span class="string">&quot;SET AUTOCOMMIT=0&quot;</span>  		<span class="comment">//手动commit	</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UNSET_TRAN	<span class="string">&quot;SET AUTOCOMMIT=1&quot;</span>		<span class="comment">//自动commit</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置事务为手动提交</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mysql_OperationTran</span><span class="params">(MYSQL *mysql)</span>  			</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//--开启事务</span></span><br><span class="line">	<span class="type">int</span> ret = mysql_query(mysql, <span class="string">&quot;start transaction&quot;</span>);  </span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_OperationTran query start err: %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//--设置事务为手动提交</span></span><br><span class="line">	ret = mysql_query(mysql, SET_TRAN);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_OperationTran query set err: %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//设置事务为自动提交</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mysql_AutoTran</span><span class="params">(MYSQL *mysql)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//--开启事务</span></span><br><span class="line">	<span class="type">int</span> ret = mysql_query(mysql, <span class="string">&quot;start transaction&quot;</span>);  </span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_AutoTran query start err: %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//--设置事务为自动提交</span></span><br><span class="line">	ret = mysql_query(mysql, UNSET_TRAN);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_AutoTran query set err: %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;		</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行commit，手动提交事务</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mysql_Commit</span><span class="params">(MYSQL *mysql)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> ret = mysql_query(mysql, <span class="string">&quot;COMMIT&quot;</span>); </span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;commit err: %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行rollback，回滚事务		</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">mysql_Rollback</span><span class="params">(MYSQL *mysql)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> ret = mysql_query(mysql, <span class="string">&quot;ROLLBACK&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;rollback err: %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DROP_SAMPLE_TABLE <span class="string">&quot;DROP TABLE IF EXISTS test_table&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CREATE_SAMPLE_TABLE <span class="string">&quot;CREATE TABLE test_table(col1 INT,\</span></span></span><br><span class="line"><span class="string"><span class="meta">                                                 col2 VARCHAR(10),\</span></span></span><br><span class="line"><span class="string"><span class="meta">                                                 col3 VARCHAR(10))&quot;</span></span></span><br><span class="line">                                         </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> sql01 <span class="string">&quot;INSERT INTO test_table(col1,col2,col3) VALUES(10, &#x27;AAA&#x27;, &#x27;A1&#x27;)&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> sql02 <span class="string">&quot;INSERT INTO test_table(col1,col2,col3) VALUES(20, &#x27;BBB&#x27;, &#x27;B2&#x27;)&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> sql03 <span class="string">&quot;INSERT INTO test_table(col1,col2,col3) VALUES(30, &#x27;CCC&#x27;, &#x27;C3&#x27;)&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> sql04 <span class="string">&quot;INSERT INTO test_table(col1,col2,col3) VALUES(40, &#x27;DDD&#x27;, &#x27;D4&#x27;)&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	MYSQL *mysql = mysql_init(<span class="literal">NULL</span>);</span><br><span class="line">	</span><br><span class="line">	mysql = mysql_real_connect(mysql, <span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;mydb2&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span> (mysql == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		ret = mysql_errno(mysql);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;func mysql_real_connect() err：%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125; 	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot; --- connect ok......\n&quot;</span>);	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (mysql_query(mysql, DROP_SAMPLE_TABLE)) &#123;</span><br><span class="line">	  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot; DROP TABLE failed\n&quot;</span>);</span><br><span class="line">	  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot; %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">	  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (mysql_query(mysql, CREATE_SAMPLE_TABLE)) &#123;</span><br><span class="line">	  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot; CREATE TABLE failed\n&quot;</span>);</span><br><span class="line">	  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot; %s\n&quot;</span>, mysql_error(mysql));</span><br><span class="line">	  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">	ret = mysql_OperationTran(mysql); 	<span class="comment">//开启事务，并修改事务属性为手动commit </span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_OperationTran() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	ret = mysql_query(mysql, sql01);	<span class="comment">//向表中插入第一行数据 ‘AAA’</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_query() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = mysql_query(mysql, sql02);	<span class="comment">//向表中插入第二行数据 ‘BBB’</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_query() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = mysql_Commit(mysql); 		<span class="comment">//手动提交事务</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_Commit() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	ret = mysql_AutoTran(mysql); 		<span class="comment">// =再次= 修改事务属性为【自动】commit</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_OperationTran() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = mysql_OperationTran(mysql); 	<span class="comment">// =再次= 修改事务属性为【手动】commit</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_OperationTran() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = mysql_query(mysql, sql03);	<span class="comment">//向表中插入第三行数据 ‘CCC’</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_query() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = mysql_query(mysql, sql04);	<span class="comment">//向表中插入第四行数据 ‘DDD’</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_query() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	ret = mysql_Rollback(mysql);		<span class="comment">//直接rollback操作</span></span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;mysql_Rollback() err:%d\n&quot;</span>, ret);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//rollback操作是否能回退掉CCC、DDD的值，取决于事务属性。</span></span><br><span class="line">	mysql_close(mysql);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="预处理类API"><a href="#预处理类API" class="headerlink" title="预处理类API"></a>预处理类API</h3><p>MySQL客户端／服务器协议提供了预处理语句。该功能采用了由<code>mysql_stmt_init()</code>初始化函数返回的<code>MYSQL_STMT</code>语句处理程序数据结构。对于多次执行的语句，预处理执行是一种有效的方式。首先对语句进行解析，为执行作好准备。接下来，在以后使用初始化函数返回的语句句柄执行一次或多次。</p>
<p>对于多次执行的语句，<strong>预处理执行比直接执行快</strong>，主要原因在于，仅对查询执行一次解析操作。在直接执行的情况下，每次执行语句时，均将进行查询。此外，由于每次执行预处理语句时仅需发送参数的数据，从而<strong>减少了网络通信量</strong>。</p>
<p>预处理语句的另一个优点是，它<strong>采用了二进制协议，从而使得客户端和服务器之间的数据传输更有效率。</strong></p>
<blockquote>
<p>性能、调优是数据库编程永恒不变的主题！如果能把SQL语句框架预先处理好，当真正要执行SQL语句时只需要发送对应的参数到对应的SQL框架中，就能提高客户端访问服务器的速度，且数据量小，可以减少网络通信量，提高数据传输效率高。				</p>
</blockquote>
<p>预处理语句的优势在于归纳为：一次编译、多次运行，省去了解析优化等过程；此外预处理语句能<strong>防止 SQL 注入</strong>。</p>
<h4 id="预处理相关函数"><a href="#预处理相关函数" class="headerlink" title="预处理相关函数"></a>预处理相关函数</h4><ul>
<li><a href="#mysql_stmt_init%E5%87%BD%E6%95%B0"><code>mysql_stmt_init()</code></a>				初始化预处理环境句柄。	返回一个结构体指针 <code>MYSQL_STMT *stmt</code></li>
<li><a href="#mysql_stmt_prepare%E5%87%BD%E6%95%B0"><code>mysql_stmt_prepare()</code></a>				向上面句柄中添加SQL语句，带有 <code>(?,?,?)</code> 占位符</li>
<li><a href="#mysql_stmt_param_count%E5%87%BD%E6%95%B0"><code>mysql_stmt_param_count()</code> </a>		求绑定变量的个数(辅助函数)， 有多少个’?’就返回多少</li>
<li><a href="#mysql_stmt_bind_param%E5%87%BD%E6%95%B0"><code>mysql_stmt_bind_param()</code></a>			将?对应的实参，设置到预处理环境句柄中</li>
<li><a href="#mysql_stmt_execute%E5%87%BD%E6%95%B0"><code>mysql_stmt_execute()</code></a>				执行预处理的SQL语句</li>
<li><a href="#mysql_stmt_error%E5%87%BD%E6%95%B0"><code>mysql_stmt_error()</code> </a>	    获取错误消息。</li>
<li><a href="#mysql_stmt_close%E5%87%BD%E6%95%B0"><code>mysql_stmt_close()</code> </a>	    关闭预处理语句</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202211221646758.png" alt="image-20221122164501715"></p>
<h5 id="mysql-stmt-init函数"><a href="#mysql-stmt-init函数" class="headerlink" title="mysql_stmt_init函数"></a>mysql_stmt_init函数</h5><p>创建MYSQL_STMT句柄。对于该句柄，应使用<a href="#mysql_stmt_close%E5%87%BD%E6%95%B0"><code>mysql_stmt_close(MYSQL_STMT *)</code></a>释放。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MYSQL_STMT *<span class="title function_">mysql_stmt_init</span><span class="params">(MYSQL *mysql)</span>;</span><br><span class="line"><span class="comment">//成功时，返回指向MYSQL_STMT结构的指针。如果内存溢出，返回NULL。</span></span><br></pre></td></tr></table></figure>

<h5 id="mysql-stmt-prepare函数"><a href="#mysql-stmt-prepare函数" class="headerlink" title="mysql_stmt_prepare函数"></a>mysql_stmt_prepare函数</h5><p>准备sql语句框架,字符串必须包含1条SQL语句(通过将问号字符“?”嵌入到SQL字符串的恰当位置)。不应为语句添加终结用分号(‘;’)或\g。 </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mysql_stmt_prepare</span><span class="params">(MYSQL_STMT *stmt, <span class="type">const</span> <span class="type">char</span> *query, <span class="type">unsigned</span> <span class="type">long</span> length)</span>;</span><br><span class="line"><span class="comment">//query为sql语句字符串,length为sql字符串长度</span></span><br><span class="line"><span class="comment">//如果成功处理了语句，返回0。如果出现错误，返回非0值。 </span></span><br></pre></td></tr></table></figure>

<p>可通过调用<a href="#mysql_stmt_error%E5%87%BD%E6%95%B0"><code>mysql_stmt_error() </code></a>获取错误消息。</p>
<h5 id="mysql-stmt-param-count函数"><a href="#mysql-stmt-param-count函数" class="headerlink" title="mysql_stmt_param_count函数"></a>mysql_stmt_param_count函数</h5><p>返回预处理语句中参数标记符的数目。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">mysql_stmt_param_count</span><span class="params">(MYSQL_STMT *stmt)</span>;</span><br><span class="line"><span class="comment">//表示语句中参数数目的无符号长整数。 </span></span><br></pre></td></tr></table></figure>

<h5 id="mysql-stmt-bind-param函数"><a href="#mysql-stmt-bind-param函数" class="headerlink" title="mysql_stmt_bind_param函数"></a>mysql_stmt_bind_param函数</h5><p><code>mysql_stmt_bind_param()</code>用于为SQL语句中的参数标记符绑定数据，以传递给<code>mysql_stmt_prepare()</code>。它使用<code>MYSQL_BIND</code>结构来提供数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_bool <span class="title function_">mysql_stmt_bind_param</span><span class="params">(MYSQL_STMT *stmt, MYSQL_BIND *bind)</span>;</span><br><span class="line"><span class="comment">//bind应该为MYSQL_BIND数组首地址</span></span><br><span class="line"><span class="comment">//如果绑定成功，返回0。如果出现错误，返回非0值。</span></span><br></pre></td></tr></table></figure>

<h6 id="MYSQL-BIND结构体"><a href="#MYSQL-BIND结构体" class="headerlink" title="MYSQL_BIND结构体"></a>MYSQL_BIND结构体</h6><p>详解参考<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/c-api/8.0/en/c-api-prepared-statement-data-structures.html">官方文档</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">MYSQL_BIND</span> &#123;</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> *length; <span class="comment">/* 参考下方讲解*/</span></span><br><span class="line">  <span class="type">bool</span> *is_null;         <span class="comment">/* 问号缓冲区中的值是否可以为空Pointer to null indicator */</span></span><br><span class="line">  <span class="type">void</span> *buffer;          <span class="comment">/* 指向问号缓冲区的地址buffer to get/put data */</span></span><br><span class="line">  <span class="comment">/* set this if you want to track data truncations happened during fetch */</span></span><br><span class="line">  <span class="type">bool</span> *error;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> *row_ptr; <span class="comment">/* for the current data position */</span></span><br><span class="line">  <span class="type">void</span> (*store_param_func)(NET *net, <span class="keyword">struct</span> MYSQL_BIND *param);</span><br><span class="line">  <span class="type">void</span> (*fetch_result)(<span class="keyword">struct</span> MYSQL_BIND *, MYSQL_FIELD *, <span class="type">unsigned</span> <span class="type">char</span> **row);</span><br><span class="line">  <span class="type">void</span> (*skip_result)(<span class="keyword">struct</span> MYSQL_BIND *, MYSQL_FIELD *, <span class="type">unsigned</span> <span class="type">char</span> **row);</span><br><span class="line">  <span class="comment">/* output buffer length, must be set when fetching str/binary */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> buffer_length;<span class="comment">//缓冲区长度,字符串要提供.作为输入参数时表示buffer的	字节数,作为输出结果时,表示可以存储在buffer中的最大字节数</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> offset;              <span class="comment">/* offset position for char/binary fetch */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> length_value;        <span class="comment">/* Used if length is 0 */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> param_number;         <span class="comment">/* For null count and error messages */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> pack_length;          <span class="comment">/* Internal length for packed data */</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">enum_field_types</span> <span class="title">buffer_type</span>;</span> <span class="comment">/* 问号缓冲区的类别buffer type */</span></span><br><span class="line">  <span class="type">bool</span> error_value;                  <span class="comment">/* used if error is 0 */</span></span><br><span class="line">  <span class="type">bool</span> is_unsigned;                  <span class="comment">/* set if integer type is unsigned */</span></span><br><span class="line">  <span class="type">bool</span> long_data_used;               <span class="comment">/* If used with mysql_send_long_data */</span></span><br><span class="line">  <span class="type">bool</span> is_null_value;                <span class="comment">/* Used if is_null is 0 */</span></span><br><span class="line">  <span class="type">void</span> *extension;</span><br><span class="line">&#125; MYSQL_BIND;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>值得注意的是上面结构体中的length成员和buffer_length成员你的区别:</p>
<ul>
<li><p>对于入参数据绑定，设置 length 表示 buffer 中存储的参数值的实际长度。这是由 mysql_stmt_execute() 使用的。</p>
<p>当length为NULL时，buffer_length可以作为长度来用</p>
<ul>
<li>但改变buffer_length之后必须重新调用<code>mysql_stmt_bind()</code>才会对查询起作用。</li>
<li>而length只要改变其所指向的unsigned long，就会在下一次查询起作用，不用重新调用<code>mysql_stmt_bind()</code>。</li>
</ul>
</li>
<li><p>对于输出值绑定，MySQL 在您调用 mysql_stmt_fetch() 时设置 length 。 mysql_stmt_fetch() 返回值决定了如何解释长度：</p>
<ul>
<li>如果返回值为0，则 *length 表示参数值的实际长度。</li>
<li>如果返回值为 <code>MYSQL_DATA_TRUNCATED</code> ，则 *length 表示参数值的非截断长度。在这种情况下， *length 和 buffer_length 中的最小值表示值的实际长度。</li>
</ul>
</li>
</ul>
</blockquote>
<p>buffer_type成员指定的允许值:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202211221724158.png" alt="image-20221122172303182"></p>
<h5 id="mysql-stmt-execute函数"><a href="#mysql-stmt-execute函数" class="headerlink" title="mysql_stmt_execute函数"></a>mysql_stmt_execute函数</h5><p><code>mysql_stmt_execute()</code>执行与语句句柄相关的预处理查询。在该调用期间，将当前绑定的参数标记符的值发送到服务器，服务器用新提供的数据替换标记符。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mysql_stmt_execute</span><span class="params">(MYSQL_STMT *stmt)</span>;</span><br><span class="line"><span class="comment">//如果执行成功，返回0。如果出现错误，返回非0值。</span></span><br></pre></td></tr></table></figure>

<h5 id="mysql-stmt-bind-result函数"><a href="#mysql-stmt-bind-result函数" class="headerlink" title="mysql_stmt_bind_result函数"></a>mysql_stmt_bind_result函数</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">mysql_stmt_bind_result</span><span class="params">(MYSQL_STMT *stmt, MYSQL_BIND *bind)</span></span></span><br><span class="line"><span class="function"><span class="comment">//返回值:如果绑定成功，返回0。如果出现错误，返回非0值。</span></span></span><br></pre></td></tr></table></figure>

<p>一种函数，用于将结果集中的列与数据缓冲和长度缓冲关联（绑定）起来。当调用<code>mysql_stmt_fetch()</code>以获取数据时，MySQL客户端&#x2F;服务器协议会将绑定列的数据置于指定的缓冲区内。</p>
<h5 id="mysql-stmt-fetch函数"><a href="#mysql-stmt-fetch函数" class="headerlink" title="mysql_stmt_fetch函数"></a>mysql_stmt_fetch函数</h5><p>mysql_stmt_fetch是函数名，mysql_stmt_fetch()返回结果集中的下一行。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">mysql_stmt_fetch</span><span class="params">(MYSQL_STMT *stmt)</span></span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>返回值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>成功，数据被提取到应用程序数据缓冲区。</td>
</tr>
<tr>
<td>1</td>
<td>出现错误。调用mysql_stmt_error()，可获取错误消息。</td>
</tr>
<tr>
<td>MYSQL_NO_DATA</td>
<td>不存在行&#x2F;数据。</td>
</tr>
<tr>
<td>MYSQL_DATA_TRUNCATED</td>
<td>出现数据截短。</td>
</tr>
</tbody></table>
<h5 id="mysql-stmt-error函数"><a href="#mysql-stmt-error函数" class="headerlink" title="mysql_stmt_error函数"></a>mysql_stmt_error函数</h5><p>对于由stmt指定的语句，<code>mysql_stmt_error()</code>返回由Null终结的字符串，该字符串包含最近调用的语句API函数的错误消息，该函数或成功或失败。如果未出现错误，返回空字符串(<code>&quot;&quot;</code>)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">char</span> *<span class="title function_">mysql_stmt_error</span><span class="params">(MYSQL_STMT *stmt)</span> </span><br></pre></td></tr></table></figure>

<h5 id="mysql-stmt-close函数"><a href="#mysql-stmt-close函数" class="headerlink" title="mysql_stmt_close函数"></a>mysql_stmt_close函数</h5><p>关闭预处理句柄</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my_bool <span class="title function_">mysql_stmt_close</span><span class="params">(MYSQL_STMT *)</span>;</span><br><span class="line"><span class="comment">//如果成功释放了语句，返回0。如果出现错误，返回非0值。 </span></span><br></pre></td></tr></table></figure>

<h4 id="预处理案例"><a href="#预处理案例" class="headerlink" title="预处理案例"></a>预处理案例</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> id[<span class="number">5</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> name[<span class="number">129</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">char</span> nodedesc[<span class="number">513</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    MYSQL_TIME createtime;</span><br><span class="line">    <span class="type">int</span> authcode = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> state = <span class="number">0</span>;</span><br><span class="line">    string query = <span class="string">&quot;select * from SECNODE where id = ?&quot;</span>;</span><br><span class="line">    MYSQL_STMT *stmt = <span class="built_in">mysql_stmt_init</span>(mysql);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">mysql_stmt_prepare</span>(stmt,query.<span class="built_in">c_str</span>(),query.<span class="built_in">size</span>())) &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Could not prepare statement: &quot;</span>&lt;&lt;<span class="built_in">mysql_stmt_error</span>(stmt)&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//初始化问号参数集</span></span><br><span class="line">    MYSQL_BIND bind[<span class="number">1</span>];<span class="comment">//初始化问号数作为参数个bind</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> paramlength=<span class="number">4</span>;</span><br><span class="line">    <span class="built_in">memset</span>(bind,<span class="number">0</span>,<span class="built_in">sizeof</span>(MYSQL_BIND));</span><br><span class="line">    bind[<span class="number">0</span>].buffer_type = MYSQL_TYPE_STRING;</span><br><span class="line">    bind[<span class="number">0</span>].buffer = (<span class="type">char</span>*)clientID.<span class="built_in">c_str</span>();</span><br><span class="line">    bind[<span class="number">0</span>].length = &amp;paramlength;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">mysql_stmt_bind_param</span>(stmt, bind)) &#123;</span><br><span class="line">       cout&lt;&lt;<span class="string">&quot;Could not bind parameters:&quot;</span>&lt;&lt;<span class="built_in">mysql_stmt_error</span>(stmt)&lt;&lt;endl;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">mysql_stmt_execute</span>(stmt)) &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;Could not execute statement: &quot;</span>&lt;&lt; <span class="built_in">mysql_stmt_error</span>(stmt)&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="comment">//初始化结果集</span></span><br><span class="line">    MYSQL_BIND res[<span class="number">6</span>];</span><br><span class="line">    <span class="built_in">memset</span>(res, <span class="number">0</span>, <span class="built_in">sizeof</span>(bind));</span><br><span class="line">    res[<span class="number">0</span>].buffer_type = MYSQL_TYPE_STRING;</span><br><span class="line">    res[<span class="number">0</span>].buffer = id;</span><br><span class="line">    res[<span class="number">0</span>].buffer_length = <span class="built_in">sizeof</span>(id)<span class="number">-1</span>;</span><br><span class="line">    res[<span class="number">1</span>].buffer = name;</span><br><span class="line">    res[<span class="number">1</span>].buffer_type = MYSQL_TYPE_VAR_STRING;</span><br><span class="line">    res[<span class="number">1</span>].buffer_length = <span class="built_in">sizeof</span>(name)<span class="number">-1</span>;</span><br><span class="line">    res[<span class="number">2</span>].buffer = nodedesc;</span><br><span class="line">    res[<span class="number">2</span>].buffer_type = MYSQL_TYPE_VAR_STRING;</span><br><span class="line">    res[<span class="number">2</span>].buffer_length = <span class="built_in">sizeof</span>(nodedesc)<span class="number">-1</span>;</span><br><span class="line">    res[<span class="number">3</span>].buffer_type = MYSQL_TYPE_TIME;</span><br><span class="line">    res[<span class="number">3</span>].buffer = &amp;createtime;</span><br><span class="line">    res[<span class="number">4</span>].buffer = &amp;authcode;</span><br><span class="line">    res[<span class="number">4</span>].buffer_type = MYSQL_TYPE_LONG;</span><br><span class="line">    res[<span class="number">5</span>].buffer = &amp;state;</span><br><span class="line">    res[<span class="number">5</span>].buffer_type = MYSQL_TYPE_LONG;</span><br><span class="line">    cout&lt;&lt;<span class="built_in">mysql_stmt_bind_result</span>(stmt, res)&lt;&lt;endl;</span><br><span class="line">    <span class="built_in">mysql_stmt_store_result</span>(stmt);</span><br><span class="line">    <span class="comment">// 获取结果</span></span><br><span class="line">    <span class="type">int</span> fetch;</span><br><span class="line">    <span class="keyword">while</span> ((fetch = <span class="built_in">mysql_stmt_fetch</span>(stmt)) != MYSQL_NO_DATA) &#123;</span><br><span class="line">        cout &lt;&lt;<span class="string">&quot;fetch:&quot;</span>&lt;&lt;fetch&lt;&lt;endl;</span><br><span class="line">       cout&lt;&lt;<span class="string">&quot;id:&quot;</span>&lt;&lt; id&lt;&lt;<span class="string">&quot;, name: &quot;</span>&lt;&lt; name&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">mysql_stmt_close</span>(stmt);</span><br></pre></td></tr></table></figure>

<h1 id="oracle和mysql的区别"><a href="#oracle和mysql的区别" class="headerlink" title="oracle和mysql的区别"></a>oracle和mysql的区别</h1><p>oracle要求select和from一定要组合使用,mysql可以没有from</p>
<h1 id="sqlite"><a href="#sqlite" class="headerlink" title="sqlite"></a>sqlite</h1><p>SQLite 是一种轻量级的关系数据库管理系统，广泛用于嵌入式系统和移动应用程序中。它的特点是： </p>
<ol>
<li><strong>轻量级</strong>：SQLite 的库文件非常小，通常只有几百 KB，适合资源有限的环境。 </li>
<li><strong>自包含</strong>：SQLite 不需要安装和配置，所有的数据库文件都是普通的文件，可以直接使用。 </li>
<li><strong>零配置</strong>：它不需要服务器进程，数据库文件可以直接在应用程序中打开和操作。 </li>
<li><strong>跨平台</strong>：SQLite 可以在多种操作系统上运行，包括 Windows、Linux 和 macOS。</li>
</ol>
<p>在各大操作系统中基本都有预装</p>
<p>可以使用<code>sqlite3 --version</code>查看安装的版本</p>
<h1 id="时序数据库"><a href="#时序数据库" class="headerlink" title="时序数据库"></a>时序数据库</h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1r14y1Q7ec/">参考视频教程,讲解得比较底层</a></p>
<ol>
<li><strong>InfluxDB</strong>：一个开源的时序数据库，专为高性能数据写入和查询而设计，适合监控和分析工业数据。 </li>
<li><strong>TimescaleDB</strong>：基于PostgreSQL的扩展，支持时序数据的存储和查询，具备强大的SQL功能。 </li>
<li><strong>Prometheus</strong>：虽然主要用于监控，但也可以作为时序数据库，适合收集和查询时间序列数据。 </li>
<li><strong>OpenTSDB</strong>：一个分布式、可扩展的时序数据库，通常与Hadoop和HBase结合使用。 </li>
<li><strong>Graphite</strong>：用于存储和绘制时序数据，特别适合监控和性能指标。 </li>
<li>**Kdb+**：高性能的时序数据库，广泛应用于金融和其他需要快速数据处理的工业领域。</li>
</ol>
<h1 id="非关系数据库"><a href="#非关系数据库" class="headerlink" title="非关系数据库"></a>非关系数据库</h1><p>数据库有两种</p>
<ul>
<li><p>关系型数据库</p>
<p>mysql,oracle,sqlite,sql server</p>
<ul>
<li>操作数据必须要使用sql语句</li>
<li>数据存储在磁盘</li>
<li>存储的数据量大</li>
</ul>
</li>
<li><p>非关系型数据库</p>
<p>nosql,redis</p>
<ul>
<li>操作不使用sql语句,命令方式</li>
<li>数据默认存储在内存,速度快,效率高,存储数据量小</li>
<li>不需要数据库表,以键值对的方式存储的</li>
</ul>
</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202305261512329.png" alt="image-20230526151239035" style="zoom:50%;" />

<ol>
<li>所有的数据默认存储在关系型数据库中</li>
<li>客户端访问服务器, 有一些数据, 服务器需要频繁的查询数据<ul>
<li>服务器首先将数据从关系型数据库中读出 -&gt; 第一次</li>
<li>将数据写入到redis中</li>
<li>客户端第二次包含以后访问服务器</li>
<li>服务器从redis中直接读数据</li>
</ul>
</li>
</ol>
<h2 id="NoSQL数据库"><a href="#NoSQL数据库" class="headerlink" title="NoSQL数据库"></a>NoSQL数据库</h2><p>如果你的应用场景允许，考虑使用 NoSQL 数据库（如 MongoDB）。</p>
<p>这些数据库通常使用 JSON 文档存储数据，操作方式更接近编程语言本身，避免了 SQL 的复杂性</p>
<p>下面是几个比较轻量的NoSQL数据库盘点如下:</p>
<ol>
<li><strong>Redis</strong>： - Redis 是一个开源的键值存储数据库，通常用于缓存和快速数据存取。它在内存中运行，速度非常快，且可以通过简单的安装和配置来使用。虽然 Redis 的主要数据存储在内存中，但它也可以持久化到磁盘。 </li>
<li><strong>LiteDB</strong>： - LiteDB 是一个轻量级的 NoSQL 文档数据库，专为 .NET 应用程序设计。它是一个单文件数据库，简单易用，适合嵌入式应用。 </li>
<li><strong>PouchDB</strong>： - PouchDB 是一个 JavaScript 数据库，允许在浏览器中使用 NoSQL 数据库。它可以与 CouchDB 同步，适合需要在客户端存储数据的应用。 </li>
<li><strong>LevelDB</strong>： - LevelDB 是一个开源的键值存储库，由 Google 开发。它是一个轻量级的数据库，适合需要快速存取和高效存储的场景。</li>
</ol>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="安装与使用"><a href="#安装与使用" class="headerlink" title="安装与使用"></a>安装与使用</h3><p><a target="_blank" rel="noopener" href="http://redis.cn/">官网跳转</a></p>
<p>安装命令: <code>sudo apt install redis-server redis-tools</code></p>
<p>redis两个角色</p>
<ul>
<li><p>服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">服务器启动(不填路径默认找根目录下的redis.conf)</span></span><br><span class="line">redis-server [配置文件路径]</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">客户端</span></span><br><span class="line">redis-cli [-p 端口号] [-h ip地址]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认连接本地6379端口的服务器</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过客户端关闭服务器</span></span><br><span class="line">shutdown</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">客户端的测试命令</span></span><br><span class="line">ping [&quot;测试消息&quot;]</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="http://redis.cn/commands.html">官方命令在线文档</a></p>
<ol>
<li>安装完成后，Redis服务将自动启动。您可以使用以下命令检查Redis服务的状态：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status redis-server</span><br><span class="line"></span><br></pre></td></tr></table></figure>
如果服务正在运行，您将看到<code>active (running)</code>的状态。 </li>
<li>如果Redis服务未运行，您可以使用以下命令手动启动它：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start redis-server</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ol start="3">
<li>您还可以使用以下命令停止Redis服务：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop redis-server</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ol start="4">
<li>如果您希望Redis服务在系统启动时自动启动，可以使用以下命令启用它：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> redis-server</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h4 id="redis配置文件"><a href="#redis配置文件" class="headerlink" title="redis配置文件"></a>redis配置文件</h4><p>给redis服务器使用的</p>
<p>根目录下的<code>redis.conf</code></p>
<p>配置文件常用配置项</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">允许谁访问redis服务器(如果注释掉它表示任何主机都可以访问到redis服务器)</span></span><br><span class="line">bind 127.0.0.1 192.168.1.100</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">保护模式(保护模式必须要关闭才能允许远程主机访问reids服务器)</span></span><br><span class="line">protected-mode yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis服务器启动的时候绑定的端口(默认为6379)</span></span><br><span class="line">port 6379</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">客户端空闲的超时时长,超时后服务器主动断开连接(0表示禁用该超时断开功能)</span></span><br><span class="line">timeout 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">服务器启动后是否以守护进程存在</span></span><br><span class="line">daemonize no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果上一项设置了服务器是守护进程,就会生成一个pid文件,路径设置为如下,一般改为./redis_6379.pid表示redis-server的启动目录下生成pid文件</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">服务器是守护进程,才会写日志文件,日志文件路径如下(空<span class="string">&quot;&quot;</span>表示把日志丢到了空设备中,意思不想保留下来,一般修改成./redis.log)</span></span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置数据库的个数(通过<span class="keyword">select</span> dbID来切换数据库,dbID== 0到database的值-1之间的一个值)</span></span><br><span class="line">databases 16</span><br></pre></td></tr></table></figure>

<p>另有<a href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE%E9%A1%B9">数据持久化相关的配置项(点击跳转)</a></p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>redis中数据的组织形式:</p>
<ul>
<li><p>key: 必须是字符串 - “hello world”(双引号括住的部分会将空格也视为字符串的一部分)</p>
</li>
<li><p>value: 可选的</p>
<ul>
<li><p>String类型</p>
<p>字符串</p>
</li>
<li><p>List类型</p>
<p>存储多个String字符串的</p>
</li>
<li><p>Set类型</p>
<p>集合(元素不重复,数据是无序的)</p>
</li>
<li><p>SortedSet类型</p>
<p>排序集合(元素不重复,默认升序)</p>
</li>
<li><p>Hash类型</p>
<p>与[[stl]]数据组织方式一样   key:value</p>
<ul>
<li>map是红黑树实现的</li>
<li>hash是数组实现的</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="String类型命令"><a href="#String类型命令" class="headerlink" title="String类型命令"></a>String类型命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">key -&gt; string</span><br><span class="line">value -&gt; string</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置一个键值对-&gt;string:string</span></span><br><span class="line">SET key value</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过key得到value</span></span><br><span class="line">GET key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同时设置一个或多个 key-value 对</span></span><br><span class="line">MSET key value [key value ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同时查看过个key</span></span><br><span class="line">MGET key [key ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">key: hello, value: world, append: 12345</span></span><br><span class="line">APPEND key value</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">返回 key 所储存的字符串值的长度</span></span><br><span class="line">STRLEN key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">INCR key为key值加1  INCRBY key n:key的值加n</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DECR key为key值减1  DECRBY key n:key的值减n</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">前提, value必须是数字字符串 -<span class="string">&quot;12345&quot;</span></span></span><br><span class="line">DECR key</span><br></pre></td></tr></table></figure>

<h4 id="List类型命令"><a href="#List类型命令" class="headerlink" title="List类型命令"></a>List类型命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">key -&gt; string</span><br><span class="line">value -&gt; list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将一个或多个值 value 插入到列表 key 的表头</span></span><br><span class="line">LPUSH key value [value ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将一个或多个值 value 插入到列表 key 的表尾 (最右边)。</span></span><br><span class="line">RPUSH key value [value ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">list中删除元素</span></span><br><span class="line">LPOP key # 删除最左侧元素</span><br><span class="line">RPOP key # 删除最右侧元素</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">遍历</span></span><br><span class="line">LRANGE key start stop</span><br><span class="line">start: 起始位置, 0</span><br><span class="line">stop: 结束位置, -1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">倒数第二个为-2,倒数第三为-3,依此类推</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过下标得到对应位置的字符串</span></span><br><span class="line">LINDEX key index</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">list中字符串的个数</span></span><br><span class="line">LLEN key</span><br></pre></td></tr></table></figure>

<h4 id="Set类型命令"><a href="#Set类型命令" class="headerlink" title="Set类型命令"></a>Set类型命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">key -&gt; string</span><br><span class="line">value -&gt; set类型 (&quot;string&quot;, &quot;string1&quot;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加元素</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将一个或多个 member 元素加入到集合 key 当中，已经存在于集合的 member 元素将被忽略</span></span><br><span class="line">SADD key member [member ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">遍历</span></span><br><span class="line">SMEMBERS key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">差集</span></span><br><span class="line">SDIFF key [key ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">交集</span></span><br><span class="line">SINTER key [key ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">并集</span></span><br><span class="line">SUNION key [key ...]</span><br></pre></td></tr></table></figure>

<h4 id="SortedSet-类型"><a href="#SortedSet-类型" class="headerlink" title="SortedSet 类型"></a>SortedSet 类型</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">key -&gt; string</span><br><span class="line">value -&gt; sorted ([socre, member], [socre, member], ...)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加元素(如果添加的member已存在,可以更新score的值)</span></span><br><span class="line">ZADD key score member [[score member] [score member] ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">遍历 (WITHSCORES参数能让成员和它的 score 值一并返回)</span></span><br><span class="line">ZRANGE key start stop [WITHSCORES] # -&gt; 升序集合</span><br><span class="line">ZREVRANGE key start stop [WITHSCORES] # -&gt; 降序集合</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定分数区间内元素的个数</span></span><br><span class="line">ZCOUNT key min max</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示member的薪水排名</span></span><br><span class="line">ZRANK key member#由尾至前的排名</span><br><span class="line">ZREVRANK key member#由前至尾的排名</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">移除有序集中的一个或多个成员</span></span><br><span class="line">ZREM key member [member...]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">系那是成员的score值</span></span><br><span class="line">ZSCORE key member</span><br></pre></td></tr></table></figure>

<h4 id="Hash类型命令"><a href="#Hash类型命令" class="headerlink" title="Hash类型命令"></a>Hash类型命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">key -&gt;string</span><br><span class="line">value -&gt; hash ([field:value], [field:value], [field:value], ...)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加数据(field是字段)  添加一个field:value的键值对</span></span><br><span class="line">HSET key field value</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取某字段数据</span></span><br><span class="line">HGET key field</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">批量插入键值对</span></span><br><span class="line">HMSET key field value [field value ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">批量取数据</span></span><br><span class="line">HMGET key field [field ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除键值对</span></span><br><span class="line">HDEL key field [field ...]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">判断字段是否存在(1存在,0不存在)</span></span><br><span class="line">HEXISTS key file</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">遍历哈希表key中所有的字段和值</span></span><br><span class="line">HGETALL key</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">返回哈希表key中的所有字段</span></span><br><span class="line">HKEYS key</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">返回哈希表key中的字段数来你肝</span></span><br><span class="line">HLEN key</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">返回哈希表key中的所有字段的值</span></span><br><span class="line">HVALS key</span><br></pre></td></tr></table></figure>

<h4 id="Key-相关的命令"><a href="#Key-相关的命令" class="headerlink" title="Key 相关的命令"></a>Key 相关的命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除键值对</span></span><br><span class="line">DEL key [key ...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看key值</span></span><br><span class="line">KEYS pattern</span><br><span class="line">查找所有符合给定模式 pattern 的 key 。</span><br><span class="line">KEYS * 匹配数据库中所有 key 。</span><br><span class="line">KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。</span><br><span class="line">KEYS h*llo 匹配 hllo 和 heeeeello 等。</span><br><span class="line">KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给key设置生存时长(seconds可以输入算式如24*60*60)</span></span><br><span class="line">EXPIRE key seconds</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看key当前还剩下的生存时长,无限生存时间返回的是-1</span></span><br><span class="line">ttl key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取消生存时长</span></span><br><span class="line">PERSIST key</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">返回key对应的valued的数据类型</span></span><br><span class="line">TYPE key</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">判断key值是否存在(存在返回1,否则返回0)</span></span><br><span class="line">EXISTS key</span><br></pre></td></tr></table></figure>

<h3 id="redis插件"><a href="#redis插件" class="headerlink" title="redis插件"></a>redis插件</h3><p><a target="_blank" rel="noopener" href="https://github.com/RedisBloom/RedisBloom/tree/v2.2.14">布隆过滤器插件</a></p>
<p> [[数据结构#布隆过滤器|了解布隆过滤器]]</p>
<h3 id="Redis数据持久化"><a href="#Redis数据持久化" class="headerlink" title="Redis数据持久化"></a>Redis数据持久化</h3><blockquote>
<p>持久化:数据从内存到磁盘的过程</p>
</blockquote>
<p><strong>持久化的两种方式</strong></p>
<ul>
<li><strong><code>rdb方式</code></strong><ul>
<li>这是一种默认的持久化方式,默认打开</li>
<li>磁盘的持久化文件<code>xxx.rdb</code></li>
<li>将内存数据以<strong>二进制</strong>的方式直接写入磁盘文件</li>
<li>文件比较<strong>小,恢复时间短,效率高</strong></li>
<li>以<strong>用户设定的频率</strong>同步数据</li>
</ul>
</li>
<li><strong><code>aof方式</code></strong><ul>
<li>默认是关闭的</li>
<li>磁盘的持久化文件<code>xxx.aof</code></li>
<li>直接将<strong>生成数据的命令</strong>写入磁盘文件</li>
<li>文件比较<strong>大,恢复时间长,效率低</strong></li>
<li><strong>每隔1s同步一次</strong>,不可设置(由于频率很快,数据完整性高)</li>
</ul>
</li>
</ul>
<p><strong>二者关联</strong></p>
<ul>
<li>aof和rdb同步方式可以同时打开</li>
<li>aof和rdb同步方式可以同时关闭</li>
<li>两种模式同时开启的情况下,数据恢复时<ul>
<li>效率上考虑用<code>rdb模式</code></li>
<li>数据完整性上考虑用<code>aof模式</code></li>
</ul>
</li>
</ul>
<h4 id="数据持久化的配置项"><a href="#数据持久化的配置项" class="headerlink" title="数据持久化的配置项"></a>数据持久化的配置项</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置rdb的同步频率(设置为save <span class="string">&quot;&quot;</span>表示关闭rdb同步方式)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">900s内至少一个key发生变化就同步数据到磁盘上</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">300s内至少十个key发生变化就同步数据</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">60s内至少一万个key发生变化就同步数据</span></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rdb同步到磁盘上的文件名字</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rdb和aof文件同步到磁盘上的文件的路径</span></span><br><span class="line">dir ./</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">aof文件同步功能是否要打开</span></span><br><span class="line">appendonly no</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">aof文件名字</span></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">aof的同步方式(可以设置为always,everysec或no)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">everysec为每秒同步一次(折中方案,推荐)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">always为每写一次就同步一次(效率最低)</span></span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">no为操作系统想的时候才会同步(效率最高,一般不用)</span></span><br><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure>

<h3 id="Redis开发"><a href="#Redis开发" class="headerlink" title="Redis开发"></a>Redis开发</h3><p>redis开发库有很多,有官方的有第三方的,支持各种语言,在<a target="_blank" rel="noopener" href="http://redis.cn/clients.html">官网有罗列(点击跳转)</a></p>
<p>此处以C语言的库<a target="_blank" rel="noopener" href="https://github.com/redis/hiredis">HIREDIS</a>作为选择</p>
<h4 id="HIREDIS库"><a href="#HIREDIS库" class="headerlink" title="HIREDIS库"></a>HIREDIS库</h4><p><a target="_blank" rel="noopener" href="https://github.com/redis/hiredis">HIREDIS库github链接</a></p>
<p><strong>hiredis API接口的使用</strong></p>
<p><strong>连接数据库</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接数据库</span></span><br><span class="line">redisContext *<span class="title function_">redisConnect</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *ip, <span class="type">int</span> port)</span>;</span><br><span class="line">redisContext *<span class="title function_">redisConnectWithTimeout</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *ip,<span class="type">int</span> port, <span class="type">const</span> <span class="keyword">struct</span> timeval tv)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>redisContext结构体</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">redisContext</span> &#123;</span><br><span class="line">    <span class="type">const</span> redisContextFuncs *funcs;   <span class="comment">/* Function table */</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> err; <span class="comment">/* Error flags, 0 when there is no error 不等于0表示有错误*/</span></span><br><span class="line">    <span class="type">char</span> errstr[<span class="number">128</span>]; <span class="comment">/* String representation of error when applicable */</span></span><br><span class="line">    redisFD fd;</span><br><span class="line">    <span class="type">int</span> flags;</span><br><span class="line">    <span class="type">char</span> *obuf; <span class="comment">/* Write buffer */</span></span><br><span class="line">    redisReader *reader; <span class="comment">/* Protocol reader */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">redisConnectionType</span> connection_type;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> *connect_timeout;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> *command_timeout;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">        <span class="type">char</span> *host;</span><br><span class="line">        <span class="type">char</span> *source_addr;</span><br><span class="line">        <span class="type">int</span> port;</span><br><span class="line">    &#125; tcp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">        <span class="type">char</span> *path;</span><br><span class="line">    &#125; unix_sock;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* For non-blocking connect */</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr</span> *saddr;</span><br><span class="line">    <span class="type">size_t</span> addrlen;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Optional data and corresponding destructor users can use to provide</span></span><br><span class="line"><span class="comment">     * context to a given redisContext.  Not used by hiredis. */</span></span><br><span class="line">    <span class="type">void</span> *privdata;</span><br><span class="line">    <span class="built_in">void</span> (*free_privdata)(<span class="type">void</span> *);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Internal context pointer presently used by hiredis to manage</span></span><br><span class="line"><span class="comment">     * SSL connections. */</span></span><br><span class="line">    <span class="type">void</span> *privctx;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* An optional RESP3 PUSH handler */</span></span><br><span class="line">    redisPushFn *push_cb;</span><br><span class="line">&#125; redisContext;</span><br></pre></td></tr></table></figure>

<p><strong>执行redis命令函数</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行redis命令</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">redisCommand</span><span class="params">(redisContext *c, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="comment">//第一个参数,即c为redisConnect的返回值</span></span><br><span class="line"><span class="comment">//如reply = redisCommand(c,&quot;SET %s %s&quot;, &quot;foo&quot;, &quot;hello world&quot;);</span></span><br></pre></td></tr></table></figure>

<p><strong>返回值指向的结构</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// redisCommand 函数实际的返回值类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">redisReply</span> &#123;</span></span><br><span class="line"><span class="comment">/* 命令执行结果的返回类型 */</span></span><br><span class="line"><span class="type">int</span> type;</span><br><span class="line"><span class="comment">/* 存储执行结果返回为整数 */</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> integer;</span><br><span class="line"><span class="comment">/* str变量的字符串值长度 */</span></span><br><span class="line"><span class="type">size_t</span> len;</span><br><span class="line"><span class="comment">/* 存储命令执行结果返回是字符串, 或者错误信息 */</span></span><br><span class="line"><span class="type">char</span> *str;</span><br><span class="line"><span class="comment">/* 返回结果是数组, 代表数据的大小 */</span></span><br><span class="line"><span class="type">size_t</span> elements;</span><br><span class="line"><span class="comment">/* 存储执行结果返回是数组*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">redisReply</span> **<span class="title">element</span>;</span></span><br><span class="line">&#125; redisReply;</span><br></pre></td></tr></table></figure>

<p><strong>type的类型盘点</strong></p>
<table>
<thead>
<tr>
<th>状态</th>
<th>表示含义</th>
</tr>
</thead>
<tbody><tr>
<td>REDIS_REPLY_STRING&#x3D;&#x3D;1</td>
<td>返回值是<strong>字符串</strong>,字符串储存在redis-&gt;str当中,字符串长度为redis-&gt;len</td>
</tr>
<tr>
<td>REDIS_REPLY_ARRAY&#x3D;&#x3D; 2</td>
<td>返回值是<strong>数组</strong>，数组大小存在redis-&gt;elements里面，数组值存储在redis-&gt;element[i]里面。数组里面存储的是指向redisReply的指针，数组里面的返回值可以通过redis-&gt;element[i]-&gt;str来访问，数组的结果里全是type&#x3D;&#x3D;REDIS_REPLY_STRING的redisReply对象指针。</td>
</tr>
<tr>
<td>REDIS_REPLY_INTEGER&#x3D;&#x3D; 3</td>
<td>返回整数long long，从integer字段获取值</td>
</tr>
<tr>
<td>REDIS_REPLY_NIL&#x3D;&#x3D;4</td>
<td>返回值为空表示执行结果为空</td>
</tr>
<tr>
<td>REDIS_REPLY_STATUS&#x3D;&#x3D;5</td>
<td>返回命令执行的状态，比如<code>set foo bar</code>返回的状态为OK，存储在str当中 <code>reply-&gt;str == &quot;OK&quot; 。</code></td>
</tr>
<tr>
<td>REDIS_REPLY_ERROR &#x3D;&#x3D;6</td>
<td>命令执行错误,错误信息存放在 reply-&gt;str当中。</td>
</tr>
</tbody></table>
<p><strong>释放资源</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//释放放回结果</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">freeReplyObject</span><span class="params">(<span class="type">void</span> *reply)</span>;</span><br><span class="line"><span class="comment">//释放连接</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">redisFree</span><span class="params">(redisContext *c)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hiredis.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    redisContext* c = <span class="built_in">redisConnect</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">    <span class="keyword">if</span>(c-&gt;err!=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;连接成功&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">    redisReply* ret = (redisReply*)<span class="built_in">redisCommand</span>(c,<span class="string">&quot;keys *&quot;</span>);</span><br><span class="line">    std::cout&lt;&lt;ret-&gt;type&lt;&lt;std::endl;<span class="comment">//显示为2,为数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ret-&gt;elements; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout&lt;&lt;ret-&gt;element[i]-&gt;str&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">freeReplyObject</span>(ret);</span><br><span class="line">    <span class="built_in">redisFree</span>(c);</span><br><span class="line">    cout&lt;&lt;ret-&gt;str&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="sql-server相关"><a href="#sql-server相关" class="headerlink" title="sql server相关"></a>sql server相关</h1><h2 id="sql-server配置"><a href="#sql-server配置" class="headerlink" title="sql server配置"></a>sql server配置</h2><p>此处记录win11下配置sql server的操作流程</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/sql/linux/quickstart-install-connect-docker?view=sql-server-ver16&tabs=cli&pivots=cs1-bash">参考官方指导</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装好镜像后</span></span><br><span class="line">sudo docker pull mcr.microsoft.com/mssql/server:2022-latest</span><br><span class="line"></span><br><span class="line">sudo docker run -e &quot;ACCEPT_EULA=Y&quot; -e &quot;MSSQL_SA_PASSWORD=&lt;YourStrong@Passw0rd&gt;&quot; -p 1433:1433 --name sql1 --hostname sql1 -d mcr.microsoft.com/mssql/server:2022-latest</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>-e &quot;ACCEPT_EULA=Y&quot;</code></td>
<td>将 ACCEPT_EULA 变量设置为任意值，以确认接受最终用户许可协议，是 SQL Server 映像的必需设置。</td>
</tr>
<tr>
<td><code>-e &quot;MSSQL_SA_PASSWORD=&lt;YourStrong@Passw0rd&gt;&quot;</code></td>
<td>指定至少包含 8 个字符且符合密码策略的强密码，是 SQL Server 映像的必需设置。</td>
</tr>
<tr>
<td><code>-e &quot;MSSQL_COLLATION=&lt;SQL_Server_collation&gt;&quot;</code></td>
<td>指定自定义 SQL Server 排序规则，可不使用默认值 SQL_Latin1_General_CP1_CI_AS。</td>
</tr>
<tr>
<td><code>-p 1433:1433</code></td>
<td>将主机环境中的 TCP 端口映射到容器中的 TCP 端口，在此例中，SQL Server 侦听容器中的 TCP 1433，此容器端口会对主机上的 TCP 端口 1433 公开。</td>
</tr>
<tr>
<td><code>--name sql1</code></td>
<td>为容器指定自定义名称，若运行多个容器，不能重复使用相同名称。</td>
</tr>
<tr>
<td><code>--hostname sql1</code></td>
<td>用于显式设置容器主机名，未指定则默认为随机生成的系统 GUID。</td>
</tr>
<tr>
<td><code>-d</code></td>
<td>在后台运行容器（守护程序）。</td>
</tr>
<tr>
<td><code>mcr.microsoft.com/mssql/server:2022-latest</code></td>
<td>SQL Server Linux 容器映像。</td>
</tr>
</tbody></table>
<p>默认情况下，密码必须设置为至少八个字符且包含以下四种字符中的三种：大写字母、小写字母、十进制数字、符号</p>
<p><code>   sudo /opt/mssql-tools/bin/sqlcmd -S localhost -U &lt;userid&gt; -P &quot;&lt;YourNewStrong@Passw0rd&gt;&quot;</code>  登录进sql server</p>
<p>查看容器的ip地址使用这句命令:<code>docker inspect -f &#39;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#39; 容器名/容器id</code></p>
<blockquote>
<p>新建好的数据库默认只能使用身份验证模式启动</p>
<p>需要使用SSMS通过身份验证模式连接上数据库,在右键-属性-安全性中,有服务器身份验证,选择”SQL Server和Windows身份验证模式(S)”</p>
<p>启用sa账户: 在树形图中的安全性-登录名中找到sa账户,右键属性中可以启用</p>
<p>用户名的密码可以在树形图中的安全性-登录名中具体登录名右键属性中修改</p>
<p>连接上数据库后用此命令修改也可以 <code> ALTER LOGIN sa WITH PASSWORD = &#39;new_password&#39;;</code></p>
<p>启动远程连接需要打开sql server配置管理器,找到MSSQLSERVER 的协议,右键TCP&#x2F;IP选择”启用”.事后要重启SQL server服务</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/sql/linux/quickstart-install-connect-ubuntu?view=sql-server-ver16&tabs=ubuntu2004">Ubuntu：在 Linux 上安装 SQL Server - SQL Server | Microsoft Learn</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zgscwxd/article/details/131586286">【自学笔记】在SQL Server中创建用户角色及授权(使用SQL语句)更新2023.07.06_sqlserver创建用户并授权-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/sql/relational-databases/backup-restore/quickstart-backup-restore-database?view=sql-server-ver16&tabs=ssms">快速入门：使用 SSMS 备份和还原数据库 - SQL Server | Microsoft Learn</a></p>
<h2 id="备份与还原bak文件"><a href="#备份与还原bak文件" class="headerlink" title="备份与还原bak文件"></a>备份与还原bak文件</h2><h3 id="备份流程"><a href="#备份流程" class="headerlink" title="备份流程"></a>备份流程</h3><ol>
<li>打开SQL Server客户端，选中数据库，鼠标右键选择 任务 &gt; 备份，操作备份</li>
<li>在备份页面指定bak文件路径存放路径，默认是数据库路径，可以自行指定。其他默认是完整备份，单击 确定</li>
</ol>
<h3 id="还原流程"><a href="#还原流程" class="headerlink" title="还原流程"></a>还原流程</h3><ol>
<li><p>打开SQL Server客户端，选中数据库，鼠标右键单击 任务 &gt; 还原，操作还原</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202412041515438.png" style="zoom:50%;" />
</li>
<li><p>单击数据库，在此页面选择源设备，单击右侧【…】按钮，在指定备份单击 添加，选择保存的bak文件，单击 确定</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202412041516472.png" alt="image-20241204151615714" style="zoom: 50%;" />
</li>
<li><p>勾选覆盖现有数据库，单击 确定</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202412041517464.png" alt="image-20241204151615714" style="zoom: 50%;" /></li>
</ol>
<h1 id="数据库映射技术ORM"><a href="#数据库映射技术ORM" class="headerlink" title="数据库映射技术ORM"></a>数据库映射技术ORM</h1><p><strong>ORM对象关系映射</strong>是指将应用程序中的对象模型（通常是面向对象的模型）与数据库中的关系模型进行映射的过程。简单来说,ORM是通过使用描述对象和数据库之间映射的元数据,将程序中的对象自动持久化到关系数据库中</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202412161346239.png" alt="image-20241216134638753" style="zoom: 33%;" />

<p>常见的数据库映射技术包括对象关系映射（ORM）框架，如</p>
<ul>
<li>[[CSharp入门#CSharp Entity Framework|Entity Framework Core（在.NET平台上）]]</li>
<li>NHibenate（在Java平台上）,年代久远</li>
<li>SqlSugger(当下比较流行)</li>
<li>Dapper(半ORM)</li>
<li>MyBatis.Net(需要写一大堆的XML,里面要写sql语句)</li>
<li>MyBatisPlus(Java开发最流行)</li>
</ul>
<p>这些ORM框架提供了便捷的方式来映射数据库表和对象之间的关系，简化了数据访问层的开发工作。</p>
<p>使用方式实例可以参考[[CSharp入门#CSharp Entity Framework|CSharp Entity Framework]]</p>
<p>ORM能解决下面的问题:</p>
<ol>
<li>SQL语法学习</li>
<li>开发效率低</li>
<li>字段重命名,需要挨个地方修改</li>
<li>数据库更换,如SQLServer更换为MySQL数据库,SQL语句不同,有兼容性问题</li>
</ol>
<blockquote>
<p>ORM的底层会通过<strong>反射</strong>帮我们生成数据库能够执行的SQL语句</p>
</blockquote>
<p>缺点: </p>
<ol>
<li><p>降低了系统的执行效率</p>
</li>
<li><p>遇到复杂的查询时显得有些吃力</p>
<p>基本ORM框架也支持直接执行sql语句</p>
</li>
</ol>
<h1 id="写时复制和事务处理"><a href="#写时复制和事务处理" class="headerlink" title="写时复制和事务处理"></a>写时复制和事务处理</h1><p>大部分数据库都支持的操作</p>
<h2 id="写时复制"><a href="#写时复制" class="headerlink" title="写时复制"></a>写时复制</h2><h3 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h3><ul>
<li>当需要对数据进行修改时，不直接修改原始数据，而是先复制一份数据的副本，在副本上进行修改。</li>
<li>只有在真正需要修改时才进行数据的复制，这样可以延迟复制操作，提高性能。</li>
</ul>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ul>
<li><strong>读取阶段</strong>：多个事务可以并发地读取同一个数据页或记录，不需要进行复制操作。</li>
<li><strong>写入阶段</strong>：当事务尝试修改数据时，先将需要修改的数据页或记录复制到一个新位置（副本）。</li>
<li><strong>提交阶段</strong>：事务成功后，新副本替代原始数据，未被提交的修改则会被丢弃。</li>
</ul>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>**多版本并发控制 (MVCC)**：允许读写事务并发执行，读操作不会阻塞写操作。</li>
<li><strong>减少锁争用</strong>：读事务不需要加锁，因为读取的是快照数据。</li>
<li><strong>提高可靠性</strong>：原始数据在未确认修改前保持不变，减少数据损坏的风险。</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li><strong>PostgreSQL 的 MVCC 实现</strong>：每次写操作会创建一个数据的版本，未提交的事务可以访问旧版本。</li>
<li><strong>文件系统（如 ZFS 和 Btrfs）</strong>：写时复制用于实现快照和可靠的数据存储。</li>
</ul>
<h2 id="事务处理原理"><a href="#事务处理原理" class="headerlink" title="事务处理原理"></a>事务处理原理</h2><p>数据库中的事务（Transaction）是逻辑上的一组操作，它们要么全部成功（提交），要么全部失败（回滚）。事务处理的核心是保证<strong>ACID</strong>属性：</p>
<h3 id="ACID-属性"><a href="#ACID-属性" class="headerlink" title="ACID 属性"></a>ACID 属性</h3><ul>
<li><strong>Atomicity（原子性）</strong>：事务中的所有操作要么全部完成，要么全部不执行。</li>
<li><strong>Consistency（一致性）</strong>：事务执行前后，数据库必须处于一致状态。</li>
<li><strong>Isolation（隔离性）</strong>：事务的执行不被其他事务干扰，即使是并发事务也要表现为独立运行。</li>
<li><strong>Durability（持久性）</strong>：事务提交后，其对数据库的修改永久生效，即使发生系统崩溃。</li>
</ul>
<h3 id="事务处理机制"><a href="#事务处理机制" class="headerlink" title="事务处理机制"></a>事务处理机制</h3><ul>
<li><p>**事务日志 (WAL, Write-Ahead Logging)**：</p>
<ul>
<li><p>**WAL (Write-Ahead Logging)**：</p>
<p>在事务修改数据之前，先将修改记录写入日志。</p>
<p>如果事务失败，系统可以通过日志回滚未完成的操作。</p>
</li>
<li><p><strong>Undo Log</strong>：</p>
<p>记录数据被修改前的旧值。</p>
<p>回滚时用旧值还原数据。</p>
</li>
</ul>
</li>
<li><p><strong>回滚机制</strong></p>
<p>在事务失败或中止时，根据 Undo Log 将数据库状态恢复到事务开始前的状态。</p>
</li>
<li><p><strong>锁机制</strong>：</p>
<ul>
<li><p><strong>共享锁（S 锁）</strong>：</p>
<p>用于读操作，多个事务可以同时持有。</p>
</li>
<li><p><strong>排他锁（X 锁）</strong>：</p>
<p>用于写操作，确保只有一个事务能够修改数据。</p>
</li>
<li><p><strong>多粒度锁</strong>：</p>
<p>锁的粒度可以是行、页、表或整个数据库，以平衡并发性能和隔离性。</p>
</li>
</ul>
<p><strong>两阶段锁协议（2PL）</strong>：</p>
<ul>
<li>在事务中分为加锁阶段和解锁阶段。</li>
<li>事务在执行时先加锁，直到事务提交或回滚后才释放所有锁。</li>
</ul>
</li>
<li><p><strong>MVCC（多版本并发控制）</strong>：</p>
<p>通过保存不同版本的数据实现读写并发分离。</p>
<ul>
<li>数据库为每个事务维护数据的多个版本。</li>
<li>读操作访问旧版本数据，写操作创建新版本，互不冲突。</li>
</ul>
</li>
<li><p><strong>检查点</strong>：</p>
<ul>
<li>定期将日志的部分内容刷入磁盘，减少恢复时间。</li>
</ul>
</li>
</ul>
<h3 id="事务的状态"><a href="#事务的状态" class="headerlink" title="事务的状态"></a>事务的状态</h3><ul>
<li><strong>Active（活动状态）</strong>：事务开始执行，但未完成。</li>
<li><strong>Partially Committed（部分提交）</strong>：事务所有操作执行完成，但尚未写入磁盘。</li>
<li><strong>Failed（失败状态）</strong>：事务因某种原因失败，需要回滚。</li>
<li><strong>Aborted（中止状态）</strong>：事务已经回滚，数据恢复到事务开始时的状态。</li>
<li><strong>Committed（已提交）</strong>：事务成功结束，所有修改永久生效。</li>
</ul>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><p>数据库使用隔离级别来控制并发事务的相互影响，共有以下四种隔离级别（从低到高）：</p>
<ul>
<li><strong>Read Uncommitted（读未提交）</strong>：事务可以读取未提交的数据，存在脏读问题。</li>
<li><strong>Read Committed（读已提交）</strong>：只能读取已提交的数据，避免脏读。</li>
<li><strong>Repeatable Read（可重复读）</strong>：同一事务中多次读取结果一致，避免不可重复读。</li>
<li><strong>Serializable（可串行化）</strong>：最高隔离级别，事务按串行顺序执行，避免幻读。</li>
</ul>
<h2 id="数据库相关课程介绍"><a href="#数据库相关课程介绍" class="headerlink" title="数据库相关课程介绍"></a>数据库相关课程介绍</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2/202411231734344.png" alt="image-20241123173458541"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"></a><div class="post-copyright__author_name">ZEROKO14</div><div class="post-copyright__author_desc">zeroko14's blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://che77a38.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://che77a38.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/')">数据库</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://che77a38.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=数据库&amp;url=https://che77a38.github.io/posts/%E6%95%B0%E6%8D%AE%E5%BA%93/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://che77a38.github.io" target="_blank">ZEROKO14的个人博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>数据库<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E6%95%B0%E5%AD%A6/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">数学</div></div></a></div><div class="next-post pull-right"><a href="/posts/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">网络编程</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">欢迎来到ZEROKO14的个人博客</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ZEROKO14</h1><div class="author-info__desc">zeroko14's blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/che77a38" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#oracle"><span class="toc-number">1.</span> <span class="toc-text">oracle</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#DBA"><span class="toc-number">1.1.</span> <span class="toc-text">DBA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.2.</span> <span class="toc-text">启动数据库服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-number">1.2.1.</span> <span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux"><span class="toc-number">1.2.2.</span> <span class="toc-text">Linux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.3.</span> <span class="toc-text">容器数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.1.</span> <span class="toc-text">容器数据库基本操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.</span> <span class="toc-text">登录数据库服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E6%9C%BA%E7%99%BB%E9%99%86"><span class="toc-number">1.4.1.</span> <span class="toc-text">本机登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E7%99%BB%E9%99%86"><span class="toc-number">1.4.2.</span> <span class="toc-text">远程登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#oracle%E5%88%9B%E5%BB%BA%E6%A1%88%E4%BE%8B%E8%84%9A%E6%9C%AC"><span class="toc-number">1.4.3.</span> <span class="toc-text">oracle创建案例脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E5%92%8Csqlplus"><span class="toc-number">2.</span> <span class="toc-text">sql和sqlplus</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sqlplus%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">sqlplus常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%91%98%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">2.1.1.</span> <span class="toc-text">管理员创建用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E8%AF%AD%E8%A8%80%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">SQL语言的类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.</span> <span class="toc-text">数据库对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8"><span class="toc-number">3.1.</span> <span class="toc-text">表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">3.1.1.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-number">3.1.2.</span> <span class="toc-text">修改表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">删除表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Oracle%E7%9A%84%E5%9B%9E%E6%94%B6%E7%AB%99"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">Oracle的回收站</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E5%88%A0%E9%99%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">两种删除方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.1.4.</span> <span class="toc-text">表的约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E7%9A%84%E5%88%A0%E9%99%A4%E7%9B%B8%E5%85%B3"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">外键的删除相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#check%E6%A3%80%E6%9F%A5%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">check检查性约束</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">3.2.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.1.</span> <span class="toc-text">视图相关操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">3.3.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.1.</span> <span class="toc-text">索引的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="toc-number">3.3.2.</span> <span class="toc-text">索引的种类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E5%88%97"><span class="toc-number">3.4.</span> <span class="toc-text">序列</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.4.1.</span> <span class="toc-text">序列的操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BA%8F%E5%88%97%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.4.2.</span> <span class="toc-text">使用序列需要注意的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E4%B9%89%E8%AF%8D"><span class="toc-number">3.5.</span> <span class="toc-text">同义词</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.5.1.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E4%B9%89%E8%AF%8D%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.5.2.</span> <span class="toc-text">同义词的操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E6%8F%92%E5%85%A5%E7%9B%B8%E5%85%B3"><span class="toc-number">4.</span> <span class="toc-text">sql插入相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">批处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E4%BF%AE%E6%94%B9%E7%9B%B8%E5%85%B3"><span class="toc-number">5.</span> <span class="toc-text">sql修改相关</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E5%88%A0%E9%99%A4%E7%9B%B8%E5%85%B3"><span class="toc-number">6.</span> <span class="toc-text">sql删除相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#truncate%E5%92%8Cdelete%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.1.</span> <span class="toc-text">truncate和delete的区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql%E6%9F%A5%E8%AF%A2%E7%9B%B8%E5%85%B3"><span class="toc-number">7.</span> <span class="toc-text">sql查询相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACselect%E8%AF%AD%E5%8F%A5"><span class="toc-number">7.1.</span> <span class="toc-text">基本select语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D"><span class="toc-number">7.1.1.</span> <span class="toc-text">去重</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">7.1.2.</span> <span class="toc-text">表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E5%90%8D"><span class="toc-number">7.1.3.</span> <span class="toc-text">别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4"><span class="toc-number">7.1.4.</span> <span class="toc-text">过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">7.1.4.1.</span> <span class="toc-text">比较运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">7.1.4.2.</span> <span class="toc-text">集合运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E6%89%BE"><span class="toc-number">7.1.4.3.</span> <span class="toc-text">模糊查找</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">7.1.4.4.</span> <span class="toc-text">逻辑运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">7.1.4.5.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">7.1.5.</span> <span class="toc-text">排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84"><span class="toc-number">7.1.6.</span> <span class="toc-text">分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0%E8%BF%87%E6%BB%A4"><span class="toc-number">7.1.7.</span> <span class="toc-text">分组函数过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">7.1.7.1.</span> <span class="toc-text">优化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">单行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.1.</span> <span class="toc-text">字符函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.2.</span> <span class="toc-text">数值函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.3.</span> <span class="toc-text">转换函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#to-char%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.3.1.</span> <span class="toc-text">to_char函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#to-number%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.3.2.</span> <span class="toc-text">to_number函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#to-date%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.3.3.</span> <span class="toc-text">to_date函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#date%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">7.2.3.4.</span> <span class="toc-text">date的格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%92%8C%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.3.5.</span> <span class="toc-text">时间和日期函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.4.</span> <span class="toc-text">通用函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">分组函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#count%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">7.3.0.1.</span> <span class="toc-text">count注意点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8E%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.</span> <span class="toc-text">条件表达式与条件函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#case%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">7.4.1.</span> <span class="toc-text">case条件表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decode%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.2.</span> <span class="toc-text">decode函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.5.</span> <span class="toc-text">多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF"><span class="toc-number">7.5.1.</span> <span class="toc-text">笛卡尔积</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">7.5.2.</span> <span class="toc-text">连接条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">7.5.2.1.</span> <span class="toc-text">等值连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-number">7.5.2.2.</span> <span class="toc-text">不等值连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">7.5.2.3.</span> <span class="toc-text">外连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">7.5.2.3.1.</span> <span class="toc-text">右外连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">7.5.2.3.2.</span> <span class="toc-text">左外连接</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">7.5.2.4.</span> <span class="toc-text">自连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.6.</span> <span class="toc-text">子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#where%E5%90%8E%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="toc-number">7.6.1.</span> <span class="toc-text">where后子查询案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select%E5%90%8E%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="toc-number">7.6.2.</span> <span class="toc-text">select后子查询案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#having%E5%90%8E%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="toc-number">7.6.3.</span> <span class="toc-text">having后子查询案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#from%E5%90%8E%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="toc-number">7.6.4.</span> <span class="toc-text">from后子查询案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.6.5.</span> <span class="toc-text">多行子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.6.6.</span> <span class="toc-text">单行子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%B8%ADnull"><span class="toc-number">7.6.7.</span> <span class="toc-text">子查询中null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">7.6.8.</span> <span class="toc-text">子查询优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#top-N%E9%97%AE%E9%A2%98"><span class="toc-number">7.6.9.</span> <span class="toc-text">top-N问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">7.7.</span> <span class="toc-text">集合运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9Btips"><span class="toc-number">7.8.</span> <span class="toc-text">一些tips</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">7.9.</span> <span class="toc-text">综合案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">8.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-number">8.1.</span> <span class="toc-text">事务的特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">8.2.</span> <span class="toc-text">事务的流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E4%B8%8E%E5%9B%9E%E6%BB%9A"><span class="toc-number">8.2.1.</span> <span class="toc-text">提交与回滚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E4%BA%8B%E5%8A%A1"><span class="toc-number">8.3.</span> <span class="toc-text">控制事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">8.4.</span> <span class="toc-text">隔离级别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL99%E5%AE%9A%E4%B9%894%E4%B8%AD%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">8.4.1.</span> <span class="toc-text">SQL99定义4中隔离级别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#oracle%E5%BC%80%E5%8F%91"><span class="toc-number">9.</span> <span class="toc-text">oracle开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#OCCI"><span class="toc-number">9.1.</span> <span class="toc-text">OCCI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OCCI%E4%BB%8B%E7%BB%8D"><span class="toc-number">9.1.1.</span> <span class="toc-text">OCCI介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OCCI%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">9.1.2.</span> <span class="toc-text">OCCI项目配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-number">9.1.2.1.</span> <span class="toc-text">头文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">9.1.2.2.</span> <span class="toc-text">库文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#linux%E4%B8%8B%E7%9A%84%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">9.1.2.3.</span> <span class="toc-text">linux下的环境配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%87%A0%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">9.1.2.4.</span> <span class="toc-text">常见的几个环境变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#occi%E4%BD%BF%E7%94%A8"><span class="toc-number">9.1.3.</span> <span class="toc-text">occi使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">9.1.3.1.</span> <span class="toc-text">开发流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8API"><span class="toc-number">9.1.3.2.</span> <span class="toc-text">常用API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#oracle%E7%AE%80%E6%98%93%E6%A1%88%E4%BE%8B"><span class="toc-number">9.1.3.3.</span> <span class="toc-text">oracle简易案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORA-24550"><span class="toc-number">9.2.</span> <span class="toc-text">ORA-24550</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mysql"><span class="toc-number">10.</span> <span class="toc-text">Mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E7%89%88%E6%9C%AC%E5%8F%8A%E4%B8%8B%E8%BD%BD"><span class="toc-number">10.1.</span> <span class="toc-text">MySQL版本及下载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#red-hat"><span class="toc-number">10.1.1.</span> <span class="toc-text">red hat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD"><span class="toc-number">10.1.1.1.</span> <span class="toc-text">卸载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">10.1.1.2.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">10.1.1.2.1.</span> <span class="toc-text">安装客户端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ubuntu"><span class="toc-number">10.1.2.</span> <span class="toc-text">ubuntu</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">10.1.2.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD-1"><span class="toc-number">10.1.2.2.</span> <span class="toc-text">卸载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#win7-64%E4%BD%8D"><span class="toc-number">10.1.3.</span> <span class="toc-text">win7 64位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#win10-64%E4%BD%8D"><span class="toc-number">10.1.4.</span> <span class="toc-text">win10 64位</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">10.2.</span> <span class="toc-text">mysql的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93CURD"><span class="toc-number">10.2.1.</span> <span class="toc-text">数据库CURD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8CURD"><span class="toc-number">10.2.2.</span> <span class="toc-text">表CURD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">10.2.2.1.</span> <span class="toc-text">mysql的数据类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84CURD%E6%93%8D%E4%BD%9C"><span class="toc-number">10.2.3.</span> <span class="toc-text">数据的CURD操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E7%9A%84%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">10.2.4.</span> <span class="toc-text">mysql的分组查询注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E7%9A%84top-N%E9%97%AE%E9%A2%98"><span class="toc-number">10.2.5.</span> <span class="toc-text">mysql的top-N问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.6.</span> <span class="toc-text">mysql中的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.6.1.</span> <span class="toc-text">日期时间函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.6.1.1.</span> <span class="toc-text">日期格式函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.6.2.</span> <span class="toc-text">数学相关函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.6.3.</span> <span class="toc-text">字符串相关函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0-1"><span class="toc-number">10.2.6.4.</span> <span class="toc-text">转换函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%A4%E7%A9%BA%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.6.5.</span> <span class="toc-text">滤空函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E7%9A%84%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.2.7.</span> <span class="toc-text">mysql的多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.2.7.1.</span> <span class="toc-text">交叉连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.2.7.2.</span> <span class="toc-text">内连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL99%E5%86%99%E6%B3%95"><span class="toc-number">10.2.7.2.1.</span> <span class="toc-text">SQL99写法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#oracle%E5%86%99%E6%B3%95"><span class="toc-number">10.2.7.2.2.</span> <span class="toc-text">oracle写法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.2.7.3.</span> <span class="toc-text">mysql外连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.2.7.3.1.</span> <span class="toc-text">mysql左外连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.2.7.3.2.</span> <span class="toc-text">mysql右外连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql%E6%BB%A1%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.2.7.3.3.</span> <span class="toc-text">mysql满外连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E8%A1%A8%E7%9A%84%E7%BA%A6%E6%9D%9F"><span class="toc-number">10.2.8.</span> <span class="toc-text">mysql表的约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-number">10.3.</span> <span class="toc-text">mysql中文乱码问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MYSQL-API"><span class="toc-number">10.4.</span> <span class="toc-text">MYSQL API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.</span> <span class="toc-text">常用函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-init%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.1.</span> <span class="toc-text">mysql_init函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-real-connect%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.2.</span> <span class="toc-text">mysql_real_connect函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-query%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.3.</span> <span class="toc-text">mysql_query函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-close%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.4.</span> <span class="toc-text">mysql_close函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E7%9B%B8%E5%85%B3"><span class="toc-number">10.4.1.5.</span> <span class="toc-text">编码相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-character-set-name%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.5.1.</span> <span class="toc-text">mysql_character_set_name函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-set-character-set%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.5.2.</span> <span class="toc-text">mysql_set_character_set函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E9%9B%86%E7%9B%B8%E5%85%B3"><span class="toc-number">10.4.1.6.</span> <span class="toc-text">结果集相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-store-result%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.6.1.</span> <span class="toc-text">mysql_store_result函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-fetch-row%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.6.2.</span> <span class="toc-text">mysql_fetch_row函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-free-result%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.6.3.</span> <span class="toc-text">mysql_free_result函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%95%B4%E4%BD%93%E6%A1%88%E4%BE%8B"><span class="toc-number">10.4.1.6.4.</span> <span class="toc-text">查询数据整体案例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%88%97%E6%95%B0%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.6.5.</span> <span class="toc-text">获取列数函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.6.6.</span> <span class="toc-text">获取表头函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-affected-rows%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.1.6.7.</span> <span class="toc-text">mysql_affected_rows函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%96%E5%86%99%E6%A1%88%E4%BE%8B"><span class="toc-number">10.4.2.</span> <span class="toc-text">mysql客户端编写案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MYSQL%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-number">10.4.3.</span> <span class="toc-text">MYSQL的事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3sql%E8%AF%AD%E5%8F%A5"><span class="toc-number">10.4.3.1.</span> <span class="toc-text">相关sql语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="toc-number">10.4.3.2.</span> <span class="toc-text">代码案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E7%B1%BBAPI"><span class="toc-number">10.4.4.</span> <span class="toc-text">预处理类API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.</span> <span class="toc-text">预处理相关函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-init%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.1.</span> <span class="toc-text">mysql_stmt_init函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-prepare%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.2.</span> <span class="toc-text">mysql_stmt_prepare函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-param-count%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.3.</span> <span class="toc-text">mysql_stmt_param_count函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-bind-param%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.4.</span> <span class="toc-text">mysql_stmt_bind_param函数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#MYSQL-BIND%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">10.4.4.1.4.1.</span> <span class="toc-text">MYSQL_BIND结构体</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-execute%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.5.</span> <span class="toc-text">mysql_stmt_execute函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-bind-result%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.6.</span> <span class="toc-text">mysql_stmt_bind_result函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-fetch%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.7.</span> <span class="toc-text">mysql_stmt_fetch函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-error%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.8.</span> <span class="toc-text">mysql_stmt_error函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mysql-stmt-close%E5%87%BD%E6%95%B0"><span class="toc-number">10.4.4.1.9.</span> <span class="toc-text">mysql_stmt_close函数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E6%A1%88%E4%BE%8B"><span class="toc-number">10.4.4.2.</span> <span class="toc-text">预处理案例</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#oracle%E5%92%8Cmysql%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">11.</span> <span class="toc-text">oracle和mysql的区别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sqlite"><span class="toc-number">12.</span> <span class="toc-text">sqlite</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">13.</span> <span class="toc-text">时序数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%9E%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">14.</span> <span class="toc-text">非关系数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">14.1.</span> <span class="toc-text">NoSQL数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis"><span class="toc-number">14.2.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">14.2.1.</span> <span class="toc-text">安装与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">14.2.1.1.</span> <span class="toc-text">redis配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">14.2.2.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">14.2.3.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#String%E7%B1%BB%E5%9E%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">14.2.3.1.</span> <span class="toc-text">String类型命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List%E7%B1%BB%E5%9E%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">14.2.3.2.</span> <span class="toc-text">List类型命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Set%E7%B1%BB%E5%9E%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">14.2.3.3.</span> <span class="toc-text">Set类型命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SortedSet-%E7%B1%BB%E5%9E%8B"><span class="toc-number">14.2.3.4.</span> <span class="toc-text">SortedSet 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash%E7%B1%BB%E5%9E%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">14.2.3.5.</span> <span class="toc-text">Hash类型命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Key-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">14.2.3.6.</span> <span class="toc-text">Key 相关的命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E6%8F%92%E4%BB%B6"><span class="toc-number">14.2.4.</span> <span class="toc-text">redis插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">14.2.5.</span> <span class="toc-text">Redis数据持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">14.2.5.1.</span> <span class="toc-text">数据持久化的配置项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%E5%BC%80%E5%8F%91"><span class="toc-number">14.2.6.</span> <span class="toc-text">Redis开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HIREDIS%E5%BA%93"><span class="toc-number">14.2.6.1.</span> <span class="toc-text">HIREDIS库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B"><span class="toc-number">14.2.6.2.</span> <span class="toc-text">测试案例</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sql-server%E7%9B%B8%E5%85%B3"><span class="toc-number">15.</span> <span class="toc-text">sql server相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql-server%E9%85%8D%E7%BD%AE"><span class="toc-number">15.1.</span> <span class="toc-text">sql server配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9Fbak%E6%96%87%E4%BB%B6"><span class="toc-number">15.2.</span> <span class="toc-text">备份与还原bak文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E6%B5%81%E7%A8%8B"><span class="toc-number">15.2.1.</span> <span class="toc-text">备份流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%98%E5%8E%9F%E6%B5%81%E7%A8%8B"><span class="toc-number">15.2.2.</span> <span class="toc-text">还原流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%98%A0%E5%B0%84%E6%8A%80%E6%9C%AFORM"><span class="toc-number">16.</span> <span class="toc-text">数据库映射技术ORM</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6%E5%92%8C%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">17.</span> <span class="toc-text">写时复制和事务处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E6%97%B6%E5%A4%8D%E5%88%B6"><span class="toc-number">17.1.</span> <span class="toc-text">写时复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3"><span class="toc-number">17.1.1.</span> <span class="toc-text">核心思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">17.1.2.</span> <span class="toc-text">步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">17.1.3.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">17.1.4.</span> <span class="toc-text">应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86"><span class="toc-number">17.2.</span> <span class="toc-text">事务处理原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ACID-%E5%B1%9E%E6%80%A7"><span class="toc-number">17.2.1.</span> <span class="toc-text">ACID 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">17.2.2.</span> <span class="toc-text">事务处理机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">17.2.3.</span> <span class="toc-text">事务的状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">17.2.4.</span> <span class="toc-text">事务隔离级别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E8%AF%BE%E7%A8%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">17.3.</span> <span class="toc-text">数据库相关课程介绍</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%B7%A5%E4%B8%9A%E7%9B%B8%E5%85%B3/" title="工业相关">工业相关</a><time datetime="2025-02-14T03:04:40.761Z" title="发表于 2025-02-14 11:04:40">2025-02-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%90%86%E8%AE%BA/" title="操作系统">操作系统</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%AE%A1%E7%BB%84/" title="计算机组成原理">计算机组成原理</a><time datetime="2024-12-16T01:38:01.470Z" title="发表于 2024-12-16 09:38:01">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/" title="网络架构">网络架构</a><time datetime="2024-11-18T06:17:01.282Z" title="发表于 2024-11-18 14:17:01">2024-11-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/avalonia/" title="avalonia">avalonia</a><time datetime="2024-09-11T14:51:13.000Z" title="发表于 2024-09-11 22:51:13">2024-09-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="ZEROKO14" target="_blank">ZEROKO14</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu"></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">62</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 0.88rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 0.88rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 0.88rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 0.88rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 0.88rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 0.88rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 0.88rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 0.88rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 0.88rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 0.88rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/nas/" style="font-size: 0.88rem;">nas<sup>1</sup></a><a href="/tags/next/" style="font-size: 0.88rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 0.88rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 0.88rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 0.88rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 0.88rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 0.88rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 0.88rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 0.88rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 0.88rem;">加解密<sup>1</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">基础<sup>3</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">并发模式<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>1</sup></a><a href="/tags/%E7%A1%AC%E7%BC%96%E7%A0%81/" style="font-size: 0.88rem;">硬编码<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>3</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>