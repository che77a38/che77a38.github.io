<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>字符编码 | ZEROKO14的个人博客</title><meta name="keywords" content="开发"><meta name="author" content="ZEROKO14"><meta name="copyright" content="ZEROKO14"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="字符编码"><meta name="application-name" content="字符编码"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="字符编码"><meta property="og:url" content="https://che77a38.github.io/posts/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/index.html"><meta property="og:site_name" content="ZEROKO14的个人博客"><meta property="og:description" content="有关字符编码的知识点   字符编码下面介绍多种编码方式: ANSI编码原始的ASCII编码  原始的ASCII码只占一个字节 ASCII编码的拓展：GB2312（GBK）或GB2312-80GB2312或GB2312-80：专门用来表示中文的编码 实现原理把80~FF的表给占用了，由80~FF开头的"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta property="article:author" content="ZEROKO14"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4"><meta name="description" content="有关字符编码的知识点   字符编码下面介绍多种编码方式: ANSI编码原始的ASCII编码  原始的ASCII码只占一个字节 ASCII编码的拓展：GB2312（GBK）或GB2312-80GB2312或GB2312-80：专门用来表示中文的编码 实现原理把80~FF的表给占用了，由80~FF开头的"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://che77a38.github.io/posts/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: ZEROKO14","link":"链接: ","source":"来源: ZEROKO14的个人博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ZEROKO14的个人博客',
  title: '字符编码',
  postAI: '',
  pageFillDescription: '字符编码, ANSI编码, 原始的ASCII编码, ASCII编码的拓展：GB2312（GBK）或GB2312-80, 实现原理, 缺点, UNICODE编码, UCS-2和UCS-4, UNICODE编码的存储方式, UTF-16, UTF-8, UTF-32, BOM字节顺序标识, 操作系统字符集, 控制台, 字符集转换, windows下常用转码需求, utf8的宽窄字符转换, utf8与gbk互转, utf-8转gbk, gbk转utf-8, gbk的宽窄字符互转, UTF8和UTF16互转, UTF8和UTF32互转, u8string转换为string, wchart_t*转char*, char*转wchar_t*, 字符集总结, C语言中的宽字符, 宽字符类型, 字符常用函数, 设置字面量的编码方式, C++处理宽字符有关字符编码的知识点字符编码下面介绍多种编码方式编码原始的编码原始的码只占一个字节编码的拓展或或专门用来表示中文的编码实现原理把的表给占用了由开头的两个字节拼在一起表示一个字符中国或也就是编码各国各自的编码格式统称缺点其他象形文字国家也是采取和我国一样的策略所以各个国家看到的同一个编码意思不一致编码也就是或表示英文字符时用一个字节表示中文字符时用两个或个字节编码一张包含全世界所有文字的一个编码表的编码范围是可以容纳多万个符号但他只是一个符号集只规定了符号的二进制代码却没有规定这个二进制代码应该如何存储详解参阅和在将和的区别之前再先科普两个名词和是为整合全世界的所有语言文字而诞生的任何文字在中都对应一个值这个值称为代码点也称码值代码点的值通常写成的格式而文字和代码点之间的对应关系就是顾名思义是用两个字节来表示代码点其取值范围为为了能表示更多的文字人们又提出了即用四个字节表示代码点它的范围为其中和是一样的要注意和只规定了代码点和文字之间的对应关系并没有规定代码点在计算机中如何存储规定存储方式的称为也就是我们下面将要提到的编码的存储方式编码的存储方式维基百科默认的字符串内部编码都是编码以位无符号整数为单位注意是位为一个单位不表示一个字符就只有位这个要看字符的编码处于什么范围而定的绝大部分是个字节极少数是个字节因此可以算是字节定长编码现在机器上的编码一般指的就是小端存储中国大端存储中国上图箭头所指的没有明确说明是哪种存储方式的实际上就是优缺点拆分解析快浪费空间多尤其是网络传输但传输汉字可能比省空间因为下很多汉字要字节需要区分字节序文件保存一般有个头到是没有定义的用这段来标识字节字符分高低位共个有效位如果不支持非的可以直接不认这个范围里的字符一种变长的存储方案网络传输火起来的编码格式的编码规则对于单字节的符号字节的第一位设为后面位为这个符号的码因此对于英语字母编码和码是相同的对于字节的符号第一个字节的前位都设为第位设为后面字节的前两位一律设为剩下的没有提及的二进制位全部为这个符号的码对于字节的格式有严格要求当解析某个字符失败时使用代替编码为符号集表示符号集因此占用个字节都有可能中中数据大部分是英文字符的话采用比较好中文多的话采用比较好优缺点拆分解析慢但节省空间尤其是网络传输获取字符字节数的代码获取单字符所占的字节数函数用于判断是否为字符的起始字节这段代码的实现原理是使用位操作来判断一个字节是否为字符的起始字节编码使用不同长度的字节来表示不同的字符一个字符的起始字节的最高位为或以开头的字节而后续字节的最高位都为这段代码中的位操作用于判断一个字节的最高两位是否满足字符的起始字节的条件具体来说会将字节的最高两位保留而其他位都置为然后将结果与进行比较即判断最高两位是否不等于如果最高两位不等于则表示该字节是字符的起始字节函数返回否则表示该字节是字符的后续字节函数返回函数从一个类型变量中删除字符返回要删除的字节数向前遍历字符串找到要删除的字符的起始位置删除字符计算类型中的字符数起始字节操作案例上操作编写案例任何元素都是个字节为单位中字节顺序标识文本文件的起始位置存这几个字节来表示当前文件采用什么格式存储存储格式小端存储大端存储添加头文件是编码仿头三字节中添加头提供了封装好的函数和之间的转换原理必须通过操作系统字符集编译环境和运行环境编译器转换程序源代码时所处的环境成为编译环境编译后程序执行时所处的环境称为运行环境源码字符集和执行字符集源码字符集源码文件是使用何种编码保存的执行字符集可执行程序内保存的是何种编码程序执行时内存中字符编码在编译时编译器会根据源文件的编码源码字符集将字符串字面量转换为目标字符串只要没有进行编码转换字符串字面量在程序中的表示形式将与其在源代码中的编码相同操作系统字符集除平台外大部分其他平台编译器默认使用的编码都是编码最新版本的编译器只支持编码中文版默认采用编码默认采用编码编译器指定源文件的编码若不指定默认是指定多字节字符串常量在编译后的程序里保存的编码集若不指定默认是指定宽字节字符串常量在编译后的程序里的保存的编码集中为编译器同上设置方式但不支持设定为编译器是指即中的编译器提供了一个完整的开发环境包括编译器链接器调试器等工具用于开发和构建程序是中的核心组件之一负责将代码编译成可执行文件或库项目的属性设置编译器选项附加选项中添加和中为中为控制台控制台字符编码使用的是系统默认的编码可以通过命令查看如果控制台的编码不是对应编码显示字符串会出现乱码可通过命令修改控制台的编码从而正常显示字符串及环境下的终端乱码下的终端乱码解决字符集转换如果程序需要在多个平台编译运行则代码必须使用使用可以更容易的在多字节字符串和宽字符直接转换更容易避免程序乱码中文路径错误等问题中引入的和主要使用引入的和相结合进行转换但在遭到废弃下常用转码需求下面的代码在上完美运行转码需求小在下的名可能是而下是因此做跨平台的话仍然要给不同的系统做适配的宽窄字符转换转为注意使用这个函数的时候需要求的编码是不然会抛异常转为与互转下面和互转的代码都是先转化为的我们可以再拆分得到和互转转转的宽窄字符互转转为转为两个比较好的两个第三方库分别是以及和互转下面也行上面在被废弃了转而你好和互转转换为可以通过这种方式转换为类型本质上就是字节流拷贝你好世界转将宽字符转换为多字节字符在模式下使用转将多字节字符转换为宽字符在模式下使用字符集总结字符类型字符串类型字符长度引入的版本开始就存在在不同的编译器和操作系统上不同开始就存在不支持直接对等的输出可以通过下面方式使用来输出使用转换方式来输出一些建议不建议用其类型的问题可以参阅这里及在标准中不受支持任何系统都不支持而且可能永远不会因为兼容性原因在大多数平台上普通的字符串已经是在上您可以使用进行编译这将在主要的操作系统上为您提供可移植的支持您甚至不能使用字符串在中编写程序因为平台之间的兼容性的问题同样不建议用语言中的宽字符宽字符类型多字节字符类型宽字符类型在是位而在上是位这使得移植变得困难平台的就是就是编码中国使用的是编码一个字节的零表示结尾中国使用的是编码两个字节的表示结尾的意思是让编译器存储该字符串的时候按照来存储也可以设置编译器选项设置默认存储格式为就不需要写这个了字符常用函数使用的函数版本根据编码不同也被提供了两套多字节字符函数宽字符函数作用打印到控制台函数获取长度字符串复制字符串拼接字符串比较字符串查找功能下面是定义的一组字符串函数这些函数用来计算字符串长度复制字符串连接字符串和比较字符串这些函数与链接库中对应的函数功能相同如果定义了标识符那么这些函数将接受宽字符串否则只接受常规字符串宽字符串版的函数可在中执行设置字面量的编码方式标准引入了原始字符串字面量和字符串字面量的语法其中用于表示字符串字面量这种格式允许在字符串中直接使用字符而无需进行转义或使用特殊的编码方式字符串字面量前面可以加上不同的前缀来表示不同的含义以下是常用的字符串字面量前缀及其含义前缀表示宽字符字符串宽字符字符串是由类型表示的字符串每个字符占用个字节例如表示一个由宽字符组成的字符串前缀表示编码的字符串是一种可变长度的编码每个字符占用到个字节例如你好表示一个由编码的字符串前缀表示编码的字符串编码是一种固定长度的字符编码每个字符占用或个字节例如表示一个由编码的字符串前缀表示编码的字符串是一种固定长度的编码每个字符占用个字节例如表示一个由编码的字符串前缀表示原始字符串原始字符串中的特殊字符不会被转义可以直接包含在字符串中例如表示一个包含反斜杠的字符串而不需要对反斜杠进行转义处理宽字符参考链接',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-23 16:46:42',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://th.bing.com/th/id/OIP.wtmjepfWPBvn26uz7s18dgHaHa?rs=1&amp;pid=ImgDetMain"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">ZEROKO14的个人博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 1.05rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 1.05rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 1.05rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 1.05rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 1.05rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 1.05rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 1.05rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 1.05rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 1.05rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 1.05rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 1.05rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/next/" style="font-size: 1.05rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 1.05rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 1.05rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 1.05rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 1.05rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 1.05rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 1.05rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 1.05rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 1.05rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 1.05rem;">加解密<sup>1</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.05rem;">多线程<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.05rem;">数学<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>1</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">架构<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 1.05rem;">监控<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>2</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.05rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">27</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/10/"><span class="card-archive-list-date">十月 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/12/"><span class="card-archive-list-date">十二月 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%BC%80%E5%8F%91/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>开发</span></a></span></div></div><h1 class="post-title" itemprop="name headline">字符编码</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-11-27T06:53:34.265Z" title="发表于 2023-11-27 14:53:34">2023-11-27</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-10-23T08:46:42.540Z" title="更新于 2024-10-23 16:46:42">2024-10-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="字符编码"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新加坡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新加坡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://che77a38.github.io/posts/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url">技术</a><a href="/tags/%E5%BC%80%E5%8F%91/" tabindex="-1" itemprop="url">开发</a><h1 id="CrawlerTitle" itemprop="name headline">字符编码</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ZEROKO14</span><time itemprop="dateCreated datePublished" datetime="2023-11-27T06:53:34.265Z" title="发表于 2023-11-27 14:53:34">2023-11-27</time><time itemprop="dateCreated datePublished" datetime="2024-10-23T08:46:42.540Z" title="更新于 2024-10-23 16:46:42">2024-10-23</time></header><p>有关字符编码的知识点</p>
<span id="more"></span>

<h1 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h1><p>下面介绍多种编码方式:</p>
<h2 id="ANSI编码"><a href="#ANSI编码" class="headerlink" title="ANSI编码"></a>ANSI编码</h2><h3 id="原始的ASCII编码"><a href="#原始的ASCII编码" class="headerlink" title="原始的ASCII编码"></a><strong>原始</strong>的ASCII编码</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/4f06232eed4f93be762cd15d664b407c.jpeg" alt="4f06232eed4f93be762cd15d664b407c"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/05d27497327d7264b74d178aaf312830.jpeg" alt="05d27497327d7264b74d178aaf312830"></p>
<p>原始的ASCII码只占一个字节</p>
<h3 id="ASCII编码的拓展：GB2312（GBK）或GB2312-80"><a href="#ASCII编码的拓展：GB2312（GBK）或GB2312-80" class="headerlink" title="ASCII编码的拓展：GB2312（GBK）或GB2312-80"></a>ASCII编码的拓展：GB2312（GBK）或GB2312-80</h3><p>GB2312或GB2312-80：专门用来表示中文的编码</p>
<h4 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h4><p>把80~FF的表给占用了，由80~FF开头的两个字节拼在一起表示一个字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">中国</span><br><span class="line">D6 D0 B9 FA</span><br></pre></td></tr></table></figure>

<p>GB2312（GBK）或GB2312-80也就是ANSI编码（各国各自的编码格式统称ANSI）</p>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>其他象形文字国家也是采取和我国一样的策略，所以各个国家看到的同一个编码意思不一致。</p>
<p>ANSI编码也就是GB2312（GBK）或GB2312-80，表示英文字符时用一个字节，表示中文字符时用两个或4个字节</p>
<h2 id="UNICODE编码"><a href="#UNICODE编码" class="headerlink" title="UNICODE编码"></a>UNICODE编码</h2><p>一张包含全世界所有文字的一个编码表，Unicode的编码范围是：0~0x10FFFF，可以容纳100多万个符号！</p>
<p>但他只是一个符号集，只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/260192496">详解参阅</a></p>
<h3 id="UCS-2和UCS-4"><a href="#UCS-2和UCS-4" class="headerlink" title="UCS-2和UCS-4"></a>UCS-2和UCS-4</h3><p>在将UTF8和UTF16、UTF32的区别之前，再先科普两个名词：UCS-2和UCS-4。</p>
<blockquote>
<p>Unicode是为整合全世界的所有语言文字而诞生的。任何文字在Unicode中都对应一个值， 这个值称为<strong>代码点</strong>（code point，也称码值）。代码点的值通常写成 <code>U+ABCD</code> 的格式。而文字和代码点之间的对应关系就是<strong>UCS-2</strong>（Universal Character Set coded in 2 octets）。顾名思义，UCS-2是用两个字节来表示代码点，其取值范围为 <code>U+0000～U+FFFF</code>。</p>
<p>为了能表示更多的文字，人们又提出了<strong>UCS-4</strong>，即用四个字节表示代码点。它的范围为 <code>U+00000000～U+7FFFFFFF</code>，其中 <code>U+00000000～U+0000FFFF</code>和UCS-2是一样的。</p>
</blockquote>
<p>要注意，UCS-2和UCS-4只规定了代码点和文字之间的对应关系，并没有规定代码点在计算机中如何存储。规定存储方式的称为<strong>UTF（Unicode Transformation Format）</strong>，也就是我们下面将要提到的UNICODE编码的存储方式。</p>
<h3 id="UNICODE编码的存储方式"><a href="#UNICODE编码的存储方式" class="headerlink" title="UNICODE编码的存储方式"></a><strong>UNICODE编码的存储方式</strong></h3><h4 id="UTF-16"><a href="#UTF-16" class="headerlink" title="UTF-16"></a>UTF-16</h4><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/UTF-16">维基百科</a></p>
<blockquote>
<p>java、js、c#、python默认的字符串内部编码都是utf-16。</p>
</blockquote>
<p>UTF-16编码以16位无符号整数为单位，注意是16位为一个单位，不表示一个字符就只有16位。这个要看字符的unicode编码处于什么范围而定的，<strong>绝大部分是2个字节，极少数是4个字节(因此可以算是2字节定长编码)<strong>。</strong>现在机器上的unicode编码一般指的就是UTF-16。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UTF-16小端存储</span><br><span class="line">中国A</span><br><span class="line">2D 4E FD 56 41 00</span><br><span class="line"></span><br><span class="line">UTF-16大端存储</span><br><span class="line">中国A</span><br><span class="line">4E 2D 56 FD 00 41</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage/image-20210613135932861.png" alt="image-20210613135932861"></p>
<p>上图箭头所指的没有明确说明是哪种存储方式的Unicode<strong>实际上就是UTF-16</strong></p>
<p>优缺点：拆分解析快，浪费空间多（尤其是网络传输,但传输汉字可能比utf8省空间,因为utf8下很多汉字要3字节）,需要区分字节序。文件保存一般有个bom头：BE-‘FEFF’、LE-‘FFFE’</p>
<blockquote>
<p><code>U+D800到U+DFFF</code>是没有定义unicode的，utf-16用这段来标识4字节字符。分高低位，共20个有效bit位。如果不支持非UCS-2的unicode，可以直接不认这个范围里的字符。</p>
</blockquote>
<h4 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h4><p>一种变长的存储方案</p>
<p>网络传输火起来的编码格式     </p>
<p><strong>UTF-8的编码规则：</strong></p>
<ol>
<li>对于单字节的符号，字节的第一位设为0，后面7位为这个符号的unicode码。因此<strong>对于英语字母，UTF-8编码和ASCII码是相同的</strong>。</li>
<li>对于n字节的符号（n&gt;1），第一个字节的前n位都设为1，第n+1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的unicode码</li>
<li>UTF-8对于字节的格式有严格要求,当解析某个字符失败时,使用<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2//202311271632096.png" alt="image-20231127163227079" style="zoom: 50%;" />代替(UTF-8编码为<code>EF BF BD</code>)</li>
</ol>
<table>
<thead>
<tr>
<th>Unicode符号集</th>
<th>UTF-8(x表示Unicode符号集)</th>
</tr>
</thead>
<tbody><tr>
<td>0~7F</td>
<td>0xxxxxxx</td>
</tr>
<tr>
<td>80~7FF</td>
<td>110xxxxx 10xxxxxx</td>
</tr>
<tr>
<td>800~FFFF</td>
<td>1110xxxx 10xxxxxx 10xxxxxx</td>
</tr>
<tr>
<td>10000~10FFFF</td>
<td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
</tr>
</tbody></table>
<p>因此占用1~4个字节都有可能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A中</span><br><span class="line">41             	E4           	B8           	AD</span><br><span class="line">0(100 0001)    	1110 (0100)		10(11 1000)		10(10 1101)</span><br><span class="line">100 0001		0100			1110    0010	1101</span><br><span class="line">4	1			4				E		2		D</span><br><span class="line">A				中</span><br></pre></td></tr></table></figure>

<p>数据大部分是英文字符的话采用UTF-8比较好，中文多的话采用UTF-16比较好</p>
<p>优缺点：拆分解析慢，但节省空间（尤其是网络传输）</p>
<p><strong>获取utf8字符字节数的代码</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取UTF-8单字符所占的字节数</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getUTF8CharSize</span><span class="params">(<span class="type">char</span> ch)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((ch &amp; <span class="number">0xF8</span>) == <span class="number">0xF0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((ch &amp; <span class="number">0xF0</span>) == <span class="number">0xE0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((ch &amp; <span class="number">0xE0</span>) == <span class="number">0xC0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 函数用于判断是否为UTF-8字符的起始字节</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isUTF8StartByte</span><span class="params">(<span class="type">char</span> byte)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (byte &amp; <span class="number">0xC0</span>) != <span class="number">0x80</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这段代码的实现原理是使用位操作来判断一个字节是否为UTF-8字符的起始字节。</span></span><br><span class="line"><span class="comment">//UTF-8编码使用不同长度的字节来表示不同的Unicode字符。一个UTF-8字符的起始字节的最高位为0或以10开头的字节，而后续字节的最高位都为10。</span></span><br><span class="line"><span class="comment">//这段代码中的位操作`(byte &amp; 0xC0) != 0x80`用于判断一个字节的最高两位是否满足UTF-8字符的起始字节的条件。</span></span><br><span class="line"><span class="comment">//具体来说，`byte &amp; 0xC0`会将字节的最高两位保留，而其他位都置为0。然后，将结果与`0x80`进行比较，即判断最高两位是否不等于`10`。</span></span><br><span class="line"><span class="comment">//如果最高两位不等于`10`，则表示该字节是UTF-8字符的起始字节，函数返回`true`。否则，表示该字节是UTF-8字符的后续字节，函数返回`false`。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数:从一个string类型变量中删除UTF-8字符,返回要删除的字节数</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">deleteUTF8Character</span><span class="params">(std::string&amp; str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (str.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> wantDelete = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 向前遍历字符串，找到要删除的字符的起始位置</span></span><br><span class="line">    <span class="type">int</span> startPos = str.<span class="built_in">length</span>() - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (startPos &gt; <span class="number">0</span> &amp;&amp; !<span class="built_in">isUTF8StartByte</span>(str[startPos])) &#123;</span><br><span class="line">        startPos--;</span><br><span class="line">        wantDelete++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除字符</span></span><br><span class="line">    str.<span class="built_in">erase</span>(startPos);</span><br><span class="line">    <span class="keyword">return</span> wantDelete<span class="number">+1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//计算String类型中的utf8字符数</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">countUTF8Characters</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> length = str.<span class="built_in">length</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((str[i] &amp; <span class="number">0xC0</span>) != <span class="number">0x80</span>) &#123;<span class="comment">//起始字节</span></span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[[STL#string操作utf8案例|mac上string操作utf8编写案例]]</p>
<h4 id="UTF-32"><a href="#UTF-32" class="headerlink" title="UTF-32"></a>UTF-32</h4><p>任何元素都是4个字节为单位。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A					中</span><br><span class="line">41 00 00 00			 2D 4E 00 00 </span><br></pre></td></tr></table></figure>

<h3 id="BOM字节顺序标识"><a href="#BOM字节顺序标识" class="headerlink" title="BOM字节顺序标识"></a>BOM字节顺序标识</h3><p>Byte Order Mark</p>
<p>文本文件的起始位置存这几个字节来表示当前文件采用什么格式存储</p>
<table>
<thead>
<tr>
<th>存储格式</th>
<th>BOM</th>
</tr>
</thead>
<tbody><tr>
<td>UTF-8</td>
<td>EF BB BF</td>
</tr>
<tr>
<td>UTF-16LE（小端存储）</td>
<td>FF FE</td>
</tr>
<tr>
<td>UTF-16BE（大端存储）</td>
<td>FE FF</td>
</tr>
<tr>
<td>UTF-32LE</td>
<td>FF FE 00 00</td>
</tr>
<tr>
<td>UTF-32BE</td>
<td>00 00 FE FF</td>
</tr>
</tbody></table>
<p>添加BOM头</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::ofstream <span class="title">ofs</span><span class="params">(<span class="string">&quot;d:\\Temp\\test.txt&quot;</span>)</span></span>; <span class="comment">//文件是utf8编码</span></span><br><span class="line"><span class="type">char</span> c1 = <span class="number">0xEF</span>;<span class="comment">// 仿utf-8 BOM头  三字节</span></span><br><span class="line"><span class="type">char</span> c2 = <span class="number">0xBB</span>;</span><br><span class="line"><span class="type">char</span> c3 = <span class="number">0xBF</span>;</span><br><span class="line">ofs &lt;&lt; c1 &lt;&lt; c2 &lt;&lt; c3;</span><br></pre></td></tr></table></figure>

<p>[[QT]]中添加BOM头提供了封装好的函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QTextStream <span class="title">out</span><span class="params">(&amp;data)</span></span>;</span><br><span class="line">out.<span class="built_in">setCodec</span>(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">out.<span class="built_in">setGenerateByteOrderMark</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ANSI和UTF8之间的转换原理 必须通过UCS-2&#x2F;UCS-4</p>
</blockquote>
<h1 id="操作系统字符集"><a href="#操作系统字符集" class="headerlink" title="操作系统字符集"></a>操作系统字符集</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://www.bilibili.com/video/BV1TT411H7ca" alt="乱码问题教程|720x360"></p>
<p>编译环境和运行环境</p>
<ul>
<li>编译器转换程序源代码时,所处的环境成为<strong>编译环境</strong>(translation environment);</li>
<li>编译后程序执行时,所处的环境称为<strong>运行环境</strong>(execution environment)</li>
</ul>
<p>源码字符集和执行字符集</p>
<ul>
<li><strong>源码字符集</strong>(the source character set)   源码文件是使用何种编码保存的</li>
<li><strong>执行字符集</strong>(the execution character set) 可执行程序内保存的是何种编码(程序执行时内存中字符编码)</li>
</ul>
<p><strong>在编译时，编译器会根据源文件的编码(源码字符集)将字符串字面量转换为目标字符串。只要没有进行编码转换，字符串字面量在程序中的表示形式将与其在源代码中的编码相同。</strong></p>
<p><strong>操作系统字符集</strong></p>
<blockquote>
<p>除windows平台外大部分其他平台，编译器默认使用的编码都是UTF-8编码，最新版本的Clang编译器只支持UTF-8编码</p>
</blockquote>
<ul>
<li><strong>windows</strong>中文版默认采用gbk编码</li>
<li><strong>linux</strong>,mac默认采用utf-8编码</li>
</ul>
<p>GCC编译器:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-finput-charset 指定源文件的编码 (若不指定,默认是UTF-<span class="number">8</span>)</span><br><span class="line">-fexec-charset 指定多字节字符串(const char*)常量在编译后的程序里保存的编码集(若不指定,默认是UTF-<span class="number">8</span>)</span><br><span class="line">-fwide-exec-charset 指定宽字节字符串(const wchar_t*)常量在编译后的程序里的保存的编码集</span><br><span class="line"><span class="comment">#QMAKE中为:</span></span><br><span class="line">QMAKE_CFLAGS += -finput-charset=utf-<span class="number">8</span> -fexec-charset=gbk</span><br><span class="line">QMAKE_CXXFLAGS += -finput-charset=utf-<span class="number">8</span> -fexec-charset=gbk</span><br></pre></td></tr></table></figure>

<p>clang编译器:</p>
<p>同上设置方式,但不支持设定为gbk</p>
<p>VCC编译器:</p>
<blockquote>
<p><strong>VCC</strong> 是指 Visual C++ Compiler，即 Visual Studio 中的 C++ 编译器。MSVC 提供了一个完整的开发环境，包括编译器、链接器、调试器等工具，用于开发和构建 C++ 程序。VCC 是 MSVC 中的核心组件之一，负责将 C++ 代码编译成可执行文件或库。</p>
</blockquote>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">项目的属性设置 - C/C++编译器选项 - 附加选项 中添加:/source-charset:utf-<span class="number">8</span>和/execution-charset:utf-<span class="number">8</span></span><br><span class="line"><span class="comment">#QMAKE中为:</span></span><br><span class="line">QMAKE_CXXFLAGS += /source-charset:utf-<span class="number">8</span> /execution-charset:utf-<span class="number">8</span></span><br><span class="line"><span class="comment">#CMAKE中为:</span></span><br><span class="line"><span class="keyword">add_compile_options</span>(<span class="string">&quot;$&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:/source-charset:utf-8&gt;&quot;</span>) </span><br><span class="line"><span class="keyword">add_compile_options</span>(<span class="string">&quot;$&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:/execution-charset:utf-8&gt;&quot;</span>) </span><br></pre></td></tr></table></figure>

<h2 id="控制台"><a href="#控制台" class="headerlink" title="控制台"></a>控制台</h2><blockquote>
<p>windows控制台字符编码使用的是系统默认的编码，可以通过<code>chcp</code>命令查看。如果控制台的编码不是UTF-8(对应编码：65001)，显示UTF-8字符串会出现乱码，可通过<code>chcp 65001</code>命令修改控制台的编码，从而正常显示UTF-8字符串。</p>
</blockquote>
<p>[[mac及linux_C++环境#windows下的vscode终端乱码|windows下的vscode终端乱码解决]]</p>
<h1 id="字符集转换"><a href="#字符集转换" class="headerlink" title="字符集转换"></a>字符集转换</h1><blockquote>
<p>如果程序需要在多个平台编译运行，则代码必须使用UTF-8。使用UTF-8可以更容易的在多字节字符串(char*, std::string)和宽字符(wchar_t* std::wstring）直接转换，更容易避免程序乱码，中文路径错误等问题。</p>
</blockquote>
<p> C++11 中引入的 <code>char16_t</code> 和 <code>char32_t</code> </p>
<p>主要使用C++11引入的wstring_convert和codecvt相结合进行转换。但在C++17遭到废弃</p>
<h2 id="windows下常用转码需求"><a href="#windows下常用转码需求" class="headerlink" title="windows下常用转码需求"></a>windows下常用转码需求</h2><blockquote>
<p>下面的代码在windows上完美运行（linux转码需求小）。GBK在linux下的locale名可能是”zh_CN.GBK”，而windows下是”.936”），因此做跨平台的话仍然要给不同的系统做适配</p>
</blockquote>
<h3 id="utf8的宽窄字符转换"><a href="#utf8的宽窄字符转换" class="headerlink" title="utf8的宽窄字符转换"></a>utf8的宽窄字符转换</h3><ul>
<li><p><strong>std::string 转为 std::wstring</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::wstring <span class="title">utf8_to_wstr</span><span class="params">(<span class="type">const</span> std::string&amp; src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt;&gt; converter;</span><br><span class="line">    <span class="keyword">return</span> converter.<span class="built_in">from_bytes</span>(src);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：使用这个函数的时候需要求std::string的编码是utf-8，不然会抛异常。</p>
</li>
<li><p><strong>std::wstring转为std::string</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">wstr_to_utf8</span><span class="params">(<span class="type">const</span> std::wstring&amp; src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt;&gt; convert;</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">to_bytes</span>(src);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="utf8与gbk互转"><a href="#utf8与gbk互转" class="headerlink" title="utf8与gbk互转"></a>utf8与gbk互转</h3><p>下面utf-8和gbk互转的代码，都是先转化为<code>std::wstring</code>的，我们可以再拆分。得到std::wstring和gbk互转。</p>
<h4 id="utf-8转gbk"><a href="#utf-8转gbk" class="headerlink" title="utf-8转gbk"></a>utf-8转gbk</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">utf8_to_gbk</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt; &gt; conv;</span><br><span class="line">    std::wstring tmp_wstr = conv.<span class="built_in">from_bytes</span>(str);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//GBK locale name in windows</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* GBK_LOCALE_NAME = <span class="string">&quot;.936&quot;</span>;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_byname&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;&gt; <span class="built_in">convert</span>(<span class="keyword">new</span> std::<span class="built_in">codecvt_byname</span>&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;(GBK_LOCALE_NAME));</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">to_bytes</span>(tmp_wstr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="gbk转utf-8"><a href="#gbk转utf-8" class="headerlink" title="gbk转utf-8"></a>gbk转utf-8</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">gbk_to_utf8</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//GBK locale name in windows</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* GBK_LOCALE_NAME = <span class="string">&quot;.936&quot;</span>;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_byname&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;&gt; <span class="built_in">convert</span>(<span class="keyword">new</span> std::<span class="built_in">codecvt_byname</span>&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;(GBK_LOCALE_NAME));</span><br><span class="line">    std::wstring tmp_wstr = convert.<span class="built_in">from_bytes</span>(str);</span><br><span class="line"> </span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">wchar_t</span>&gt;&gt; cv2;</span><br><span class="line">    <span class="keyword">return</span> cv<span class="number">2.</span><span class="built_in">to_bytes</span>(tmp_wstr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="gbk的宽窄字符互转"><a href="#gbk的宽窄字符互转" class="headerlink" title="gbk的宽窄字符互转"></a>gbk的宽窄字符互转</h3><ul>
<li><p><strong>std::string 转为 std::wstring</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::wstring <span class="title">gbk_to_wstr</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//GBK locale name in windows</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* GBK_LOCALE_NAME = <span class="string">&quot;.936&quot;</span>;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_byname&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;&gt; <span class="built_in">convert</span>(<span class="keyword">new</span> std::<span class="built_in">codecvt_byname</span>&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;(GBK_LOCALE_NAME));</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">from_bytes</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>std::wstring转为std::string</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string <span class="title">wstr_to_gbk</span><span class="params">(<span class="type">const</span> std::wstring&amp; wstr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// GBK locale name in Windows</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* GBK_LOCALE_NAME = <span class="string">&quot;.936&quot;</span>;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_byname&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;&gt; <span class="built_in">convert</span>(<span class="keyword">new</span> std::<span class="built_in">codecvt_byname</span>&lt;<span class="type">wchar_t</span>, <span class="type">char</span>, <span class="type">mbstate_t</span>&gt;(GBK_LOCALE_NAME));</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">to_bytes</span>(wstr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>两个比较好的两个第三方库分别是 <a target="_blank" rel="noopener" href="http://utfcpp.sourceforge.net/">UTF8-CPP</a>以及<a target="_blank" rel="noopener" href="http://www.boost.org/doc/libs/1_51_0/libs/locale/doc/html/index.html">Boost.Locale</a>。</p>
<h2 id="UTF8和UTF16互转"><a href="#UTF8和UTF16互转" class="headerlink" title="UTF8和UTF16互转"></a>UTF8和UTF16互转</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;codecvt&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function">std::u16string <span class="title">to_utf16</span><span class="params">( std::string str )</span> <span class="comment">// utf-8 to utf16</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> std::wstring_convert&lt; std::codecvt_utf8_utf16&lt;<span class="type">char16_t</span>&gt;, <span class="type">char16_t</span> &gt;&#123;&#125;.<span class="built_in">from_bytes</span>(str); &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function">std::string <span class="title">to_utf8</span><span class="params">( std::u16string str16 )</span> <span class="comment">// utf-16 to utf8</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> std::wstring_convert&lt; std::codecvt_utf8_utf16&lt;<span class="type">char16_t</span>&gt;, <span class="type">char16_t</span> &gt;&#123;&#125;.<span class="built_in">to_bytes</span>(str16); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面也行</span></span><br><span class="line"><span class="function">std::u16string <span class="title">to_utf16</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> <span class="comment">// UTF-8 to UTF-16</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8_utf16&lt;<span class="type">char16_t</span>&gt;, <span class="type">char16_t</span>&gt; convert;</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">from_bytes</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">to_utf8</span><span class="params">(<span class="type">const</span> std::u16string&amp; str16)</span> <span class="comment">// UTF-16 to UTF-8</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8_utf16&lt;<span class="type">char16_t</span>&gt;, <span class="type">char16_t</span>&gt; convert;</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">to_bytes</span>(str16);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面在C++17被废弃了</p>
<p>转而:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//c++17</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;codecvt&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale&gt;</span></span></span><br><span class="line"><span class="function">std::u16string <span class="title">to_utf16</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> <span class="comment">// UTF-8 to UTF-16</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">char16_t</span>&gt;, <span class="type">char16_t</span>&gt; convert;</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">from_bytes</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">to_utf8</span><span class="params">(<span class="type">const</span> std::u16string&amp; str16)</span> <span class="comment">// UTF-16 to UTF-8</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">char16_t</span>&gt;, <span class="type">char16_t</span>&gt; convert;</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">to_bytes</span>(str16);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string utf8Str = <span class="string">u8&quot;Hello, 你好&quot;</span>;</span><br><span class="line">    std::u16string utf16Str = <span class="built_in">to_utf16</span>(utf8Str);</span><br><span class="line">    std::string convertedUtf8Str = <span class="built_in">to_utf8</span>(utf16Str);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Original UTF-8: &quot;</span> &lt;&lt; utf8Str &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Converted UTF-16: &quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char16_t</span> c : utf16Str) &#123;</span><br><span class="line">        std::cout &lt;&lt; std::hex &lt;&lt; <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(c) &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Converted back to UTF-8: &quot;</span> &lt;&lt; convertedUtf8Str &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="UTF8和UTF32互转"><a href="#UTF8和UTF32互转" class="headerlink" title="UTF8和UTF32互转"></a>UTF8和UTF32互转</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::u32string <span class="title">to_utf32</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> <span class="comment">// UTF-8 to UTF-32</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">char32_t</span>&gt;, <span class="type">char32_t</span>&gt; convert;</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">from_bytes</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">to_utf32</span><span class="params">(<span class="type">const</span> std::u32string&amp; str32)</span> <span class="comment">// UTF-32 to UTF-8</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::wstring_convert&lt;std::codecvt_utf8&lt;<span class="type">char32_t</span>&gt;, <span class="type">char32_t</span>&gt; convert;</span><br><span class="line">    <span class="keyword">return</span> convert.<span class="built_in">to_bytes</span>(str32);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="u8string转换为string"><a href="#u8string转换为string" class="headerlink" title="u8string转换为string"></a>u8string转换为string</h2><p>可以通过这种方式转换为string类型,本质上就是字节流拷贝</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u8string u8str =<span class="string">u8&quot;你好,世界&quot;</span>;</span><br><span class="line">cout&lt;&lt;<span class="built_in">string</span>(u8str.<span class="built_in">begin</span>(),u8str.<span class="built_in">end</span>())&lt;&lt;endl;</span><br></pre></td></tr></table></figure>

<h2 id="wchart-t-转char"><a href="#wchart-t-转char" class="headerlink" title="wchart_t*转char*"></a>wchart_t*转char*</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">char</span> *<span class="title">WCharToChar</span><span class="params">(<span class="type">char</span> *dest, <span class="type">const</span> <span class="type">wchar_t</span> *wstr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == wstr)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">WideCharToMultiByte</span>(CP_ACP, <span class="number">0</span>, wstr, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>); <span class="comment">// get wchar length</span></span><br><span class="line">    <span class="built_in">WideCharToMultiByte</span>(CP_ACP, <span class="number">0</span>, wstr, <span class="number">-1</span>, dest, len, <span class="literal">NULL</span>, <span class="literal">NULL</span>);         <span class="comment">// CP_UTF8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>将宽字符（wchar_t）转换为多字节字符（char），在 UNICODE 模式下使用。</p>
<h2 id="char-转wchar-t"><a href="#char-转wchar-t" class="headerlink" title="char*转wchar_t*"></a>char*转wchar_t*</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">wchar_t</span> *<span class="title">CharToWChar</span><span class="params">(<span class="type">wchar_t</span> *dest, <span class="type">const</span> <span class="type">char</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == str)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">MultiByteToWideChar</span>(CP_ACP, <span class="number">0</span>, str, <span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>); <span class="comment">// get char length</span></span><br><span class="line">    <span class="built_in">MultiByteToWideChar</span>(CP_ACP, <span class="number">0</span>, str, <span class="number">-1</span>, dest, len);         <span class="comment">// CP_UTF8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>将多字节字符（char）转换为宽字符（wchar_t），在 UNICODE 模式下使用。</p>
<h1 id="字符集总结"><a href="#字符集总结" class="headerlink" title="字符集总结"></a>字符集总结</h1><table>
<thead>
<tr>
<th>字符类型</th>
<th>字符串类型</th>
<th>字符长度(bit)</th>
<th>引入的C++版本</th>
</tr>
</thead>
<tbody><tr>
<td>char</td>
<td>string</td>
<td>8</td>
<td>开始就存在</td>
</tr>
<tr>
<td>char8_t</td>
<td>u8string</td>
<td>8</td>
<td>20</td>
</tr>
<tr>
<td>char16_t</td>
<td>u16string</td>
<td>16</td>
<td>11</td>
</tr>
<tr>
<td>char32_t</td>
<td>u32string</td>
<td>32</td>
<td>11</td>
</tr>
<tr>
<td>wchar_t</td>
<td>wstring</td>
<td>在不同的编译器和操作系统上不同</td>
<td>开始就存在</td>
</tr>
</tbody></table>
<p>cout不支持直接对u8string,u16string,u32string,wstring等的输出.可以通过下面方式:</p>
<ul>
<li>wstring使用wcout来输出</li>
<li>u8string,u16string,u32string使用<a href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E8%BD%AC%E6%8D%A2">转换方式</a>来输出</li>
</ul>
<p>一些建议:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.coder.work/article/576380">char8_t不建议用,其类型的问题可以参阅这里</a></p>
<p>char8_t及u8string在标准中不受支持，任何系统API都不支持(而且可能永远不会,因为兼容性原因)。在大多数平台上，普通的<code>char</code>字符串已经是UTF-8，在Windows上，您可以使用<code>/utf-8</code>进行编译，这将在主要的操作系统上为您提供可移植的Unicode支持。您甚至不能使用u8字符串在C++20中编写Hello程序：</p>
</li>
<li><p>wchar_t因为平台之间的兼容性的问题,同样不建议用</p>
</li>
</ul>
<h1 id="C语言中的宽字符"><a href="#C语言中的宽字符" class="headerlink" title="C语言中的宽字符"></a>C语言中的宽字符</h1><h2 id="宽字符类型"><a href="#宽字符类型" class="headerlink" title="宽字符类型"></a>宽字符类型</h2><ul>
<li>char：多字节字符类型</li>
<li>wchar_t：宽字符类型</li>
</ul>
<blockquote>
<p><code>wchar_t</code> 在windows是 16 位，而在linux上是 32 位。这使得移植变得困难。linux平台的std::wstring就是std::u32string, wchar_t 就是char32_t (utf-32编码)</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> szStr[]=<span class="string">&quot;中国&quot;</span>;<span class="comment">//使用的是ANSI编码 D6 D0 B9 FA 00 (一个字节的零表示结尾)</span></span><br><span class="line"><span class="type">wchar_t</span> sezStr[]=<span class="string">L&quot;中国&quot;</span>;<span class="comment">//使用的是UTF-16编码 2D 4E FD 56 00 00(两个字节的0表示结尾)</span></span><br><span class="line"><span class="comment">//L的意思是让编译器存储该字符串的时候按照UTF-16来存储，也可以设置编译器选项设置默认存储格式为UTF-16，就不需要写这个L了</span></span><br></pre></td></tr></table></figure>

<h2 id="字符常用函数"><a href="#字符常用函数" class="headerlink" title="字符常用函数"></a>字符常用函数</h2><p>使用的函数版本根据编码不同也被提供了两套</p>
<table>
<thead>
<tr>
<th>多字节字符函数</th>
<th>宽字符函数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>printf</td>
<td>wprintf</td>
<td>打印到控制台函数</td>
</tr>
<tr>
<td>strlen</td>
<td>wcslen</td>
<td>获取长度</td>
</tr>
<tr>
<td>strcpy</td>
<td>wcscpy</td>
<td>字符串复制</td>
</tr>
<tr>
<td>strcat</td>
<td>wcscat</td>
<td>字符串拼接</td>
</tr>
<tr>
<td>strcmp</td>
<td>wcscmp</td>
<td>字符串比较</td>
</tr>
<tr>
<td>strstr</td>
<td>wcsstr</td>
<td>字符串查找功能</td>
</tr>
</tbody></table>
<p>&#x3D;&#x3D;&#x3D;</p>
<p>下面是Windows定义的一组字符串函数，这些函数用来计算字符串长度、复制字符串、连接字符串和比较字符串：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ILength = <span class="built_in">lstrlen</span> (pString) ;</span><br><span class="line">        </span><br><span class="line">pString = <span class="built_in">lstrcpy</span> (pString1, pString2) ;</span><br><span class="line">        </span><br><span class="line">pString = <span class="built_in">lstrcpyn</span> (pString1, pString2, iCount) ;</span><br><span class="line">        </span><br><span class="line">pString = <span class="built_in">lstrcat</span> (pString1, pString2) ;</span><br><span class="line">        </span><br><span class="line">iComp = <span class="built_in">lstrcmp</span> (pString1, pString2) ;</span><br><span class="line">        </span><br><span class="line">iComp = <span class="built_in">lstrcmpi</span> (pString1, pString2) ;</span><br></pre></td></tr></table></figure>

<p>这些函数与C链接库中对应的函数功能相同。如果定义了UNICODE标识符，那么这些函数将接受宽字符串，否则只接受常规字符串。宽字符串版的lstrlenW函数可在Windows 98中执行。</p>
<h2 id="设置字面量的编码方式"><a href="#设置字面量的编码方式" class="headerlink" title="设置字面量的编码方式"></a>设置字面量的编码方式</h2><blockquote>
<p>C++11 标准引入了原始字符串字面量（Raw String Literal）和 Unicode 字符串字面量（Unicode String Literal）的语法，其中 u”” 用于表示 Unicode 字符串字面量。这种格式允许在字符串中直接使用 Unicode 字符，而无需进行转义或使用特殊的编码方式</p>
</blockquote>
<p>字符串字面量（string literals）前面可以加上不同的前缀来表示不同的含义。以下是常用的字符串字面量前缀及其含义：</p>
<ul>
<li><code>L</code> 前缀：表示宽字符（wide character）字符串。宽字符字符串是由 wchar_t 类型表示的字符串，每个字符占用 2 个字节。例如，<code>L&quot;Hello&quot;</code> 表示一个由宽字符组成的字符串。</li>
<li><code>u8</code> 前缀：表示 UTF-8 编码的字符串。UTF-8 是一种可变长度的 Unicode 编码，每个字符占用 1 到 4 个字节。例如，<code>u8&quot;你好&quot;</code> 表示一个由 UTF-8 编码的字符串。</li>
<li><code>u</code> 前缀：表示 Unicode(UTF-16) 编码的字符串。Unicode 编码是一种固定长度的字符编码，每个字符占用 2或4 个字节。例如，<code>u&quot;こんにちは&quot;</code> 表示一个由 Unicode 编码的字符串。</li>
<li><code>U</code> 前缀：表示 UTF-32 编码的字符串。UTF-32 是一种固定长度的 Unicode 编码，每个字符占用 4 个字节。例如，<code>U&quot;🌞&quot;</code> 表示一个由 UTF-32 编码的字符串。</li>
<li><code>R</code> 前缀：表示原始字符串（raw string）。原始字符串中的特殊字符不会被转义，可以直接包含在字符串中。例如，<code>R&quot;(C:\Windows\System32)&quot;</code> 表示一个包含反斜杠的字符串，而不需要对反斜杠进行转义。</li>
</ul>
<h1 id="C-处理宽字符"><a href="#C-处理宽字符" class="headerlink" title="C++处理宽字符"></a>C++处理宽字符</h1><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/aKSdHGq0Nj9GAAl9xfMaJw">参考链接</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" title="头像" alt="头像"></a><div class="post-copyright__author_name">ZEROKO14</div><div class="post-copyright__author_desc">zeroko14's blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://che77a38.github.io/posts/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://che77a38.github.io/posts/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/')">字符编码</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://che77a38.github.io/posts/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=字符编码&amp;url=https://che77a38.github.io/posts/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://che77a38.github.io" target="_blank">ZEROKO14的个人博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%BC%80%E5%8F%91/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>开发<span class="tagsPageCount">4</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E5%8A%A0%E8%A7%A3%E5%AF%86%E7%9B%B8%E5%85%B3/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">加密与解密</div></div></a></div><div class="next-post pull-right"><a href="/posts/C++11%E4%B8%8E14/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C++11与14</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/STL/" title="标准模板库(STL)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-24</div><div class="title">标准模板库(STL)</div></div></a></div><div><a href="/posts/windows%E5%BC%80%E5%8F%91/" title="windows开发"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-24</div><div class="title">windows开发</div></div></a></div><div><a href="/posts/%E5%B1%8F%E5%B9%95%E7%9B%91%E6%8E%A7%EF%BC%88%E6%9C%AA%E5%AE%8C%E6%88%90%EF%BC%89/" title="屏幕监控"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-24</div><div class="title">屏幕监控</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://avatars.githubusercontent.com/u/27732581?s=400&amp;u=303b2c0e2118ad20406f8d718e885bcf99fc8bf8&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">欢迎来到ZEROKO14的个人博客</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ZEROKO14</h1><div class="author-info__desc">zeroko14's blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/che77a38" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">字符编码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ANSI%E7%BC%96%E7%A0%81"><span class="toc-number">1.1.</span> <span class="toc-text">ANSI编码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E7%9A%84ASCII%E7%BC%96%E7%A0%81"><span class="toc-number">1.1.1.</span> <span class="toc-text">原始的ASCII编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ASCII%E7%BC%96%E7%A0%81%E7%9A%84%E6%8B%93%E5%B1%95%EF%BC%9AGB2312%EF%BC%88GBK%EF%BC%89%E6%88%96GB2312-80"><span class="toc-number">1.1.2.</span> <span class="toc-text">ASCII编码的拓展：GB2312（GBK）或GB2312-80</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">实现原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">缺点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UNICODE%E7%BC%96%E7%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">UNICODE编码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UCS-2%E5%92%8CUCS-4"><span class="toc-number">1.2.1.</span> <span class="toc-text">UCS-2和UCS-4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UNICODE%E7%BC%96%E7%A0%81%E7%9A%84%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">UNICODE编码的存储方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UTF-16"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">UTF-16</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UTF-8"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">UTF-8</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UTF-32"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">UTF-32</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BOM%E5%AD%97%E8%8A%82%E9%A1%BA%E5%BA%8F%E6%A0%87%E8%AF%86"><span class="toc-number">1.2.3.</span> <span class="toc-text">BOM字节顺序标识</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">操作系统字符集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-number">2.1.</span> <span class="toc-text">控制台</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E8%BD%AC%E6%8D%A2"><span class="toc-number">3.</span> <span class="toc-text">字符集转换</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E4%B8%8B%E5%B8%B8%E7%94%A8%E8%BD%AC%E7%A0%81%E9%9C%80%E6%B1%82"><span class="toc-number">3.1.</span> <span class="toc-text">windows下常用转码需求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#utf8%E7%9A%84%E5%AE%BD%E7%AA%84%E5%AD%97%E7%AC%A6%E8%BD%AC%E6%8D%A2"><span class="toc-number">3.1.1.</span> <span class="toc-text">utf8的宽窄字符转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#utf8%E4%B8%8Egbk%E4%BA%92%E8%BD%AC"><span class="toc-number">3.1.2.</span> <span class="toc-text">utf8与gbk互转</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#utf-8%E8%BD%ACgbk"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">utf-8转gbk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gbk%E8%BD%ACutf-8"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">gbk转utf-8</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gbk%E7%9A%84%E5%AE%BD%E7%AA%84%E5%AD%97%E7%AC%A6%E4%BA%92%E8%BD%AC"><span class="toc-number">3.1.3.</span> <span class="toc-text">gbk的宽窄字符互转</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UTF8%E5%92%8CUTF16%E4%BA%92%E8%BD%AC"><span class="toc-number">3.2.</span> <span class="toc-text">UTF8和UTF16互转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UTF8%E5%92%8CUTF32%E4%BA%92%E8%BD%AC"><span class="toc-number">3.3.</span> <span class="toc-text">UTF8和UTF32互转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u8string%E8%BD%AC%E6%8D%A2%E4%B8%BAstring"><span class="toc-number">3.4.</span> <span class="toc-text">u8string转换为string</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wchart-t-%E8%BD%ACchar"><span class="toc-number">3.5.</span> <span class="toc-text">wchart_t*转char*</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#char-%E8%BD%ACwchar-t"><span class="toc-number">3.6.</span> <span class="toc-text">char*转wchar_t*</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">字符集总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%AE%BD%E5%AD%97%E7%AC%A6"><span class="toc-number">5.</span> <span class="toc-text">C语言中的宽字符</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">宽字符类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">字符常用函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AD%97%E9%9D%A2%E9%87%8F%E7%9A%84%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F"><span class="toc-number">5.3.</span> <span class="toc-text">设置字面量的编码方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C-%E5%A4%84%E7%90%86%E5%AE%BD%E5%AD%97%E7%AC%A6"><span class="toc-number">6.</span> <span class="toc-text">C++处理宽字符</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/avalonia/" title="avalonia">avalonia</a><time datetime="2024-09-11T14:51:13.000Z" title="发表于 2024-09-11 22:51:13">2024-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E8%A7%86%E9%A2%91%E6%95%88%E6%9E%9C/" title="PR">PR</a><time datetime="2024-07-18T07:06:08.330Z" title="发表于 2024-07-18 15:06:08">2024-07-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/%E5%89%8D%E7%AB%AF/" title="WEB前端">WEB前端</a><time datetime="2024-07-18T07:06:08.323Z" title="发表于 2024-07-18 15:06:08">2024-07-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/slidev/" title="slidev">slidev</a><time datetime="2024-07-18T07:06:08.319Z" title="发表于 2024-07-18 15:06:08">2024-07-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/C++%E5%A4%9A%E7%BA%BF%E7%A8%8B/" title="C++多线程">C++多线程</a><time datetime="2024-07-18T07:05:59.794Z" title="发表于 2024-07-18 15:05:59">2024-07-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="ZEROKO14" target="_blank">ZEROKO14</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu"></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">57</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">48</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/C/" style="font-size: 0.88rem;">C#<sup>3</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C++<sup>5</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/CSharp/" style="font-size: 0.88rem;">CSharp<sup>1</sup></a><a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">C语言<sup>1</sup></a><a href="/tags/FPS/" style="font-size: 0.88rem;">FPS<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/MFC/" style="font-size: 0.88rem;">MFC<sup>1</sup></a><a href="/tags/PE/" style="font-size: 0.88rem;">PE<sup>1</sup></a><a href="/tags/QT/" style="font-size: 0.88rem;">QT<sup>1</sup></a><a href="/tags/WPF/" style="font-size: 0.88rem;">WPF<sup>3</sup></a><a href="/tags/ai/" style="font-size: 0.88rem;">ai<sup>1</sup></a><a href="/tags/cmake/" style="font-size: 0.88rem;">cmake<sup>1</sup></a><a href="/tags/doxygen/" style="font-size: 0.88rem;">doxygen<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/json/" style="font-size: 0.88rem;">json<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/next/" style="font-size: 0.88rem;">next<sup>1</sup></a><a href="/tags/ppt/" style="font-size: 0.88rem;">ppt<sup>1</sup></a><a href="/tags/slidev/" style="font-size: 0.88rem;">slidev<sup>1</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>1</sup></a><a href="/tags/xml/" style="font-size: 0.88rem;">xml<sup>1</sup></a><a href="/tags/yaml/" style="font-size: 0.88rem;">yaml<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 0.88rem;">代码规范<sup>1</sup></a><a href="/tags/%E5%86%85%E6%A0%B8/" style="font-size: 0.88rem;">内核<sup>2</sup></a><a href="/tags/%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3/" style="font-size: 0.88rem;">内核相关<sup>5</sup></a><a href="/tags/%E5%8A%A0%E8%A7%A3%E5%AF%86/" style="font-size: 0.88rem;">加解密<sup>1</sup></a><a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 0.88rem;">多线程<sup>1</sup></a><a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">开发<sup>4</sup></a><a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 0.88rem;">数学<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>1</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">架构<sup>1</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>1</sup></a><a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 0.88rem;">监控<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>1</sup></a><a href="/tags/%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">管理<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>2</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 0.88rem;">逆向<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>