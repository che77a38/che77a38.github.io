---
title: å­—ç¬¦ç¼–ç 
tags: å¼€å‘
categories: æŠ€æœ¯
mathjax: true
abbrlink: ebfb97d0
---
æœ‰å…³å­—ç¬¦ç¼–ç çš„çŸ¥è¯†ç‚¹
<!-- more -->

# å­—ç¬¦ç¼–ç 

ä¸‹é¢ä»‹ç»å¤šç§ç¼–ç æ–¹å¼:

## ANSIç¼–ç 

### **åŸå§‹**çš„ASCIIç¼–ç 

![4f06232eed4f93be762cd15d664b407c](https://cdn.jsdelivr.net/gh/che77a38/blogImage/4f06232eed4f93be762cd15d664b407c.jpeg)

![05d27497327d7264b74d178aaf312830](https://cdn.jsdelivr.net/gh/che77a38/blogImage/05d27497327d7264b74d178aaf312830.jpeg)

åŸå§‹çš„ASCIIç åªå ä¸€ä¸ªå­—èŠ‚

### ASCIIç¼–ç çš„æ‹“å±•ï¼šGB2312ï¼ˆGBKï¼‰æˆ–GB2312-80

GB2312æˆ–GB2312-80ï¼šä¸“é—¨ç”¨æ¥è¡¨ç¤ºä¸­æ–‡çš„ç¼–ç 

#### å®ç°åŸç†

æŠŠ80\~FFçš„è¡¨ç»™å ç”¨äº†ï¼Œç”±80\~FFå¼€å¤´çš„ä¸¤ä¸ªå­—èŠ‚æ‹¼åœ¨ä¸€èµ·è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦

```
ä¸­å›½
D6 D0 B9 FA
```

GB2312ï¼ˆGBKï¼‰æˆ–GB2312-80ä¹Ÿå°±æ˜¯ANSIç¼–ç ï¼ˆå„å›½å„è‡ªçš„ç¼–ç æ ¼å¼ç»Ÿç§°ANSIï¼‰

#### ç¼ºç‚¹

å…¶ä»–è±¡å½¢æ–‡å­—å›½å®¶ä¹Ÿæ˜¯é‡‡å–å’Œæˆ‘å›½ä¸€æ ·çš„ç­–ç•¥ï¼Œæ‰€ä»¥å„ä¸ªå›½å®¶çœ‹åˆ°çš„åŒä¸€ä¸ªç¼–ç æ„æ€ä¸ä¸€è‡´ã€‚

ANSIç¼–ç ä¹Ÿå°±æ˜¯GB2312ï¼ˆGBKï¼‰æˆ–GB2312-80ï¼Œè¡¨ç¤ºè‹±æ–‡å­—ç¬¦æ—¶ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºä¸­æ–‡å­—ç¬¦æ—¶ç”¨ä¸¤ä¸ªæˆ–4ä¸ªå­—èŠ‚


## UNICODEç¼–ç 

ä¸€å¼ åŒ…å«å…¨ä¸–ç•Œæ‰€æœ‰æ–‡å­—çš„ä¸€ä¸ªç¼–ç è¡¨ï¼ŒUnicodeçš„ç¼–ç èŒƒå›´æ˜¯ï¼š0~0x10FFFFï¼Œå¯ä»¥å®¹çº³100å¤šä¸‡ä¸ªç¬¦å·ï¼

ä½†ä»–åªæ˜¯ä¸€ä¸ªç¬¦å·é›†ï¼Œåªè§„å®šäº†ç¬¦å·çš„äºŒè¿›åˆ¶ä»£ç ï¼Œå´æ²¡æœ‰è§„å®šè¿™ä¸ªäºŒè¿›åˆ¶ä»£ç åº”è¯¥å¦‚ä½•å­˜å‚¨ã€‚

[è¯¦è§£å‚é˜…](https://zhuanlan.zhihu.com/p/260192496)

### UCS-2å’ŒUCS-4

åœ¨å°†UTF8å’ŒUTF16ã€UTF32çš„åŒºåˆ«ä¹‹å‰ï¼Œå†å…ˆç§‘æ™®ä¸¤ä¸ªåè¯ï¼šUCS-2å’ŒUCS-4ã€‚

> Unicodeæ˜¯ä¸ºæ•´åˆå…¨ä¸–ç•Œçš„æ‰€æœ‰è¯­è¨€æ–‡å­—è€Œè¯ç”Ÿçš„ã€‚ä»»ä½•æ–‡å­—åœ¨Unicodeä¸­éƒ½å¯¹åº”ä¸€ä¸ªå€¼ï¼Œ è¿™ä¸ªå€¼ç§°ä¸º**ä»£ç ç‚¹**ï¼ˆcode pointï¼Œä¹Ÿç§°ç å€¼ï¼‰ã€‚ä»£ç ç‚¹çš„å€¼é€šå¸¸å†™æˆ `U+ABCD` çš„æ ¼å¼ã€‚è€Œæ–‡å­—å’Œä»£ç ç‚¹ä¹‹é—´çš„å¯¹åº”å…³ç³»å°±æ˜¯**UCS-2**ï¼ˆUniversal Character Set coded in 2 octetsï¼‰ã€‚é¡¾åæ€ä¹‰ï¼ŒUCS-2æ˜¯ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºä»£ç ç‚¹ï¼Œå…¶å–å€¼èŒƒå›´ä¸º `U+0000ï½U+FFFF`ã€‚
>
> ä¸ºäº†èƒ½è¡¨ç¤ºæ›´å¤šçš„æ–‡å­—ï¼Œäººä»¬åˆæå‡ºäº†**UCS-4**ï¼Œå³ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºä»£ç ç‚¹ã€‚å®ƒçš„èŒƒå›´ä¸º `U+00000000ï½U+7FFFFFFF`ï¼Œå…¶ä¸­ `U+00000000ï½U+0000FFFF`å’ŒUCS-2æ˜¯ä¸€æ ·çš„ã€‚

è¦æ³¨æ„ï¼ŒUCS-2å’ŒUCS-4åªè§„å®šäº†ä»£ç ç‚¹å’Œæ–‡å­—ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œå¹¶æ²¡æœ‰è§„å®šä»£ç ç‚¹åœ¨è®¡ç®—æœºä¸­å¦‚ä½•å­˜å‚¨ã€‚è§„å®šå­˜å‚¨æ–¹å¼çš„ç§°ä¸º**UTFï¼ˆUnicode Transformation Formatï¼‰**ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸‹é¢å°†è¦æåˆ°çš„UNICODEç¼–ç çš„å­˜å‚¨æ–¹å¼ã€‚

### **UNICODEç¼–ç çš„å­˜å‚¨æ–¹å¼**

#### UTF-16

[ç»´åŸºç™¾ç§‘](https://zh.wikipedia.org/wiki/UTF-16)

> javaã€jsã€c#ã€pythoné»˜è®¤çš„å­—ç¬¦ä¸²å†…éƒ¨ç¼–ç éƒ½æ˜¯utf-16ã€‚

UTF-16ç¼–ç ä»¥16ä½æ— ç¬¦å·æ•´æ•°ä¸ºå•ä½ï¼Œæ³¨æ„æ˜¯16ä½ä¸ºä¸€ä¸ªå•ä½ï¼Œä¸è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦å°±åªæœ‰16ä½ã€‚è¿™ä¸ªè¦çœ‹å­—ç¬¦çš„unicodeç¼–ç å¤„äºä»€ä¹ˆèŒƒå›´è€Œå®šçš„ï¼Œ**ç»å¤§éƒ¨åˆ†æ˜¯2ä¸ªå­—èŠ‚ï¼Œæå°‘æ•°æ˜¯4ä¸ªå­—èŠ‚(å› æ­¤å¯ä»¥ç®—æ˜¯2å­—èŠ‚å®šé•¿ç¼–ç )**ã€‚**ç°åœ¨æœºå™¨ä¸Šçš„unicodeç¼–ç ä¸€èˆ¬æŒ‡çš„å°±æ˜¯UTF-16ã€‚**

```
UTF-16å°ç«¯å­˜å‚¨
ä¸­å›½A
2D 4E FD 56 41 00

UTF-16å¤§ç«¯å­˜å‚¨
ä¸­å›½A
4E 2D 56 FD 00 41
```

![image-20210613135932861](https://cdn.jsdelivr.net/gh/che77a38/blogImage/image-20210613135932861.png)

ä¸Šå›¾ç®­å¤´æ‰€æŒ‡çš„æ²¡æœ‰æ˜ç¡®è¯´æ˜æ˜¯å“ªç§å­˜å‚¨æ–¹å¼çš„Unicode**å®é™…ä¸Šå°±æ˜¯UTF-16**

ä¼˜ç¼ºç‚¹ï¼šæ‹†åˆ†è§£æå¿«ï¼Œæµªè´¹ç©ºé—´å¤šï¼ˆå°¤å…¶æ˜¯ç½‘ç»œä¼ è¾“,ä½†ä¼ è¾“æ±‰å­—å¯èƒ½æ¯”utf8çœç©ºé—´,å› ä¸ºutf8ä¸‹å¾ˆå¤šæ±‰å­—è¦3å­—èŠ‚ï¼‰,éœ€è¦åŒºåˆ†å­—èŠ‚åºã€‚æ–‡ä»¶ä¿å­˜ä¸€èˆ¬æœ‰ä¸ªbomå¤´ï¼šBE-'FEFF'ã€LE-'FFFE'

> `U+D800åˆ°U+DFFF`æ˜¯æ²¡æœ‰å®šä¹‰unicodeçš„ï¼Œutf-16ç”¨è¿™æ®µæ¥æ ‡è¯†4å­—èŠ‚å­—ç¬¦ã€‚åˆ†é«˜ä½ä½ï¼Œå…±20ä¸ªæœ‰æ•ˆbitä½ã€‚å¦‚æœä¸æ”¯æŒéUCS-2çš„unicodeï¼Œå¯ä»¥ç›´æ¥ä¸è®¤è¿™ä¸ªèŒƒå›´é‡Œçš„å­—ç¬¦ã€‚

#### UTF-8

ä¸€ç§å˜é•¿çš„å­˜å‚¨æ–¹æ¡ˆ

ç½‘ç»œä¼ è¾“ç«èµ·æ¥çš„ç¼–ç æ ¼å¼     

**UTF-8çš„ç¼–ç è§„åˆ™ï¼š**

1. å¯¹äºå•å­—èŠ‚çš„ç¬¦å·ï¼Œå­—èŠ‚çš„ç¬¬ä¸€ä½è®¾ä¸º0ï¼Œåé¢7ä½ä¸ºè¿™ä¸ªç¬¦å·çš„unicodeç ã€‚å› æ­¤**å¯¹äºè‹±è¯­å­—æ¯ï¼ŒUTF-8ç¼–ç å’ŒASCIIç æ˜¯ç›¸åŒçš„**ã€‚
2. å¯¹äºnå­—èŠ‚çš„ç¬¦å·ï¼ˆn>1ï¼‰ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰nä½éƒ½è®¾ä¸º1ï¼Œç¬¬n+1ä½è®¾ä¸º0ï¼Œåé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º10ã€‚å‰©ä¸‹çš„æ²¡æœ‰æåŠçš„äºŒè¿›åˆ¶ä½ï¼Œå…¨éƒ¨ä¸ºè¿™ä¸ªç¬¦å·çš„unicodeç 
3. UTF-8å¯¹äºå­—èŠ‚çš„æ ¼å¼æœ‰ä¸¥æ ¼è¦æ±‚,å½“è§£ææŸä¸ªå­—ç¬¦å¤±è´¥æ—¶,ä½¿ç”¨<img src="https://cdn.jsdelivr.net/gh/che77a38/blogImage2//202311271632096.png" alt="image-20231127163227079" style="zoom: 50%;" />ä»£æ›¿(UTF-8ç¼–ç ä¸º`EF BF BD`)

| Unicodeç¬¦å·é›† | UTF-8(xè¡¨ç¤ºUnicodeç¬¦å·é›†)           |
| ------------- | ----------------------------------- |
| 0~7F          | 0xxxxxxx                            |
| 80~7FF        | 110xxxxx 10xxxxxx                   |
| 800~FFFF      | 1110xxxx 10xxxxxx 10xxxxxx          |
| 10000~10FFFF  | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

å› æ­¤å ç”¨1~4ä¸ªå­—èŠ‚éƒ½æœ‰å¯èƒ½

```
Aä¸­
41             	E4           	B8           	AD
0(100 0001)    	1110 (0100)		10(11 1000)		10(10 1101)
100 0001		0100			1110    0010	1101
4	1			4				E		2		D
A				ä¸­
```

æ•°æ®å¤§éƒ¨åˆ†æ˜¯è‹±æ–‡å­—ç¬¦çš„è¯é‡‡ç”¨UTF-8æ¯”è¾ƒå¥½ï¼Œä¸­æ–‡å¤šçš„è¯é‡‡ç”¨UTF-16æ¯”è¾ƒå¥½

ä¼˜ç¼ºç‚¹ï¼šæ‹†åˆ†è§£ææ…¢ï¼Œä½†èŠ‚çœç©ºé—´ï¼ˆå°¤å…¶æ˜¯ç½‘ç»œä¼ è¾“ï¼‰

**è·å–utf8å­—ç¬¦å­—èŠ‚æ•°çš„ä»£ç **

```cpp
// è·å–UTF-8å•å­—ç¬¦æ‰€å çš„å­—èŠ‚æ•°
int getUTF8CharSize(char ch) {
    if ((ch & 0xF8) == 0xF0) {
        return 4;
    } else if ((ch & 0xF0) == 0xE0) {
        return 3;
    } else if ((ch & 0xE0) == 0xC0) {
        return 2;
    } else {
        return 1;
    }
}
// å‡½æ•°ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºUTF-8å­—ç¬¦çš„èµ·å§‹å­—èŠ‚
bool isUTF8StartByte(char byte) {
    return (byte & 0xC0) != 0x80;
}
//è¿™æ®µä»£ç çš„å®ç°åŸç†æ˜¯ä½¿ç”¨ä½æ“ä½œæ¥åˆ¤æ–­ä¸€ä¸ªå­—èŠ‚æ˜¯å¦ä¸ºUTF-8å­—ç¬¦çš„èµ·å§‹å­—èŠ‚ã€‚
//UTF-8ç¼–ç ä½¿ç”¨ä¸åŒé•¿åº¦çš„å­—èŠ‚æ¥è¡¨ç¤ºä¸åŒçš„Unicodeå­—ç¬¦ã€‚ä¸€ä¸ªUTF-8å­—ç¬¦çš„èµ·å§‹å­—èŠ‚çš„æœ€é«˜ä½ä¸º0æˆ–ä»¥10å¼€å¤´çš„å­—èŠ‚ï¼Œè€Œåç»­å­—èŠ‚çš„æœ€é«˜ä½éƒ½ä¸º10ã€‚
//è¿™æ®µä»£ç ä¸­çš„ä½æ“ä½œ`(byte & 0xC0) != 0x80`ç”¨äºåˆ¤æ–­ä¸€ä¸ªå­—èŠ‚çš„æœ€é«˜ä¸¤ä½æ˜¯å¦æ»¡è¶³UTF-8å­—ç¬¦çš„èµ·å§‹å­—èŠ‚çš„æ¡ä»¶ã€‚
//å…·ä½“æ¥è¯´ï¼Œ`byte & 0xC0`ä¼šå°†å­—èŠ‚çš„æœ€é«˜ä¸¤ä½ä¿ç•™ï¼Œè€Œå…¶ä»–ä½éƒ½ç½®ä¸º0ã€‚ç„¶åï¼Œå°†ç»“æœä¸`0x80`è¿›è¡Œæ¯”è¾ƒï¼Œå³åˆ¤æ–­æœ€é«˜ä¸¤ä½æ˜¯å¦ä¸ç­‰äº`10`ã€‚
//å¦‚æœæœ€é«˜ä¸¤ä½ä¸ç­‰äº`10`ï¼Œåˆ™è¡¨ç¤ºè¯¥å­—èŠ‚æ˜¯UTF-8å­—ç¬¦çš„èµ·å§‹å­—èŠ‚ï¼Œå‡½æ•°è¿”å›`true`ã€‚å¦åˆ™ï¼Œè¡¨ç¤ºè¯¥å­—èŠ‚æ˜¯UTF-8å­—ç¬¦çš„åç»­å­—èŠ‚ï¼Œå‡½æ•°è¿”å›`false`ã€‚

// å‡½æ•°:ä»ä¸€ä¸ªstringç±»å‹å˜é‡ä¸­åˆ é™¤UTF-8å­—ç¬¦,è¿”å›è¦åˆ é™¤çš„å­—èŠ‚æ•°
int deleteUTF8Character(std::string& str) {
    if (str.empty()) {
        return 0;
    }
    int wantDelete = 0;
    // å‘å‰éå†å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°è¦åˆ é™¤çš„å­—ç¬¦çš„èµ·å§‹ä½ç½®
    int startPos = str.length() - 1;
    while (startPos > 0 && !isUTF8StartByte(str[startPos])) {
        startPos--;
        wantDelete++;
    }
    // åˆ é™¤å­—ç¬¦
    str.erase(startPos);
    return wantDelete+1;
}

//è®¡ç®—Stringç±»å‹ä¸­çš„utf8å­—ç¬¦æ•°
int countUTF8Characters(const std::string& str) {
    int count = 0;
    int length = str.length();
    for (int i = 0; i < length; ) {
        if ((str[i] & 0xC0) != 0x80) {//èµ·å§‹å­—èŠ‚
            count++;
        }
        i++;
    }
    return count;
}
```

[[STL#stringæ“ä½œutf8æ¡ˆä¾‹|macä¸Šstringæ“ä½œutf8ç¼–å†™æ¡ˆä¾‹]]

#### UTF-32

ä»»ä½•å…ƒç´ éƒ½æ˜¯4ä¸ªå­—èŠ‚ä¸ºå•ä½ã€‚

```
A					ä¸­
41 00 00 00			 2D 4E 00 00 
```

### BOMå­—èŠ‚é¡ºåºæ ‡è¯†

Byte Order Mark

æ–‡æœ¬æ–‡ä»¶çš„èµ·å§‹ä½ç½®å­˜è¿™å‡ ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå½“å‰æ–‡ä»¶é‡‡ç”¨ä»€ä¹ˆæ ¼å¼å­˜å‚¨

| å­˜å‚¨æ ¼å¼             | BOM         |
| -------------------- | ----------- |
| UTF-8                | EF BB BF    |
| UTF-16LEï¼ˆå°ç«¯å­˜å‚¨ï¼‰ | FF FE       |
| UTF-16BEï¼ˆå¤§ç«¯å­˜å‚¨ï¼‰ | FE FF       |
| UTF-32LE             | FF FE 00 00 |
| UTF-32BE             | 00 00 FE FF |

æ·»åŠ BOMå¤´

```cpp
std::ofstream ofs("d:\\Temp\\test.txt"); //æ–‡ä»¶æ˜¯utf8ç¼–ç 
char c1 = 0xEF;// ä»¿utf-8 BOMå¤´  ä¸‰å­—èŠ‚
char c2 = 0xBB;
char c3 = 0xBF;
ofs << c1 << c2 << c3;
```

[[QT]]ä¸­æ·»åŠ BOMå¤´æä¾›äº†å°è£…å¥½çš„å‡½æ•°

```cpp
QTextStream out(&data);
out.setCodec("UTF-8");
out.setGenerateByteOrderMark(true);
```

> ANSIå’ŒUTF8ä¹‹é—´çš„è½¬æ¢åŸç† å¿…é¡»é€šè¿‡UCS-2/UCS-4



# æ“ä½œç³»ç»Ÿå­—ç¬¦é›†

![ä¹±ç é—®é¢˜æ•™ç¨‹|720x360](https://www.bilibili.com/video/BV1TT411H7ca)

ç¼–è¯‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒ

- ç¼–è¯‘å™¨è½¬æ¢ç¨‹åºæºä»£ç æ—¶,æ‰€å¤„çš„ç¯å¢ƒæˆä¸º**ç¼–è¯‘ç¯å¢ƒ**(translation environment);
- ç¼–è¯‘åç¨‹åºæ‰§è¡Œæ—¶,æ‰€å¤„çš„ç¯å¢ƒç§°ä¸º**è¿è¡Œç¯å¢ƒ**(execution environment)

æºç å­—ç¬¦é›†å’Œæ‰§è¡Œå­—ç¬¦é›†

- **æºç å­—ç¬¦é›†**(the source character set)   æºç æ–‡ä»¶æ˜¯ä½¿ç”¨ä½•ç§ç¼–ç ä¿å­˜çš„
- **æ‰§è¡Œå­—ç¬¦é›†**(the execution character set) å¯æ‰§è¡Œç¨‹åºå†…ä¿å­˜çš„æ˜¯ä½•ç§ç¼–ç (ç¨‹åºæ‰§è¡Œæ—¶å†…å­˜ä¸­å­—ç¬¦ç¼–ç )

**æ“ä½œç³»ç»Ÿå­—ç¬¦é›†**

> é™¤windowså¹³å°å¤–å¤§éƒ¨åˆ†å…¶ä»–å¹³å°ï¼Œç¼–è¯‘å™¨é»˜è®¤ä½¿ç”¨çš„ç¼–ç éƒ½æ˜¯UTF-8ç¼–ç ï¼Œæœ€æ–°ç‰ˆæœ¬çš„Clangç¼–è¯‘å™¨åªæ”¯æŒUTF-8ç¼–ç 

- **windows**ä¸­æ–‡ç‰ˆé»˜è®¤é‡‡ç”¨gbkç¼–ç 
- **linux**é»˜è®¤é‡‡ç”¨utf-8ç¼–ç 

GCCç¼–è¯‘å™¨:

```cmake
-finput-charset æŒ‡å®šæºæ–‡ä»¶çš„ç¼–ç  (è‹¥ä¸æŒ‡å®š,é»˜è®¤æ˜¯UTF-8)
-fexec-charset æŒ‡å®šå¤šå­—èŠ‚å­—ç¬¦ä¸²(const char*)å¸¸é‡åœ¨ç¼–è¯‘åçš„ç¨‹åºé‡Œä¿å­˜çš„ç¼–ç é›†(è‹¥ä¸æŒ‡å®š,é»˜è®¤æ˜¯UTF-8)
-fwide-exec-charset æŒ‡å®šå®½å­—èŠ‚å­—ç¬¦ä¸²(const wchar_t*)å¸¸é‡åœ¨ç¼–è¯‘åçš„ç¨‹åºé‡Œçš„ä¿å­˜çš„ç¼–ç é›†
#QMAKEä¸­ä¸º:
QMAKE_CFLAGS += -finput-charset=utf-8 -fexec-charset=gbk
QMAKE_CXXFLAGS += -finput-charset=utf-8 -fexec-charset=gbk
```

clangç¼–è¯‘å™¨:

åŒä¸Šè®¾ç½®æ–¹å¼,ä½†ä¸æ”¯æŒè®¾å®šä¸ºgbk

VCCç¼–è¯‘å™¨:

> **VCC** æ˜¯æŒ‡ Visual C++ Compilerï¼Œå³ Visual Studio ä¸­çš„ C++ ç¼–è¯‘å™¨ã€‚MSVC æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬ç¼–è¯‘å™¨ã€é“¾æ¥å™¨ã€è°ƒè¯•å™¨ç­‰å·¥å…·ï¼Œç”¨äºå¼€å‘å’Œæ„å»º C++ ç¨‹åºã€‚VCC æ˜¯ MSVC ä¸­çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£å°† C++ ä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ã€‚

```cmake
é¡¹ç›®çš„å±æ€§è®¾ç½® - C/C++ç¼–è¯‘å™¨é€‰é¡¹ - é™„åŠ é€‰é¡¹ ä¸­æ·»åŠ :/source-charset:utf-8å’Œ/execution-charset:utf-8
#QMAKEä¸­ä¸º:
QMAKE_CXXFLAGS += /source-charset:utf-8 /execution-charset:utf-8
#CMAKEä¸­ä¸º:
add_compile_options("$<$<CXX_COMPILER_ID:MSVC>:/source-charset:utf-8>") 
add_compile_options("$<$<CXX_COMPILER_ID:MSVC>:/execution-charset:utf-8>") 
```

## æ§åˆ¶å°

> windowsæ§åˆ¶å°å­—ç¬¦ç¼–ç ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿé»˜è®¤çš„ç¼–ç ï¼Œå¯ä»¥é€šè¿‡`chcp`å‘½ä»¤æŸ¥çœ‹ã€‚å¦‚æœæ§åˆ¶å°çš„ç¼–ç ä¸æ˜¯UTF-8(å¯¹åº”ç¼–ç ï¼š65001)ï¼Œæ˜¾ç¤ºUTF-8å­—ç¬¦ä¸²ä¼šå‡ºç°ä¹±ç ï¼Œå¯é€šè¿‡`chcp 65001`å‘½ä»¤ä¿®æ”¹æ§åˆ¶å°çš„ç¼–ç ï¼Œä»è€Œæ­£å¸¸æ˜¾ç¤ºUTF-8å­—ç¬¦ä¸²ã€‚

[[macåŠlinux_C++ç¯å¢ƒ#windowsä¸‹çš„vscodeç»ˆç«¯ä¹±ç |windowsä¸‹çš„vscodeç»ˆç«¯ä¹±ç è§£å†³]]

# å­—ç¬¦é›†è½¬æ¢

> å¦‚æœç¨‹åºéœ€è¦åœ¨å¤šä¸ªå¹³å°ç¼–è¯‘è¿è¡Œï¼Œåˆ™ä»£ç å¿…é¡»ä½¿ç”¨UTF-8ã€‚ä½¿ç”¨UTF-8å¯ä»¥æ›´å®¹æ˜“çš„åœ¨å¤šå­—èŠ‚å­—ç¬¦ä¸²(char*, std::string)å’Œå®½å­—ç¬¦(wchar_t* std::wstringï¼‰ç›´æ¥è½¬æ¢ï¼Œæ›´å®¹æ˜“é¿å…ç¨‹åºä¹±ç ï¼Œä¸­æ–‡è·¯å¾„é”™è¯¯ç­‰é—®é¢˜ã€‚

 C++11 ä¸­å¼•å…¥çš„ `char16_t` å’Œ `char32_t` 

ä¸»è¦ä½¿ç”¨C++11å¼•å…¥çš„wstring_convertå’Œcodecvtç›¸ç»“åˆè¿›è¡Œè½¬æ¢ã€‚ä½†ä¼¼ä¹åœ¨C++17é­åˆ°åºŸå¼ƒ

## windowsä¸‹å¸¸ç”¨è½¬ç éœ€æ±‚

> ä¸‹é¢çš„ä»£ç åœ¨windowsä¸Šå®Œç¾è¿è¡Œï¼ˆlinuxè½¬ç éœ€æ±‚å°ï¼‰ã€‚GBKåœ¨linuxä¸‹çš„localeåå¯èƒ½æ˜¯"zh_CN.GBK"ï¼Œè€Œwindowsä¸‹æ˜¯".936"ï¼‰ï¼Œå› æ­¤åšè·¨å¹³å°çš„è¯ä»ç„¶è¦ç»™ä¸åŒçš„ç³»ç»Ÿåšé€‚é…
>

### utf8çš„å®½çª„å­—ç¬¦è½¬æ¢

- **std::string è½¬ä¸º std::wstring**

  ```cpp
  std::wstring utf8_to_wstr(const std::string& src)
  {
      std::wstring_convert<std::codecvt_utf8<wchar_t>> converter;
      return converter.from_bytes(src);
  }
  ```

  æ³¨æ„ï¼šä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™éœ€è¦æ±‚std::stringçš„ç¼–ç æ˜¯utf-8ï¼Œä¸ç„¶ä¼šæŠ›å¼‚å¸¸ã€‚

- **std::wstringè½¬ä¸ºstd::string**

  ```cpp
  std::string wstr_to_utf8(const std::wstring& src)
  {
      std::wstring_convert<std::codecvt_utf8<wchar_t>> convert;
      return convert.to_bytes(src);
  }
  ```

### utf8ä¸gbkäº’è½¬

ä¸‹é¢utf-8å’Œgbkäº’è½¬çš„ä»£ç ï¼Œéƒ½æ˜¯å…ˆè½¬åŒ–ä¸º`std::wstring`çš„ï¼Œæˆ‘ä»¬å¯ä»¥å†æ‹†åˆ†ã€‚å¾—åˆ°std::wstringå’Œgbkäº’è½¬ã€‚

#### utf-8è½¬gbk

```cpp
std::string utf8_to_gbk(const std::string& str)
{
    std::wstring_convert<std::codecvt_utf8<wchar_t> > conv;
    std::wstring tmp_wstr = conv.from_bytes(str);
 
    //GBK locale name in windows
    const char* GBK_LOCALE_NAME = ".936";
    std::wstring_convert<std::codecvt_byname<wchar_t, char, mbstate_t>> convert(new std::codecvt_byname<wchar_t, char, mbstate_t>(GBK_LOCALE_NAME));
    return convert.to_bytes(tmp_wstr);
}
```

#### gbkè½¬utf-8

```cpp
std::string gbk_to_utf8(const std::string& str)
{
    //GBK locale name in windows
    const char* GBK_LOCALE_NAME = ".936";
    std::wstring_convert<std::codecvt_byname<wchar_t, char, mbstate_t>> convert(new std::codecvt_byname<wchar_t, char, mbstate_t>(GBK_LOCALE_NAME));
    std::wstring tmp_wstr = convert.from_bytes(str);
 
    std::wstring_convert<std::codecvt_utf8<wchar_t>> cv2;
    return cv2.to_bytes(tmp_wstr);
}
```

### gbkçš„å®½çª„å­—ç¬¦äº’è½¬

- **std::string è½¬ä¸º std::wstring**

  ```cpp
  std::wstring gbk_to_wstr(const std::string& str)
  {
      //GBK locale name in windows
      const char* GBK_LOCALE_NAME = ".936";
      std::wstring_convert<std::codecvt_byname<wchar_t, char, mbstate_t>> convert(new std::codecvt_byname<wchar_t, char, mbstate_t>(GBK_LOCALE_NAME));
      return convert.from_bytes(str);
  }
  ```

- **std::wstringè½¬ä¸ºstd::string**

  ```cpp
  std::string wstr_to_gbk(const std::wstring& wstr)
  {
      // GBK locale name in Windows
      const char* GBK_LOCALE_NAME = ".936";
      std::wstring_convert<std::codecvt_byname<wchar_t, char, mbstate_t>> convert(new std::codecvt_byname<wchar_t, char, mbstate_t>(GBK_LOCALE_NAME));
      return convert.to_bytes(wstr);
  }
  ```

ä¸¤ä¸ªæ¯”è¾ƒå¥½çš„ä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“åˆ†åˆ«æ˜¯ [UTF8-CPP](http://utfcpp.sourceforge.net/)ä»¥åŠ[Boost.Locale](http://www.boost.org/doc/libs/1_51_0/libs/locale/doc/html/index.html)ã€‚

## UTF8å’ŒUTF16äº’è½¬

```cpp
#include <string>
#include <codecvt>
#include <locale>
#include <iostream>
 
std::u16string to_utf16( std::string str ) // utf-8 to utf16
{ return std::wstring_convert< std::codecvt_utf8_utf16<char16_t>, char16_t >{}.from_bytes(str); }
 
std::string to_utf8( std::u16string str16 ) // utf-16 to utf8
{ return std::wstring_convert< std::codecvt_utf8_utf16<char16_t>, char16_t >{}.to_bytes(str16); }
```

æ®ç§°ä¸Šé¢åœ¨C++17è¢«åºŸå¼ƒäº†

è½¬è€Œ:

```cpp
//c++17
#include <iostream>
#include <codecvt>
#include <locale>

std::u16string to_utf16(const std::string& str) // UTF-8 to UTF-16
{
    std::wstring_convert<std::codecvt_utf8_utf16<char16_t>, char16_t> convert;
    return convert.from_bytes(str);
}

std::string to_utf8(const std::u16string& str16) // UTF-16 to UTF-8
{
    std::wstring_convert<std::codecvt_utf8_utf16<char16_t>, char16_t> convert;
    return convert.to_bytes(str16);
}

int main()
{
    std::string utf8Str = u8"Hello, ä½ å¥½";
    std::u16string utf16Str = to_utf16(utf8Str);
    std::string convertedUtf8Str = to_utf8(utf16Str);

    std::cout << "Original UTF-8: " << utf8Str << std::endl;
    std::cout << "Converted UTF-16: ";
    for (char16_t c : utf16Str) {
        std::cout << std::hex << static_cast<int>(c) << " ";
    }
    std::cout << std::endl;
    std::cout << "Converted back to UTF-8: " << convertedUtf8Str << std::endl;

    return 0;
}
```

# Cè¯­è¨€ä¸­çš„å®½å­—ç¬¦

## å®½å­—ç¬¦ç±»å‹

- charï¼šå¤šå­—èŠ‚å­—ç¬¦ç±»å‹
- wchar_tï¼šå®½å­—ç¬¦ç±»å‹  

> `wchar_t` åœ¨windowsæ˜¯ 16 ä½ï¼Œè€Œåœ¨linuxä¸Šæ˜¯ 32 ä½ã€‚è¿™ä½¿å¾—ç§»æ¤å˜å¾—å›°éš¾ã€‚linuxå¹³å°çš„std::wstringå°±æ˜¯std::u32string, wchar_t å°±æ˜¯char32_t (utf-32ç¼–ç )

```cpp
char szStr[]="ä¸­å›½";//ä½¿ç”¨çš„æ˜¯ANSIç¼–ç  D6 D0 B9 FA 00 (ä¸€ä¸ªå­—èŠ‚çš„é›¶è¡¨ç¤ºç»“å°¾)
wchar_t sezStr[]=L"ä¸­å›½";//ä½¿ç”¨çš„æ˜¯UTF-16ç¼–ç  2D 4E FD 56 00 00(ä¸¤ä¸ªå­—èŠ‚çš„0è¡¨ç¤ºç»“å°¾)
//Lçš„æ„æ€æ˜¯è®©ç¼–è¯‘å™¨å­˜å‚¨è¯¥å­—ç¬¦ä¸²çš„æ—¶å€™æŒ‰ç…§UTF-16æ¥å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ç¼–è¯‘å™¨é€‰é¡¹è®¾ç½®é»˜è®¤å­˜å‚¨æ ¼å¼ä¸ºUTF-16ï¼Œå°±ä¸éœ€è¦å†™è¿™ä¸ªLäº†
```

## å­—ç¬¦å¸¸ç”¨å‡½æ•°

ä½¿ç”¨çš„å‡½æ•°ç‰ˆæœ¬æ ¹æ®ç¼–ç ä¸åŒä¹Ÿè¢«æä¾›äº†ä¸¤å¥—

| å¤šå­—èŠ‚å­—ç¬¦å‡½æ•° | å®½å­—ç¬¦å‡½æ•° | ä½œç”¨             |
| -------------- | ---------- | ---------------- |
| printf         | wprintf    | æ‰“å°åˆ°æ§åˆ¶å°å‡½æ•° |
| strlen         | wcslen     | è·å–é•¿åº¦         |
| strcpy         | wcscpy     | å­—ç¬¦ä¸²å¤åˆ¶       |
| strcat         | wcscat     | å­—ç¬¦ä¸²æ‹¼æ¥       |
| strcmp         | wcscmp     | å­—ç¬¦ä¸²æ¯”è¾ƒ       |
| strstr         | wcsstr     | å­—ç¬¦ä¸²æŸ¥æ‰¾åŠŸèƒ½   |

===

ä¸‹é¢æ˜¯Windowså®šä¹‰çš„ä¸€ç»„å­—ç¬¦ä¸²å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ç”¨æ¥è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ã€å¤åˆ¶å­—ç¬¦ä¸²ã€è¿æ¥å­—ç¬¦ä¸²å’Œæ¯”è¾ƒå­—ç¬¦ä¸²ï¼š

```cpp
ILength = lstrlen (pString) ;
        
pString = lstrcpy (pString1, pString2) ;
        
pString = lstrcpyn (pString1, pString2, iCount) ;
        
pString = lstrcat (pString1, pString2) ;
        
iComp = lstrcmp (pString1, pString2) ;
        
iComp = lstrcmpi (pString1, pString2) ;
```

è¿™äº›å‡½æ•°ä¸Cé“¾æ¥åº“ä¸­å¯¹åº”çš„å‡½æ•°åŠŸèƒ½ç›¸åŒã€‚å¦‚æœå®šä¹‰äº†UNICODEæ ‡è¯†ç¬¦ï¼Œé‚£ä¹ˆè¿™äº›å‡½æ•°å°†æ¥å—å®½å­—ç¬¦ä¸²ï¼Œå¦åˆ™åªæ¥å—å¸¸è§„å­—ç¬¦ä¸²ã€‚å®½å­—ç¬¦ä¸²ç‰ˆçš„lstrlenWå‡½æ•°å¯åœ¨Windows 98ä¸­æ‰§è¡Œã€‚

## è®¾ç½®å­—é¢é‡çš„ç¼–ç æ–¹å¼

> C++11 æ ‡å‡†å¼•å…¥äº†åŸå§‹å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆRaw String Literalï¼‰å’Œ Unicode å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆUnicode String Literalï¼‰çš„è¯­æ³•ï¼Œå…¶ä¸­ u"" ç”¨äºè¡¨ç¤º Unicode å­—ç¬¦ä¸²å­—é¢é‡ã€‚è¿™ç§æ ¼å¼å…è®¸åœ¨å­—ç¬¦ä¸²ä¸­ç›´æ¥ä½¿ç”¨ Unicode å­—ç¬¦ï¼Œè€Œæ— éœ€è¿›è¡Œè½¬ä¹‰æˆ–ä½¿ç”¨ç‰¹æ®Šçš„ç¼–ç æ–¹å¼

å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆstring literalsï¼‰å‰é¢å¯ä»¥åŠ ä¸Šä¸åŒçš„å‰ç¼€æ¥è¡¨ç¤ºä¸åŒçš„å«ä¹‰ã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å­—ç¬¦ä¸²å­—é¢é‡å‰ç¼€åŠå…¶å«ä¹‰ï¼š

- `L` å‰ç¼€ï¼šè¡¨ç¤ºå®½å­—ç¬¦ï¼ˆwide characterï¼‰å­—ç¬¦ä¸²ã€‚å®½å­—ç¬¦å­—ç¬¦ä¸²æ˜¯ç”± wchar_t ç±»å‹è¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦å ç”¨ 2 ä¸ªå­—èŠ‚ã€‚ä¾‹å¦‚ï¼Œ`L"Hello"` è¡¨ç¤ºä¸€ä¸ªç”±å®½å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚
- `u8` å‰ç¼€ï¼šè¡¨ç¤º UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚UTF-8 æ˜¯ä¸€ç§å¯å˜é•¿åº¦çš„ Unicode ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å ç”¨ 1 åˆ° 4 ä¸ªå­—èŠ‚ã€‚ä¾‹å¦‚ï¼Œ`u8"ä½ å¥½"` è¡¨ç¤ºä¸€ä¸ªç”± UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚
- `u` å‰ç¼€ï¼šè¡¨ç¤º Unicode(UTF-16) ç¼–ç çš„å­—ç¬¦ä¸²ã€‚Unicode ç¼–ç æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„å­—ç¬¦ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å ç”¨ 2æˆ–4 ä¸ªå­—èŠ‚ã€‚ä¾‹å¦‚ï¼Œ`u"ã“ã‚“ã«ã¡ã¯"` è¡¨ç¤ºä¸€ä¸ªç”± Unicode ç¼–ç çš„å­—ç¬¦ä¸²ã€‚
- `U` å‰ç¼€ï¼šè¡¨ç¤º UTF-32 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚UTF-32 æ˜¯ä¸€ç§å›ºå®šé•¿åº¦çš„ Unicode ç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦å ç”¨ 4 ä¸ªå­—èŠ‚ã€‚ä¾‹å¦‚ï¼Œ`U"ğŸŒ"` è¡¨ç¤ºä¸€ä¸ªç”± UTF-32 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚
- `R` å‰ç¼€ï¼šè¡¨ç¤ºåŸå§‹å­—ç¬¦ä¸²ï¼ˆraw stringï¼‰ã€‚åŸå§‹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ä¸ä¼šè¢«è½¬ä¹‰ï¼Œå¯ä»¥ç›´æ¥åŒ…å«åœ¨å­—ç¬¦ä¸²ä¸­ã€‚ä¾‹å¦‚ï¼Œ`R"(C:\Windows\System32)"` è¡¨ç¤ºä¸€ä¸ªåŒ…å«åæ–œæ çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸éœ€è¦å¯¹åæ–œæ è¿›è¡Œè½¬ä¹‰ã€‚





